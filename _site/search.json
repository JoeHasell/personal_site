[
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html",
    "title": "Joe Hasell",
    "section": "",
    "text": "fix newline in minified js file #780"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-1",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-1",
    "title": "Joe Hasell",
    "section": "2.33.2",
    "text": "2.33.2\n\nBugfix\n\nfix scroll to bottom #777"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-2",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-2",
    "title": "Joe Hasell",
    "section": "2.33.1",
    "text": "2.33.1\n\nBugfix\n\nfix padding removed by minifier"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-3",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-3",
    "title": "Joe Hasell",
    "section": "2.33.0",
    "text": "2.33.0\n\nFeatures\n\nadd a color and background attributes to the font tag in the xml formatter\nadd terminal-none animation\nallow to easily change border-radius on terminal #766\nadd clear_cache to cmd ### Bugfix\nfix flicker of dynamic prompt on enter #757\nfix re-rendering of jQuery/DOM nodes #759\nfix regression in less + images\nfix embedding the Terminal inside SVG #744\nfix when the login function is not async\nfix calling login_name in dynamic prompt\nfix masking command on typing animation #770\nfix selection/click on text that was echo without newline (when prompt is still in same line)\nfix exception when outputLimit is used #776\nfix showing links for emails like prompt #768\nfix line wrapping when text between formatting have brackets #772"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-4",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-4",
    "title": "Joe Hasell",
    "section": "2.32.1",
    "text": "2.32.1\n\nBugfix\n\nleading spaces with echo + keepWords #754\nfix loading hidden terminal"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-5",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-5",
    "title": "Joe Hasell",
    "section": "2.32.0",
    "text": "2.32.0\n\nFeatures\n\nadd insert typing animation\nadd --text-shadow css variable\nnew API method parse_formatting\nallow to use terminal style of external element #731 ### Bugfix\nfix calculating number of rows (affecting less command)\nfix glow with prism and error messages #729\nfix prism and typing animation #726\nfix various TypeScript typing errors\nfix spacing between lines\nfix wrong mouse cursor on terminal cursor and character before\nfix catastrophic reflow when executing hundreds of echos in a loop\nfix empty lines in prompt (visible when using typing animation) #734\nfix trimming whitespace with echo keep_words #738\nfix JSON working on processing nested formatting with html entities #735\nfix echo array of numbers #747\nimprove performance when terminal don’t have height\nfix partial text (echo without newline) rendering #751"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-6",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-6",
    "title": "Joe Hasell",
    "section": "2.31.1",
    "text": "2.31.1\n\nBugfix\n\nfixing low severity self XSS with potential more security implications #727"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-7",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-7",
    "title": "Joe Hasell",
    "section": "2.31.0",
    "text": "2.31.0\n\nBreaking\n\nremove undocumented echo_command (that was used by old echo_newline extension) ### Features\nscroll to bottom for each line in multiline typing animation\nallow to use --glow: 1 with default animation\nnew API terminal::enter same as echo_command but supports animation\nadd global option execAnimationDelay default - 100\nmake execAnimation work only with execHash #723 ### Bugfix\nfix prompt that return string or promise (in animation and set_prompt) #724\nfix formatting in typing animation #721\nfix formatting colors and --glow #725\nfix record stop command being recorded #719"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-8",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-8",
    "title": "Joe Hasell",
    "section": "2.30.2",
    "text": "2.30.2\n\nBugfix\n\nfix animated exec array with sync commands #722"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-9",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-9",
    "title": "Joe Hasell",
    "section": "2.30.1",
    "text": "2.30.1\n\nBugfix\n\nfix record built-in commands in URL hash"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-10",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-10",
    "title": "Joe Hasell",
    "section": "2.30.0",
    "text": "2.30.0\n\nFeatures\n\nadd span to xml formatting\nallow to use class attribute in XML formatting (span, link, and img)\nnew API methods clear_buffer() and get_output_buffer() #717 ### Bugfix\nfix bug on Android with GBoard keyboard #693\nfix refresh when scrollbar appear (using scrollbar-gutter)\nfix link color to pass WCAG contrast ratio\nremove tabindex attribute on links\nadd label to clipboard textarea for a11y\nallow to escape angle brackets in XML formatting #710\nfix black line before the image #708\nfix scroll to bottom when echo an image #716\nfix multiple echo with !flush && !newline #709\nfix updating hash for long async commands #703"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-11",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-11",
    "title": "Joe Hasell",
    "section": "2.29.5",
    "text": "2.29.5\n\nBugfix\n\nfix empty prompt when no wcwidth is included"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-12",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-12",
    "title": "Joe Hasell",
    "section": "2.29.4",
    "text": "2.29.4\n\nBugfix\n\nfix empty lines when print single multi-line string"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-13",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-13",
    "title": "Joe Hasell",
    "section": "2.29.3",
    "text": "2.29.3\n\nBugfix\n\nfix echo raw interfering with echo without newline #695\nupdate hash with proper array if hash is escaped\ninvalidate cache and update CMD on term::refresh() #699\nallow to add horizontal scrollbar with single wrap options #692\nhandle promise rejection in onInit #691"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-14",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-14",
    "title": "Joe Hasell",
    "section": "2.29.2",
    "text": "2.29.2\n\nBugfix\n\nfix linkify of urls (better url detection)\nfix linkify urls in command line (enable link in cmd)\nfix two bugs with echo without newline (when prompt have 0 width and lines have different length)\nfix applying glow shadow to transparent text\nfix async responsive greetings\nfix multiple echo of async functions and promises mixed with strings\nfix get_output() on lines that are promises #687\nfix echo newline when one of the values is promise or function\nfix invalid css when partial output is no longer partial\nadd padding to terminal size i term::geometry() #686\nclear extended commands from view when calling import_view #690"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-15",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-15",
    "title": "Joe Hasell",
    "section": "2.29.1",
    "text": "2.29.1\n\nBugfix\n\nremove all: unset CSS that was breaking resizing events and visibility of textarea"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-16",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-16",
    "title": "Joe Hasell",
    "section": "2.29.0",
    "text": "2.29.0\n\nBreaking\n\nremove undocumented <large>/<big>/<wide> and add <font> tag to XML formatter ### Feature\nadd animation to exec and execAnimation option #679\nadd warning when calling invoke_key on disabled terminal #678\nif interpreter returns a promise and it’s animating the terminal will not pause (for exec array)\nallow to use brackets inside extended commands (e.g. JavaScript code to hide commands)\nexpose $.terminal.xml_formatter.tags\nadd --glow conditional hack ### Bugfix\ntweak types for cmd function prompt\nfix broken order of execution in exec when using pause/resume\nfix mixing extended commands and terminal formatting\nfix invoking get_command() in interpreter (clear command after user action)\nfix parse_command when command have leading spaces #681"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-17",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-17",
    "title": "Joe Hasell",
    "section": "2.28.1",
    "text": "2.28.1\n\nBugfix\n\nfix applying style of text-decoration (e.g. underline)\nfix using custom font in Canvas animations"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-18",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-18",
    "title": "Joe Hasell",
    "section": "2.28.0",
    "text": "2.28.0\n\nBreaking\n\nnested_formatting inherit styles by default ### Feature\nadd forms extension #610\nrewrite xml_formatter and add new tags\nadd animation interface #611\nuse dash - as input file to read from STDIN in from-ansi executable\nimprove auth error message\nadd “enter” typing animation with prefix prompt\nallow to render ansi in less correctly (using ansi option) ### Bugfix\nfix rest of the extension files in NodeJS (regression since 2.22.0)\nfix inheritance of attributes (including styles) and classes in nested formatting\nfix echo and prompt with animation (using typing options)\nfix empty prompt\ndisable keyboard on typing animation\nfix resizing when using default cache #677"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-19",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-19",
    "title": "Joe Hasell",
    "section": "2.27.1",
    "text": "2.27.1\n\nBugfix\n\nfix from_ansi and add option --ansi -a"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-20",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-20",
    "title": "Joe Hasell",
    "section": "2.27.0",
    "text": "2.27.0\n\nFeature\n\nadd CSS and option ansi to echo to properly render ANSI art\nadd typing animation to set_prompt #673\nreturn promise from set_prompt and echo when using typing animation\nadd from_ansi executable #670\nnew emoji ### Bugfix\nfix bug in cache (when echo same string two times in a row) #672\nfix exception when calling term::echo with typing animation\nfix regression in width (chess demo)\nfix usage in NodeJS (regression since 2.22.0)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-21",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-21",
    "title": "Joe Hasell",
    "section": "2.26.0",
    "text": "2.26.0\n\nFeature\n\nBetter API for prompt typing animation with term::read and term::echo ### Bugfix\nfix return value from JSON-RPC (ignore only null)\nfix missing TypeScript definitions for typing API method\nfix multi-line prompt regression\nremove extra space after prompt animation\nfix echo string with newline at the end and with newline == false and refresh\nfix $.rpc helper on Ajax error\nadd default useCache option & TypeScript definition\nfix regression in text selection over prompt with fontawesome (Chrome bug #1087787)\nfix cutting off underscore in certain sizes of the terminal"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-22",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-22",
    "title": "Joe Hasell",
    "section": "2.25.1",
    "text": "2.25.1\n\nBugfix\n\nfix wrong auth tokens when using exec to login\nfix exec array for async login\nfix Auth to nested RPC interpreter without system.describe\ndon’t echo falsy values from RPC"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-23",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-23",
    "title": "Joe Hasell",
    "section": "2.25.0",
    "text": "2.25.0\n\nFeatures\n\nadd new API $.rpc for JSON-RPC requests ### Bugfix\nproperly handle promise rejection in login\nfix re executing extended commands on resize #666\nfix rendering jQuery object with Canvas #664\nfix right mouse click on link to not scroll to cursor #644"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-24",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-24",
    "title": "Joe Hasell",
    "section": "2.24.0",
    "text": "2.24.0\n\nFeatures\n\nadd terminal::typing API method\nadd --font custom property #662\nadd alt tag to images from formatting #661\nimprove command parser #657 ### Bugfix\nfix TypeScript types for echo with promises #658"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-25",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-25",
    "title": "Joe Hasell",
    "section": "2.23.2",
    "text": "2.23.2\n\nBugfix\n\nfix regression in scroll to view mechanism (that cause scroll up randomly)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-26",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-26",
    "title": "Joe Hasell",
    "section": "2.23.1",
    "text": "2.23.1\n\nBugfix\n\nfix reversed class in cmd (e.g. in less command)\nfix hack to reflow the cursor in Firefox from #654"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-27",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-27",
    "title": "Joe Hasell",
    "section": "2.23.0",
    "text": "2.23.0\n\nFeatures\n\ninclude echo without newline into the core of the library ### Bugfix\nremove unsafe eval (function constructor) that breaks CSP #647\nfix up/down arrow when prompt is empty string 651\nfix prompt containing brackets #648\nfix ANSI Art (add saving and restoring cursor using ANSI escape code)\nfix mouse wheel and touch scroll in less when content is smaller than height of the terminal\nfix regression in copy/paste with right click"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-28",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-28",
    "title": "Joe Hasell",
    "section": "2.22.0",
    "text": "2.22.0\n\nFeatures\n\nmake unix formatting and basic tools work in web worker ### Bugfix\nfix scrolling whole page when using mouse wheel in less\nfix some missing cp_437 characters for ANSI Art\nfix usage as bookmarklet on StackOverflow (force css of textarea)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-29",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-29",
    "title": "Joe Hasell",
    "section": "2.21.0",
    "text": "2.21.0\n\nFeatures\n\nadd wrap and keepWords option to less #641\nadd new method term::geometry to the API #637 ### Bugfix\nfix parsing JSON code inside strings #642"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-30",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-30",
    "title": "Joe Hasell",
    "section": "2.20.2",
    "text": "2.20.2\n\nBugfix\n\nfix bold background and default color in Unix formatting (another ANSI artwork issue)\nfix rendering 0x1E in ANSI art\nfix when browser don’t have ES6 Map object #630\nfix echo_newline extension\nfix handling of blink in ANSI Art\nfix error in prism when calling without options and render flags (e.g.: echo or prompt)\nfix background color for links that have set background using formatting\nfix empty cursor on Windows when copy/paste #634"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-31",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-31",
    "title": "Joe Hasell",
    "section": "2.20.1",
    "text": "2.20.1\n\nBugfix\n\nfix async synchronization of async functions and normal echo\nfix exception when executing empty command with pipe\nfix serialization of commands when using pipe operator and function interpreter\nfix exception in terminal::destroy"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-32",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-32",
    "title": "Joe Hasell",
    "section": "2.20.0",
    "text": "2.20.0\n\nBreaking\n\nset_interpreter return a promise instead of terminal instance ### Features\nadd support for echo async functions #629\nallow to run exec using onInit that will use pipe #603 ### Bugfix\nfix silent error when executing empty command from hash\nwith issues with browser that don’t support css variables #630\nfix exception in IE from formatters #631"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-33",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-33",
    "title": "Joe Hasell",
    "section": "2.19.1/2.19.2",
    "text": "2.19.1/2.19.2\n\nBugfix\n\nfix prism highlighting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-34",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-34",
    "title": "Joe Hasell",
    "section": "2.19.0",
    "text": "2.19.0\n\nFeatures\n\nadd support blink ANSI escape (unix_formatting)\nnew unix formatting API options, ansiArt option change behavior of blinking ### Bugfix\nfix prism when page have color set on span\nfix visible textarea when global css set background image\nfix exception delete_word_forward (ALT+D) delete_word_backward (CTRL+W)\nfix page scrolling on enter when terminal don’t have scrollbar\nfix ANSI Art #622 (unix formatting)\nfix empty echo in CTRL+D #626"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-35",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-35",
    "title": "Joe Hasell",
    "section": "2.18.3",
    "text": "2.18.3\n\nBugfix\n\nfix jumping to cursor position on mobile (with code)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-36",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-36",
    "title": "Joe Hasell",
    "section": "2.18.2",
    "text": "2.18.2\n\nBugfix\n\nfix when page use line-height on body"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-37",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-37",
    "title": "Joe Hasell",
    "section": "2.18.1",
    "text": "2.18.1\n\nBugfix\n\nfix glitches in history navigation (visible when using multiline commands in history)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-38",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-38",
    "title": "Joe Hasell",
    "section": "2.18.0",
    "text": "2.18.0\n\nFeatures\n\nnew API to use renderHandler with update\nnew API (apply_formatters function option) to pick where processing of formatting should work #588\nallow to toggle formatters in prism (enabled by default only for echo and command)\nescape slash in escape_formatting/escape_brackets #605\nadd support for rgb(a) and hsl(a) colors #590\nunify Firefox and Webkit (chrome) custom scrollbars #607 ### Bugfix\nfix same cases of wrong calculated size of the character when –size is used #602\nadd custom scrollbar on Firefox\nfix colors of Webkit scrollbar\nfix renderHandler in update\nfix formatting in update - reusing options from echo\nfix normal return string from prompt\nfix pipe symbol inside strings #606\nfix spaces in images in less & text selection\nfix regresion in fontawesome icons\nfix inconsistency with emoji and wide characters in terminal and cmd\nfix rounding issue that cause exception in less when rendering images"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-39",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-39",
    "title": "Joe Hasell",
    "section": "2.17.6",
    "text": "2.17.6\n\nBugfix\n\nfix adding duplicated prism formatters #573\nfix inserting emoji using Windows 10 emoji picker\nfix position of textarea in multi line command (probably will affect IME or Emoji picker)\nmake jump to bottom on click only when terminal is not enabled #596\nfix init cmd plugin without terminal\nfix underscore cut off in Firefox (visible in signature)\nfix combined emoji characters and skin tone variations #598\nfix down arrow at when cursor at the end of broken line #601\nfix broken keymap inheritance in nested interpreters #615"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-40",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-40",
    "title": "Joe Hasell",
    "section": "2.17.5",
    "text": "2.17.5\n\nBugfix\n\nfix eating last bracket from split_equal #597\nfix false positive recursive echo error #593"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-41",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-41",
    "title": "Joe Hasell",
    "section": "2.17.4",
    "text": "2.17.4\n\nBugfix\n\nfix jumping on right click near bottom and/or right edge when terminal is not full screen\nfix double event fire on right mouse click\nfix scrollbar size in Chrome"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-42",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-42",
    "title": "Joe Hasell",
    "section": "2.17.3",
    "text": "2.17.3\n\nBugfix\n\nfix for font-family wildcard css rule\nfix cursor on scrollbar\nfix broken html with wide characters without formatting\nfix jumping to address bar on CTRL+L #587\nfix issue in less when only one image get rendered #583\nfix jumping on focus on mobile when terminal content scrolled down #572\nfix detecting iPad iOS 13as mobile #589\nfix return false from onPaste to disable insert from clipboard\nfix paste in command mode of less plugin #581\nfix jumping when click near bottom and/or right edge #592"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-43",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-43",
    "title": "Joe Hasell",
    "section": "2.17.2",
    "text": "2.17.2\n\nBugfix\n\nfix cursor on strings in prism"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-44",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-44",
    "title": "Joe Hasell",
    "section": "2.17.1",
    "text": "2.17.1\n\nBugfix\n\nfix regressions in text selection, cursor and CSS variables #584\nunify selection on font icons (fontawesome) and emoji"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-45",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-45",
    "title": "Joe Hasell",
    "section": "2.17.0",
    "text": "2.17.0\n\nFeatures\n\nnew CTRL+ARROW DOWN/UP shortcuts and ignore the multi line commands (change history) ### Bugfix\nfix ch unit bug for Firefox and IE #579\nfix broken emoji #578\nfix broken cursor navigation in Firefox #577\nfix default cursor color animation on color cmd from formatting (e.g. prism)\nfix font-awesome selection (partial - works only in Firefox)\nfix consistency of data-text attribute and span\nfix issue with split_equal when it swallow the line if the line had bracket at the end\nallow to use .emoji CSS in .raw output\nfix up/down on multi line command navigation when command have brackets and/or wrappings\nfix empty lines after wrapping in CMD when splitted line length == cols\nfix navigating of formatting when stacked formatters are used and one change length #580"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-46",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-46",
    "title": "Joe Hasell",
    "section": "2.16.1",
    "text": "2.16.1\n\nBugfix\n\nfix disappearing cursor when use up down arrow in multi line CMD #576\nfix broken color CSS variables #575\nfix swallowed escape bracket as input in CMD #574"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-47",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-47",
    "title": "Joe Hasell",
    "section": "2.16.0",
    "text": "2.16.0\n\nFeatures\n\nstyle of scrollbars in WebKit\nintegration with fontawesome icons added using formatting ### Bugfix\nfix version of widget.js"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-48",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-48",
    "title": "Joe Hasell",
    "section": "2.15.4",
    "text": "2.15.4\n\nBugfix\n\nfix jumping when you scrolled down the div terminal #565"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-49",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-49",
    "title": "Joe Hasell",
    "section": "2.15.3",
    "text": "2.15.3\n\nBugfix\n\nfix broken formatting in prism.js when processing brackets"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-50",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-50",
    "title": "Joe Hasell",
    "section": "2.15.2",
    "text": "2.15.2\n\nBugfix\n\nfix toggle keyboard on multiple terminals on same page\nfix jumping to prompt on press CTRL+C when terminal scrolled to top\ndon’t scroll to bottom when click on terminal that already in focus"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-51",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-51",
    "title": "Joe Hasell",
    "section": "2.15.1",
    "text": "2.15.1\n\nBugfix\n\nfix combination of mobile: focus, selection and touchscroll"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-52",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-52",
    "title": "Joe Hasell",
    "section": "2.15.0",
    "text": "2.15.0\n\nFeatures\n\nadd new API event touchscroll for mobile (use it in less) #556\nmobile paste #458\ncmd::clip API method used internally, mostly for mobile ### Bugfix\nfix vertical bar cursor animation on empty command line\nfix edge case while splitting the command line with formatting (better fix for #379)\nfix option parser when using minus or double minus as argument\nfix issue when wcwidth is added and there are no wide characters\nfix prism + wide characters (e.g. Chinese and Japanese inside strings)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-53",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-53",
    "title": "Joe Hasell",
    "section": "2.14.1",
    "text": "2.14.1\n\nBugfix\n\nfix empty rows size"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-54",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-54",
    "title": "Joe Hasell",
    "section": "2.14.0",
    "text": "2.14.0\n\nFeatures\n\nallow to return promise from renderHandler\nallow to extend the ansiParser in unix_formatting\nadd a way to to handle Sixel terminal image format #553\nimprove performance of cmd render when moving cursor\nimplement H cursor movement #553\nunix formatting ANSI character replacements modes ### Bugfix\nfix click on last line in multiline cmd #554\nfix selecting textarea content when selecting cmd\nfix possible loops in renderHandler\nfix parsing image REGEXes in less\nfix cmd cursor up/down with wrapping #557\nfix issue with prism (html language) and less\nfix left/right pagination in less, when not all lines are longer then cols\nfix CTRL+ARROWRIGHT #560\nfix urls inside formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-55",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-55",
    "title": "Joe Hasell",
    "section": "2.12.0",
    "text": "2.12.0\n\nFeatures\n\nimprove performance\nadd cache for formatting and processing lines\nbig improvements to less plugin re-rendering (e.g. when scrolling text with keyboard)\ncursor movement in unix formatting (virtual cursor not supported in cmd, because it make no sense) #553 ### Bugfix\nfix empty lines in less\nfix split_equal with keep works and formatting at the end.\nfix searching inside links in less"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#released-on-npm-as-2.11.1",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#released-on-npm-as-2.11.1",
    "title": "Joe Hasell",
    "section": "2.10.1 (released on npm as 2.11.1)",
    "text": "2.10.1 (released on npm as 2.11.1)\n\nBugfix\n\nfix glow effect of prompt when it don’t have formatting\nfix exec commands from echo\nfix echo formatting with newline and bracket at the end\nfix single wide character exception\nfix substring after string when string have bracket at the end #550\nfix images & style from formatters inside cmd #519"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-56",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-56",
    "title": "Joe Hasell",
    "section": "2.10.0",
    "text": "2.10.0\n\nFeature\n\nimprove performance by adding function $.terminal.partition\nallow to use force resize cmd::resize(true) (to update init command line with emoji)\nadd glow style #549 ### Bugfix\nfix throw/reject in async function/promise #546\nallow to return string from greetings function\nfix low level iterate_formatting function to handle html entities properly\nfix spacing of wider characters (Chinese/Japanese) in echo (to match cmd)\nfix jumping on right click #545\nfix selection on double click on cmd\nfix parse_options #547\nfix style of links with wcwidth #544\nfix copy of empty lines in output #548"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-57",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-57",
    "title": "Joe Hasell",
    "section": "2.9.0",
    "text": "2.9.0\n\nFeatures\n\nallow to return a promise from greetings function #531\ncall onClear before clear and allow to cancel #527\nnew renderHandler option #526\nallow to echo DOM nodes and jQuery objects #526\nhandle broken images in terminal and less (svg and error message respectively)\nterminal have terminal-less class when less runs\npipe extension monkey patch terminal like echo newline, and it allow to use standard interpreter (old API work the same). ### Bugfix\nfix links from formatters in cmd\nfix images from formatters in cmd #519\nfix less #522\nfix recursive error when echo finalize throwed exception #524\nfix prism - xml nested formatting and weird wrapping #523, #410\nlimit number of characters in click on exception line #525\nfix less search clear on resize #528\nfix less search second instance (move one line to bottom)\ndon’t delay backspace by default on Desktop + fix delay key check #532\nfix pipe when argument is pipe in quote echo \"|\"\nfix display_position (click on cmd) when using prism + unix formatting #533\nallow path in URL for links and images\nfix multiple issues with less plugin\nfew fixes to pipe\nfix echo array after refresh #540\nfix apply formatters in update #543\nfix pause on login when using callback #538"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-58",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-58",
    "title": "Joe Hasell",
    "section": "2.8.0",
    "text": "2.8.0\n\nFeature\n\nnew events onBeforeLogin, onAfterLogin, onBeforeEcho and onAfterEcho\ninherit of style in nesting formatter (with flag __inherit__ = true on nested_formatting) #513\nimage formatting (less with images #515)\nnew echo_command API method (for echo_newline default action)\nmobile delete disabled by default + option toggle #506 ### Bugfix\nadd missing onAfterCommand and onBeforeCommand to d.ts file\nfix Emoji #514\nfix nesting with prism formatter"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-59",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-59",
    "title": "Joe Hasell",
    "section": "2.7.1",
    "text": "2.7.1\n\nBugfix\n\nfix invoking methods by typing it into terminal #512\ndon’t remove extended command when using echo with exec: false"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-60",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-60",
    "title": "Joe Hasell",
    "section": "2.7.0",
    "text": "2.7.0\n\nBreaking/Feature\n\nall classes are prefixed with cmd or terminal except .token (PrimsJS internals) and .emoji (this may be feature that fix some bugs, that also may break user code - but it’s internal html structure and it’s not documented as API) #510 ### Bugfix\nfix issue with space in IE and Edge #507\nmultiple bracket escaping issues #505\nfix paste of images #505\nfix xml formatter in Prism (regression) #410"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-61",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-61",
    "title": "Joe Hasell",
    "section": "2.6.3",
    "text": "2.6.3\n\nBugfix\n\nfix mobile keypress invocation when no keypress (Android)\nfix sizing issue with underscores #501"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-62",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-62",
    "title": "Joe Hasell",
    "section": "2.6.2",
    "text": "2.6.2\n\nBugfix\n\nfix CTRL+C when terminal is not in focus (it should bypass enabled flag only when select text is inside terminal) #499\nfix keepWord option in echo of last line #497\nfix broken formatting in Prism #496"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-63",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-63",
    "title": "Joe Hasell",
    "section": "2.6.1",
    "text": "2.6.1\n\nBugfix\n\nfix sourcemaps\nfix prism + --size\nfix echo double slashes\nescape options to $.terminal.format (default to true - same behavior) to fix previous error"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-64",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-64",
    "title": "Joe Hasell",
    "section": "2.6.0",
    "text": "2.6.0\n\nFeatures\n\nnew option mobileIngoreAutoSpace to fix issue on Android when typing keys: , ) . (default empty array) ### Bugfix\nfix hold+backspace on command line with whitespace\nfix context menu on Firefox #494"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-65",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-65",
    "title": "Joe Hasell",
    "section": "2.5.2",
    "text": "2.5.2\n\nBugfix\n\nfix CTR+C when inside of single echo output is selected\nfix paste + key on Mac/Chrome #493"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-66",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-66",
    "title": "Joe Hasell",
    "section": "2.5.1",
    "text": "2.5.1\n\nBugfix\n\nfix 1px black space in style of selection after prism token\nadditional validate instead of just throw and capture JSON errors in format function (devtools improvement)\nfix typescript types for version 3.3.29 and freeze the version"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-67",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-67",
    "title": "Joe Hasell",
    "section": "2.5.0",
    "text": "2.5.0\n\nFeatures\n\nBetter API option doubleTabEchoCommand so you don’t need to call echo_command() function in doubleTab.\nnew API Cmd::column(boolean): number\nmoving cursor up down in multiline command (like in Chrome Dev tools) ### Bugfix\nfix wrong array detection in completion when array passed across iframes\nfix prism.js and emoji.js dependencies when run with webpack\nfix keepWord option for echo (iterate_formatting function that is called by split_equal) #491\nfix press key after hold different key #488\nfix echo empty line on longer lines (issue only happen in examples page in scheme inside dialog)\nfix for jQuery UI dialog visibility change detection\nfix hidden cursor in FireFox"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-68",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-68",
    "title": "Joe Hasell",
    "section": "2.4.1",
    "text": "2.4.1\n\nBugfix\n\nshow terminal content after it’s resized when initially not visible (fix jumping of text)\nfix pipe when using read + echo in first command and read in next\nfix issue with jumping of terminal on keypress #486\nfix hold key when key change fast (manifested by jumping to address bar on ALT+D) #485\nfix scroll page when terminal don’t have scrollbar #484\nfix issue with call .complete(['cd']); because of default “clear” (moved code outside of complete)\nfix Prism formatter when highlighted code have brackets\nfix few async prompt issues including #474"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-69",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-69",
    "title": "Joe Hasell",
    "section": "2.4.0",
    "text": "2.4.0\n\nFeatures\n\nimprovements to performance of rendering and navigating longer command lines\nCTRL+C now retain newlines inside cmd and terminal output (modern browsers only)\nmore control over server side calls by using invokeMethods option in echo\nwarn users when they try to complete commands with newlines and word complete is set ### Bugfix\nfix scrollbar flicker on right click on right/bottom edge of terminal when no scrollbar\nfix text selections on multi line text without line breaks\nfix small bugs in animations (replace all of them with box-shadow)\ndebounce HOLD+ARROWS (left/right) so they are usable again\nfix exception when completion characters not safe for regular exception"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-70",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-70",
    "title": "Joe Hasell",
    "section": "2.3.0",
    "text": "2.3.0\n\nFeatures\n\nadd experimental $.terminal.pipe function\nallow to return string from onPaste (not only a promise)\nadd CTRL+Home and CTRL+End keys + HOME and END move cursor to the end and beginning of the line #479\nzoom page when using mousewheel + CTRL key (browser default) #468\nallow to set attributes from formatting with filtering options (to prevent unwanted onclick or other attrs by echo untrusted text) #472 ### Bugfix\nfix selecting whole text of single .cmd line\nfix double call of async prompt with async interpreter #474\nfix async + RPC + exec + no system.describe #475\nfix describe === false (exception in js and typscript definition)\ndon’t pause terminal when user code return result of calling terminal::read()\nfix jumping while using up/down arrows #477 #478\nfix issue with echo brackets inside formatting when using unix formatting #470\nfix wrong &quote; entity in formatting tag data-text attribute (it should be &quot;)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-71",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-71",
    "title": "Joe Hasell",
    "section": "2.2.0",
    "text": "2.2.0\n\nFeatures\n\nHandle unclosed entities #462 ### Bugfix\ndon’t complete default commands as argument #465\ndon’t show links in echo command + format links inside formatting #464\nfix calling set_mask in onPop\nfix visibility change when terminal have position:fixed #466\necho without argument or with empty string - to create blank line #467"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-72",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-72",
    "title": "Joe Hasell",
    "section": "2.1.2",
    "text": "2.1.2\n\nBugfix\n\nremove bugfix for #402 that should never land in the code\nfix removing temp terminal (used to calculate char size)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-73",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-73",
    "title": "Joe Hasell",
    "section": "2.1.1",
    "text": "2.1.1\n\nBugfix\n\ndon’t apply emoji css inside .raw class (added by echo('string', {raw: true})) #461\nfix wrapping when using font-family wildcard css rule"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-74",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-74",
    "title": "Joe Hasell",
    "section": "2.1.0",
    "text": "2.1.0\n\nFeatures\n\ncursor glow animation\nadd invoke_key to cmd\nonPaste event\nintegrate emoji into terminal ### Bugfix\nfix wrapping when command have & and ; but it’s not entity #454\nfix wrapping when css style created using id #454\nfix calculating number of characters on init in bare cmd\nfix .inverted class #457\nfix background color on selection (when using –color)\nfix hidden bar cursor when command is empty\nfix copy terminal output to clipboard (newlines issue) #456\nremove weird space between lines of selection\nfix jumping of cursor with underline animation\nfix selection of command line\nfix error color when –color is used\nfix ANSI art issue #460"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-75",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-75",
    "title": "Joe Hasell",
    "section": "2.0.2",
    "text": "2.0.2\n\nBugfix\n\nfix ansi escapes in unix formatting for sequence 5;1;47m that fixes rendering ANSI art\nfix cutting of underline from ASCII art\nfix cutting ASCII art underscores in Codepen/Linux/Chromium on GNU/LINUX\nfix ascii_table when text have \nfix prism highlighting in echo (terminal rules were stronger than Prism)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-76",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-76",
    "title": "Joe Hasell",
    "section": "2.0.1",
    "text": "2.0.1\n\nBugfix\n\nfix focus to textarea or input that was printed using terminal echo function (reported as question on SO)\nfix cutting of bottom part of greetings lines in Firefox\nfix keep focus into cursor feature added in 2.0 (up arrow was causing scroll to top) report in firebase chat\ndon’t add empty string to history\nfix bottom padding in FireFox\ndon’t overwrite wildcard selector that change font with wildcard selector (reported by @ovk on gitter)\nfix return true in mousewheel it now disable JavaScript scrolling (reported by @ovk on gitter)\nfix size down to --size: 0.6"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-77",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-77",
    "title": "Joe Hasell",
    "section": "2.0.0",
    "text": "2.0.0\n\nBreaking\n\nfrom now on if terminal is added to body it’s in fact added to div inside body (the API didn’t changed) $('body').terminal().is('body'); will be false ### Features\nnew option repeatTimeoutKeys with default of HOLD+BACKSPACE that should have delay when deleting words\nuse setTimeout instead of alert to show exception that can be shown in terminal\nallow to move cursor when regex formatter don’t change length of the string\ndon’t style links if they don’t have href\nnew plugin isFullyInViewport (link to source in comment)\nscroll terminal to always view cursor in multiline command\nadd onPositionChange to option to terminal\nadd tabindex option to cmd and terminal ### Bugfix\nfix delay when using arrow keys by filtering keys that have delay when hold\nfix skipping lines that have emoji as last character inside formatting\nfix cursor over tab\nfix tracking replace for emoji and extra chars when adding formatting multiple times\nfix inconsistency of cursor on background formatting between Windows and Linux\nfix echo newline as first character of formatting\nfix slash as last character in formatting when generation command line with slash and cursor just after\nfix escape bracket in command line\nfix relative and absolute urls with default anyLinks: false\nfix android and iPhone issues #443 #414\nfix ANSI escapes in unix_formatting $444\nfix jumping cursor when there are no text before cursor line in Chrome\nfix selection menu in latest Android\nfix wrong number of chars per line when insert called after init and scrollbar appear\nfix missing cursor when init cmd plugin (without calling refresh)\nfix issue with function prompt not updating after resume"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-78",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-78",
    "title": "Joe Hasell",
    "section": "1.23.2",
    "text": "1.23.2\n\nBugfix\n\nfix too tall cursor (blink included underline)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-79",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-79",
    "title": "Joe Hasell",
    "section": "1.23.1",
    "text": "1.23.1\n\nBugfix\n\nfix cursor when terminal is empty"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-80",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-80",
    "title": "Joe Hasell",
    "section": "1.23.0",
    "text": "1.23.0\n\nFeatures\n\nES6 iterator helper that iterate over string that handle formatting, emoji and extra chars ### Bugfix\nfix tracking replace in Edge (missing RegExp::flags)\nhide textarea cursor in Edge and IE11\nfix cursor in Edge and almost IE11\nfix calculating prompt length (wrong wrapping because of first line count)\nuse setInterval as replacement for Intersection Observer when not supported (IE)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-81",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-81",
    "title": "Joe Hasell",
    "section": "1.22.6/7",
    "text": "1.22.6/7\n\nBugfix\n\nfix selection of command line"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-82",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-82",
    "title": "Joe Hasell",
    "section": "1.22.5",
    "text": "1.22.5\n\nBugfix\n\nfix issue with n command line and cursor position #436\nfix underline and bar animation after fix for prism\ndisable selecting artificial last character in line for cmd\nfix cursor animation on background for toggle animation dynamically"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-83",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-83",
    "title": "Joe Hasell",
    "section": "1.22.4",
    "text": "1.22.4\n\nBugfix\n\nfix cursor in prism when on token in next line"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-84",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-84",
    "title": "Joe Hasell",
    "section": "1.22.3",
    "text": "1.22.3\n\nBugfix\n\nreverse css animations so the prompt is visible when you hold key"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-85",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-85",
    "title": "Joe Hasell",
    "section": "1.22.2",
    "text": "1.22.2\n\nBugfix\n\npersistent function prompt don’t render on enable and on init\nfix duplicated line when prompt have more then one line\niterate_formatting to handle emoji like substring and split_equal"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-86",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-86",
    "title": "Joe Hasell",
    "section": "1.22.1",
    "text": "1.22.1\n\nBugfix\n\nfix broken jquery.terminal.js because after last change there was no build\nfix invocation in xml_formatting and dterm\nadd onCommandChange to defaults file so it’s picked up by dterm (update d.ts)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-87",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-87",
    "title": "Joe Hasell",
    "section": "1.22.0",
    "text": "1.22.0\n\nFeatures\n\nadd sourcemaps to min js and css files #430\nnew option holdRepeatTimeout - which is number of the delay between keypress repeat when holding key\nselection to change background color based on formatting like in Bash\nembed emoji regex by Mathias Bynens for better emoji detection\nallow to execute extended commands including terminal and cmd methods from formatters\nsupport for true colors (24bit) in unix formatting #433\nexpose split_characters in $.terminal namespace\ncmd commands option functions to have cmd as this context\n\n\n\nBugfix\n\nupdate typescript definition to new options + minor tweaks to the api\nfix cursor for PrismJS punctuation class\nfix emoji that contain U+FE0F character at the end #424\nfix for combine characters\nfix typescript definition for prompt and greetings #425\nfix typo in holdTimeout option name\nfix wrapping when command have emoji and combine characters\nfix align tabs when inside cursor line and align with prompt\nfix multiple 8-bit color codes in single ANSI escape\nfix cursor position when on formatting that change color and background\nallow to use login function in set_interpreter"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-88",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-88",
    "title": "Joe Hasell",
    "section": "1.21.0",
    "text": "1.21.0\n\nSecurity\n\nadd option invokeMethods that disable by default executing terminal and cmd methods from echo\n\n\n\nFeatures\n\nHOLD keymap modifier + HOLD+[SHIFT]+BACKSPACE/DELETE to delete word before and after the cursor #420\nalign tabs like in unix terminal #423\ntabs terminal options change tab length, not only columns/arrays\nadd tabs option for cmd\nimprove performance of display_position (when you click on character in long command that change length)\n\n\n\nBugfix\n\nfix &) in scheme prism formatting #421\ndon’t process keys other then enter in reverse search\nfix issue with background in Prismjs css\ninsert prism syntax formatter before nested formatting so it work for html if included with unix_formatting\nfix emoji and Unicode surrogate pairs #422"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-89",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-89",
    "title": "Joe Hasell",
    "section": "1.20.5",
    "text": "1.20.5\n\nBugfix\n\none more fix to position in normal function formatter (prism)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-90",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-90",
    "title": "Joe Hasell",
    "section": "1.20.4",
    "text": "1.20.4\n\nBugfix\n\nfix position in normal function formatter (prism)\nfix syntax (prism) function name in developer tools"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-91",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-91",
    "title": "Joe Hasell",
    "section": "1.20.3",
    "text": "1.20.3\n\nBugfix\n\nfix regression in overtyping #409"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-92",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-92",
    "title": "Joe Hasell",
    "section": "1.20.2",
    "text": "1.20.2\n\nBugfix\n\nescape formatting when using unix formatting in cmd\nfix cursor style while hover over links\none more fix cursor position"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-93",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-93",
    "title": "Joe Hasell",
    "section": "1.20.1",
    "text": "1.20.1\n\nBugfix\n\nfix click after line for last line"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-94",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-94",
    "title": "Joe Hasell",
    "section": "1.20.0",
    "text": "1.20.0\n\nSecurity\n\nanyLinks option to disable anything exception http and ftp (when false - default) - it make possible to insert javascript links, which is potential XSS vulnerability\n\n\n\nFeatures\n\nlinksNoFollow option (default false)\nadd UMD for utility files #418\n\n\n\nBug Fixes\n\nhandling backspaces in unix formatting #409\n\nhandle he same when adding leftovers before backspace in unix formatting\nfix cursor position when text have tabs found when fixing #409\nother fixes to backspaces\n\nfix font change in universal selector #415\nfix regression bug in formatters (emoji demo) #416\nfix cmd::resize() without args that make number of characters equal to 1 #413\nfix click after line #419"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-95",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-95",
    "title": "Joe Hasell",
    "section": "1.19.1",
    "text": "1.19.1\n\nBug Fixes\n\nfix type definition to match types from @types/jquery #412\nfix infinite loop in regex formatter with loop option #409"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-96",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-96",
    "title": "Joe Hasell",
    "section": "1.19.0",
    "text": "1.19.0\n\nFeatures\n\nadd TypeScript definition file\nupdate formatters API to have a way to return position after replace from function formatter\nregex formatters and $.tracking_replace now accept function as replacement\nupdate unix formatters to use new API so they work with command line\nset exit to false if no login provided\n\n\n\nBugs\n\nfix overtyping function #409\nremove CR characters only for display\ndon’t invoke onPosition change when calling position and don’t change the value\nfix clearing CR characters that was causing removal of empty lines #411"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-97",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-97",
    "title": "Joe Hasell",
    "section": "1.18.0",
    "text": "1.18.0\n\nFeature\n\nlooping regex formatters that replace until they don’t match the regex\nadd tracking_replace to $.terminal namespace\n$.terminal.syntax helper\nnew language for prism: “website” that handle html, javascript and css syntax\n\n\n\nBugs\n\nhandle formatters that replace backspaces and characters before #409\nfix broken < > & with cmd + prism #410\nfix background in prism with black background terminal\nremove warning from nested_formatting when if find nested formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-98",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-98",
    "title": "Joe Hasell",
    "section": "1.17.0",
    "text": "1.17.0\n\nFeatures\n\nadd ascii_table utility in separated file\nper user command line history\nadd $.terminal.parse_options which return same object as yargs parser\n$.jrpc helper now return its own created promise instead of $.ajax\nadd wcwidth as dependency so it will always show wider characters correctly (in browsers will work the same as optional)\nexpose terminal exception in $.terminal namespace\nnew API option doubleTab #405\n\n\n\nBugfix\n\ndisable history in read & login (regression from 1.16.0 history interpreter option)\nfix recursive error on extended commands (but it will only work on exact same commands without trailing white space)\ncreate copy of Prism for formatter so it can be used with normal html based prism snippets\ndouble fix: command line when formatter return empty formatting and prism that return empty formatting after ( and space\nthird fix fox jumping on right click\nfix columns method\nfix infinite loop when regex in formatters don’t have g flag\nfix parsing escape quotes\nfix split equal to handle brackets when using without formatting\nfix command line wrapping if prompt contain brackets as text #407\ninsert ^C where cursor was located #404\nfix echo crlf (windows line ending) #408\nallow to call cmd without arguments\nrename undocumented remove API method to remove_line so you can call jQuery remove\nfix throwing exception when there is error in formatter (it now only show alert)\nfix double exception when exec command throw exception"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-99",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-99",
    "title": "Joe Hasell",
    "section": "1.16.1",
    "text": "1.16.1\n\nBugs\n\nfix paste/select all when click below .cmd\nsecond fix to jumping on right click (context menu) #399\nchange $.terminal.prism_formatting to $.terminal.prism"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-100",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-100",
    "title": "Joe Hasell",
    "section": "1.16.0",
    "text": "1.16.0\n\nFeatures\n\nallow to have limited import when export is save and restored from JSON #393\nadd support for new u and s regex flags when parsing commands\nadd less plugin based on the one from leash\nsupports for promises returned from completion function\nadd prism.js file that include monkey patch for PrismJS library (for syntax highlight) to output terminal formatting\nbetter read method #397\nhandle promises returned from login and async login function #401\nadd history option for push for easy disabling history for new interpreter\nadd scrollObject option, so you can use body when terminal is on full screen div without height\n\n\n\nBugs\n\nfix resizer in Firefox #395\nfix $.terminal.columns and echo array #394\nfix $.terminal.columns for wider characters and terminal formatting\nfix rows() when using –size #398\nfix null in JSON hash\nfix jumping on right click (context menu) #399\nfix formatting inside brackets #396\nfix async interpreter #400\nuse window resize when terminal added to body"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-101",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-101",
    "title": "Joe Hasell",
    "section": "1.15.0",
    "text": "1.15.0\n\nFeatures\n\nallow to invoke terminal and cmd methods from extended commands ([[ terminal::set_prompt(\">>> \") ]])\nnew API method invoke_key that allow to invoke shortcut terminal.invoke_key('CTRL+L') will clear the terminal\nshift+backspace now do the same thing as backspace\n\n\n\nBugs\n\nfix wider characters in IE #380\nfix issue with number of characters when terminal is added to DOM after creation in IE\nfix scrolling on body in Safari\nfix exception when entering JSON with literal strings #389\nfix orphaned closing bracket on multiline echo #390\nfix whitespace insert after first character after first focus #391\nfix open link when click on url from exception"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-102",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-102",
    "title": "Joe Hasell",
    "section": "1.14.0",
    "text": "1.14.0\n\nFeatures\n\npass options to formatters and accept option unixFormattingEscapeBrackets in unix_formatting (PR by Marcel Link)\nimprove performance of repaint and layout whole page when changing content of the terminal\nuse ch unit for wide characters if browser support it (it have wide support then css variables)\nkeymap terminal method and allow to set shortcuts on runtime\n\n\n\nBugs\n\nfix newline as first character in formatting #375.\nfix error when echo undefined (it will echo string undefined since it’s converted to string)\nfix first argument to keymap function, it’s now keypress event\nfix resizing issue when scrollbar appear/disappear while you type #378\nfix cut of cursor when command line had full length lines and it was at the end #379"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-103",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-103",
    "title": "Joe Hasell",
    "section": "1.12.1",
    "text": "1.12.1\n\nfix minified css file + fix scrollbar"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-104",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-104",
    "title": "Joe Hasell",
    "section": "1.12.0",
    "text": "1.12.0\n\nFeatures\n\ndefault options for cmd plugin\ncaseSensitiveSearch option for both terminal and cmd plugins\n\n\n\nBugfixes\n\nfix urls ending with slash #365\nstringify non string commands in set_command\nfix scrolling of the page, when press space, after you click on the link\nfix scrolling flicker when terminal added to body\nsmall css fixes for element containers when terminal added to body\nfix for wide characters inside bigger text #369\nwhen clicking on terminal and it already had focus the textarea was blured #370\nfix parsing empty strings “” or ’’\nfix warning from webpack about –char-width without default #371"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-105",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-105",
    "title": "Joe Hasell",
    "section": "1.11.4",
    "text": "1.11.4\n\nhandle non string and functions in error the same as in echo\nfix selection for raw output (reported by @ovk)\nhide font resizer so you actually can select text starting from top left"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-106",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-106",
    "title": "Joe Hasell",
    "section": "1.11.3",
    "text": "1.11.3\n\ncreate empty div for function line that return empty string, that was causing issues with update #363\nset classes from terminal to fake terminal that is used to calculate character size\ndon’t use length css variable on formatting when length is the same as wcwidth\ncss fixes for terminal in jQuery UI dialog (dterm)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-107",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-107",
    "title": "Joe Hasell",
    "section": "1.11.2",
    "text": "1.11.2\n\nfix issue with –char-width == 0 if terminal have display:none\nfix DELETE numpad key on IE\nignore invalid procedures description in system.describe\nfix font resizer and init resizers when terminal hidden initialy\nfix broken wrapping in new feature of updating divs on resize"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-108",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-108",
    "title": "Joe Hasell",
    "section": "1.11.1",
    "text": "1.11.1\n\nfix IE inconsistency in key property for numpad calc keys (reported by @ovk #362\nfix completion skipping letters (reported by @ovk #361)\nfix issue with last character in line beeing closing braket (reported by @arucil #358)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-109",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-109",
    "title": "Joe Hasell",
    "section": "1.11.0",
    "text": "1.11.0\n\nFeatures\n\nupdate API method accept options 3rd argument\nspeed up refresh on resize by checking character size in font resizer (reported by @artursOs)\nchange command line num chars on resize + settings.numChars (reported by @artursOs #353)\nadd remove api method that call update(line, null);\ndon’t call scroll to bottom on resize/refresh/update/remove\nimprove scroll_element plugin by using document.scrollingElement if present and cache the value\nresizer plugin use ResizeObserver if defined\nremove fake call to finalize in echo to catch potential error\nsilent boolean 3rd argument to cmd::set and 2nd to terminal::set_command\nhandy classed to change cursor animation in IE ### Bugs\ndon’t prevent default scroll when terminal have no scrollbar\nrestart cursor animation on keydown (requested by @theMeow on chat)\ndon’t redraw whole terminal in update api method\nshow exception from onAfterRedraw on terminal\ndon’t show first argument to method in help command when login is used\nallow to call disable/focus(false) from command + fix focus(false) with single terminal (reported by Eric Lindgren #359)\nfix autofocus on init"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-110",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-110",
    "title": "Joe Hasell",
    "section": "1.10.1",
    "text": "1.10.1\n\nfix scroll to bottom on scrolling when terminal is disabled (reported by @RomanPerin #355)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-111",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-111",
    "title": "Joe Hasell",
    "section": "1.10.0",
    "text": "1.10.0\n\nFeatures\n\nnew api for formatters Array with 2 elements regex and replacement string (it fix issue when formatters change length of string - emoji demo)\nnormalize IE key property for keymap + always use +SPACEBAR if there is any control key\ncursor text for terminal and cmd\nonEchoCommand callback gets second argument command\ncmd keymap api function, along with object and no arguments, accept string as first argument and function as second\nonly one exception per callback event\nselect all context menu (based on idea from CodeMirror) ### Bugs\nfix cursor in IE and iOS/Safari reported by @RinaVladimyrovna #350\ndon’t apply formatters in echo commands for completion (found by applying completion to emoji demo)\nfix substring and html entity (entering < & > in command line was showing entity not character)\npaste context menu not for img tag to allow to save as\nfix nested formatting (by introducing meta on formatter function that apply the function to whole string)\nfix format_split when text have \\ character before ]\nfix line ending on windows in command line (CRLF)\nfix copy from command line\nfix cursor position when command line have formatting (using formatters)\nfix cursor position when command line have 3 lines\ndon’t apply formatters for greetings not only for signture (user can use formatting because he control the string)\nfix max call stack exception when error happen in onEchoCommand\nChinese character occupy 2 characters same as in linux terminal (requirement wcwidth and css variables)\nfix substring and string like ‘<a’ that was breaking command line\nfix newlines in string when do parse/split _command (used by command line)\nfix split equal and command line splitting\nfix exception in keymap when calling original in the one that was overwriten by terminal like CTRL+V (reported by Ravi Teja Mamidipaka #351)\nnot all keymaps had terminal as this context"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-112",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-112",
    "title": "Joe Hasell",
    "section": "1.9.0",
    "text": "1.9.0\n\nFeatures\n\nnew api utils $.terminal.length and $.terminal.columns\necho array (resizable in columns that fit the width, using settings.tabs as pad right)\ncallback function parseObject that’s called on object different then string (on render)\ncalling option method with numRows or numChars redraw terminal output (for testing)\nonFlush callback (called when text is rendered on screen in flush method)\nregex helper $.terminal.formatter created using Symbols can be use instead of regex\nnew option pasteImage (default true) - requested by @ssv1000 #342\nCTRL+C cancel command like in bash if no selection - requested by @abhiks19 #343\nrefresh API method\nnew api method display_position in cmd plugin that return corrected position of the cursor if cursor in the middle of the word that got replaced by longer or shorter string in formatting function (fix for emoji demo) ### Bugs\nadd missing –size default for underline animation\nfix trim of spaces in front of lines when keep words is true\nfix newline in prompt found while answering question on SO\nfix insert of newline in the middle of the command line if there is “word space word” and you press space after space\nfix infinite loop in split_equal with keep words when word is longer than the limit and there is space before long word\nfix paste on MacOS - regresion after adding context menu paste (reported by Ravi Teja Mamidipaka #340)\nfix cursor in textarea in Edge and IE (reported by Tejaswi Rohit Anupindi #344)\nfix input for Android 4.4 in emulator (tested on saucelabs.com)\nfix selection + css variables (know bug in MS Edge)\nfix apply/call issue that was causing Android 2.3 to crash\nfix context menu on selected text (the selected text was cleared)\nallow to call original terminal keymap for overwrites defined in terminal (not only the ones defined in cmd)\nescape < and > issue reported by @itsZN #345\nfix moving cursor when formatting change size of text (found when creating emoji demo) the click was rewritten using span for each character\nfix command line when for wide characters\ndon’t move the cursor on click when cmd disabled\nfix substring"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-113",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-113",
    "title": "Joe Hasell",
    "section": "1.8.0",
    "text": "1.8.0\n\nallow to return promise from prompt + fix promise in echo\nadd back context menu paste that was removed by mistake\nmake terminal work in Data URI (access to cookies was throwing exception in Chrome)\nfix case insensitive autocomplete when there is single completion\nfix completion error when more then one completion (PR by Anton Vasilev #337)\nfix artificialy triggered click (reported by Paul Smirnov #338)\nfix focus issue when you have multiple terminals\nfix css animations\nfix move cursor on click\nfix quick click to focus + CTRL+V (reported by @artursOs #336)\nfix outputLimit\nfix exception that sometimes happen on mouseup"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-114",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-114",
    "title": "Joe Hasell",
    "section": "1.7.2",
    "text": "1.7.2\n\nfix blur when click ouside terminal when element you click is on top of terminal\nthis is terminal instance inside echo function\nfix localStorage exception and empty line height while creating terminal from data URI\nrefocus when click on terminal (fix for :focus-within)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-115",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-115",
    "title": "Joe Hasell",
    "section": "1.7.1",
    "text": "1.7.1\n\nfix blur terminals when open context menu and then click right mouse button (sometimes last terminal didn’t get disabled)\nfix backspase"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-116",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-116",
    "title": "Joe Hasell",
    "section": "1.7.0",
    "text": "1.7.0\n\nFeatures\n\nadd option caseSensitiveAutocomplete default to true #332\nexpose Stack/Cycle/History in $.terminal so they can be tested\nmake :focus-within .prompt selector work with terminal (work also on codepen) ### Bugs\nfix jumping of terminal when created one after another and changing the one that have focus in Edge\nfix issue that all terminals was enabled not the last one created\nfix issue that on click next terminal get focused on browsers with touch screen (reported by @itsZN #330)\nfix missing default keymap in cmd plugin (found on SO by Arnaldo Montoya)\nupdate dterm to enable terminal when is visible (when open) using IntersectionObserver\nfix issue with focus on click on MacOS (reported by @RomanPerin #255)\nfix pasting (reported by @artursOs #331)\nfix unescaped entity error (reported by Nikolai Orekhov #333)\nfix onFocus and onBlur events\nfix blur textarea on disable"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-117",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-117",
    "title": "Joe Hasell",
    "section": "1.6.4",
    "text": "1.6.4\n\njust missed build"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-118",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-118",
    "title": "Joe Hasell",
    "section": "1.6.3",
    "text": "1.6.3\n\nfix issue with auto-enable and insert to DOM after terminal was created\nfix issue with space and dead keys (reported by David Peter)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-119",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-119",
    "title": "Joe Hasell",
    "section": "1.6.2",
    "text": "1.6.2\n\nfix altGr+key issue reported by Erik Lilja"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-120",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-120",
    "title": "Joe Hasell",
    "section": "1.6.1",
    "text": "1.6.1\n\ndon’t call encode in escape_formatting (requested by @ovk)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-121",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-121",
    "title": "Joe Hasell",
    "section": "1.6.0",
    "text": "1.6.0\n\nFeatures\n\nnew API method apply_formatters\nadd UMD (requested by @fazelfarajzade)\nadd new events: onEchoCommand and onAfterRedraw (requested by @ovk) ### Bugs\nfix issue that formatters where applied to formatting (discovered by issue from @ovk)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-122",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-122",
    "title": "Joe Hasell",
    "section": "1.5.3",
    "text": "1.5.3\n\nfix cursor over entity (mainly  ) issue reported by @ovk\nfix space scroll page"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-123",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-123",
    "title": "Joe Hasell",
    "section": "1.5.2",
    "text": "1.5.2\n\nkeep formatting when cursor is over one, issue reported by @Oleg on StackOverflow\nfix jumping prompt when it have newlines"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-124",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-124",
    "title": "Joe Hasell",
    "section": "1.5.1",
    "text": "1.5.1\n\nfix autofocus with position: fixes (reported by @ovk)\nfix input method using sogou keyboard on windows (reported by @hnujxm)\nfix long line wrapping and click to move cursor with wider characters like Chinese"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-125",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-125",
    "title": "Joe Hasell",
    "section": "1.5.0",
    "text": "1.5.0\n\nFeatures\n\nrun fake keypress and keydown created in input when not fired by the browser (android)\nimprove perfomance by calculating char size only on resize and init (issue reported by @artursOs)\nnew cmd delegate method get_position/set_position added to terminal\nresolve promises returned from intrpreter in jQuery 2.x\nallow to use newlines in prompt\ndon’t rethrow user exception when exceptionHandler is set (mainly for testing that option)\nadd option describe that is a string mapping procs from system.describe procs (default “procs”) it can be “result” or “result.procs” if system.describe is normal JSON-RPC method ### Bugs\nadd option to cmd::disable to not blur so it don’t hide android keyboard on pause\ndon’t enable terminal on init on Android\nfix next key after CTRL+V that was triggering input event (reported by @artursOs)\nfix parsing strings\ndon’t hide virtual keyboard on Android when called pause()\nfix input on Firefox with google keyboard (reported by Filip Wieland)\ndisable terminal on resume event in cordova (is the terminal is disabled when no virutal keyboard)\nfix moving cursor on click (after multiline command) and the height of the cmd plugin\nfix escape completion (that enabled by default)\nremove hardcoded DemoService from json-rpc system.describe"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-126",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-126",
    "title": "Joe Hasell",
    "section": "1.4.3",
    "text": "1.4.3\n\ndon’t execute keypress callback when terminal is disabled (reported by @artursOs)\nfix android (input event was not bind)\ndisable keypress when you press CTRL+key and caps-lock is on (bug in firefox reported by @artursOs)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-127",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-127",
    "title": "Joe Hasell",
    "section": "1.4.2",
    "text": "1.4.2\n\nfix context menu pasting and pasting images when terminal not in focus (thanks to Alex Molchanov for reporing a bug)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-128",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-128",
    "title": "Joe Hasell",
    "section": "1.4.1",
    "text": "1.4.1\n\nadd rel=“noopener” to all links\nremove anonymous function name that was duplicating parameter with the same name that was causing error in PhantomJS (thanks to @rteshnizi for bug report)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-129",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-129",
    "title": "Joe Hasell",
    "section": "1.4.0",
    "text": "1.4.0\n\nFeatures\n\nadd paste using context menu ### Bugs\nfix recursive exception when finalize echo function throw exception\nfix underline animation\nfix wordAutocomplete and add completionEscape option (issue reported by Quentin Barrand)\nimprove parsing commands (it now convert “foo”bar’baz’ to foobarbaz like bash)\nfix normalize and substring\nremove empty formatting in normalize function"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-130",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-130",
    "title": "Joe Hasell",
    "section": "1.3.1",
    "text": "1.3.1\n\nfix cols/rows that was causing signature to not show"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-131",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-131",
    "title": "Joe Hasell",
    "section": "1.3.0",
    "text": "1.3.0\n\nFeateres\n\npaste of images (using echo) in browsers that support clipboard event\nadd args_quotes to parse_/split_ command api utilities\nadd IntersectionObserver to add resizer and call resize (not all browser support it, polyfill exists)\nadd MutationObserver to detect when terminal is added/removed from DOM and call IntersectionObserver when added\nnew API utiltites normalize, substring, unclosed_strings and helper iterate_formatting\nadd default formatter that handle nested formatting\nwhen using rpc or object interpreter it will throw exception when there are unclosed strings\nelement resizer (as jQuery plugin) that work inside iframe ### Bugs\nremove onPop event from main interpreter (with null as next)\nmousewheel work without jQuery mousewheel and fix jumps of text\nfix number of rows after adding underline animation\nfix outputLimit\nfix calculation of cols and rows\nstrings object are not longer saved in variable on terminal creation so you can change it dynamically after terminal is created (use command to change language)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-132",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-132",
    "title": "Joe Hasell",
    "section": "1.2.0",
    "text": "1.2.0\n\nFeatures\n\nmake terminal accessible to screen readers:\n\nterminal focus using tab key (we can’t blur on tab keybecause it’s used to enter tab character or for completion)\nmake command line in cmd plugin hidden from screen readers\nadd role=“log” to terminal-output and hide echo command, so result of command are read by screen reader but not command that user typed and prompt"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-133",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-133",
    "title": "Joe Hasell",
    "section": "1.1.4",
    "text": "1.1.4\n\nfix size with css var with underline animation\nfix minified css (cssnano was removing unused animations)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-134",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-134",
    "title": "Joe Hasell",
    "section": "1.1.3",
    "text": "1.1.3\n\nfix click to change position when command have newlines"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-135",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-135",
    "title": "Joe Hasell",
    "section": "1.1.2",
    "text": "1.1.2\n\nfrom pauseEvents option form cmd plugin - it always execute keyboard events"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-137",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-137",
    "title": "Joe Hasell",
    "section": "1.1.0",
    "text": "1.1.0\n\nfix CMD+V on MacOS chrome\nadd stay option to insert same as in cmd plugin\nadd option pauseEvents - default set to true\nfix exception when calling purge more then once\nfix history: false option\nkeymap have priority over keydown so you can overwrite with CTRL+D keymap function"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-138",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-138",
    "title": "Joe Hasell",
    "section": "1.0.15",
    "text": "1.0.15\n\nfix echo command when press tab twice and there are more then one completion\nfix CTRL+D when paused (it now resume the interpreter)\nfocus don’t enable terminal when paused (it was hidden by you could enter text)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-139",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-139",
    "title": "Joe Hasell",
    "section": "1.0.14",
    "text": "1.0.14\n\nfix moving of the content on focus/blur when command line at the bottom\ndon’t move cursor on click when focusing\nthrow exception about key property polyfill on init of cmd plugin"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-140",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-140",
    "title": "Joe Hasell",
    "section": "1.0.12",
    "text": "1.0.12\n\nfix for Android/Chrome that have unidentified as key property for single character keys\nfix entering text in the middle on Android/Chrome\nfix backspace on Android/Chrome/SwiftKey\nfix cursor position when click on word completion on Android"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-141",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-141",
    "title": "Joe Hasell",
    "section": "1.0.11",
    "text": "1.0.11\n\nfix dead keys logic (for special keys that don’t trigger keypress like delete)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-142",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-142",
    "title": "Joe Hasell",
    "section": "1.0.9/10",
    "text": "1.0.9/10\n\nfix dead_keys logic (when keypress after special keys like arrows)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-143",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-143",
    "title": "Joe Hasell",
    "section": "1.0.8",
    "text": "1.0.8\n\nfix paste in IE and Edge"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-144",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-144",
    "title": "Joe Hasell",
    "section": "1.0.7",
    "text": "1.0.7\n\nfix exec when pause called in onInit\nfix reverse search\nfix 3 argument in completion error\nfix login from hash for async JSON-RPC\nfix focus(false)/disable in exec from hash\nfix regression of pasting in MacOS\nscroll to bottom in insert method\nremove default extra property from interpreter (all properties are saved in interperter) and make main options extra pass to intepterer not using extra property\nfix completion when text have spaces (escaped or inside quotes)\nfix dead keys on MacOSX (testing shortcuts now require keydown and keypress events)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-145",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-145",
    "title": "Joe Hasell",
    "section": "1.0.6",
    "text": "1.0.6\n\nfix AltGr on non US keyboard layouts"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-146",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-146",
    "title": "Joe Hasell",
    "section": "1.0.5",
    "text": "1.0.5\n\nfix CTRL+D to delete forward one character\ndon’t use user agent sniffing to get scroll element if terminal attached to body\nfix & on French layout"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-147",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-147",
    "title": "Joe Hasell",
    "section": "1.0.3/4",
    "text": "1.0.3/4\n\nfix keypress with key polyfill"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-148",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-148",
    "title": "Joe Hasell",
    "section": "1.0.2",
    "text": "1.0.2\n\nfix CTRL+V in Firefox and IE\nfix issue in jQuery >= 3.0\nfix space, backspace, resize and arrows in IE\nfix middle mouse paste on GNU/Linux"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-149",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-149",
    "title": "Joe Hasell",
    "section": "1.0.1",
    "text": "1.0.1\n\nfix signature"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-150",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-150",
    "title": "Joe Hasell",
    "section": "1.0.0",
    "text": "1.0.0\n\nFEATURES:\n\ncopy to system clipboard when copy to kill area\nsimplify changing of terminal colors using css variables\nalways export history and import when importHistory option is true\nadd bar and underline cursor animations and a way to enable it with single css variable\nrecalcualate cols and rows on terminal resize (not only window)\nrequest/response and onPush/onPop callbacks\nall callbacks have terminal as this (terminal in parameter stay the same)\nadd option softPause to control pause visible option - it don’t hide the prompt when set to true\nadd wordAutocomplete option (default true)\nadd complete and before_cursor api methods and use it for autocomplete\nformatting for command line (you can’t type formatting but you can use $.terminal.formatters to\nformat command you’re writing)\nnew option formatters for echo (error method by default disable formatters)\ninterpeter and terminal accept extra option that can be use in onPop or onPush\nadd keymap option to cmd, terminal and interpreter where you can add shortcuts\nclicking on character, in cmd plugin, move cursor to that character\n\n\n\nBUGS:\n\nfix width calculation with scrollbar visible\nfix exception in Firefox throw by setSelectionRange in caret plugin\nmake echo sync when echo string or function (flush didn’t work on codepen)\nfix onCommandChange callback on backspace\nDon’t echo extended commands on resize\nuse JSON.parse to process strings when parsing command line\nfix rpc in array when there are no system.describe\ncall exeptionHandler on every exception (even iternal)\nfix echo resolved content when interpreter return a promise\nfix for valid /[/]/g regex\nfix pushing JSON-RPC intepreter\nfix selection in IE\nclear selection when click anywhere in the terminal\nfix removing global events on terminal destroy\ndon’t execute javascript file when fetching line that trigger exception in browser that have fileName in exception (like Firfox)\n\n\n\nBREAKING CHANGES:\n\ncompletion function now have two arguments string and callback and terminal is in this\nremoved setInterpreter, parseArguments, splitArguments, parseCommand and splitCommand\nif you execute keydown event manualy to trigger terminal/cmd shortcuts you need to pass key property with key name (see spec/terminalSpec.js file)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-151",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-151",
    "title": "Joe Hasell",
    "section": "0.11.23",
    "text": "0.11.23\n\nadd scrollBottomOffset option"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-152",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-152",
    "title": "Joe Hasell",
    "section": "0.11.22",
    "text": "0.11.22\n\nscroll to bottom of the terminal when option scrollOnEcho is set to false but the terminal is at the bottom\nadd new api methods is_bottom and scroll_to_bottom"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-153",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-153",
    "title": "Joe Hasell",
    "section": "0.11.21",
    "text": "0.11.21\n\ndon’t scroll to terminal (using caret plugin) when it’s disabled"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-154",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-154",
    "title": "Joe Hasell",
    "section": "0.11.20",
    "text": "0.11.20\n\ndon’t convert links to formatting when raw option is true"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-155",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-155",
    "title": "Joe Hasell",
    "section": "0.11.19",
    "text": "0.11.19\n\nfix getting data from local storage\nremove spell check and auto capitalize from textarea"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-156",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-156",
    "title": "Joe Hasell",
    "section": "0.11.18",
    "text": "0.11.18\n\nfix input method"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-157",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-157",
    "title": "Joe Hasell",
    "section": "0.11.17",
    "text": "0.11.17\n\nfix echo when line is short and have newlines"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-158",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-158",
    "title": "Joe Hasell",
    "section": "0.11.16",
    "text": "0.11.16\n\nadd versioned files to npmignore\nadd global and echo option wrap to disable long line wrapping\ndon’t send warning when mime for JSON-RPC is text/json"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-159",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-159",
    "title": "Joe Hasell",
    "section": "0.11.15",
    "text": "0.11.15\n\nreplace json_stringify with JSON.stringify"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-160",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-160",
    "title": "Joe Hasell",
    "section": "0.11.14",
    "text": "0.11.14\n\nfix focus on desktop"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-161",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-161",
    "title": "Joe Hasell",
    "section": "0.11.13",
    "text": "0.11.13\n\nallow only memory storage with memory option set to true"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-162",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-162",
    "title": "Joe Hasell",
    "section": "0.11.12",
    "text": "0.11.12\n\nfix focus on mobile"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-163",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-163",
    "title": "Joe Hasell",
    "section": "0.11.11",
    "text": "0.11.11\n\nfix do not enable the terminal on click if it’s frozen"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-164",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-164",
    "title": "Joe Hasell",
    "section": "0.11.10",
    "text": "0.11.10\n\nfix focus on click"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-165",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-165",
    "title": "Joe Hasell",
    "section": "0.11.9",
    "text": "0.11.9\n\nfix outputLimit option"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-166",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-166",
    "title": "Joe Hasell",
    "section": "0.11.8",
    "text": "0.11.8\n\nadd scrollOnEcho option"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-167",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-167",
    "title": "Joe Hasell",
    "section": "0.11.7",
    "text": "0.11.7\n\nfix History::last"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-168",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-168",
    "title": "Joe Hasell",
    "section": "0.11.6",
    "text": "0.11.6\n\nfix flush\nnew API method $.terminal.last_id"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-169",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-169",
    "title": "Joe Hasell",
    "section": "0.11.5",
    "text": "0.11.5\n\nfix focus on Android"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-170",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-170",
    "title": "Joe Hasell",
    "section": "0.11.4",
    "text": "0.11.4\n\nallow to change completion using option API method"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-171",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-171",
    "title": "Joe Hasell",
    "section": "0.11.3",
    "text": "0.11.3\n\nadd echoCommand option"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-172",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-172",
    "title": "Joe Hasell",
    "section": "0.11.2",
    "text": "0.11.2\n\nallow to select text using double click"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-173",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-173",
    "title": "Joe Hasell",
    "section": "0.11.1",
    "text": "0.11.1\n\nfix exec login from hash\nallow to pause with visible command line\nnew api method clear_history_state"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-174",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-174",
    "title": "Joe Hasell",
    "section": "0.11.0",
    "text": "0.11.0\n\nfix default prompt for push\nadd word-wrap: break-word for cases when echo html that have long lines\nfix login function as setting when used with JSON-RPC\nadd help command to JSON-RPC when there is system.describe\nfix exec array and delayed commands (when you exec and don’t wait for promise to resolve)\nfix double cursor in terminals when calling resume on disabled terminal\nfix calling login after pop from login\nadd infiniteLogin option to push\nfix exec after init when used with JSON-RPC with system.describe\nmake set_interpreter return terminal object\nlogout when onBeforeLogin return false\nfix backspace in Vivaldi browser by keeping focus in textarea for all browsers\nnew API method last_index\nalow to remove the line by passing null as replacement to update function\nfix number of characters per line\nfix paste on MacOSX"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-175",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-175",
    "title": "Joe Hasell",
    "section": "0.10.12",
    "text": "0.10.12\n\nfix css animation of blinking in minified file"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-176",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-176",
    "title": "Joe Hasell",
    "section": "0.10.11",
    "text": "0.10.11\n\nfix check arity for nested object; throw error when calling logout in login"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-177",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-177",
    "title": "Joe Hasell",
    "section": "0.10.10",
    "text": "0.10.10\n\nescape brackets while echo completion strings"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-178",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-178",
    "title": "Joe Hasell",
    "section": "0.10.9",
    "text": "0.10.9\n\nfix issue with jQuery Timers when page included another jQuery after initialization"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-179",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-179",
    "title": "Joe Hasell",
    "section": "0.10.8",
    "text": "0.10.8\n\nadd mangle option to uglifyjs"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-180",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-180",
    "title": "Joe Hasell",
    "section": "0.10.7",
    "text": "0.10.7\n\nfix if interpreter is an array and have function"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-181",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-181",
    "title": "Joe Hasell",
    "section": "0.10.6",
    "text": "0.10.6\n\nfix overwriting of exit and clear commands"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-182",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-182",
    "title": "Joe Hasell",
    "section": "0.10.5",
    "text": "0.10.5\n\nprevent infinite loop in terminal::active when no terminal"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-183",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-183",
    "title": "Joe Hasell",
    "section": "0.10.4",
    "text": "0.10.4\n\nchange -min to .min in minfied versions of files"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-184",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-184",
    "title": "Joe Hasell",
    "section": "0.10.3",
    "text": "0.10.3\n\nmake npm happy about version"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-185",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-185",
    "title": "Joe Hasell",
    "section": "0.10.2",
    "text": "0.10.2\n\nAdd minified css file"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-186",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-186",
    "title": "Joe Hasell",
    "section": "0.10.1",
    "text": "0.10.1\n\nfix url regex for formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-187",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-187",
    "title": "Joe Hasell",
    "section": "0.10.0",
    "text": "0.10.0\n\nkeepWords option to echo and words parameter in split_equal\nfix login for nested intepreters\nfix destroy of cmd plugin\nfix saving commands in hash\nallow to disable completion in nested interpreter\nchange position of cursor in reverse history search\nfix pasting in Firefox\nexec is adding command to history\nfix execHash in FireFox\ntestsing terminal and cmd plugin + call from command line\nfix exec for nested login rpc command\nfix exec from hash if commands use pause/resume\nfix exec for build in commands\nfix other various exec from hash issues\nfix local logout and login commands\nmousewheel and resize options for interpreter\nuse MIT license\nonExport and onImport events"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-188",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-188",
    "title": "Joe Hasell",
    "section": "0.9.3",
    "text": "0.9.3\n\nchange settings to method\nfix process_commands and escape_regex\nfix login from hash\nfix raw echo\ndon’t print empty string after removing extended commands strings\nfix history_state method"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-189",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-189",
    "title": "Joe Hasell",
    "section": "0.9.2",
    "text": "0.9.2\n\ndon’t change command line history if ctrl key is pressed\nfix middle mouse copy on GNU/Linux\nfix resize issue"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-190",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-190",
    "title": "Joe Hasell",
    "section": "0.9.1",
    "text": "0.9.1\n\nfreeze and frozen API methods that disable/enable terminal that can’t be enabled by click"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-191",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-191",
    "title": "Joe Hasell",
    "section": "0.9.0",
    "text": "0.9.0\n\nuse url hash to store terminal session\nfix export/import\nfocus/blur on Window focus/blur\nallow to change mask char for passwords\nfix space after completed command and in ALT+D\nclass .command in div created by echo command, and error class in error function\nCSS selection is now one solid color, also support h1..h6, tables and pre tags\nfix ANSI Formatting bug\nregex as History Filter\ncustom Formatters\nraw and globalToken options\nfix encoding entites\nallow to echo jQuery promise\nexec return promise, exec with array of commands\nauto resume/pause if user code return promise\nmobile (tested on Android) - users report that it don’t work - need testing\nfunctions splitCommand, parseCommand, splitArguments, parseArguments changed to kebab case, but the old functions are kept for backward compatibility\nnew API method read (wrapper over push), autologin and update\nextended commands with syntax [{   }]"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-192",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-192",
    "title": "Joe Hasell",
    "section": "0.8.8",
    "text": "0.8.8\n\nfix 2 json rpc bugs"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-193",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-193",
    "title": "Joe Hasell",
    "section": "0.8.7",
    "text": "0.8.7\n\nfix processing command function"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-194",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-194",
    "title": "Joe Hasell",
    "section": "0.8.6",
    "text": "0.8.6\n\none space after fully completed command"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-195",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-195",
    "title": "Joe Hasell",
    "section": "0.8.5",
    "text": "0.8.5\n\nall regex for formatting case insensitive"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-196",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-196",
    "title": "Joe Hasell",
    "section": "0.8.4",
    "text": "0.8.4\n\nfix redraw lines on import_view, fix calculating rows"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-197",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-197",
    "title": "Joe Hasell",
    "section": "0.8.3",
    "text": "0.8.3\n\nfix completion in nested interpreters\nlogin option in push\nremove pause/resume from login\nfix parsing RegExes\nfix display text with more then limit lines in one echo"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-198",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-198",
    "title": "Joe Hasell",
    "section": "0.8.2",
    "text": "0.8.2\n\nadd Terminal::exception function"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-199",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-199",
    "title": "Joe Hasell",
    "section": "0.8.1",
    "text": "0.8.1\n\nfix login/logout"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-200",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-200",
    "title": "Joe Hasell",
    "section": "0.8.0",
    "text": "0.8.0\n\nCTRL+L clear terminal\nShift+Enter insert newline\nremove tabcompletion option (now completion can be true, array or function)\nadd onRPCError and exceptionHandler callbacks\ninterpreter can be an array\nignoreSystemDescribe option\nhandle invalid JSON-RPC\nCSS style for standalone cmd plugin\nusing CSS3 Animation for blinking if supported\nfix [0m\nbetter error handling (all messages are in $.terminal.defaults.strings)\nnamed colors for terminal formatting\nexpose settings and login function\nmore tools in $.terminal\npaste kill text with CTRL+Y\npaste text from selection using middle mouse button\nfix login, history and exec\ndisable few things when in login function\nall Strings are in $.terminal.defaults.strings\nmore functions in $.terminal object"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-201",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-201",
    "title": "Joe Hasell",
    "section": "0.7.12",
    "text": "0.7.12\n\nfix terminal when start as invisible, rest property to parseCommand"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-202",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-202",
    "title": "Joe Hasell",
    "section": "0.7.11",
    "text": "0.7.11\n\nfix last history command"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-203",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-203",
    "title": "Joe Hasell",
    "section": "0.7.10",
    "text": "0.7.10\n\nfix reverse search"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-204",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-204",
    "title": "Joe Hasell",
    "section": "0.7.9",
    "text": "0.7.9\n\nDon’t show version when use source file"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-205",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-205",
    "title": "Joe Hasell",
    "section": "0.7.8",
    "text": "0.7.8\n\nAllow to call $.terminal.active() in prompt"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-206",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-206",
    "title": "Joe Hasell",
    "section": "0.7.7",
    "text": "0.7.7\n\nfix long line wrap on Init, don’t call termina::resize on init"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-207",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-207",
    "title": "Joe Hasell",
    "section": "0.7.6",
    "text": "0.7.6\n\nfix small errors and typos"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-208",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-208",
    "title": "Joe Hasell",
    "section": "0.7.5",
    "text": "0.7.5\n\nfix flush, add option linksNoReferer"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-209",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-209",
    "title": "Joe Hasell",
    "section": "0.7.4",
    "text": "0.7.4\n\nfix interpreter when there is not system.describe in JSON-RPC\nadd method flush and fix refresh"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-210",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-210",
    "title": "Joe Hasell",
    "section": "0.7.3",
    "text": "0.7.3\n\nadd ANSI 256 (8bit) formatting from Xterm\nfix Regexes\nadd ntroff formatting support (output from man)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-211",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-211",
    "title": "Joe Hasell",
    "section": "0.7.2",
    "text": "0.7.2\n\nfix purge, json-rpc, history. Improve json-rpc and add check arity"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-212",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-212",
    "title": "Joe Hasell",
    "section": "0.7.1",
    "text": "0.7.1\n\nadd tests\nterminal without eval\nfix issue with umpersand (unenclosed entinity) in multiline"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-213",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-213",
    "title": "Joe Hasell",
    "section": "0.7.0",
    "text": "0.7.0\n\nadd outputLimit, add method destroy\nadd utilities parseArguments, splitArguments, parseCommand and splitCommand to $.terminal\nallow to overwrite, by user, parsing commands in object as eval\nmake cmd chainable\nfix command line (interepters) names for localStorage use\nfix Login/Token LocalStorage names\nadd method purge (that clear localStorage)\nconvert escaped hex and octals in double quoted strings as chars\nfix Tilda on Windows\nmore ANSI codes\ncomplete common string on TAB\nfix cancel ajax on CTRL+D when paused"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-214",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-214",
    "title": "Joe Hasell",
    "section": "0.6.5",
    "text": "0.6.5\n\nfinalize and raw options in echo"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-215",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-215",
    "title": "Joe Hasell",
    "section": "0.6.4",
    "text": "0.6.4\n\nfix regexes, CMD+`, CMD+R, CMD+L on Mac, fix Resize if terminal is hidden, fix wrap ANSI formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-216",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-216",
    "title": "Joe Hasell",
    "section": "0.6.3",
    "text": "0.6.3\n\nfix arguments in automatic JSON-RPC"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-217",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-217",
    "title": "Joe Hasell",
    "section": "0.6.2",
    "text": "0.6.2\n\nfix arguments in object as eval, new option processArguments"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-218",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-218",
    "title": "Joe Hasell",
    "section": "0.6.1",
    "text": "0.6.1\n\nfix first echo (like greetings)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-219",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-219",
    "title": "Joe Hasell",
    "section": "0.6",
    "text": "0.6\n\nfix formatting with links and emails and long lines\nhistory is a list with command as last element\nhistory have size\nYou can type more characters in reverse search if command not found\nexport/import\nnResize event"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-220",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-220",
    "title": "Joe Hasell",
    "section": "0.5.4",
    "text": "0.5.4\n\nfix scroll when attaching terminal to body in non Webkit browsers"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-221",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-221",
    "title": "Joe Hasell",
    "section": "0.5.3",
    "text": "0.5.3\n\nlevel api function\nrestore mask on pop\nclick out of terminal remove focus\nCTRL+H CTRL+W\nuse selector as default name for the terminal"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-222",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-222",
    "title": "Joe Hasell",
    "section": "0.5.2",
    "text": "0.5.2\n\nfix entity in lines\nadd data-text attribute to formatting span"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-223",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-223",
    "title": "Joe Hasell",
    "section": "0.5.1",
    "text": "0.5.1\n\nfunction in push\nallow to put braket in formatting (closed with escape)\nprint nested object in automatic rpc\nterminal instance in login callback"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-224",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-224",
    "title": "Joe Hasell",
    "section": "0.5",
    "text": "0.5\n\ntab completion work with callback function\npush command allow for objects\nadd CTRL+G to cancel Reverse Search"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-225",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-225",
    "title": "Joe Hasell",
    "section": "0.4.23",
    "text": "0.4.23\n\nfix Style"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-226",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-226",
    "title": "Joe Hasell",
    "section": "0.4.21/22",
    "text": "0.4.21/22\n\nSmall fixes"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-227",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-227",
    "title": "Joe Hasell",
    "section": "0.4.20",
    "text": "0.4.20\n\nadd exec, greetings, onClear, onBlur, onFocus, onTerminalChange"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-228",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-228",
    "title": "Joe Hasell",
    "section": "0.4.19",
    "text": "0.4.19\n\nadd support for ANSI terminal formatting\nfix cancelable ajax on\nadd CTRL+D\nreplace emails with link mailto\nremove formatting processing from command line\nadd text glow option to formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-229",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-229",
    "title": "Joe Hasell",
    "section": "0.4.18",
    "text": "0.4.18\n\nfix scrollbar, better exceptions in chrome, replace urls with links\none style for font and color in root .terminal class"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-230",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-230",
    "title": "Joe Hasell",
    "section": "0.4.17",
    "text": "0.4.17\n\nfix IE formatting issue by adding cross-browser split"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-231",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-231",
    "title": "Joe Hasell",
    "section": "0.4.16",
    "text": "0.4.16\n\nadd reverse history search on CTRL+R\nfix cancel ajax call on CTRL+D"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-232",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-232",
    "title": "Joe Hasell",
    "section": "0.4.15",
    "text": "0.4.15\n\nonly one command from multiply commands is added to history\nCTRL+D is handled even if exit is false"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-233",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-233",
    "title": "Joe Hasell",
    "section": "0.4.14",
    "text": "0.4.14\n\nterminal don’t add space after prompt (prompt need to add this space)\nfix historyFilter\nremove livequery"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-234",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-234",
    "title": "Joe Hasell",
    "section": "0.4.12",
    "text": "0.4.12\n\nhistory return history object\nadd historyFilter\nnew event onCommandChange that execute scroll_to_bottom\nadd event onBeforeLogin"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-235",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-235",
    "title": "Joe Hasell",
    "section": "0.4.11",
    "text": "0.4.11\n\nfix blank lines when echo longer strings"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-236",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-236",
    "title": "Joe Hasell",
    "section": "0.4.10",
    "text": "0.4.10\n\nfix long line formatting and linebreak in the middle of formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-237",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-237",
    "title": "Joe Hasell",
    "section": "0.4.9",
    "text": "0.4.9\n\nfix wrap first line when prompt contain formatting"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-238",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-238",
    "title": "Joe Hasell",
    "section": "0.4.8",
    "text": "0.4.8\n\nfix alt+d and ctrl+u"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-239",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-239",
    "title": "Joe Hasell",
    "section": "0.4.7",
    "text": "0.4.7\n\nfix inserting special characters in Webkit on Windows"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-240",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-240",
    "title": "Joe Hasell",
    "section": "0.4.6",
    "text": "0.4.6\n\nremove undocumented pipe operator\nrefreash prompt on resume"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-241",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-241",
    "title": "Joe Hasell",
    "section": "0.4.5",
    "text": "0.4.5\n\nfix line wrapping when text contains tabulations"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-242",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-242",
    "title": "Joe Hasell",
    "section": "0.4.4",
    "text": "0.4.4\n\nfix line wrapping with scrollbars"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-243",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-243",
    "title": "Joe Hasell",
    "section": "0.4.3",
    "text": "0.4.3\n\nfix JSON-RPC when use without login"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-244",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-244",
    "title": "Joe Hasell",
    "section": "0.4.2",
    "text": "0.4.2\n\nfix formatting when text contain empty lines"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-245",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-245",
    "title": "Joe Hasell",
    "section": "0.4.1",
    "text": "0.4.1\n\nfix formatting when text contains newline characters"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-246",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-246",
    "title": "Joe Hasell",
    "section": "0.4",
    "text": "0.4\n\nfix text formating when text splited into more then one line\nyou can pass nested objects as first argument\nadd tab completion with object passed as first argument"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-247",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-247",
    "title": "Joe Hasell",
    "section": "0.3.8",
    "text": "0.3.8\n\nfix cursor manipulation when command contain new line characters"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-248",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-248",
    "title": "Joe Hasell",
    "section": "0.3.7",
    "text": "0.3.7\n\nfix function terminal.login_name"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-249",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-249",
    "title": "Joe Hasell",
    "section": "0.3.6",
    "text": "0.3.6\n\nfix switch between terminals - when terminal is not visible scroll to current terminal"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-250",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-250",
    "title": "Joe Hasell",
    "section": "0.3.5",
    "text": "0.3.5\n\nfix scrolling in jQuery 1.6"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-251",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-251",
    "title": "Joe Hasell",
    "section": "0.3.3",
    "text": "0.3.3\n\nfixing PAGE UP/DOWN"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-252",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-252",
    "title": "Joe Hasell",
    "section": "0.3.2",
    "text": "0.3.2\n\nfixing cursor in long lines"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-253",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-253",
    "title": "Joe Hasell",
    "section": "0.3.1",
    "text": "0.3.1\n\nfixing small bugs, speed up resizing"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-254",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-254",
    "title": "Joe Hasell",
    "section": "0.3",
    "text": "0.3\n\nfix resizing on start and issue with greetings\nadd formating strings to set style of text.\nadd to echo a function which will be called when terminal is resized"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#rc2",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#rc2",
    "title": "Joe Hasell",
    "section": "0.3-RC2",
    "text": "0.3-RC2\n\nfix manipulation of long line commands"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#rc1",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#rc1",
    "title": "Joe Hasell",
    "section": "0.3-RC1",
    "text": "0.3-RC1\n\nadd callbacks and new functions\nyou can now overwrite keyboard shortcuts\nresizing recalculates lines length and redraw content\nif you create plugin for elements that are not in the DOM\nand then append it to DOM it’s display corectly\nput all dependencies in one file\nDefault greetings show terminal signature depending on width of terminal\nuse Local Sorage for command line history if posible\nremove access to command line (cmd plugin) and add interface to allow interact with it"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-255",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-255",
    "title": "Joe Hasell",
    "section": "0.2.3.9",
    "text": "0.2.3.9\n\nfix append enter character (0x0D) to the command (thanks to marat for reporting the bug)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-256",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-256",
    "title": "Joe Hasell",
    "section": "0.2.3.8",
    "text": "0.2.3.8\n\nupdate mousewheel plugin which fix scrolling in Opera (Thanks for Alexey Dubovtsev for reporting the bug)"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-257",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-257",
    "title": "Joe Hasell",
    "section": "0.2.3.7",
    "text": "0.2.3.7\n\nfix cursor in IE in tilda example"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-258",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-258",
    "title": "Joe Hasell",
    "section": "0.2.3.6",
    "text": "0.2.3.6\n\nfix json serialization in IE"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-259",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-259",
    "title": "Joe Hasell",
    "section": "0.2.3.5",
    "text": "0.2.3.5\n\nfix demos and clipboard textarea transparency in IE"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-260",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-260",
    "title": "Joe Hasell",
    "section": "0.2.3.4",
    "text": "0.2.3.4\n\nfix long lines in command line issue"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-261",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-261",
    "title": "Joe Hasell",
    "section": "0.2.3.3",
    "text": "0.2.3.3\n\nfix Terminal in Internet Exporer"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-262",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-262",
    "title": "Joe Hasell",
    "section": "0.2.3.2",
    "text": "0.2.3.2\n\nfix blank line issue (thanks to Chris Janicki for finding the bug)\nfix CTRL + Arrows scroll on CTRL+V"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-263",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-263",
    "title": "Joe Hasell",
    "section": "0.2.3.1",
    "text": "0.2.3.1\n\nallow CTRL+W CTRL+T"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-264",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-264",
    "title": "Joe Hasell",
    "section": "0.2.3",
    "text": "0.2.3\n\nfix for \"(#$%.{\" characters on Opera/Chrome\nadd cursor move with CTRL+P, CTRL+N, CTRL+F, CTRL+B which also work in Chrome fix Arrow Keys on Chrome (for cursor move and command line history)\nchange License to LGPL3."
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-265",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-265",
    "title": "Joe Hasell",
    "section": "0.2.2",
    "text": "0.2.2\n\nfix down-arrow/open parentises issue in Opera and Chrome"
  },
  {
    "objectID": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-266",
    "href": "site_apps/shinylive/jquery.terminal/CHANGELOG.html#section-266",
    "title": "Joe Hasell",
    "section": "0.2.1",
    "text": "0.2.1\n\nadd support for paste from clipboard with CTRL+V (Copy to clipboard is always enabled on websites)"
  },
  {
    "objectID": "PhD_pages/data_appendices/1_B_prepare_WID.html",
    "href": "PhD_pages/data_appendices/1_B_prepare_WID.html",
    "title": "Appendix 1.B: Preparing WID inequality data",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nimport pandas as pd\n\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad WID data\n\n\n\n\n\nWe load the data from a file prepared from the WID Stata package by Our World in Data.\nThe data was prepared in three separate files according to three income concepts: post_tax disposable income, post_tax national income and pretax national income.\nThese we append into a single file.\n\n# df_wid<- read.csv(\"https://raw.githubusercontent.com/owid/notebooks/main/BetterDataDocs/PabloArriagada/WID/data/final/wid_pretax.csv\")\n\ninc_concepts = [\n  'posttax_dis',\n  'posttax_nat',\n  'pretax'\n]\n\n# filepaths = [f'data/original/wid_{inc_concept}.csv' for inc_concept in inc_concepts]\n\nfilepaths = [f'https://raw.githubusercontent.com/owid/notebooks/main/BetterDataDocs/PabloArriagada/WID/data/final/wid_{inc_concept}.csv' for inc_concept in inc_concepts]\n\nwid_dfs = [pd.read_csv(filepath) for filepath in filepaths]\n\ndf_wid = pd.concat(wid_dfs, keys=inc_concepts)\n\n# Tidy up indexes\ndf_wid = df_wid.reset_index()\n\ndf_wid = df_wid.drop('level_1', axis=1)\n\ndf_wid = df_wid\\\n  .rename(columns={\"level_0\": \"inc_concept\"})\n\nThe resulting dataframe looks like this:\n\ndf_wid.head(50)\n\n\n\n\n\n  \n    \n      \n      inc_concept\n      Entity\n      Year\n      Gini coefficient\n      Palma ratio (S90/S40 ratio)\n      S90/S10 ratio\n      S80/S20 ratio\n      S90/S50 ratio\n      P90/P10 ratio\n      P90/P50 ratio\n      ...\n      P50 - income threshold (median)\n      P60 - income threshold\n      P70 - income threshold\n      P80 - income threshold\n      P90 - income threshold of the top 10%\n      P99.999 - income threshold of the top 0.001%\n      P99.99 - income threshold of the top 0.01%\n      P99.9 - income threshold of the top 0.1%\n      P99 - income threshold of the top 1%\n      P0-P40 - share of the bottom 40%\n    \n  \n  \n    \n      0\n      posttax_dis\n      Albania\n      1996\n      0.443678\n      2.422797\n      -333.000000\n      25.670330\n      1.490303\n      25.732002\n      2.317264\n      ...\n      5598.351958\n      6677.413311\n      8006.281754\n      9828.944789\n      12972.860259\n      3.422160e+05\n      1.510025e+05\n      6.662973e+04\n      29400.308601\n      NaN\n    \n    \n      1\n      posttax_dis\n      Albania\n      2002\n      0.457921\n      2.658412\n      -518.833310\n      27.597702\n      1.622199\n      22.376900\n      2.413228\n      ...\n      6694.514303\n      7975.635075\n      9737.097324\n      12066.302508\n      16155.386192\n      4.734979e+05\n      2.035016e+05\n      8.746166e+04\n      37589.584734\n      NaN\n    \n    \n      2\n      posttax_dis\n      Albania\n      2005\n      0.450608\n      2.535596\n      -3063.000000\n      25.782608\n      1.554034\n      21.295458\n      2.335103\n      ...\n      7686.136668\n      9047.728429\n      10957.297531\n      13599.462132\n      17947.917954\n      5.249345e+05\n      2.257264e+05\n      9.706431e+04\n      41738.495620\n      NaN\n    \n    \n      3\n      posttax_dis\n      Albania\n      2008\n      0.449409\n      2.516900\n      -1526.500000\n      26.379889\n      1.544259\n      23.671341\n      2.287115\n      ...\n      8896.834378\n      10535.777463\n      12746.381573\n      15715.719306\n      20348.079121\n      6.605182e+05\n      2.767225e+05\n      1.159322e+05\n      48569.517624\n      NaN\n    \n    \n      4\n      posttax_dis\n      Albania\n      2012\n      0.448045\n      2.490733\n      441.571440\n      23.009708\n      1.545500\n      20.856731\n      2.309005\n      ...\n      9237.230442\n      10833.767569\n      13111.034275\n      16134.512223\n      21328.810393\n      7.254662e+05\n      3.004032e+05\n      1.243918e+05\n      51508.541439\n      NaN\n    \n    \n      5\n      posttax_dis\n      Albania\n      2015\n      0.454367\n      2.561644\n      99.343750\n      18.937500\n      1.614525\n      14.074163\n      2.474667\n      ...\n      9373.105143\n      11023.116961\n      13685.740204\n      16946.858143\n      23195.315519\n      7.946113e+05\n      3.284476e+05\n      1.357618e+05\n      56116.281830\n      NaN\n    \n    \n      6\n      posttax_dis\n      Albania\n      2016\n      0.461121\n      2.696459\n      71.066666\n      19.140625\n      1.690275\n      16.278803\n      2.567514\n      ...\n      9639.325184\n      11562.745214\n      14300.537763\n      17777.603581\n      24749.103918\n      7.507099e+05\n      3.198851e+05\n      1.363063e+05\n      58081.474818\n      NaN\n    \n    \n      7\n      posttax_dis\n      Albania\n      2017\n      0.454116\n      2.577143\n      68.630432\n      18.078358\n      1.624807\n      15.629199\n      2.510383\n      ...\n      9978.637893\n      11909.588865\n      14669.536394\n      18131.390209\n      25050.198975\n      7.536452e+05\n      3.217940e+05\n      1.374007e+05\n      58667.844949\n      NaN\n    \n    \n      8\n      posttax_dis\n      Albania\n      2018\n      0.447469\n      2.472930\n      72.232559\n      17.850746\n      1.562374\n      15.320574\n      2.447565\n      ...\n      10459.202046\n      12392.437320\n      15164.734593\n      18848.563541\n      25599.579922\n      7.440504e+05\n      3.204498e+05\n      1.380122e+05\n      59439.508772\n      NaN\n    \n    \n      9\n      posttax_dis\n      Austria\n      2004\n      0.326530\n      1.334253\n      8.267806\n      4.805300\n      0.984396\n      3.096185\n      1.762371\n      ...\n      35286.670484\n      39035.236480\n      43363.663231\n      49921.128086\n      62188.220292\n      2.431403e+06\n      1.320109e+06\n      7.774640e+05\n      211588.042089\n      NaN\n    \n    \n      10\n      posttax_dis\n      Austria\n      2005\n      0.345903\n      1.465773\n      9.363914\n      5.291109\n      1.077410\n      3.403942\n      1.855844\n      ...\n      34716.135165\n      38197.112972\n      42718.653949\n      49946.254954\n      64427.749511\n      3.612437e+06\n      1.702892e+06\n      7.095053e+05\n      248950.528592\n      NaN\n    \n    \n      11\n      posttax_dis\n      Austria\n      2006\n      0.367595\n      1.633964\n      10.285267\n      5.700629\n      1.200512\n      3.426140\n      1.898158\n      ...\n      34663.420551\n      38676.077697\n      43407.700010\n      50532.721225\n      65796.645717\n      4.996613e+06\n      3.172447e+06\n      1.139762e+06\n      242768.542032\n      NaN\n    \n    \n      12\n      posttax_dis\n      Austria\n      2007\n      0.350346\n      1.488813\n      9.656152\n      5.438356\n      1.093214\n      3.486120\n      1.921174\n      ...\n      36767.860475\n      41341.468466\n      47024.544231\n      54943.652176\n      70637.453336\n      1.698754e+06\n      1.433770e+06\n      8.638599e+05\n      247555.469358\n      NaN\n    \n    \n      13\n      posttax_dis\n      Austria\n      2008\n      0.347730\n      1.468288\n      9.652038\n      5.304982\n      1.084155\n      3.364637\n      1.913161\n      ...\n      37081.428241\n      41027.512140\n      46463.463867\n      54460.542813\n      70942.731826\n      8.245163e+06\n      2.147393e+06\n      7.680208e+05\n      221238.961102\n      NaN\n    \n    \n      14\n      posttax_dis\n      Austria\n      2009\n      0.335487\n      1.370213\n      9.288462\n      5.154689\n      1.006250\n      3.405491\n      1.881750\n      ...\n      34889.950919\n      38569.223749\n      43501.083884\n      51367.088655\n      65654.173788\n      9.567820e+06\n      1.983310e+06\n      5.631204e+05\n      205141.575820\n      NaN\n    \n    \n      15\n      posttax_dis\n      Austria\n      2010\n      0.339232\n      1.411793\n      9.365931\n      5.190012\n      1.035216\n      3.315426\n      1.846056\n      ...\n      35778.198642\n      39896.932616\n      44373.141615\n      51523.937298\n      66048.561994\n      1.400596e+06\n      1.400468e+06\n      1.184037e+06\n      206816.527636\n      NaN\n    \n    \n      16\n      posttax_dis\n      Austria\n      2011\n      0.332465\n      1.364235\n      9.174050\n      5.098540\n      0.998278\n      3.253533\n      1.789999\n      ...\n      37501.331875\n      41360.248857\n      46049.906710\n      53181.015363\n      67127.333543\n      7.742503e+06\n      2.371002e+06\n      7.773831e+05\n      210209.431887\n      NaN\n    \n    \n      17\n      posttax_dis\n      Austria\n      2012\n      0.314739\n      1.235832\n      8.450000\n      4.772674\n      0.907687\n      3.301658\n      1.836239\n      ...\n      37611.682860\n      41727.696916\n      46606.971956\n      54286.468019\n      69064.045150\n      4.139564e+06\n      1.108600e+06\n      4.574044e+05\n      183772.599610\n      NaN\n    \n    \n      18\n      posttax_dis\n      Austria\n      2013\n      0.310547\n      1.219973\n      7.929824\n      4.594071\n      0.898906\n      3.165626\n      1.805434\n      ...\n      37121.320382\n      41132.034729\n      45785.167960\n      53036.989193\n      67020.091036\n      2.418154e+06\n      1.461007e+06\n      6.258436e+05\n      184835.958287\n      NaN\n    \n    \n      19\n      posttax_dis\n      Austria\n      2014\n      0.324911\n      1.323705\n      8.491177\n      4.828107\n      0.974350\n      3.100024\n      1.764432\n      ...\n      36268.820161\n      40043.031105\n      44370.680736\n      51127.735812\n      63993.857724\n      3.006590e+06\n      1.731662e+06\n      8.180580e+05\n      201882.465663\n      NaN\n    \n    \n      20\n      posttax_dis\n      Austria\n      2015\n      0.310730\n      1.226906\n      8.290909\n      4.648899\n      0.901780\n      3.050093\n      1.711939\n      ...\n      36770.062314\n      40566.421167\n      44807.940041\n      50986.688602\n      62948.113758\n      1.168543e+06\n      1.159790e+06\n      8.295021e+05\n      201581.461331\n      NaN\n    \n    \n      21\n      posttax_dis\n      Austria\n      2016\n      0.330063\n      1.350535\n      9.251593\n      5.032491\n      0.990116\n      3.163156\n      1.756769\n      ...\n      36751.411444\n      40493.371923\n      45240.407108\n      51834.526105\n      64563.745444\n      2.149281e+06\n      1.742189e+06\n      9.534938e+05\n      198458.606147\n      NaN\n    \n    \n      22\n      posttax_dis\n      Bosnia and Herzegovina\n      1980\n      0.323922\n      1.247872\n      11.590697\n      5.407459\n      0.899964\n      3.839829\n      1.797241\n      ...\n      1639.240511\n      1994.820908\n      2171.272102\n      2437.436675\n      2946.110056\n      1.765769e+05\n      5.606848e+04\n      1.840047e+04\n      6626.441560\n      NaN\n    \n    \n      23\n      posttax_dis\n      Bosnia and Herzegovina\n      1981\n      0.323916\n      1.247872\n      11.590697\n      5.407459\n      0.899964\n      3.839418\n      1.797382\n      ...\n      1636.711278\n      1991.845340\n      2168.147755\n      2433.865994\n      2941.795482\n      1.763219e+05\n      5.598621e+04\n      1.837309e+04\n      6616.473407\n      NaN\n    \n    \n      24\n      posttax_dis\n      Bosnia and Herzegovina\n      1982\n      0.323933\n      1.247872\n      11.590697\n      5.407459\n      0.899964\n      3.839744\n      1.797327\n      ...\n      1636.264943\n      1991.101448\n      2167.552641\n      2432.973323\n      2940.902812\n      1.762545e+05\n      5.596835e+04\n      1.836818e+04\n      6614.836844\n      NaN\n    \n    \n      25\n      posttax_dis\n      Bosnia and Herzegovina\n      1983\n      0.323813\n      1.247371\n      11.586046\n      5.406077\n      0.899603\n      3.840825\n      1.797468\n      ...\n      1633.735710\n      1989.018550\n      2164.428295\n      2429.700198\n      2936.588238\n      1.760670e+05\n      5.588861e+04\n      1.833679e+04\n      6602.934572\n      NaN\n    \n    \n      26\n      posttax_dis\n      Bosnia and Herzegovina\n      1984\n      0.332829\n      1.310010\n      11.930233\n      5.586014\n      0.944404\n      3.875636\n      1.842521\n      ...\n      1600.409346\n      1958.667755\n      2149.848011\n      2431.634317\n      2948.788067\n      1.966119e+05\n      6.113870e+04\n      1.959516e+04\n      6855.560310\n      NaN\n    \n    \n      27\n      posttax_dis\n      Bosnia and Herzegovina\n      1985\n      0.329238\n      1.283461\n      11.785047\n      5.511142\n      0.923810\n      3.874683\n      1.827472\n      ...\n      1616.031079\n      1975.926051\n      2162.940511\n      2451.273067\n      2953.251420\n      1.812664e+05\n      5.725261e+04\n      1.868121e+04\n      6684.465140\n      NaN\n    \n    \n      28\n      posttax_dis\n      Bosnia and Herzegovina\n      1986\n      0.330885\n      1.283854\n      11.850962\n      5.697540\n      0.914996\n      4.151808\n      1.839873\n      ...\n      1634.330823\n      1997.945255\n      2205.044800\n      2515.396562\n      3006.960425\n      1.246632e+05\n      4.461567e+04\n      1.642811e+04\n      6502.211589\n      NaN\n    \n    \n      29\n      posttax_dis\n      Bosnia and Herzegovina\n      1987\n      0.335034\n      1.321058\n      12.186603\n      5.715308\n      0.946840\n      4.125128\n      1.858080\n      ...\n      1610.228721\n      1968.338352\n      2168.742869\n      2466.746022\n      2991.933806\n      1.699842e+05\n      5.540225e+04\n      1.860459e+04\n      6786.973464\n      NaN\n    \n    \n      30\n      posttax_dis\n      Bosnia and Herzegovina\n      1990\n      0.320483\n      1.215903\n      11.185185\n      5.347165\n      0.873464\n      3.852868\n      1.805231\n      ...\n      1655.308579\n      2028.444829\n      2215.310511\n      2498.882158\n      2988.214346\n      1.388150e+05\n      4.702499e+04\n      1.650756e+04\n      6361.467214\n      NaN\n    \n    \n      31\n      posttax_dis\n      Bosnia and Herzegovina\n      2001\n      0.449018\n      2.542276\n      62.540001\n      18.671875\n      1.576109\n      16.790304\n      2.282341\n      ...\n      7427.315736\n      8770.933548\n      10367.177099\n      12791.223717\n      16951.663148\n      9.660877e+05\n      3.277422e+05\n      1.132455e+05\n      41170.258907\n      NaN\n    \n    \n      32\n      posttax_dis\n      Bosnia and Herzegovina\n      2004\n      0.448017\n      2.494118\n      37.857143\n      15.062112\n      1.591592\n      12.100798\n      2.491139\n      ...\n      7614.330196\n      8913.165707\n      10929.113150\n      13588.080876\n      18968.354483\n      4.784235e+05\n      2.217401e+05\n      1.015686e+05\n      45307.935241\n      NaN\n    \n    \n      33\n      posttax_dis\n      Bosnia and Herzegovina\n      2007\n      0.446135\n      2.476790\n      39.848103\n      15.405751\n      1.570858\n      12.668105\n      2.453044\n      ...\n      8546.873264\n      9964.136389\n      12123.506218\n      14997.756302\n      20965.853402\n      4.764216e+05\n      2.281581e+05\n      1.077264e+05\n      49305.611092\n      NaN\n    \n    \n      34\n      posttax_dis\n      Bosnia and Herzegovina\n      2011\n      0.445600\n      2.457562\n      36.193180\n      14.569277\n      1.572063\n      11.591341\n      2.461620\n      ...\n      8413.865367\n      9742.754116\n      11890.668008\n      14743.196444\n      20711.739880\n      7.115255e+05\n      2.922715e+05\n      1.202510e+05\n      49670.862086\n      NaN\n    \n    \n      35\n      posttax_dis\n      Bosnia and Herzegovina\n      2015\n      0.443763\n      2.420532\n      34.978024\n      14.191176\n      1.559530\n      11.082072\n      2.427410\n      ...\n      9608.407213\n      11177.870650\n      13642.682552\n      16955.828943\n      23323.544850\n      8.772548e+05\n      3.535390e+05\n      1.425581e+05\n      57563.854243\n      NaN\n    \n    \n      36\n      posttax_dis\n      Belgium\n      1985\n      0.351327\n      1.384282\n      21.644068\n      7.483577\n      0.968525\n      6.848332\n      2.068584\n      ...\n      23829.068265\n      27899.253575\n      32625.798097\n      39228.214895\n      49292.433060\n      8.818798e+05\n      4.287973e+05\n      2.084946e+05\n      101376.582380\n      NaN\n    \n    \n      37\n      posttax_dis\n      Belgium\n      1988\n      0.370274\n      1.548986\n      14.790322\n      7.517361\n      1.090369\n      6.423766\n      2.194749\n      ...\n      25194.860150\n      29659.959058\n      36011.518790\n      42503.997708\n      55296.400849\n      1.539870e+06\n      6.703277e+05\n      2.918035e+05\n      127026.357897\n      NaN\n    \n    \n      38\n      posttax_dis\n      Belgium\n      1991\n      0.368910\n      1.498574\n      23.666666\n      8.297088\n      1.042047\n      6.839683\n      2.149004\n      ...\n      28077.428760\n      32664.492048\n      39096.969197\n      49400.671544\n      60338.510227\n      1.206567e+06\n      5.705741e+05\n      2.698192e+05\n      127595.002107\n      NaN\n    \n    \n      39\n      posttax_dis\n      Belgium\n      1992\n      0.374494\n      1.542874\n      22.191668\n      8.248566\n      1.074657\n      6.738485\n      2.188536\n      ...\n      27621.990502\n      32363.829592\n      38835.131415\n      51993.558415\n      60451.716177\n      1.323129e+06\n      6.117217e+05\n      2.828170e+05\n      130754.572345\n      NaN\n    \n    \n      40\n      posttax_dis\n      Belgium\n      1993\n      0.375440\n      1.543174\n      25.931372\n      8.527668\n      1.071718\n      6.342574\n      2.209555\n      ...\n      27384.074994\n      32278.467599\n      38399.693746\n      51535.374978\n      60506.619756\n      1.171194e+06\n      5.583706e+05\n      2.662048e+05\n      126913.936284\n      NaN\n    \n    \n      41\n      posttax_dis\n      Belgium\n      1994\n      0.381199\n      1.597403\n      30.404495\n      9.146138\n      1.104039\n      7.695202\n      2.243350\n      ...\n      28217.040718\n      33113.132720\n      39294.752804\n      49518.975684\n      63300.689026\n      1.306447e+06\n      6.129441e+05\n      2.875742e+05\n      134920.838917\n      NaN\n    \n    \n      42\n      posttax_dis\n      Belgium\n      1995\n      0.373736\n      1.551127\n      22.754238\n      8.313461\n      1.078313\n      6.813639\n      2.250014\n      ...\n      28612.607931\n      33690.927526\n      39921.699385\n      49321.061355\n      64378.760013\n      1.214490e+06\n      5.827483e+05\n      2.796199e+05\n      134169.836393\n      NaN\n    \n    \n      43\n      posttax_dis\n      Belgium\n      1996\n      0.376857\n      1.576182\n      25.961538\n      8.507843\n      1.094003\n      6.346833\n      2.251962\n      ...\n      28619.144071\n      33712.888957\n      39877.253630\n      49481.196793\n      64449.219606\n      1.236080e+06\n      5.906622e+05\n      2.822487e+05\n      134872.863647\n      NaN\n    \n    \n      44\n      posttax_dis\n      Belgium\n      1997\n      0.373875\n      1.580496\n      23.817390\n      8.161290\n      1.096477\n      5.784953\n      2.153851\n      ...\n      30487.042256\n      35769.158707\n      41906.594481\n      51014.313870\n      65664.549540\n      1.641316e+06\n      7.340521e+05\n      3.282929e+05\n      146823.804081\n      NaN\n    \n    \n      45\n      posttax_dis\n      Belgium\n      1998\n      0.386830\n      1.684940\n      27.155340\n      8.959432\n      1.161545\n      6.504806\n      2.323375\n      ...\n      30387.954369\n      35771.511717\n      42407.524277\n      52293.959425\n      70602.603563\n      1.426664e+06\n      6.728934e+05\n      3.173738e+05\n      149690.947401\n      NaN\n    \n    \n      46\n      posttax_dis\n      Belgium\n      1999\n      0.383610\n      1.651079\n      26.228571\n      8.784000\n      1.138017\n      6.885853\n      2.306537\n      ...\n      31224.711055\n      36985.142255\n      43371.474253\n      53264.184096\n      72020.946016\n      1.358278e+06\n      6.517876e+05\n      3.127690e+05\n      150086.253168\n      NaN\n    \n    \n      47\n      posttax_dis\n      Belgium\n      2000\n      0.389392\n      1.697917\n      27.166666\n      9.134297\n      1.169198\n      6.751075\n      2.354764\n      ...\n      31990.877425\n      38023.473508\n      46006.192422\n      57582.742738\n      75330.978204\n      1.426642e+06\n      6.838798e+05\n      3.278268e+05\n      157148.029909\n      NaN\n    \n    \n      48\n      posttax_dis\n      Belgium\n      2001\n      0.380524\n      1.620155\n      27.724489\n      8.758064\n      1.115353\n      6.319833\n      2.237169\n      ...\n      32423.700638\n      38281.389606\n      45501.602389\n      55852.364946\n      72537.301102\n      1.423077e+06\n      6.761790e+05\n      3.212883e+05\n      152661.100292\n      NaN\n    \n    \n      49\n      posttax_dis\n      Belgium\n      2002\n      0.385071\n      1.665060\n      30.043478\n      9.045455\n      1.144988\n      6.501324\n      2.251273\n      ...\n      32086.958688\n      37881.247095\n      44751.776369\n      54902.271587\n      72236.507924\n      1.554368e+06\n      7.216963e+05\n      3.350852e+05\n      155580.794180\n      NaN\n    \n  \n\n50 rows × 57 columns\n\n\n\n\n\n\n\n\n\n\n\n\nDrop subnational, regional and historical geographical entities\n\n\n\n\n\nHere we create a list of entities in the WID data that do not correspond to countries in existence today. These we drop from the data.\n\ndrop_entities =  [\n  \"China - rural\",\n  \"China - urban\",\n  \"East Germany\",\n  \"Other Russia and Central Asia\",\n  \"Other East Asia\",\n  \"Other Western Europe\",\n  \"Other Latin America\",\n  \"Other MENA\",\n  \"Other South & South-East Asia\",\n  \"Other Sub-Saharan Africa\",\n  \"Africa\",\n  \"Asia\",\n  \"Europe\",\n  \"Oceania\",\n  \"Central Asia\",\n  \"East Africa\",\n  \"East Asia\",\n  \"South Asia\",\n  \"Eastern Europe\",\n  \"Middle Africa\",\n  \"North Africa\",\n  \"North America\",\n  \"South-East Asia\",\n  \"South Africa region\",\n  \"West Africa\",\n  \"West Asia\",\n  \"Western Europe\",\n  \"European Union\",\n  \"World\",\n  \"Asia (excluding Middle East)\",\n  \"North America and Oceania\",\n  \"Sub-Saharan Africa\",\n  \"Latin America\",\n  \"Middle East\",\n  \"MENA\",\n  \"Russia and Central Asia\",\n  \"South & South-East Asia\"\n]\n\ndf_wid = df_wid.loc[~df_wid[\"Entity\"].isin(drop_entities)]\n\n\n\n\n\n\n\n\n\n\nCalculate some additional inequality metrics\n\n\n\n\n\n\n# Gini as index\ndf_wid[\"Gini\"] = df_wid['Gini coefficient'] * 100\n\n\n\n\n\n\n\n\n\n\nRename and select needed variables\n\n\n\n\n\n\ndf_wid = df_wid.rename(columns={\n    'P90-P100 - share of the top 10%':'Top_10_share',\n    'P0-P50 - share of the bottom 50%':'Bottom_50_share',\n    'P99-P100 - share of the top 1%':'Top_1_share'\n  })\n\nkeep_cols = [\n  \"Year\",\n  \"Entity\",\n  \"Gini\",\n  \"Top_10_share\",\n  \"Bottom_50_share\",\n  \"inc_concept\"\n]\n\ndf_wid = df_wid[keep_cols]\n\n\n\n\n\n\n\n\n\n\nPivot the data wider by income concept\n\n\n\n\n\n\ndf_wid = df_wid.set_index(['Year','Entity','inc_concept']).unstack()\n\ndf_wid.columns = df_wid.columns.map(lambda x: '{}_{}'.format(x[0], x[1]))\n\ndf_wid = df_wid.reset_index()\n\ndf_wid = df_wid.sort_values(by=['Entity', 'Year'])\n\n\n\n\n\n\n\n\n\n\nSee the prepared WID data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_wid.head(100)\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini_posttax_dis\n      Gini_posttax_nat\n      Gini_pretax\n      Top_10_share_posttax_dis\n      Top_10_share_posttax_nat\n      Top_10_share_pretax\n      Bottom_50_share_posttax_dis\n      Bottom_50_share_posttax_nat\n      Bottom_50_share_pretax\n    \n  \n  \n    \n      2986\n      2008\n      Afghanistan\n      NaN\n      NaN\n      52.452389\n      NaN\n      NaN\n      41.94\n      NaN\n      NaN\n      17.16\n    \n    \n      3318\n      2012\n      Afghanistan\n      NaN\n      NaN\n      49.265584\n      NaN\n      NaN\n      38.76\n      NaN\n      NaN\n      19.00\n    \n    \n      3742\n      2017\n      Afghanistan\n      NaN\n      NaN\n      51.539312\n      NaN\n      NaN\n      41.01\n      NaN\n      NaN\n      17.79\n    \n    \n      2192\n      1996\n      Albania\n      44.367788\n      41.414440\n      46.762984\n      29.97\n      28.65\n      32.57\n      20.11\n      22.10\n      18.80\n    \n    \n      2523\n      2002\n      Albania\n      45.792148\n      42.288218\n      48.169805\n      31.13\n      29.51\n      33.64\n      19.19\n      21.54\n      17.96\n    \n    \n      2739\n      2005\n      Albania\n      45.060796\n      41.501583\n      47.448188\n      30.63\n      29.00\n      33.12\n      19.71\n      22.10\n      18.43\n    \n    \n      2987\n      2008\n      Albania\n      44.940856\n      41.277974\n      47.213163\n      30.53\n      28.86\n      33.07\n      19.77\n      22.23\n      18.59\n    \n    \n      3319\n      2012\n      Albania\n      44.804508\n      40.975732\n      46.751532\n      30.91\n      29.12\n      33.00\n      20.00\n      22.56\n      19.05\n    \n    \n      3571\n      2015\n      Albania\n      45.436682\n      41.710782\n      49.306721\n      31.79\n      30.01\n      35.23\n      19.69\n      22.17\n      17.61\n    \n    \n      3659\n      2016\n      Albania\n      46.112099\n      42.233368\n      50.504972\n      31.98\n      30.14\n      35.78\n      18.92\n      21.53\n      16.48\n    \n    \n      3743\n      2017\n      Albania\n      45.411562\n      41.619377\n      49.776038\n      31.57\n      29.77\n      35.45\n      19.43\n      21.98\n      17.06\n    \n    \n      3816\n      2018\n      Albania\n      44.746907\n      41.062778\n      49.126580\n      31.06\n      29.33\n      35.03\n      19.88\n      22.36\n      17.49\n    \n    \n      362\n      1932\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      383\n      1933\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      408\n      1934\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      435\n      1935\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      460\n      1936\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      485\n      1937\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      509\n      1938\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      534\n      1939\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      557\n      1940\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      576\n      1941\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      668\n      1946\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      688\n      1947\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      711\n      1948\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      737\n      1949\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      764\n      1950\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      790\n      1951\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      817\n      1952\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      845\n      1953\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      875\n      1954\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      904\n      1955\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      960\n      1957\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1824\n      1988\n      Algeria\n      NaN\n      NaN\n      60.861157\n      NaN\n      NaN\n      51.09\n      NaN\n      NaN\n      13.27\n    \n    \n      2138\n      1995\n      Algeria\n      NaN\n      NaN\n      54.793733\n      NaN\n      NaN\n      42.81\n      NaN\n      NaN\n      15.34\n    \n    \n      3234\n      2011\n      Algeria\n      NaN\n      NaN\n      48.798551\n      NaN\n      NaN\n      38.08\n      NaN\n      NaN\n      19.02\n    \n    \n      2139\n      1995\n      Angola\n      NaN\n      NaN\n      68.246577\n      NaN\n      NaN\n      58.03\n      NaN\n      NaN\n      9.15\n    \n    \n      2405\n      2000\n      Angola\n      NaN\n      NaN\n      68.246581\n      NaN\n      NaN\n      58.03\n      NaN\n      NaN\n      9.15\n    \n    \n      2988\n      2008\n      Angola\n      NaN\n      NaN\n      60.936785\n      NaN\n      NaN\n      49.32\n      NaN\n      NaN\n      12.23\n    \n    \n      3817\n      2018\n      Angola\n      NaN\n      NaN\n      68.559672\n      NaN\n      NaN\n      58.01\n      NaN\n      NaN\n      9.04\n    \n    \n      363\n      1932\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      384\n      1933\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      409\n      1934\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      436\n      1935\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      461\n      1936\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      486\n      1937\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      510\n      1938\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      535\n      1939\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      558\n      1940\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      577\n      1941\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      595\n      1942\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      610\n      1943\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      629\n      1944\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      646\n      1945\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      669\n      1946\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      689\n      1947\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      712\n      1948\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      738\n      1949\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      765\n      1950\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      791\n      1951\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      818\n      1952\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      846\n      1953\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      876\n      1954\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      933\n      1956\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      991\n      1958\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1020\n      1959\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1069\n      1961\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2463\n      2001\n      Argentina\n      NaN\n      61.275055\n      66.088806\n      NaN\n      47.46\n      50.54\n      NaN\n      10.86\n      7.85\n    \n    \n      2524\n      2002\n      Argentina\n      NaN\n      62.559468\n      66.674702\n      NaN\n      49.18\n      51.58\n      NaN\n      10.41\n      7.79\n    \n    \n      2593\n      2003\n      Argentina\n      NaN\n      58.788309\n      61.895195\n      NaN\n      45.85\n      47.99\n      NaN\n      12.71\n      10.96\n    \n    \n      2665\n      2004\n      Argentina\n      NaN\n      57.168198\n      60.244077\n      NaN\n      44.27\n      46.24\n      NaN\n      13.55\n      11.78\n    \n    \n      2740\n      2005\n      Argentina\n      NaN\n      56.009221\n      59.255115\n      NaN\n      42.66\n      44.64\n      NaN\n      14.02\n      12.09\n    \n    \n      2822\n      2006\n      Argentina\n      NaN\n      54.506041\n      57.935620\n      NaN\n      41.33\n      43.49\n      NaN\n      14.76\n      12.73\n    \n    \n      2903\n      2007\n      Argentina\n      NaN\n      55.349858\n      58.750425\n      NaN\n      43.11\n      45.31\n      NaN\n      14.85\n      12.86\n    \n    \n      2989\n      2008\n      Argentina\n      NaN\n      55.500095\n      58.648372\n      NaN\n      43.94\n      45.44\n      NaN\n      15.01\n      13.06\n    \n    \n      3064\n      2009\n      Argentina\n      NaN\n      52.588365\n      56.898668\n      NaN\n      39.82\n      42.39\n      NaN\n      15.78\n      13.22\n    \n    \n      3147\n      2010\n      Argentina\n      NaN\n      52.869671\n      57.094291\n      NaN\n      41.21\n      43.63\n      NaN\n      16.21\n      13.64\n    \n    \n      3235\n      2011\n      Argentina\n      NaN\n      50.721697\n      55.481900\n      NaN\n      39.26\n      42.05\n      NaN\n      17.36\n      14.43\n    \n    \n      3320\n      2012\n      Argentina\n      NaN\n      48.685044\n      53.666061\n      NaN\n      36.11\n      39.05\n      NaN\n      18.00\n      14.95\n    \n    \n      3407\n      2013\n      Argentina\n      NaN\n      48.957375\n      54.173771\n      NaN\n      36.77\n      40.13\n      NaN\n      17.97\n      14.87\n    \n    \n      3487\n      2014\n      Argentina\n      NaN\n      50.984577\n      55.939785\n      NaN\n      38.30\n      41.35\n      NaN\n      16.80\n      13.83\n    \n    \n      3572\n      2015\n      Argentina\n      NaN\n      51.498334\n      56.288187\n      NaN\n      39.82\n      43.24\n      NaN\n      16.90\n      14.45\n    \n    \n      3660\n      2016\n      Argentina\n      NaN\n      52.012087\n      56.671475\n      NaN\n      41.34\n      45.29\n      NaN\n      17.01\n      15.13\n    \n    \n      3744\n      2017\n      Argentina\n      NaN\n      52.525841\n      58.135411\n      NaN\n      42.86\n      46.41\n      NaN\n      17.12\n      13.76\n    \n    \n      3818\n      2018\n      Argentina\n      NaN\n      53.612730\n      58.662965\n      NaN\n      43.86\n      46.85\n      NaN\n      16.53\n      13.46\n    \n    \n      2193\n      1996\n      Armenia\n      NaN\n      NaN\n      58.842226\n      NaN\n      NaN\n      46.77\n      NaN\n      NaN\n      13.48\n    \n    \n      2352\n      1999\n      Armenia\n      NaN\n      NaN\n      55.291180\n      NaN\n      NaN\n      44.17\n      NaN\n      NaN\n      15.68\n    \n    \n      2525\n      2002\n      Armenia\n      NaN\n      NaN\n      53.526514\n      NaN\n      NaN\n      42.91\n      NaN\n      NaN\n      16.84\n    \n    \n      2594\n      2003\n      Armenia\n      NaN\n      NaN\n      52.679758\n      NaN\n      NaN\n      42.55\n      NaN\n      NaN\n      17.53\n    \n    \n      2666\n      2004\n      Armenia\n      NaN\n      NaN\n      55.557885\n      NaN\n      NaN\n      45.67\n      NaN\n      NaN\n      16.14\n    \n    \n      2741\n      2005\n      Armenia\n      NaN\n      NaN\n      54.878909\n      NaN\n      NaN\n      45.00\n      NaN\n      NaN\n      16.48\n    \n    \n      2823\n      2006\n      Armenia\n      NaN\n      NaN\n      48.488536\n      NaN\n      NaN\n      37.77\n      NaN\n      NaN\n      19.32\n    \n    \n      2904\n      2007\n      Armenia\n      NaN\n      NaN\n      49.655285\n      NaN\n      NaN\n      38.41\n      NaN\n      NaN\n      18.56\n    \n    \n      2990\n      2008\n      Armenia\n      NaN\n      NaN\n      48.113928\n      NaN\n      NaN\n      36.96\n      NaN\n      NaN\n      19.33\n    \n    \n      3065\n      2009\n      Armenia\n      NaN\n      NaN\n      47.468036\n      NaN\n      NaN\n      36.37\n      NaN\n      NaN\n      19.74\n    \n    \n      3148\n      2010\n      Armenia\n      NaN\n      NaN\n      49.801407\n      NaN\n      NaN\n      39.12\n      NaN\n      NaN\n      18.78\n    \n    \n      3236\n      2011\n      Armenia\n      NaN\n      NaN\n      48.204984\n      NaN\n      NaN\n      37.29\n      NaN\n      NaN\n      19.48\n    \n    \n      3321\n      2012\n      Armenia\n      NaN\n      NaN\n      48.179293\n      NaN\n      NaN\n      37.70\n      NaN\n      NaN\n      19.63\n    \n    \n      3408\n      2013\n      Armenia\n      NaN\n      NaN\n      48.938826\n      NaN\n      NaN\n      37.99\n      NaN\n      NaN\n      19.06\n    \n    \n      3488\n      2014\n      Armenia\n      NaN\n      NaN\n      49.911902\n      NaN\n      NaN\n      39.16\n      NaN\n      NaN\n      18.57\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave the data\n\n\n\n\n\nI save the prepared data locally:\n\ndf_wid.to_csv(\"data/clean/wid.csv\", index=False)"
  },
  {
    "objectID": "PhD_pages/data_appendices/3_C_calc_factor_shares.html",
    "href": "PhD_pages/data_appendices/3_C_calc_factor_shares.html",
    "title": "Calculating housing and factor shares from industry data",
    "section": "",
    "text": "I moved the data folder, but haven’t yet relected this in the code below.\n\n\n\nWe take the prepared KLEMS and OECD generation of income by industry data and calculate the labour and capital share of income, separating the housing share from the latter.\n(Possibly public sector too?).\nThe key elements are this:\n\nWe use factor income as the denominator\n(Explain… Jump to section)\nWe impute capital and labour components for the self-employed\n(Explain… Jump to section))\nWe prepare two alternative specifications relating to the above imputation, to handle where labour income is greater than 100% of value added\n(Explain… Jump to section))\n\n\n\n\n\nNational accounting practices separates compensation of employees from value added (as well as taxes on production). Gross operating surplus is the residual.\n\n\n\nFor the purposes of calculating factor shares, this residual includes mixed income - the income of the self-employed which is generated by both their labour and capital inputs.\nWithin the KLEMS data, this is already separated out - using employment data… (explain).\nWe do the same process for OECD data.\n\n\n\n\n\n\n\n\n\nTO DO: This was split out from the OECD data prep. I want to process the KLEMS data at the same time.\n\n\n\n\nWe have data on the number of employed and self-employed hours are worked in each industry. We also have data on the compensation of the employed. The task is to impute the labour compensation of the self-employed and then separate this out from Gross Operating Surplus in order to arrive at a split between capital and labour income.\nThe basic strategy is to apply the same hourly rate of compensation for the employed (within each industry) to the self-employed.\n\n# main_industry_accounts_inspect<- main_industry_accounts %>%\n#   mutate(COMP_per_hour = COMP/employed_hrs,\n#          COMP_SE = COMP_per_hour * self_employed_hrs,\n#          LAB = COMP + COMP_SE)\n\nThis however creates a problem: in some cases, the total labour income implied (employed + self employed) is greater than 100% of value added. Here we show these rows grouped by industry.\n\n# kable(\n#  br<-  main_industry_accounts_inspect %>%\n#   mutate(LAB_share = LAB/VA,\n#          LAB_share_group = cut(LAB_share,\n#                        breaks=c(-100, 1, 1.1, 1.5, 2, 10, 1000000000000),\n#                        labels=c('<100%', '100-110%', '110-150%', '150-200%', '200-1,000%', '1,000+'))) %>%\n#     count(ind_code, LAB_share_group) %>%\n#     pivot_wider(names_from = LAB_share_group, values_from = n)\n# )\n\nWe take two approaches to this problem.\n\n\nThe most simple approach is just to ignore the problem and allow labour income to be greater than value added. This will mean allowing capital income to be negative.\n\n# main_industry_accounts_mod1<- main_industry_accounts %>%\n#    mutate(COMP_per_hour = COMP/employed_hrs,\n#          COMP_SE = COMP_per_hour * self_employed_hrs)\n\n\n\n\nAn alternative approach is to cap self-employed labour income at the full value of Gross Operating Surplus. This implies that total labour incomes cannot exceed 100% of value added and total capital incomes cannot be negative.\n\n# main_industry_accounts_mod2<- main_industry_accounts %>%\n#   mutate(COMP_per_hour = COMP/employed_hrs,\n#          COMP_SE = pmin(COMP_per_hour * self_employed_hrs, GOS))\n\n\n\n\nOn each model, total labour income is equal to the sum of compensation of employees and the self-employed. Total gross (net) capital income is equal to Gross (Net) Operating Surplus minus the labour income of the self-employed.\n\n# calc_LAB_CAP<- function(df){\n#   df<- df %>%\n#     mutate(LAB = COMP + COMP_SE,\n#            CAP = GOS - COMP_SE,\n#            NCAP = NOS - COMP_SE)\n# }\n# \n# main_industry_accounts_mod1<- calc_LAB_CAP(main_industry_accounts_mod1)\n# \n# main_industry_accounts_mod2<- calc_LAB_CAP(main_industry_accounts_mod2)\n\n\n\n\n\nFor the calculation of factor shares, we will use the sum across industries as the denominator - rather than the reported economy-wide aggregate.\nthe reason for this. The implicit assumption is that whatever is ‘missing’ from the aggregate has a factor split equal to that found in the available industry-level data.\nHere we calculate the sum across industries.\n\n# agg_across_industries<- function(df){\n#   \n#   df<- df %>%\n#     group_by(country, year) %>%\n#     summarise(VA = sum(VA, na.rm = TRUE),\n#               COMP = sum(COMP, na.rm = TRUE),\n#               GOS = sum(GOS, na.rm = TRUE),\n#               COMP_SE = sum(COMP_SE, na.rm = TRUE),\n#               LAB = sum(LAB, na.rm = TRUE),\n#               CAP = sum(CAP, na.rm = TRUE),\n#               NCAP = sum(NCAP, na.rm = TRUE)\n#               )\n#  \n# }\n# \n# agg_industry_mod1<- agg_across_industries(main_industry_accounts_mod1)\n# agg_industry_mod2<- agg_across_industries(main_industry_accounts_mod2)"
  },
  {
    "objectID": "PhD_pages/data_appendices/3_A_prepare_KLEMS.html",
    "href": "PhD_pages/data_appendices/3_A_prepare_KLEMS.html",
    "title": "Appendix 3.A: Preparing EU KLEMS industry data",
    "section": "",
    "text": "I moved the data folder, but haven’t yet relected this in the code below.\n\n\n\nThe titles in each of the boxes below summarise the steps taken to prepare the KLEMS industry data. In each case you can expand the box to see the code used.\n\n\n\n\n\n\nLoad libraries and functions\n\n\n\n\n\n\nlibrary(tidyverse)\nlibrary(readxl) # For handling xls source data files\nlibrary(knitr)\n\n\nsource(\"PhD_pages/scripts/general_functions.R\")\n\n\n\n\n\n\n\n\n\n\nSpecify the location of four original data files\n\n\n\n\n\nWe obtain data from four KLEMS datasets:\n\nEU KLEMS version …\nCanada…\nAn additional series for the US (different industry classification, longer series..)\nJapan\n\nHere we specify corresponding lists of URLs where the original files are located, short names for the files, and local filepaths where a copy of the original data files will be saved.\n\nfiles<- c(\"32_countries\",\n          \"CAN\",\n          \"USA\")\n\n# The urls where the files can be retrieved\ndownload_urls<- c(\"http://www.euklems.net/data/09i/all_countries_09I.txt\",\n               \"https://www.worldklems.net/data/basic/CAN_WK_07_2012.xlsx\",\n               \"https://www.worldklems.net/data/basic/usa_wk_apr_2013.xlsx\"\n)\n\n# JAPAN OLD: \"https://www.worldklems.net/data/basic/JPN_wk_may_2013.xlsx\"\n\nnames(download_urls)<- files\n\n# uses the last part of the download urls as the filenames\nfilenames<- sub(\".*\\\\/\", \"\", download_urls)\n\nnames(filenames)<- files\n\n# The directory where the copies will be saved\nfp<- \"PhD_pages/data/original/KLEMS/\"\n\n# Append this directory to the file names to specify file paths\nfilepaths<- paste0(fp, filenames)\n\nnames(filepaths)<- files\n\n\n\n\n\n\n\n\n\n\nSave a local copy of the original data files\n\n\n\n\n\nIf a new copy of the original data is required, the grab_original variable can be set to TRUE. Otherwise this step is skipped.\n\ngrab_original<- FALSE\n\nif (grab_original){\n  for (file in files){\n    print(paste0(\"Downloading \", file))\n    download.file(download_urls[file], filepaths[file])\n  }\n}\n\n\n\n\n\n\n\n\n\n\nLoad locally saved copies of original data as data frames\n\n\n\n\n\n\ndf_list<- list()\n\nImporting the main data file - with data for 32 countries.\n\ndf_list[[\"32_countries\"]]<- read.csv(filepaths[\"32_countries\"], quote=\"\")\n\n# convert to long format and rename variables\ndf_list[[\"32_countries\"]]<- df_list[[\"32_countries\"]] %>%\n  pivot_longer(cols = starts_with(\"X_\"), names_to = \"year\",\n    names_prefix = \"X_\", values_to =\"value\",\n    names_transform = list(year=as.integer),\n    values_transform = list(value=as.character)) %>%\n  rename(country = X.country,\n         transaction = var)\n\n# Remove quotations (Ideally this would be handled by specifying the right format in the read.csv command above. But I was unable to find the right format specification)\ndf_list[[\"32_countries\"]]<- df_list[[\"32_countries\"]] %>%\n  mutate(country = str_replace(country, '\"', ''),\n         value = as.numeric(str_replace(value, '\"', '')))\n\n# Recode the Entity name for US: 'USA-NAICS' -> 'USA'\ndf_list[[\"32_countries\"]]<- df_list[[\"32_countries\"]] %>%\n  mutate(country = if_else(country == \"USA-NAICS\",\n                           \"USA\",\n                           country))\n\nData for Canada and the alternative series for the US.\n\ncountries<- c(\"CAN\", \"USA\")\n\nfor (country in countries){\ndf_list[[country]]<- as.data.frame(read_excel(filepaths[country],\n                                                         sheet = 'DATA'))\n\n# convert to long format and rename variables\ndf_list[[country]]<- df_list[[country]] %>%\n  pivot_longer(cols = starts_with(\"_\"), names_to = \"year\",\n    names_prefix = \"_\", values_to =\"value\",\n    names_transform = list(year=as.integer)) %>%\n  rename(transaction = Variable) %>%\n  mutate(country = country)\n\n}\n\n\n\n\n\n\n\n\n\n\nTidying Canada data\n\n\n\n\n\n\n# Drop some NA values (- data for 2009 and 2010 is given as missing)\ndf_list[[\"CAN\"]]<- df_list[[\"CAN\"]] %>%\n  filter(!is.na(value))\n\n\n# For Canada we need to calculate some industry aggregates to be comparable with other countries\nagg_industries<- list()\n\nagg_industries[['D']]<- c(\n  \"15t16\",\n  \"17t19\",\n  \"20\",\n  \"21t22\",\n  \"23\",\n  \"24\",\n  \"25\",\n  \"26\",\n  \"27t28\",\n  \"29\",\n  \"30t33\",\n  \"34t35\",\n  \"36t37\")\n\nagg_industries[['G']]<- c(\n  \"50\",\n  \"52\")\n\nagg_industries[['I']]<- c(\n  \"60t63\",\n  \"64\")\n\nagg_industries[['K']]<- c(\n  \"70\",\n  \"71t74\")\n\nfor (agg_ind in names(agg_industries)){\n  print(paste0(\"Adding aggregate data for industry: \", agg_ind))\n  \n  df_totals<- df_list[[\"CAN\"]] %>%\n  filter(code %in% agg_industries[[agg_ind]]) %>%\n    group_by(transaction, year) %>%\n    summarise(value = sum(value)) %>%\n    ungroup() %>%\n    mutate(code = agg_ind) %>%\n    mutate(country = \"CAN\")\n\n  \n  df_list[[\"CAN\"]]<- bind_rows(df_list[[\"CAN\"]], df_totals)\n  \n}\n\n\n\n\n\n\n\n\n\n\nTidying Japan data - OLD, TO DELETE\n\n\n\n\n\n\n# Drop NA values\n# df_list[[\"JPN\"]]<- df_list[[\"JPN\"]] %>% filter(is.na(value))\n# \n# # Rename the capital compensation variable, to agree with other files\n# df_list[[\"JPN\"]]<- df_list[[\"JPN\"]] %>%\n#   mutate(transaction = replace(transaction,\n#                                transaction == \"CAP_GFCF\",\n#                                \"CAP\"))\n\n\n\n\n\n\n\n\n\n\nJoin the different dataframes together into a single dataframe\n\n\n\n\n\n\ndf<- bind_rows(\n  df_list, .id = \"source\"\n)\n\n# Make a copy of the original merged dataframe, for use later on.\ndf_orig<- df\n\n\n\n\n\n\n\n\n\n\nDrop duplicate series for the US\n\n\n\n\n\nData for the US is included in the main data file using the NAICS industry classification.\nA separate source provides a much longer series using SIC classification.\nHere we show the data for aggregate Value Added from the two datasets.\n\ndf %>%\n  filter(country %in% c(\"USA\"),\n         code == \"TOT\",\n transaction == \"VA\") %>%\n  ggplot(aes(x = year, y = value, shape = source, colour = source, alpha=0.5)) +\n  geom_point()\n\nWe drop the shorter NAICS data in favour of the SIC data.\n\ndf<- df %>%\n  filter(!(country == \"USA\" & source == \"32_countries\"))\n\n\n\n\n\n\n\n\n\n\nStandardize country names\n\n\n\n\n\nHere is the mapping of country names we use to standardize across data sources.\n\nKLEMS_country_mapping<- read.csv(paste0(fp, \"KLEMS_country_name_mapping\", \".csv\"))\n\nkable(KLEMS_country_mapping)\n\nHere we map the joined KLEMS data sets to these standardized names.\n\ndf<- map_names(\n  df = df, \n  df_mapping = KLEMS_country_mapping, \n  old_country_varname_df = \"country\", \n  old_country_varname_df_mapping = \"Country_KLEMS\",\n  new_country_varname_df_mapping = \"Our_World_In_Data_country_name\",\n  new_country_varname_final = \"country\"\n)\n\n\n\n\n\n\n\n\n\n\nSelect relevant transactions and convert to wide format\n\n\n\n\n\nWe keep only the transactions we need: Value Added, Capital income, Labour income and Compensation of employees. And we spread the data to a wider format.\n\ndf<- df %>%\n  filter(transaction %in% c(\"VA\", \"CAP\", \"LAB\", \"COMP\"))\n\ndf<- df %>%\n  pivot_wider(id_cols = c(country, year, code),\n              names_from = \"transaction\",\n              values_from = \"value\")\n\n\n\n\n\n\n\n\n\n\nReplace some NA values with 0\n\n\n\n\n\nThere are many (r df %>% filter(VA == CAP & is.na(LAB)) %>% count() %>% as.numeric()) country-year-industry observations where where CAP is 100% of VA, but LAB is missing.\nMost of these (r df %>% filter(VA == CAP & is.na(LAB) & VA == 0) %>% count() %>% as.numeric()) are where both capital income and value added equal zero. Such observations appear only for the following industries:\n\nkable(\n  df %>% filter(VA == CAP & is.na(LAB) & VA == 0) %>% count(code) \n)\n\nThere are also a small number of such observations where VA>0, listed here:\n\nkable(\n  df %>% filter(VA == CAP & is.na(LAB) & VA>0)\n)\n\nFor both cases (i.e. where LAB is NA and either VA = CAP = 0 or VA = CAP > 0) we set LAB = 0.\n\ndf<- df %>%\n  mutate(LAB = replace(LAB,\n                       VA==CAP & is.na(LAB),\n                       0))\n\nThere is a similar set of country-year-industry observations (n = r df %>% filter(VA == LAB & is.na(CAP)) %>% count() %>% as.numeric()) where VA = LAB but CAP is NA. These we list here.\n\nkable(\n  df %>% filter(VA == LAB & is.na(CAP) & VA>0)\n)\n\nFor these cases (i.e. where CAP is NA and VA = LAB) we set CAP = 0.\n\ndf<- df %>%\n  mutate(CAP = replace(CAP,\n                       VA==LAB & is.na(CAP),\n                       0))\n\n\n\n\n\n\n\n\n\n\nFilter and store data for main industries and the aggregate economy separately\n\n\n\n\n\n\n# This list gives the codes of the main industries\nmain_industry_codes<- c(\"AtB\",\n                        \"C\",\n                        \"D\",\n                        \"E\",\n                        \"F\",\n                        \"G\",\n                        \"H\",\n                        \"I\",\n                        \"J\",\n                        \"K\",\n                        \"L\",\n                        \"M\",\n                        \"N\",\n                        \"O\",\n                        \"P\",\n                        \"Q\")\n\n# filter for these codes\nmain_industry_accounts<- df %>%\n  filter(code %in% main_industry_codes)\n\n\n# Store reported totals separately\n\nreported_totals<- df %>%\n  filter(code == \"TOT\") %>%\n  select(-code)\n\n\n\n\n\n\n\n\n\n\nDrop country-year-industry observations that do not have all variables needed\n\n\n\n\n\nThere are some observations (n=r main_industry_accounts %>% filter(is.na(VA) & is.na(CAP) & is.na(LAB)) %>% count() %>% as.numeric()`) without …. . We group these by country and industry.\n\nkable(\n  main_industry_accounts %>% filter(is.na(VA) | is.na(CAP) | is.na(LAB)) %>% count(country, code)\n)\n\nWe filter these out.\n\n  # TODO check if COMP is needed, and add in check here and/or calculate it where missing? if so)\n\nmain_industry_accounts<- main_industry_accounts %>% filter(!(is.na(VA) & is.na(CAP) & is.na(LAB)) )\n\n\n\n\n\n\n\n\n\n\nAdd industry code descriptions\n\n\n\n\n\nHere are the industry descriptions provided in the data.\n\nindustry_descriptions<- df_orig %>%\n  filter(code %in% main_industry_codes) %>%\n  select(code, desc) %>%\n  drop_na() %>%\n  unique() %>%\n  arrange(code)\n\nkable(industry_descriptions)\n\nWe join these back into the clean dataframe.\n\nmain_industry_accounts<- left_join(main_industry_accounts, industry_descriptions)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCalculate aggregate across industries and merge with reported economy-wide totals\n\n\n\n\n\n\nagg_industries<- main_industry_accounts %>%\n    group_by(country, year) %>%\n    summarise(VA = sum(VA, na.rm = TRUE),\n              CAP = sum(CAP, na.rm = TRUE),\n              COMP = sum(COMP, na.rm = TRUE),\n              LAB = sum(LAB, na.rm = TRUE)\n              )\n\nreported_totals <- reported_totals %>%\n  rename(VA_reported = VA,\n         CAP_reported = CAP,\n         COMP_reported = COMP,\n         LAB_reported = LAB)\n\ncheck_totals<- left_join(agg_industries, reported_totals) %>%\n  mutate(VA_ratio = VA/VA_reported,\n         CAP_ratio = CAP/CAP_reported,\n         COMP_ratio = COMP/COMP_reported,\n         LAB_ratio = LAB/LAB_reported)\n\ntolerance<- 0.001 # tenth of a percent tolerance\n\n\n\n\nIn general the sum across industries is very close to to the reported economy-wide aggregate. In the table below we show all observations where the ratio deviates from 100% by more than r tolerance*100`%.\nNote that in Canada - which is one of the countries we will go on to use this data for - the sum across available industries falls short of the reported aggregate (for value added, Capital income, Labour income and Compensation of employees) by around 5%, with no trend over time.\n\nValue addedCapital incomeLabour incomeComp. of employees\n\n\n\nkable(\n  check_totals %>%\n  filter(VA_ratio<(1-tolerance) | VA_ratio>(1+tolerance)) %>%\n    select(country, year, VA_ratio, VA, VA_reported)\n)\n\n\n\n\nkable(\n  check_totals %>%\n  filter(CAP_ratio<(1-tolerance) | CAP_ratio>(1+tolerance)) %>%\n    select(country, year, CAP_ratio, CAP, CAP_reported)\n)\n\n\n\n\nkable(\n  check_totals %>%\n  filter(LAB_ratio<(1-tolerance) | LAB_ratio>(1+tolerance)) %>%\n    select(country, year, LAB_ratio, LAB, LAB_reported)\n)\n\n\n\n\nkable(\n  check_totals %>%\n  filter(COMP_ratio<(1-tolerance) | COMP_ratio>(1+tolerance)) %>%\n    select(country, year, COMP_ratio, COMP, COMP_reported)\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWrite cleaned data to csv\n\n\n\n\n\n\nfp<- \"PhD_pages/data/clean/\"\n\nwrite.csv(main_industry_accounts, paste0(fp, \"KLEMS_gen_income_by_industry\", \".csv\"))"
  },
  {
    "objectID": "PhD_pages/data_appendices/3_B_prepare_OECD.html",
    "href": "PhD_pages/data_appendices/3_B_prepare_OECD.html",
    "title": "Appendix 3.B: Preparing OECD industry data",
    "section": "",
    "text": "I moved the data folder, but haven’t yet relected this in the code below.\n\n\n\nThe titles in each of the boxes below summarise the steps taken to prepare the OECD industry data. In each case you can expand the box to see the code used.\n\n\n\n\n\n\nLoad libraries and functions\n\n\n\n\n\n\nlibrary(tidyverse)\nlibrary(rsdmx)\nlibrary(knitr)\n\nsource(\"PhD_pages/scripts/general_functions.R\")\n\n\n\n\n\n\n\n\n\n\nLoad industry generation of income and employment data\n\n\n\n\n\n\nfp<- \"PhD_pages/data/original/OECD/\"\n\nload(paste0(fp, \"industry_accounts\", \".Rda\"))\nload(paste0(fp, \"employment_by_industry\", \".Rda\"))\n\n\n\n\n\n\n\n\n\n\nStandardize country names\n\n\n\n\n\nHere is the mapping of country names we use to standardize across data sources.\n\nOECD_country_mapping<- read.csv(paste0(fp, \"OECD_country_name_mapping\", \".csv\"))\n\nkable(OECD_country_mapping)\n\nHere we map the two data sets to these standardized names.\n\nindustry_accounts<- map_names(\n  df = industry_accounts, \n  df_mapping = OECD_country_mapping, \n  old_country_varname_df = \"LOCATION\", \n  old_country_varname_df_mapping = \"OECD_country_name\",\n  new_country_varname_df_mapping = \"Our_World_In_Data_country_name\",\n  new_country_varname_final = \"country\"\n)\n\nemployment_by_industry<- map_names(\n  df = employment_by_industry, \n  df_mapping = OECD_country_mapping, \n  old_country_varname_df = \"LOCATION\", \n  old_country_varname_df_mapping = \"OECD_country_name\",\n  new_country_varname_df_mapping = \"Our_World_In_Data_country_name\",\n  new_country_varname_final = \"country\"\n)\n\n\n\n\n\n\n\n\n\n\nClean year variable in both files\n\n\n\n\n\n\nclean_year<- function(df){\n  df<- df %>%\n    mutate(year = as.numeric(obsTime))\n}\n\nindustry_accounts<- clean_year(industry_accounts)\nemployment_by_industry<- clean_year(employment_by_industry)\n\n\n\n\n\n\n\n\n\n\nFurther tidying of industry generation of income data\n\n\n\n\n\n\n# Filter for only current price data and the needed transactions\nindustry_accounts<- industry_accounts %>%\n  filter(MEASURE == \"C\" & \n           TRANSACT %in% c(\"B1GA\", \"D1A\",\"B2G_B3GA\", \"B2N_B3NA\", \"D29_D39A\"))\n\n\n# Recode transactions from national accounts codes to something more legible\nrecoding_transactions <- c(\n  B1GA = \"VA\", # (Gross) Value added\n  D1A = \"COMP\", # Compensation of employees\n  B2G_B3GA = \"GOS\", # Gross operating surplus\n  B2N_B3NA = \"NOS\", # Net operating surplus (net of depreciation)\n  D29_D39A = \"TOP\") # Taxes on production\n\nindustry_accounts<- industry_accounts %>%\n  mutate(TRANSACT = recode(TRANSACT, !!!recoding_transactions))\n\n\n# flip to wide format\nindustry_accounts<- industry_accounts %>%\n  pivot_wider(names_from = TRANSACT, values_from = obsValue)\n\n\n# Select and rename needed vars\nindustry_accounts<- industry_accounts %>%\n  rename(ind_code = ACTIVITY) %>%\n  select(country, year, ind_code, VA, COMP, GOS, NOS, TOP)\n\n\n\n\n\n\n\n\n\n\nFilter and store generation of income data for main industries and the aggregate economy separately\n\n\n\n\n\n\n# Main aggregate industries\n\nmain_industry_codes<- c(\"VA0\", \"VB\", \"VC\", \"VD\", \"VE\", \"VF\", \"VG\", \"VH\", \"VI\",\n                        \"VJ\", \"VK\", \"VL\", \"VM\", \"VN\", \"VO\", \"VP\", \"VQ\", \"VR\",\n                        \"VS\", \"VT\", \"VU\")\n\n# Filter industry data for main industry codes only\nmain_industry_accounts<- industry_accounts %>%\n  filter(ind_code %in% main_industry_codes)\n\n# Store economy-wide aggregates separately\nreported_totals <- industry_accounts %>%\n  filter(ind_code == 'VTOT')\n\n\n\n\n\n\n\n\n\n\nFurther tidying of industry employment data.\n\n\n\n\n\n\n# Select self-employed and employed hours and flip to wide format\nemployment_by_industry<- employment_by_industry %>%\n  filter(TRANSACT %in% c(\"ESEA\", \"EEMA\")) %>%  # codes for self-employed and employed\n  pivot_wider(id_cols = c(country, year, ACTIVITY), names_from = TRANSACT, values_from = obsValue)\n  \n  \n# Select and rename needed vars\nemployment_by_industry<- employment_by_industry %>%\n  rename(self_employed_hrs = ESEA, \n         employed_hrs = EEMA,\n         ind_code = ACTIVITY)\n\n\n\n\n\n\n\n\n\n\nJoin generation of income and employment data\n\n\n\n\n\n\nmain_industry_accounts<- left_join(main_industry_accounts, employment_by_industry)\n\n\n\n\n\n\n\n\n\n\nFilter out observations where the implied wage is infinite\n\n\n\n\n\nIn the joined data, there are a small number of rows where employed hours = 0 but compensation of employees > 0 — implying an infinite wage.\nHere we show these illogical rows, grouped by country and industry.\n\nkable(\n  main_industry_accounts %>%\n  filter((COMP>0 & employed_hrs == 0))\n)\n\nWe drop these.\n\nmain_industry_accounts<- main_industry_accounts %>%\n  filter(!(COMP>0 & employed_hrs == 0))\n\n\n\n\n\n\n\n\n\n\nFilter out country-year-industry observations without all the variables we need\n\n\n\n\n\nThere are some rows where we do not have all the variables we will need for the calculations: VA, COMP, GOS, and employed and self-employed hours.\n\nkable(\n  main_industry_accounts %>%\n    filter(is.na(VA) | is.na(COMP) | is.na(GOS) | is.na(employed_hrs) | is.na(self_employed_hrs)) %>%\n    count(country, ind_code)\n)\n\nWe drop these.\n\nmain_industry_accounts<-  main_industry_accounts %>%\n    filter(!(is.na(VA) | is.na(COMP) | is.na(GOS) | is.na(employed_hrs) | is.na(self_employed_hrs)))\n\n\n\n\n\n\n\n\n\n\nFilter out country-year observations with partial industry coverage\n\n\n\n\n\nThe objective is to have complete coverage of the economy. There are some country years where coverage across industries looks decidedly incomplete.\nFor instance, out of r length(main_industry_codes)` aggregate industry codes, these country years have data for fewer than 18:\n\nkable( \n to_drop<- main_industry_accounts %>%\n   count(country, year) %>%\n   filter(n<18)\n)\n\nWe drop these country-years with apparently incomplete data.\n\nmain_industry_accounts<- left_join(main_industry_accounts, to_drop) %>%\n  filter(is.na(n)) %>%\n  select(-n)\n\nBut because of differences in national accounting methods, missing data for a given industry does not imply the accounts are incomplete.\nIn particular, the dataset contains only r main_industry_accounts %>% filter(ind_code == “VU”)%>%count()country-year observations forVU(as compared to r main_industry_accounts %>% filter(ind_code == \"VA0\")%>%count() for VA0) and these are in general only NA or 0 values.\n\nsummary(main_industry_accounts %>% filter(ind_code == \"VU\"))\n\nIn the table below we show all remaining country years in which at least one industry — other than VU — is missing.\nWe assume that these apparent gaps do not indicate incompleteness of the data, rather just differences in national accounting practices.\n\nkable( main_industry_accounts %>%\n  select(year, country, ind_code, VA) %>%\n  pivot_wider(names_from = ind_code, values_from = VA) %>%\n  filter(if_any(VA0:VT, ~ is.na(.)))\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCalculate aggregate across industries and merge with reported economy-wide totals\n\n\n\n\n\n\nagg_industries<- main_industry_accounts %>%\n    group_by(country, year) %>%\n    summarise(VA = sum(VA, na.rm = TRUE),\n              COMP = sum(COMP, na.rm = TRUE),\n              GOS = sum(GOS, na.rm = TRUE),\n              NOS = sum(NOS, na.rm = TRUE)\n              )\n\nreported_totals <- reported_totals %>%\n  rename(VA_reported = VA,\n         COMP_reported = COMP,\n         GOS_reported = GOS,\n         NOS_reported = NOS) %>%\n  select(-ind_code)\n\ncheck_totals<- left_join(agg_industries, reported_totals) %>%\n  mutate(VA_ratio = VA/VA_reported,\n         COMP_ratio = COMP/COMP_reported,\n         GOS_ratio = GOS/GOS_reported,\n         NOS_ratio = NOS/NOS_reported)\n\ntolerance<- 0.005 # half a percent tolerance\n\n\n\n\nIn general the sum across industries is very close to to the reported economy-wide aggregate. In the table below we show all observations where the ratio deviates from 100% by more than r tolerance*100`%.\nNote that in Finland - which is one of the countries we will go on to use this data for - the sum across available industries falls short of the reported aggregate (for value added, compensation of employees and gross operating surplus) by around 5%, with no trend over time.\n\nValue addedComp. of employeesGross operating surplus\n\n\n\nkable(\n  check_totals %>%\n  filter(VA_ratio<(1-tolerance) | VA_ratio>(1+tolerance)) %>%\n    select(country, year, VA_ratio, VA, VA_reported)\n)\n\n\n\n\nkable(\n  check_totals %>%\n  filter(COMP_ratio<(1-tolerance) | COMP_ratio>(1+tolerance)) %>%\n    select(country, year, COMP_ratio, COMP, COMP_reported)\n)\n\n\n\n\nkable(\n  check_totals %>%\n  filter(GOS_ratio<(1-tolerance) | GOS_ratio>(1+tolerance)) %>%\n    select(country, year, GOS_ratio, GOS, GOS_reported)\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWrite cleaned data to csv\n\n\n\n\n\n\nfp<- \"PhD_pages/data/clean/\"\n\nwrite.csv(main_industry_accounts, paste0(fp, \"OECD_gen_income_and_employment_by_industry\", \".csv\"))"
  },
  {
    "objectID": "PhD_pages/data_appendices/1_D_prepare_population.html",
    "href": "PhD_pages/data_appendices/1_D_prepare_population.html",
    "title": "Appendix 1.D: Preparing population data",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nfrom owid import catalog\nimport pandas as pd\n\n\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad population data from Our World in Data\n\n\n\n\n\nI grab the main population series prepared by Our World in Data.\n\nresults = catalog.find('population')\nowid_pop = results[results['path'] == 'garden/owid/latest/key_indicators/population']\n\ndf_pop = owid_pop.iloc[0].load().reset_index().rename(columns={'year':'Year', 'country': 'Entity'})\n\ndf_pop.head()\n\n\n\n\n\n  \n    \n      \n      Entity\n      Year\n      population\n      world_pop_share\n    \n  \n  \n    \n      0\n      Afghanistan\n      -10000\n      14737\n      0.33\n    \n    \n      1\n      Afghanistan\n      -9000\n      20405\n      0.36\n    \n    \n      2\n      Afghanistan\n      -8000\n      28253\n      0.39\n    \n    \n      3\n      Afghanistan\n      -7000\n      39120\n      0.41\n    \n    \n      4\n      Afghanistan\n      -6000\n      54166\n      0.41\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nCheck there is population data for each country in WID, PIP, and LIS.\n\n\n\n\n\nAll countries in the PIP data are matched:\n\ndf_pip = pd.read_csv(\"data/clean/pip.csv\")\n\ncheck_pip = pd.merge(df_pip, df_pop, how = 'left')\ncheck_pip[check_pip['population'].isna()]\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini\n      Top_10_share\n      Bottom_50_share\n      MLD\n      welfare_type\n      population\n      world_pop_share\n    \n  \n  \n  \n\n\n\n\nThere is no population data for Zanzibar, present in the WID data.\n\ndf_wid = pd.read_csv(\"data/clean/wid.csv\")\n\ncheck_wid = pd.merge(df_wid, df_pop, how = 'left')\ncheck_wid[check_wid['population'].isna()]\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini_posttax_dis\n      Gini_posttax_nat\n      Gini_pretax\n      Top_10_share_posttax_dis\n      Top_10_share_posttax_nat\n      Top_10_share_pretax\n      Bottom_50_share_posttax_dis\n      Bottom_50_share_posttax_nat\n      Bottom_50_share_pretax\n      population\n      world_pop_share\n    \n  \n  \n    \n      3815\n      1957\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3816\n      1958\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3817\n      1959\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3818\n      1960\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3819\n      1961\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3820\n      1962\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3821\n      1963\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nAdd in Zanzibar population\n\n\n\n\n\nWID release their own population data, but this currently insn’t gathered in our data pipeline. For now I make up a population series for Zanzibar based on two data points from Wikipedia. At some point I will come back and replaces this with the WID population data.\n\nzanz_pop_1978 = 476111\nzanz_pop_2022 = 1889773\n\n# Assume a constant growth rate\nzanz_g = pow(zanz_pop_2022/zanz_pop_1978, 1/(2022-1978))-1\n\nyear = 2022\npop = zanz_pop_1978 * pow(1+zanz_g, year - 1978)\n\ndf_zanz_pop = df_wid[df_wid['Entity'] == \"Zanzibar\"].copy()\ndf_zanz_pop['population'] = zanz_pop_1978 * pow(1+zanz_g, df_zanz_pop['Year'] - 1978)\n\ndf_zanz_pop = df_zanz_pop[['Entity', 'Year', 'population']]\n\ndf_pop = pd.concat([df_pop, df_zanz_pop])\n\n\n\n\n\n\n\n\n\n\nSee the prepared data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_pop.head(100)\n\n\n\n\n\n  \n    \n      \n      Entity\n      Year\n      population\n      world_pop_share\n    \n  \n  \n    \n      0\n      Afghanistan\n      -10000\n      14737.0\n      0.33\n    \n    \n      1\n      Afghanistan\n      -9000\n      20405.0\n      0.36\n    \n    \n      2\n      Afghanistan\n      -8000\n      28253.0\n      0.39\n    \n    \n      3\n      Afghanistan\n      -7000\n      39120.0\n      0.41\n    \n    \n      4\n      Afghanistan\n      -6000\n      54166.0\n      0.41\n    \n    \n      5\n      Afghanistan\n      -5000\n      74999.0\n      0.39\n    \n    \n      6\n      Afghanistan\n      -4000\n      306250.0\n      1.06\n    \n    \n      7\n      Afghanistan\n      -3000\n      537500.0\n      1.21\n    \n    \n      8\n      Afghanistan\n      -2000\n      768751.0\n      1.06\n    \n    \n      9\n      Afghanistan\n      -1000\n      999998.0\n      0.91\n    \n    \n      10\n      Afghanistan\n      0\n      1999997.0\n      0.86\n    \n    \n      11\n      Afghanistan\n      100\n      2250002.0\n      0.95\n    \n    \n      12\n      Afghanistan\n      200\n      2500001.0\n      1.04\n    \n    \n      13\n      Afghanistan\n      300\n      2500001.0\n      1.10\n    \n    \n      14\n      Afghanistan\n      400\n      2500001.0\n      1.04\n    \n    \n      15\n      Afghanistan\n      500\n      2500001.0\n      0.99\n    \n    \n      16\n      Afghanistan\n      600\n      2500001.0\n      0.92\n    \n    \n      17\n      Afghanistan\n      700\n      2425001.0\n      0.87\n    \n    \n      18\n      Afghanistan\n      800\n      2350008.0\n      0.82\n    \n    \n      19\n      Afghanistan\n      900\n      2299999.0\n      0.74\n    \n    \n      20\n      Afghanistan\n      1000\n      2250002.0\n      0.70\n    \n    \n      21\n      Afghanistan\n      1100\n      2375009.0\n      0.60\n    \n    \n      22\n      Afghanistan\n      1200\n      2500001.0\n      0.56\n    \n    \n      23\n      Afghanistan\n      1300\n      1749998.0\n      0.38\n    \n    \n      24\n      Afghanistan\n      1400\n      1874998.0\n      0.42\n    \n    \n      25\n      Afghanistan\n      1500\n      1999997.0\n      0.40\n    \n    \n      26\n      Afghanistan\n      1600\n      2500001.0\n      0.48\n    \n    \n      27\n      Afghanistan\n      1700\n      2500001.0\n      0.42\n    \n    \n      28\n      Afghanistan\n      1710\n      2561614.0\n      0.42\n    \n    \n      29\n      Afghanistan\n      1720\n      2619846.0\n      0.41\n    \n    \n      30\n      Afghanistan\n      1730\n      2679387.0\n      0.40\n    \n    \n      31\n      Afghanistan\n      1740\n      2740283.0\n      0.39\n    \n    \n      32\n      Afghanistan\n      1750\n      2802568.0\n      0.38\n    \n    \n      33\n      Afghanistan\n      1760\n      2866257.0\n      0.37\n    \n    \n      34\n      Afghanistan\n      1770\n      2931400.0\n      0.36\n    \n    \n      35\n      Afghanistan\n      1780\n      2998015.0\n      0.34\n    \n    \n      36\n      Afghanistan\n      1790\n      3066156.0\n      0.33\n    \n    \n      37\n      Afghanistan\n      1800\n      3280000.0\n      0.33\n    \n    \n      38\n      Afghanistan\n      1801\n      3280000.0\n      0.33\n    \n    \n      39\n      Afghanistan\n      1802\n      3280000.0\n      0.33\n    \n    \n      40\n      Afghanistan\n      1803\n      3280000.0\n      0.33\n    \n    \n      41\n      Afghanistan\n      1804\n      3280000.0\n      0.33\n    \n    \n      42\n      Afghanistan\n      1805\n      3280000.0\n      0.33\n    \n    \n      43\n      Afghanistan\n      1806\n      3280000.0\n      0.33\n    \n    \n      44\n      Afghanistan\n      1807\n      3280000.0\n      0.33\n    \n    \n      45\n      Afghanistan\n      1808\n      3280000.0\n      0.32\n    \n    \n      46\n      Afghanistan\n      1809\n      3280000.0\n      0.32\n    \n    \n      47\n      Afghanistan\n      1810\n      3280000.0\n      0.32\n    \n    \n      48\n      Afghanistan\n      1811\n      3280000.0\n      0.32\n    \n    \n      49\n      Afghanistan\n      1812\n      3280000.0\n      0.32\n    \n    \n      50\n      Afghanistan\n      1813\n      3280000.0\n      0.32\n    \n    \n      51\n      Afghanistan\n      1814\n      3280000.0\n      0.31\n    \n    \n      52\n      Afghanistan\n      1815\n      3280000.0\n      0.31\n    \n    \n      53\n      Afghanistan\n      1816\n      3280000.0\n      0.31\n    \n    \n      54\n      Afghanistan\n      1817\n      3280000.0\n      0.31\n    \n    \n      55\n      Afghanistan\n      1818\n      3280000.0\n      0.30\n    \n    \n      56\n      Afghanistan\n      1819\n      3282935.0\n      0.30\n    \n    \n      57\n      Afghanistan\n      1820\n      3288817.0\n      0.30\n    \n    \n      58\n      Afghanistan\n      1821\n      3297661.0\n      0.30\n    \n    \n      59\n      Afghanistan\n      1822\n      3309479.0\n      0.30\n    \n    \n      60\n      Afghanistan\n      1823\n      3324285.0\n      0.30\n    \n    \n      61\n      Afghanistan\n      1824\n      3339157.0\n      0.30\n    \n    \n      62\n      Afghanistan\n      1825\n      3354095.0\n      0.30\n    \n    \n      63\n      Afghanistan\n      1826\n      3369101.0\n      0.30\n    \n    \n      64\n      Afghanistan\n      1827\n      3384173.0\n      0.30\n    \n    \n      65\n      Afghanistan\n      1828\n      3399313.0\n      0.30\n    \n    \n      66\n      Afghanistan\n      1829\n      3414520.0\n      0.29\n    \n    \n      67\n      Afghanistan\n      1830\n      3429796.0\n      0.29\n    \n    \n      68\n      Afghanistan\n      1831\n      3445140.0\n      0.29\n    \n    \n      69\n      Afghanistan\n      1832\n      3460553.0\n      0.29\n    \n    \n      70\n      Afghanistan\n      1833\n      3476034.0\n      0.29\n    \n    \n      71\n      Afghanistan\n      1834\n      3491585.0\n      0.29\n    \n    \n      72\n      Afghanistan\n      1835\n      3507205.0\n      0.29\n    \n    \n      73\n      Afghanistan\n      1836\n      3522896.0\n      0.29\n    \n    \n      74\n      Afghanistan\n      1837\n      3538656.0\n      0.29\n    \n    \n      75\n      Afghanistan\n      1838\n      3554487.0\n      0.29\n    \n    \n      76\n      Afghanistan\n      1839\n      3570389.0\n      0.29\n    \n    \n      77\n      Afghanistan\n      1840\n      3586362.0\n      0.29\n    \n    \n      78\n      Afghanistan\n      1841\n      3602406.0\n      0.29\n    \n    \n      79\n      Afghanistan\n      1842\n      3618522.0\n      0.29\n    \n    \n      80\n      Afghanistan\n      1843\n      3634711.0\n      0.29\n    \n    \n      81\n      Afghanistan\n      1844\n      3650971.0\n      0.29\n    \n    \n      82\n      Afghanistan\n      1845\n      3667305.0\n      0.29\n    \n    \n      83\n      Afghanistan\n      1846\n      3683711.0\n      0.29\n    \n    \n      84\n      Afghanistan\n      1847\n      3700191.0\n      0.29\n    \n    \n      85\n      Afghanistan\n      1848\n      3716745.0\n      0.29\n    \n    \n      86\n      Afghanistan\n      1849\n      3734342.0\n      0.29\n    \n    \n      87\n      Afghanistan\n      1850\n      3752993.0\n      0.29\n    \n    \n      88\n      Afghanistan\n      1851\n      3769828.0\n      0.29\n    \n    \n      89\n      Afghanistan\n      1852\n      3787706.0\n      0.30\n    \n    \n      90\n      Afghanistan\n      1853\n      3806634.0\n      0.30\n    \n    \n      91\n      Afghanistan\n      1854\n      3825655.0\n      0.30\n    \n    \n      92\n      Afghanistan\n      1855\n      3844769.0\n      0.30\n    \n    \n      93\n      Afghanistan\n      1856\n      3863976.0\n      0.30\n    \n    \n      94\n      Afghanistan\n      1857\n      3883276.0\n      0.30\n    \n    \n      95\n      Afghanistan\n      1858\n      3902671.0\n      0.30\n    \n    \n      96\n      Afghanistan\n      1859\n      3922160.0\n      0.30\n    \n    \n      97\n      Afghanistan\n      1860\n      3941745.0\n      0.30\n    \n    \n      98\n      Afghanistan\n      1861\n      3961424.0\n      0.30\n    \n    \n      99\n      Afghanistan\n      1862\n      3981200.0\n      0.30\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave\n\n\n\n\n\n\ndf_pop.to_csv('data/clean/population.csv')"
  },
  {
    "objectID": "PhD_pages/data_appendices/1_E_prepare_region_classifications.html",
    "href": "PhD_pages/data_appendices/1_E_prepare_region_classifications.html",
    "title": "Appendix 1.E: Preparing region classifications",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nimport pandas as pd\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad WID region classifications\n\n\n\n\n\nFor regional classifications I take WID definitions, as specified on their website here.\nI read in a csv prepared from the table in that webpage, which has been mapped to the Our World in Data standarized country names used throughout this project.\n\ndf_regions = pd.read_csv(\"data/original/WID_regions_country_standardized.csv\")\n\n\n\n\n\n\n\n\n\n\nDefine two region classifications\n\n\n\n\n\nI create a clean region mapping table using two regional definitions.\nOne is the ‘standard’ definitions used by WID.\nIn an alternative set I split Western and Eastern Europe, ccombining the latter with Russia & Central Asia to make a joint Eastern Europe and Central Asia region.\n\ndf_regions = df_regions[['Our World In Data Name', 'region (standard)', 'sub-region']].rename(columns={'Our World In Data Name': 'Entity', 'region (standard)': 'WID_region'})\n\n# Define an alt region classification\ndf_regions['region_alt'] = df_regions['WID_region']\n\ndf_regions.loc[df_regions['sub-region'] == 'Western Europe','region_alt'] = 'Western Europe'\n\ndf_regions.loc[(df_regions['sub-region'] == 'Eastern Europe') | (df_regions['WID_region'] == 'Russia & Central Asia'),'region_alt'] = 'Eastern Europe & Central Asia'\n\n\ndf_regions = df_regions[[\"Entity\", \"WID_region\", \"region_alt\"]]\n\n\n\n\n\n\n\n\n\n\nSee the prepared data\n\n\n\n\n\n\ndf_regions\n\n\n\n\n\n  \n    \n      \n      Entity\n      WID_region\n      region_alt\n    \n  \n  \n    \n      0\n      Andorra\n      Europe\n      Western Europe\n    \n    \n      1\n      United Arab Emirates\n      MENA\n      MENA\n    \n    \n      2\n      Afghanistan\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      3\n      Antigua and Barbuda\n      Latin America\n      Latin America\n    \n    \n      4\n      Anguilla\n      Latin America\n      Latin America\n    \n    \n      5\n      Albania\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      6\n      Armenia\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      7\n      Netherlands Antilles\n      Latin America\n      Latin America\n    \n    \n      8\n      Angola\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      9\n      Argentina\n      Latin America\n      Latin America\n    \n    \n      10\n      American Samoa\n      North America & Oceania\n      North America & Oceania\n    \n    \n      11\n      Austria\n      Europe\n      Western Europe\n    \n    \n      12\n      Australia\n      North America & Oceania\n      North America & Oceania\n    \n    \n      13\n      Aruba\n      Latin America\n      Latin America\n    \n    \n      14\n      Azerbaijan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      15\n      Bosnia and Herzegovina\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      16\n      Barbados\n      Latin America\n      Latin America\n    \n    \n      17\n      Bangladesh\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      18\n      Belgium\n      Europe\n      Western Europe\n    \n    \n      19\n      Burkina Faso\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      20\n      Bulgaria\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      21\n      Bahrain\n      MENA\n      MENA\n    \n    \n      22\n      Burundi\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      23\n      Benin\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      24\n      Bermuda\n      North America & Oceania\n      North America & Oceania\n    \n    \n      25\n      Brunei\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      26\n      Bolivia\n      Latin America\n      Latin America\n    \n    \n      27\n      Brazil\n      Latin America\n      Latin America\n    \n    \n      28\n      Bahamas\n      Latin America\n      Latin America\n    \n    \n      29\n      Bhutan\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      30\n      Botswana\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      31\n      Belarus\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      32\n      Belize\n      Latin America\n      Latin America\n    \n    \n      33\n      Canada\n      North America & Oceania\n      North America & Oceania\n    \n    \n      34\n      Democratic Republic of Congo\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      35\n      Central African Republic\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      36\n      Congo\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      37\n      Switzerland\n      Europe\n      Western Europe\n    \n    \n      38\n      Cote d'Ivoire\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      39\n      Cook Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      40\n      Chile\n      Latin America\n      Latin America\n    \n    \n      41\n      Cameroon\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      42\n      China\n      East Asia\n      East Asia\n    \n    \n      43\n      Colombia\n      Latin America\n      Latin America\n    \n    \n      44\n      Costa Rica\n      Latin America\n      Latin America\n    \n    \n      45\n      Czechoslovakia\n      NaN\n      Eastern Europe & Central Asia\n    \n    \n      46\n      Cuba\n      Latin America\n      Latin America\n    \n    \n      47\n      Cape Verde\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      48\n      Curacao\n      Latin America\n      Latin America\n    \n    \n      49\n      Cyprus\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      50\n      Czechia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      51\n      East Germany\n      Europe\n      Western Europe\n    \n    \n      52\n      Germany\n      Europe\n      Western Europe\n    \n    \n      53\n      Djibouti\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      54\n      Denmark\n      Europe\n      Western Europe\n    \n    \n      55\n      Dominica\n      Latin America\n      Latin America\n    \n    \n      56\n      Dominican Republic\n      Latin America\n      Latin America\n    \n    \n      57\n      Algeria\n      MENA\n      MENA\n    \n    \n      58\n      Ecuador\n      Latin America\n      Latin America\n    \n    \n      59\n      Estonia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      60\n      Egypt\n      MENA\n      MENA\n    \n    \n      61\n      Western Sahara\n      MENA\n      MENA\n    \n    \n      62\n      Eritrea\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      63\n      Spain\n      Europe\n      Western Europe\n    \n    \n      64\n      Ethiopia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      65\n      Finland\n      Europe\n      Western Europe\n    \n    \n      66\n      Fiji\n      North America & Oceania\n      North America & Oceania\n    \n    \n      67\n      Falkland Islands\n      Latin America\n      Latin America\n    \n    \n      68\n      Micronesia (country)\n      North America & Oceania\n      North America & Oceania\n    \n    \n      69\n      Faeroe Islands\n      Europe\n      Western Europe\n    \n    \n      70\n      France\n      Europe\n      Western Europe\n    \n    \n      71\n      Gabon\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      72\n      United Kingdom\n      Europe\n      Western Europe\n    \n    \n      73\n      Grenada\n      Latin America\n      Latin America\n    \n    \n      74\n      Georgia\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      75\n      Ghana\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      76\n      Gibraltar\n      Europe\n      Western Europe\n    \n    \n      77\n      Greenland\n      North America & Oceania\n      North America & Oceania\n    \n    \n      78\n      Gambia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      79\n      Guinea\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      80\n      Equatorial Guinea\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      81\n      Greece\n      Europe\n      Western Europe\n    \n    \n      82\n      Guatemala\n      Latin America\n      Latin America\n    \n    \n      83\n      Guam\n      North America & Oceania\n      North America & Oceania\n    \n    \n      84\n      Guinea-Bissau\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      85\n      Guyana\n      Latin America\n      Latin America\n    \n    \n      86\n      Hong Kong\n      East Asia\n      East Asia\n    \n    \n      87\n      Honduras\n      Latin America\n      Latin America\n    \n    \n      88\n      Croatia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      89\n      Haiti\n      Latin America\n      Latin America\n    \n    \n      90\n      Hungary\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      91\n      Indonesia\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      92\n      Ireland\n      Europe\n      Western Europe\n    \n    \n      93\n      Israel\n      MENA\n      MENA\n    \n    \n      94\n      Isle of Man\n      Europe\n      Western Europe\n    \n    \n      95\n      India\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      96\n      Iraq\n      MENA\n      MENA\n    \n    \n      97\n      Iran\n      MENA\n      MENA\n    \n    \n      98\n      Iceland\n      Europe\n      Western Europe\n    \n    \n      99\n      Italy\n      Europe\n      Western Europe\n    \n    \n      100\n      Jamaica\n      Latin America\n      Latin America\n    \n    \n      101\n      Jordan\n      MENA\n      MENA\n    \n    \n      102\n      Japan\n      East Asia\n      East Asia\n    \n    \n      103\n      Kenya\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      104\n      Kyrgyzstan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      105\n      Cambodia\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      106\n      Kiribati\n      North America & Oceania\n      North America & Oceania\n    \n    \n      107\n      Comoros\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      108\n      Saint Kitts and Nevis\n      Latin America\n      Latin America\n    \n    \n      109\n      North Korea\n      East Asia\n      East Asia\n    \n    \n      110\n      South Korea\n      East Asia\n      East Asia\n    \n    \n      111\n      Kosovo\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      112\n      Kuwait\n      MENA\n      MENA\n    \n    \n      113\n      Cayman Islands\n      Latin America\n      Latin America\n    \n    \n      114\n      Kazakhstan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      115\n      Laos\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      116\n      Lebanon\n      MENA\n      MENA\n    \n    \n      117\n      Saint Lucia\n      Latin America\n      Latin America\n    \n    \n      118\n      Liechtenstein\n      Europe\n      Western Europe\n    \n    \n      119\n      Sri Lanka\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      120\n      Liberia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      121\n      Lesotho\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      122\n      Lithuania\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      123\n      Luxembourg\n      Europe\n      Western Europe\n    \n    \n      124\n      Latvia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      125\n      Libya\n      MENA\n      MENA\n    \n    \n      126\n      Morocco\n      MENA\n      MENA\n    \n    \n      127\n      Monaco\n      Europe\n      Western Europe\n    \n    \n      128\n      Moldova\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      129\n      Montenegro\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      130\n      Madagascar\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      131\n      Marshall Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      132\n      North Macedonia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      133\n      Mali\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      134\n      Myanmar\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      135\n      Mongolia\n      East Asia\n      East Asia\n    \n    \n      136\n      Macao\n      East Asia\n      East Asia\n    \n    \n      137\n      Northern Mariana Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      138\n      Mauritania\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      139\n      Montserrat\n      Europe\n      Europe\n    \n    \n      140\n      Malta\n      Europe\n      Western Europe\n    \n    \n      141\n      Mauritius\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      142\n      Maldives\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      143\n      Malawi\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      144\n      Mexico\n      Latin America\n      Latin America\n    \n    \n      145\n      Malaysia\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      146\n      Mozambique\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      147\n      Namibia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      148\n      New Caledonia\n      North America & Oceania\n      North America & Oceania\n    \n    \n      149\n      Niger\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      150\n      Nigeria\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      151\n      Nicaragua\n      Latin America\n      Latin America\n    \n    \n      152\n      Netherlands\n      Europe\n      Western Europe\n    \n    \n      153\n      Norway\n      Europe\n      Western Europe\n    \n    \n      154\n      Nepal\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      155\n      Nauru\n      North America & Oceania\n      North America & Oceania\n    \n    \n      156\n      Niue\n      North America & Oceania\n      North America & Oceania\n    \n    \n      157\n      New Zealand\n      North America & Oceania\n      North America & Oceania\n    \n    \n      158\n      Oman\n      MENA\n      MENA\n    \n    \n      159\n      Panama\n      Latin America\n      Latin America\n    \n    \n      160\n      Peru\n      Latin America\n      Latin America\n    \n    \n      161\n      French Polynesia\n      North America & Oceania\n      North America & Oceania\n    \n    \n      162\n      Papua New Guinea\n      North America & Oceania\n      North America & Oceania\n    \n    \n      163\n      Philippines\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      164\n      Pakistan\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      165\n      Poland\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      166\n      Saint Pierre and Miquelon\n      North America & Oceania\n      North America & Oceania\n    \n    \n      167\n      Puerto Rico\n      Latin America\n      Latin America\n    \n    \n      168\n      Palestine\n      MENA\n      MENA\n    \n    \n      169\n      Portugal\n      Europe\n      Western Europe\n    \n    \n      170\n      Palau\n      North America & Oceania\n      North America & Oceania\n    \n    \n      171\n      Paraguay\n      Latin America\n      Latin America\n    \n    \n      172\n      Qatar\n      MENA\n      MENA\n    \n    \n      173\n      Romania\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      174\n      Serbia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      175\n      Russia\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      176\n      Rwanda\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      177\n      Saudi Arabia\n      MENA\n      MENA\n    \n    \n      178\n      Solomon Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      179\n      Seychelles\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      180\n      Sudan\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      181\n      Sweden\n      Europe\n      Western Europe\n    \n    \n      182\n      Singapore\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      183\n      Saint Helena\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      184\n      Slovenia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      185\n      Slovakia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      186\n      Sierra Leone\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      187\n      San Marino\n      Europe\n      Western Europe\n    \n    \n      188\n      Senegal\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      189\n      Somalia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      190\n      Suriname\n      Latin America\n      Latin America\n    \n    \n      191\n      South Sudan\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      192\n      Sao Tome and Principe\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      193\n      USSR\n      NaN\n      NaN\n    \n    \n      194\n      El Salvador\n      Latin America\n      Latin America\n    \n    \n      195\n      Sint Maarten (Dutch part)\n      Latin America\n      Latin America\n    \n    \n      196\n      Syria\n      MENA\n      MENA\n    \n    \n      197\n      Eswatini\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      198\n      Turks and Caicos Islands\n      Latin America\n      Latin America\n    \n    \n      199\n      Chad\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      200\n      Togo\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      201\n      Thailand\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      202\n      Tajikistan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      203\n      Tokelau\n      North America & Oceania\n      North America & Oceania\n    \n    \n      204\n      Timor\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      205\n      Turkmenistan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      206\n      Tunisia\n      MENA\n      MENA\n    \n    \n      207\n      Tonga\n      North America & Oceania\n      North America & Oceania\n    \n    \n      208\n      Turkey\n      MENA\n      MENA\n    \n    \n      209\n      Trinidad and Tobago\n      Latin America\n      Latin America\n    \n    \n      210\n      Tuvalu\n      North America & Oceania\n      North America & Oceania\n    \n    \n      211\n      Taiwan\n      East Asia\n      East Asia\n    \n    \n      212\n      Tanzania\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      213\n      Ukraine\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      214\n      Uganda\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      215\n      United States\n      North America & Oceania\n      North America & Oceania\n    \n    \n      216\n      Uruguay\n      Latin America\n      Latin America\n    \n    \n      217\n      Uzbekistan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      218\n      Vatican\n      Europe\n      Western Europe\n    \n    \n      219\n      Saint Vincent and the Grenadines\n      Latin America\n      Latin America\n    \n    \n      220\n      Venezuela\n      Latin America\n      Latin America\n    \n    \n      221\n      British Virgin Islands\n      Latin America\n      Latin America\n    \n    \n      222\n      United States Virgin Islands\n      Latin America\n      Latin America\n    \n    \n      223\n      Vietnam\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      224\n      Vanuatu\n      North America & Oceania\n      North America & Oceania\n    \n    \n      225\n      Wallis and Futuna\n      North America & Oceania\n      North America & Oceania\n    \n    \n      226\n      Samoa\n      North America & Oceania\n      North America & Oceania\n    \n    \n      227\n      Channel Islands\n      Europe\n      Western Europe\n    \n    \n      228\n      Yemen\n      MENA\n      MENA\n    \n    \n      229\n      Yugoslavia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      230\n      South Africa\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      231\n      Zambia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      232\n      Zimbabwe\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      233\n      Zanzibar\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave\n\n\n\n\n\n\ndf_regions.to_csv('data/clean/region_mapping.csv')"
  },
  {
    "objectID": "PhD_pages/data_appendices/1_C_prepare_LIS.html",
    "href": "PhD_pages/data_appendices/1_C_prepare_LIS.html",
    "title": "Appendix 1.C: Preparing LIS inequality data",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nimport pandas as pd\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad LIS data\n\n\n\n\n\nWe load a local file downloaded from Our World in Data\n\ndf_lis = pd.read_csv(\"data/original/Luxembourg Income Study (LIS, 2022).csv\")\n\nThe dataframe looks like this:\n\ndf_lis.head(50)\n\n\n\n\n\n  \n    \n      \n      Entity\n      Year\n      Richest decile - Average (Disposable household cash income, equivalized)\n      Richest decile - Average (Disposable household cash income, per capita)\n      Richest decile - Average (Disposable household income, equivalized)\n      Richest decile - Average (Total consumption, equivalized)\n      Richest decile - Average (Disposable household income, per capita)\n      Richest decile - Average (Total consumption, per capita)\n      Richest decile - Average (Market income, equivalized)\n      Richest decile - Average (Market income, per capita)\n      ...\n      $40 a day - Total shortfall (Market income, equivalized)\n      $6.85 a day - Total shortfall (Market income, equivalized)\n      $1 a day - Total shortfall (Market income, per capita)\n      $10 a day - Total shortfall (Market income, per capita)\n      $20 a day - Total shortfall (Market income, per capita)\n      $2.15 a day - Total shortfall (Market income, per capita)\n      $30 a day - Total shortfall (Market income, per capita)\n      $3.65 a day - Total shortfall (Market income, per capita)\n      $40 a day - Total shortfall (Market income, per capita)\n      $6.85 a day - Total shortfall (Market income, per capita)\n    \n  \n  \n    \n      0\n      Australia\n      1981\n      50023.832\n      31936.395\n      50023.832\n      NaN\n      31936.395\n      NaN\n      70626.780\n      44461.266\n      ...\n      3.866247e+10\n      3.982356e+09\n      419814080.0\n      7.280809e+09\n      1.894659e+10\n      1.058547e+09\n      3.748656e+10\n      2.019697e+09\n      6.446676e+10\n      4.467916e+09\n    \n    \n      1\n      Australia\n      1985\n      52288.690\n      34355.395\n      52288.690\n      NaN\n      34355.395\n      NaN\n      76894.055\n      49693.500\n      ...\n      4.703279e+10\n      4.726871e+09\n      492149500.0\n      8.809942e+09\n      2.266906e+10\n      1.226572e+09\n      4.324881e+10\n      2.368296e+09\n      7.203492e+10\n      5.343073e+09\n    \n    \n      2\n      Australia\n      1989\n      55940.652\n      35907.617\n      55940.652\n      NaN\n      35907.617\n      NaN\n      80695.900\n      50987.070\n      ...\n      4.477128e+10\n      4.277556e+09\n      430305820.0\n      8.015738e+09\n      2.155789e+10\n      1.101814e+09\n      4.214196e+10\n      2.128218e+09\n      7.099132e+10\n      4.823715e+09\n    \n    \n      3\n      Australia\n      1995\n      52282.652\n      32798.330\n      52282.652\n      NaN\n      32798.330\n      NaN\n      73282.766\n      45911.695\n      ...\n      6.272404e+10\n      7.392468e+09\n      888633660.0\n      1.249220e+10\n      3.081024e+10\n      2.077478e+09\n      5.684046e+10\n      3.810248e+09\n      9.136563e+10\n      7.963823e+09\n    \n    \n      4\n      Australia\n      2001\n      61141.344\n      38586.074\n      61141.344\n      NaN\n      38586.074\n      NaN\n      84623.330\n      52824.360\n      ...\n      6.588217e+10\n      7.593419e+09\n      903245250.0\n      1.306969e+10\n      3.183256e+10\n      2.127348e+09\n      5.793087e+10\n      3.916253e+09\n      9.185732e+10\n      8.249642e+09\n    \n    \n      5\n      Australia\n      2003\n      60767.030\n      39880.895\n      60767.030\n      NaN\n      39880.895\n      NaN\n      85321.850\n      55284.574\n      ...\n      6.307820e+10\n      7.219062e+09\n      881157000.0\n      1.225195e+10\n      3.014891e+10\n      2.056010e+09\n      5.539704e+10\n      3.733895e+09\n      8.857910e+10\n      7.776967e+09\n    \n    \n      6\n      Australia\n      2004\n      67044.836\n      42361.940\n      69175.920\n      55835.004\n      43536.473\n      36100.730\n      93469.810\n      58672.870\n      ...\n      3.552942e+10\n      3.863406e+09\n      438178500.0\n      6.797047e+09\n      1.692003e+10\n      1.062209e+09\n      3.098926e+10\n      1.973497e+09\n      4.969544e+10\n      4.234076e+09\n    \n    \n      7\n      Australia\n      2008\n      88829.020\n      56799.945\n      94228.330\n      NaN\n      59941.715\n      NaN\n      125306.945\n      79572.290\n      ...\n      5.045161e+10\n      5.204412e+09\n      556913800.0\n      9.192074e+09\n      2.374370e+10\n      1.392097e+09\n      4.439591e+10\n      2.628348e+09\n      7.221916e+10\n      5.701780e+09\n    \n    \n      8\n      Australia\n      2010\n      87006.910\n      54742.312\n      91029.270\n      63567.266\n      57119.117\n      40610.445\n      118103.690\n      73404.390\n      ...\n      3.286811e+10\n      3.536595e+09\n      386255840.0\n      6.257946e+09\n      1.550157e+10\n      9.536842e+08\n      2.811584e+10\n      1.804838e+09\n      4.424620e+10\n      3.896993e+09\n    \n    \n      9\n      Australia\n      2014\n      95592.190\n      59411.480\n      100014.620\n      NaN\n      61948.363\n      NaN\n      140760.030\n      86222.500\n      ...\n      5.619110e+10\n      5.810582e+09\n      613722050.0\n      1.034583e+10\n      2.619963e+10\n      1.535612e+09\n      4.797817e+10\n      2.938061e+09\n      7.639243e+10\n      6.431944e+09\n    \n    \n      10\n      Australia\n      2016\n      95338.805\n      57815.190\n      98961.770\n      68191.990\n      60041.000\n      41841.562\n      137332.670\n      82343.980\n      ...\n      3.157090e+10\n      3.298953e+09\n      329876830.0\n      5.809851e+09\n      1.477044e+10\n      8.604021e+08\n      2.745273e+10\n      1.645921e+09\n      4.482942e+10\n      3.617623e+09\n    \n    \n      11\n      Australia\n      2018\n      95226.620\n      58856.266\n      98357.400\n      NaN\n      60820.470\n      NaN\n      139952.250\n      84917.270\n      ...\n      5.699418e+10\n      6.208357e+09\n      650117200.0\n      1.085852e+10\n      2.696330e+10\n      1.663812e+09\n      4.886336e+10\n      3.168145e+09\n      7.752602e+10\n      6.823221e+09\n    \n    \n      12\n      Austria\n      1994\n      69881.110\n      45899.453\n      69881.110\n      NaN\n      45899.453\n      NaN\n      89520.310\n      58899.938\n      ...\n      2.206478e+10\n      2.630414e+09\n      285884320.0\n      4.438652e+09\n      1.071117e+10\n      7.270337e+08\n      1.952715e+10\n      1.356840e+09\n      3.193494e+10\n      2.840446e+09\n    \n    \n      13\n      Austria\n      1995\n      65876.910\n      43685.550\n      65876.910\n      NaN\n      43685.550\n      NaN\n      87497.840\n      56811.676\n      ...\n      2.219400e+10\n      2.590032e+09\n      284019940.0\n      4.428834e+09\n      1.083907e+10\n      7.102111e+08\n      2.003968e+10\n      1.324459e+09\n      3.266376e+10\n      2.784787e+09\n    \n    \n      14\n      Austria\n      1996\n      60737.586\n      41528.630\n      60737.586\n      NaN\n      41528.630\n      NaN\n      84336.910\n      55718.867\n      ...\n      2.260098e+10\n      2.775207e+09\n      301874460.0\n      4.597060e+09\n      1.098366e+10\n      7.625631e+08\n      2.033913e+10\n      1.419866e+09\n      3.325607e+10\n      2.937981e+09\n    \n    \n      15\n      Austria\n      1997\n      59613.934\n      40621.113\n      59613.934\n      NaN\n      40621.113\n      NaN\n      82288.234\n      55246.480\n      ...\n      2.368187e+10\n      2.872324e+09\n      306911040.0\n      4.752263e+09\n      1.143486e+10\n      7.813284e+08\n      2.080697e+10\n      1.464992e+09\n      3.359248e+10\n      3.043656e+09\n    \n    \n      16\n      Austria\n      1998\n      68518.330\n      47025.664\n      68518.330\n      NaN\n      47025.664\n      NaN\n      90662.670\n      59918.950\n      ...\n      2.383486e+10\n      2.873143e+09\n      304562900.0\n      4.804085e+09\n      1.146382e+10\n      7.751332e+08\n      2.081868e+10\n      1.455688e+09\n      3.364921e+10\n      3.066837e+09\n    \n    \n      17\n      Austria\n      1999\n      67443.310\n      45999.090\n      67443.310\n      NaN\n      45999.090\n      NaN\n      88740.010\n      59038.746\n      ...\n      2.322060e+10\n      2.922314e+09\n      311632480.0\n      4.752616e+09\n      1.125651e+10\n      7.980534e+08\n      2.010428e+10\n      1.482893e+09\n      3.234846e+10\n      3.065703e+09\n    \n    \n      18\n      Austria\n      2000\n      63320.880\n      43179.418\n      63320.880\n      NaN\n      43179.418\n      NaN\n      88740.445\n      58514.668\n      ...\n      2.314955e+10\n      2.960108e+09\n      320404900.0\n      4.877011e+09\n      1.123190e+10\n      8.083421e+08\n      1.983614e+10\n      1.501765e+09\n      3.185132e+10\n      3.138284e+09\n    \n    \n      19\n      Austria\n      2003\n      69734.380\n      47596.600\n      70221.875\n      NaN\n      47835.707\n      NaN\n      95364.120\n      63157.457\n      ...\n      2.337836e+10\n      3.002156e+09\n      381028670.0\n      4.784872e+09\n      1.123712e+10\n      8.791692e+08\n      1.992914e+10\n      1.561116e+09\n      3.173868e+10\n      3.108729e+09\n    \n    \n      20\n      Austria\n      2004\n      75738.140\n      50994.240\n      76067.560\n      NaN\n      51156.832\n      NaN\n      98464.940\n      64571.703\n      ...\n      2.398168e+10\n      2.999760e+09\n      331263200.0\n      4.905073e+09\n      1.142636e+10\n      8.291091e+08\n      2.022340e+10\n      1.525757e+09\n      3.228851e+10\n      3.152394e+09\n    \n    \n      21\n      Austria\n      2005\n      69021.120\n      46443.652\n      69458.160\n      NaN\n      46635.330\n      NaN\n      89961.950\n      60223.830\n      ...\n      2.671138e+10\n      3.385736e+09\n      395115800.0\n      5.566860e+09\n      1.284201e+10\n      9.586561e+08\n      2.246157e+10\n      1.748484e+09\n      3.528864e+10\n      3.596450e+09\n    \n    \n      22\n      Austria\n      2006\n      72895.760\n      49464.617\n      73242.600\n      NaN\n      49679.770\n      NaN\n      97450.016\n      64547.445\n      ...\n      2.716263e+10\n      3.362454e+09\n      380588670.0\n      5.538014e+09\n      1.297598e+10\n      9.348848e+08\n      2.280834e+10\n      1.716200e+09\n      3.564946e+10\n      3.559522e+09\n    \n    \n      23\n      Austria\n      2007\n      78440.230\n      52059.820\n      78412.410\n      NaN\n      52243.830\n      NaN\n      111056.770\n      73114.336\n      ...\n      2.656803e+10\n      3.154759e+09\n      309539140.0\n      5.291345e+09\n      1.259816e+10\n      8.291382e+08\n      2.207385e+10\n      1.586577e+09\n      3.428095e+10\n      3.367000e+09\n    \n    \n      24\n      Austria\n      2008\n      79230.125\n      53437.938\n      79606.910\n      NaN\n      53738.477\n      NaN\n      113746.720\n      75953.060\n      ...\n      2.708904e+10\n      3.217971e+09\n      314792480.0\n      5.433489e+09\n      1.284498e+10\n      8.485980e+08\n      2.244254e+10\n      1.615634e+09\n      3.447038e+10\n      3.447235e+09\n    \n    \n      25\n      Austria\n      2009\n      83951.730\n      56609.137\n      84748.350\n      NaN\n      57179.586\n      NaN\n      119655.460\n      78789.250\n      ...\n      2.828675e+10\n      3.386112e+09\n      346781950.0\n      5.683956e+09\n      1.347219e+10\n      8.996375e+08\n      2.336469e+10\n      1.708271e+09\n      3.580894e+10\n      3.613923e+09\n    \n    \n      26\n      Austria\n      2010\n      81076.695\n      53947.445\n      81523.470\n      NaN\n      54308.460\n      NaN\n      110757.810\n      72573.290\n      ...\n      2.862892e+10\n      3.495099e+09\n      360289800.0\n      5.770098e+09\n      1.367704e+10\n      9.423384e+08\n      2.383922e+10\n      1.765965e+09\n      3.643571e+10\n      3.690540e+09\n    \n    \n      27\n      Austria\n      2011\n      80493.055\n      54190.473\n      80793.740\n      NaN\n      54409.770\n      NaN\n      112055.695\n      73432.210\n      ...\n      2.842217e+10\n      3.383949e+09\n      347815260.0\n      5.701490e+09\n      1.343139e+10\n      9.147812e+08\n      2.353691e+10\n      1.719751e+09\n      3.619471e+10\n      3.632217e+09\n    \n    \n      28\n      Austria\n      2012\n      75392.040\n      52374.832\n      76614.310\n      NaN\n      52578.530\n      NaN\n      107937.840\n      72005.130\n      ...\n      2.938072e+10\n      3.551610e+09\n      380646900.0\n      5.954646e+09\n      1.396010e+10\n      9.727799e+08\n      2.399811e+10\n      1.813611e+09\n      3.653724e+10\n      3.795469e+09\n    \n    \n      29\n      Austria\n      2013\n      82440.470\n      57029.902\n      82440.470\n      NaN\n      57029.902\n      NaN\n      112982.030\n      76692.664\n      ...\n      2.921268e+10\n      3.527228e+09\n      391929760.0\n      5.877413e+09\n      1.391488e+10\n      9.774984e+08\n      2.380032e+10\n      1.805767e+09\n      3.615176e+10\n      3.749382e+09\n    \n    \n      30\n      Austria\n      2014\n      79697.336\n      55544.285\n      79697.336\n      NaN\n      55544.285\n      NaN\n      109840.990\n      74982.900\n      ...\n      2.914435e+10\n      3.656938e+09\n      413919070.0\n      6.009400e+09\n      1.386119e+10\n      1.025508e+09\n      2.406541e+10\n      1.880889e+09\n      3.679829e+10\n      3.877160e+09\n    \n    \n      31\n      Austria\n      2015\n      78624.210\n      54856.367\n      78624.210\n      NaN\n      54856.367\n      NaN\n      111741.914\n      75959.805\n      ...\n      2.977386e+10\n      3.780052e+09\n      453066900.0\n      6.129731e+09\n      1.411562e+10\n      1.081278e+09\n      2.444680e+10\n      1.946668e+09\n      3.729886e+10\n      3.962612e+09\n    \n    \n      32\n      Austria\n      2016\n      84399.180\n      57378.082\n      84399.180\n      NaN\n      57378.082\n      NaN\n      119039.484\n      78786.150\n      ...\n      3.033834e+10\n      3.861010e+09\n      476160860.0\n      6.297410e+09\n      1.447051e+10\n      1.113062e+09\n      2.448154e+10\n      1.996445e+09\n      3.687180e+10\n      4.063655e+09\n    \n    \n      33\n      Austria\n      2017\n      81013.720\n      54702.066\n      81013.720\n      NaN\n      54702.066\n      NaN\n      111630.930\n      74736.870\n      ...\n      2.918657e+10\n      3.735702e+09\n      441075140.0\n      6.055330e+09\n      1.391907e+10\n      1.056690e+09\n      2.370464e+10\n      1.921560e+09\n      3.597913e+10\n      3.921300e+09\n    \n    \n      34\n      Austria\n      2018\n      83463.160\n      57253.105\n      83463.160\n      NaN\n      57253.105\n      NaN\n      115263.470\n      78277.100\n      ...\n      3.012088e+10\n      3.887151e+09\n      466428800.0\n      6.278360e+09\n      1.434872e+10\n      1.113488e+09\n      2.426827e+10\n      2.005151e+09\n      3.702200e+10\n      4.063442e+09\n    \n    \n      35\n      Austria\n      2019\n      82089.420\n      56629.710\n      82089.420\n      NaN\n      56629.710\n      NaN\n      117377.695\n      80094.660\n      ...\n      2.934813e+10\n      3.778096e+09\n      460785950.0\n      6.115253e+09\n      1.395052e+10\n      1.083482e+09\n      2.378189e+10\n      1.952915e+09\n      3.594893e+10\n      3.971567e+09\n    \n    \n      36\n      Belgium\n      1985\n      41134.703\n      23562.771\n      41134.703\n      NaN\n      23562.771\n      NaN\n      38227.390\n      23615.049\n      ...\n      4.050182e+10\n      5.040509e+09\n      727205000.0\n      7.808187e+09\n      2.013577e+10\n      1.567359e+09\n      4.046943e+10\n      2.683192e+09\n      6.779089e+10\n      5.163750e+09\n    \n    \n      37\n      Belgium\n      1988\n      44465.400\n      25686.190\n      44465.400\n      NaN\n      25686.190\n      NaN\n      40741.664\n      24987.645\n      ...\n      4.049237e+10\n      5.135251e+09\n      734519400.0\n      7.990967e+09\n      2.018125e+10\n      1.588525e+09\n      3.989350e+10\n      2.727084e+09\n      6.661184e+10\n      5.263755e+09\n    \n    \n      38\n      Belgium\n      1992\n      44531.805\n      27947.602\n      44531.805\n      NaN\n      27947.602\n      NaN\n      66219.220\n      41001.363\n      ...\n      3.805986e+10\n      5.616064e+09\n      765230300.0\n      8.642301e+09\n      1.919126e+10\n      1.707524e+09\n      3.315387e+10\n      2.977780e+09\n      5.177313e+10\n      5.774300e+09\n    \n    \n      39\n      Belgium\n      1995\n      59845.996\n      38071.760\n      59923.324\n      NaN\n      38126.027\n      NaN\n      55208.395\n      34615.797\n      ...\n      3.698898e+10\n      4.445858e+09\n      570852900.0\n      7.297604e+09\n      1.788184e+10\n      1.301427e+09\n      3.297802e+10\n      2.311891e+09\n      5.336472e+10\n      4.677550e+09\n    \n    \n      40\n      Belgium\n      1997\n      53506.082\n      35397.207\n      53506.082\n      NaN\n      35397.207\n      NaN\n      86715.390\n      54934.605\n      ...\n      3.964167e+10\n      4.942290e+09\n      453824160.0\n      8.287223e+09\n      1.910603e+10\n      1.276683e+09\n      3.243410e+10\n      2.474495e+09\n      4.885963e+10\n      5.306969e+09\n    \n    \n      41\n      Belgium\n      2000\n      71637.734\n      46533.008\n      71679.220\n      NaN\n      46711.453\n      NaN\n      81062.570\n      53535.490\n      ...\n      3.042676e+10\n      3.996733e+09\n      531078560.0\n      6.334454e+09\n      1.452915e+10\n      1.194686e+09\n      2.547413e+10\n      2.086721e+09\n      4.052982e+10\n      4.135878e+09\n    \n    \n      42\n      Belgium\n      2003\n      58273.867\n      39482.965\n      58621.387\n      NaN\n      39609.260\n      NaN\n      88043.020\n      58628.383\n      ...\n      3.953542e+10\n      4.981929e+09\n      536375600.0\n      8.298363e+09\n      1.898224e+10\n      1.336157e+09\n      3.200798e+10\n      2.512582e+09\n      4.782651e+10\n      5.300771e+09\n    \n    \n      43\n      Belgium\n      2004\n      65745.970\n      43220.270\n      66189.400\n      NaN\n      43448.746\n      NaN\n      100193.055\n      67825.380\n      ...\n      3.988252e+10\n      5.215997e+09\n      595704400.0\n      8.548323e+09\n      1.934049e+10\n      1.446502e+09\n      3.210507e+10\n      2.667045e+09\n      4.735235e+10\n      5.520924e+09\n    \n    \n      44\n      Belgium\n      2005\n      65475.125\n      42411.062\n      65999.730\n      NaN\n      42670.984\n      NaN\n      98763.520\n      66044.880\n      ...\n      3.953359e+10\n      5.077595e+09\n      564602430.0\n      8.352918e+09\n      1.899013e+10\n      1.383333e+09\n      3.170606e+10\n      2.573566e+09\n      4.751340e+10\n      5.364465e+09\n    \n    \n      45\n      Belgium\n      2006\n      65316.900\n      43735.547\n      67048.160\n      NaN\n      44811.060\n      NaN\n      93107.400\n      61628.582\n      ...\n      3.967641e+10\n      4.917687e+09\n      517002600.0\n      8.281226e+09\n      1.907284e+10\n      1.300792e+09\n      3.204192e+10\n      2.468123e+09\n      4.801887e+10\n      5.279435e+09\n    \n    \n      46\n      Belgium\n      2007\n      67657.810\n      44996.285\n      69637.945\n      NaN\n      46142.060\n      NaN\n      96476.266\n      63592.367\n      ...\n      3.888916e+10\n      4.895261e+09\n      518650560.0\n      8.012710e+09\n      1.860519e+10\n      1.307985e+09\n      3.183521e+10\n      2.462262e+09\n      4.805315e+10\n      5.148464e+09\n    \n    \n      47\n      Belgium\n      2008\n      63561.543\n      43540.340\n      65590.460\n      NaN\n      44618.855\n      NaN\n      90110.710\n      60801.484\n      ...\n      3.911911e+10\n      5.013727e+09\n      552635100.0\n      8.184741e+09\n      1.878338e+10\n      1.360048e+09\n      3.184249e+10\n      2.528480e+09\n      4.787434e+10\n      5.271591e+09\n    \n    \n      48\n      Belgium\n      2009\n      65641.500\n      43462.285\n      67333.240\n      NaN\n      44480.590\n      NaN\n      91483.610\n      60059.312\n      ...\n      4.061629e+10\n      5.136852e+09\n      544317600.0\n      8.544614e+09\n      1.958761e+10\n      1.378240e+09\n      3.307023e+10\n      2.588505e+09\n      4.927838e+10\n      5.453379e+09\n    \n    \n      49\n      Belgium\n      2010\n      63487.170\n      43094.580\n      65512.977\n      NaN\n      44407.176\n      NaN\n      91967.040\n      62218.300\n      ...\n      4.214041e+10\n      5.457073e+09\n      602626900.0\n      8.930732e+09\n      2.037472e+10\n      1.485109e+09\n      3.427268e+10\n      2.766432e+09\n      5.102372e+10\n      5.768364e+09\n    \n  \n\n50 rows × 826 columns\n\n\n\n\n\n\n\n\n\n\n\n\nSelect and rename needed variables, calculating some additional inequality metrics\n\n\n\n\n\n\ninc_concepts = {\n\n    \"short_name\": [\n        \"equiv_disposable\",\n        \"equiv_market\",\n        \"percap_disposable\",\n        \"percap_market\"],\n    \"long_name\": [\n        \"Disposable household income, equivalized\",\n        \"Market income, equivalized\",\n        \"Disposable household income, per capita\",\n        \"Disposable household income, per capita\"\n    ]\n}\n\nkeep_vars = []\n\nfor i in range(len(inc_concepts['short_name'])):\n\n    short_suffix = inc_concepts['short_name'][i]\n    long_suffix = inc_concepts['long_name'][i]\n\n    # Gini\n    gini_new_var = f'Gini_{short_suffix}'\n    gini_old_var = f'Gini coefficient ({long_suffix})'\n\n    df_lis[gini_new_var] = df_lis[gini_old_var] * 100\n\n    keep_vars.append(gini_new_var)\n\n    # Top 10% share\n    top10_new_var = f'Top_10_share_{short_suffix}'\n    top10_old_var = f'Richest decile - Share ({long_suffix})'\n\n    df_lis[top10_new_var] = df_lis[top10_old_var]\n\n    keep_vars.append(top10_new_var)\n\n    # Bottom 50% share\n    sum_cols = [\n    'Poorest decile - Share',\n    '2nd decile - Share',\n    '3rd decile - Share',\n    '4th decile - Share',\n    '5th decile - Share',\n    ]\n\n    sum_cols = [sub + f' ({long_suffix})' for sub in sum_cols]\n\n    bottom50_new_var = f'Bottom_50_share_{short_suffix}'\n\n    df_lis[bottom50_new_var] = df_lis[sum_cols].sum(axis=1)\n\n    keep_vars.append(bottom50_new_var)\n\n\n\nother_vars_to_keep = [\"Year\", \"Entity\"]\n\nkeep_vars = other_vars_to_keep + keep_vars\n\ndf_lis = df_lis[keep_vars]\n\n\n\n\n\n\n\n\n\n\nSee the prepared data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_lis.head(100)\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini_equiv_disposable\n      Top_10_share_equiv_disposable\n      Bottom_50_share_equiv_disposable\n      Gini_equiv_market\n      Top_10_share_equiv_market\n      Bottom_50_share_equiv_market\n      Gini_percap_disposable\n      Top_10_share_percap_disposable\n      Bottom_50_share_percap_disposable\n      Gini_percap_market\n      Top_10_share_percap_market\n      Bottom_50_share_percap_market\n    \n  \n  \n    \n      0\n      1981\n      Australia\n      28.2\n      20.7114\n      30.1790\n      40.4\n      25.3814\n      21.8905\n      31.3\n      23.3191\n      28.4171\n      31.3\n      23.3191\n      28.4171\n    \n    \n      1\n      1985\n      Australia\n      29.3\n      21.6330\n      29.5275\n      43.7\n      27.6839\n      19.7606\n      32.5\n      24.2772\n      27.7783\n      32.5\n      24.2772\n      27.7783\n    \n    \n      2\n      1989\n      Australia\n      30.4\n      22.4356\n      28.8189\n      43.1\n      27.7520\n      20.1667\n      33.1\n      24.6904\n      27.3028\n      33.1\n      24.6904\n      27.3028\n    \n    \n      3\n      1995\n      Australia\n      31.1\n      22.7384\n      28.2401\n      47.0\n      29.0784\n      17.0353\n      32.9\n      24.6306\n      27.5334\n      32.9\n      24.6306\n      27.5334\n    \n    \n      4\n      2001\n      Australia\n      32.0\n      23.5894\n      27.7841\n      48.1\n      30.1565\n      16.2782\n      33.7\n      25.1233\n      26.9225\n      33.7\n      25.1233\n      26.9225\n    \n    \n      5\n      2003\n      Australia\n      31.6\n      23.0152\n      28.0085\n      46.9\n      29.1615\n      17.1217\n      33.7\n      25.1594\n      26.9625\n      33.7\n      25.1594\n      26.9625\n    \n    \n      6\n      2004\n      Australia\n      31.1\n      23.5554\n      28.6207\n      45.7\n      29.0491\n      18.3739\n      32.7\n      25.0199\n      27.7169\n      32.7\n      25.0199\n      27.7169\n    \n    \n      7\n      2008\n      Australia\n      33.5\n      25.7203\n      27.3298\n      46.9\n      31.2839\n      18.0212\n      35.5\n      27.4164\n      26.1679\n      35.5\n      27.4164\n      26.1679\n    \n    \n      8\n      2010\n      Australia\n      33.3\n      24.8845\n      27.1446\n      47.3\n      30.3982\n      17.1927\n      34.9\n      26.3605\n      26.3001\n      34.9\n      26.3605\n      26.3001\n    \n    \n      9\n      2014\n      Australia\n      32.9\n      25.5024\n      27.7800\n      48.1\n      32.6434\n      17.4592\n      34.2\n      26.7302\n      27.1183\n      34.2\n      26.7302\n      27.1183\n    \n    \n      10\n      2016\n      Australia\n      32.6\n      24.7741\n      27.7320\n      45.9\n      30.7677\n      18.7156\n      33.7\n      25.8249\n      27.1812\n      33.7\n      25.8249\n      27.1812\n    \n    \n      11\n      2018\n      Australia\n      32.9\n      25.1997\n      27.7172\n      46.9\n      31.7626\n      18.2276\n      34.2\n      26.4557\n      27.0175\n      34.2\n      26.4557\n      27.0175\n    \n    \n      12\n      1994\n      Austria\n      27.8\n      21.7770\n      31.0690\n      43.8\n      27.2680\n      19.5033\n      30.8\n      24.0030\n      29.1101\n      30.8\n      24.0030\n      29.1101\n    \n    \n      13\n      1995\n      Austria\n      26.6\n      21.1158\n      31.8506\n      43.7\n      27.6185\n      19.7262\n      29.9\n      23.3414\n      29.6358\n      29.9\n      23.3414\n      29.6358\n    \n    \n      14\n      1996\n      Austria\n      25.8\n      20.3351\n      32.0640\n      43.5\n      27.1217\n      19.5170\n      29.3\n      23.1278\n      30.0955\n      29.3\n      23.1278\n      30.0955\n    \n    \n      15\n      1997\n      Austria\n      25.5\n      20.0592\n      32.3206\n      43.4\n      26.7349\n      19.5847\n      29.1\n      22.6440\n      30.3816\n      29.1\n      22.6440\n      30.3816\n    \n    \n      16\n      1998\n      Austria\n      27.5\n      22.2563\n      31.4371\n      44.9\n      28.5377\n      18.8182\n      31.3\n      24.9982\n      29.0709\n      31.3\n      24.9982\n      29.0709\n    \n    \n      17\n      1999\n      Austria\n      26.2\n      21.2059\n      32.0782\n      44.0\n      27.4915\n      19.3987\n      29.7\n      23.7468\n      29.8057\n      29.7\n      23.7468\n      29.8057\n    \n    \n      18\n      2000\n      Austria\n      25.4\n      20.6036\n      32.7149\n      43.6\n      27.2789\n      19.7973\n      28.9\n      22.9367\n      30.2479\n      28.9\n      22.9367\n      30.2479\n    \n    \n      19\n      2003\n      Austria\n      26.5\n      21.3393\n      31.8880\n      45.1\n      28.4883\n      18.6745\n      29.6\n      23.5392\n      30.0162\n      29.6\n      23.5392\n      30.0162\n    \n    \n      20\n      2004\n      Austria\n      26.8\n      22.0364\n      31.9070\n      45.6\n      28.9304\n      18.4123\n      29.9\n      23.8801\n      29.8098\n      29.9\n      23.8801\n      29.8098\n    \n    \n      21\n      2005\n      Austria\n      26.0\n      21.0588\n      32.2278\n      46.2\n      28.3760\n      17.5347\n      28.8\n      22.8680\n      30.3678\n      28.8\n      22.8680\n      30.3678\n    \n    \n      22\n      2006\n      Austria\n      26.8\n      21.7931\n      31.7895\n      47.7\n      29.7501\n      16.6698\n      29.7\n      23.7801\n      29.9291\n      29.7\n      23.7801\n      29.9291\n    \n    \n      23\n      2007\n      Austria\n      28.4\n      22.1949\n      30.6260\n      48.6\n      30.7191\n      16.0955\n      30.6\n      23.8709\n      29.2386\n      30.6\n      23.8709\n      29.2386\n    \n    \n      24\n      2008\n      Austria\n      28.0\n      22.2378\n      30.9866\n      49.0\n      31.1528\n      15.9883\n      30.4\n      24.1139\n      29.5302\n      30.4\n      24.1139\n      29.5302\n    \n    \n      25\n      2009\n      Austria\n      28.9\n      22.9112\n      30.4470\n      50.6\n      32.3594\n      14.9424\n      31.4\n      24.7046\n      28.8619\n      31.4\n      24.7046\n      28.8619\n    \n    \n      26\n      2010\n      Austria\n      28.0\n      22.1773\n      30.9118\n      49.8\n      30.9039\n      15.0692\n      30.3\n      23.6672\n      29.3688\n      30.3\n      23.6672\n      29.3688\n    \n    \n      27\n      2011\n      Austria\n      28.2\n      22.2599\n      30.8252\n      49.6\n      31.0864\n      15.2284\n      30.9\n      23.8736\n      28.9522\n      30.9\n      23.8736\n      28.9522\n    \n    \n      28\n      2012\n      Austria\n      27.7\n      21.7198\n      31.1267\n      49.5\n      30.7545\n      15.1985\n      30.6\n      23.6161\n      29.1880\n      30.6\n      23.6161\n      29.1880\n    \n    \n      29\n      2013\n      Austria\n      28.0\n      22.4941\n      31.0187\n      49.7\n      31.1161\n      15.1641\n      31.1\n      24.4794\n      29.0872\n      31.1\n      24.4794\n      29.0872\n    \n    \n      30\n      2014\n      Austria\n      27.5\n      22.1878\n      31.4116\n      49.5\n      31.0075\n      15.3305\n      30.7\n      24.2447\n      29.3028\n      30.7\n      24.2447\n      29.3028\n    \n    \n      31\n      2015\n      Austria\n      27.6\n      22.0004\n      31.2595\n      49.7\n      31.0976\n      15.1204\n      30.8\n      24.0319\n      29.1982\n      30.8\n      24.0319\n      29.1982\n    \n    \n      32\n      2016\n      Austria\n      28.5\n      22.4421\n      30.7155\n      50.3\n      31.8777\n      14.9410\n      31.0\n      24.0239\n      29.0026\n      31.0\n      24.0239\n      29.0026\n    \n    \n      33\n      2017\n      Austria\n      27.7\n      21.8421\n      31.1325\n      48.8\n      30.1465\n      15.6248\n      30.0\n      23.2091\n      29.5576\n      30.0\n      23.2091\n      29.5576\n    \n    \n      34\n      2018\n      Austria\n      28.0\n      22.3748\n      31.1442\n      49.7\n      31.0995\n      15.3011\n      31.0\n      24.0545\n      29.0590\n      31.0\n      24.0545\n      29.0590\n    \n    \n      35\n      2019\n      Austria\n      27.4\n      21.7319\n      31.4725\n      49.1\n      30.7803\n      15.6146\n      30.4\n      23.3517\n      29.2624\n      30.4\n      23.3517\n      29.2624\n    \n    \n      36\n      1985\n      Belgium\n      22.8\n      19.0669\n      34.0871\n      41.7\n      24.1700\n      20.2685\n      25.2\n      19.1502\n      32.8306\n      25.2\n      19.1502\n      32.8306\n    \n    \n      37\n      1988\n      Belgium\n      23.5\n      19.6520\n      33.8333\n      42.4\n      24.9415\n      20.1113\n      25.7\n      19.8434\n      32.5495\n      25.7\n      19.8434\n      32.5495\n    \n    \n      38\n      1992\n      Belgium\n      22.8\n      18.6798\n      34.1364\n      45.6\n      26.3068\n      17.1878\n      24.9\n      20.0608\n      32.8502\n      24.9\n      20.0608\n      32.8502\n    \n    \n      39\n      1995\n      Belgium\n      26.8\n      21.5448\n      31.6364\n      46.9\n      28.4432\n      16.7190\n      28.4\n      22.8487\n      31.0023\n      28.4\n      22.8487\n      31.0023\n    \n    \n      40\n      1997\n      Belgium\n      25.1\n      19.7236\n      32.4064\n      48.3\n      28.4608\n      15.2332\n      26.9\n      21.5896\n      31.7778\n      26.9\n      21.5896\n      31.7778\n    \n    \n      41\n      2000\n      Belgium\n      28.9\n      23.6319\n      30.7483\n      51.3\n      34.1729\n      15.2615\n      29.9\n      24.8682\n      30.3385\n      29.9\n      24.8682\n      30.3385\n    \n    \n      42\n      2003\n      Belgium\n      26.1\n      20.5639\n      31.8582\n      48.5\n      28.1923\n      14.7719\n      28.3\n      22.3801\n      30.8327\n      28.3\n      22.3801\n      30.8327\n    \n    \n      43\n      2004\n      Belgium\n      27.1\n      21.9555\n      31.4670\n      50.2\n      30.4583\n      14.2118\n      28.8\n      23.1740\n      30.6903\n      28.8\n      23.1740\n      30.6903\n    \n    \n      44\n      2005\n      Belgium\n      27.0\n      21.6756\n      31.5322\n      49.0\n      29.9344\n      15.2924\n      28.3\n      22.6702\n      30.9093\n      28.3\n      22.6702\n      30.9093\n    \n    \n      45\n      2006\n      Belgium\n      27.2\n      21.5829\n      31.3356\n      48.2\n      28.6299\n      15.4494\n      29.1\n      23.3013\n      30.4324\n      29.1\n      23.3013\n      30.4324\n    \n    \n      46\n      2007\n      Belgium\n      27.5\n      21.9729\n      31.1760\n      48.3\n      29.0006\n      15.4849\n      29.4\n      23.5485\n      30.2877\n      29.4\n      23.5485\n      30.2877\n    \n    \n      47\n      2008\n      Belgium\n      26.2\n      20.6228\n      31.7834\n      47.2\n      27.6019\n      16.1025\n      28.4\n      22.5599\n      30.7401\n      28.4\n      22.5599\n      30.7401\n    \n    \n      48\n      2009\n      Belgium\n      26.7\n      20.9649\n      31.4422\n      47.9\n      27.7206\n      15.2211\n      28.4\n      22.3047\n      30.7090\n      28.4\n      22.3047\n      30.7090\n    \n    \n      49\n      2010\n      Belgium\n      26.3\n      20.5291\n      31.5966\n      48.7\n      28.2520\n      14.7279\n      28.2\n      22.3755\n      30.9048\n      28.2\n      22.3755\n      30.9048\n    \n    \n      50\n      2011\n      Belgium\n      26.8\n      20.9416\n      31.3138\n      49.0\n      28.6037\n      14.3974\n      28.3\n      22.4024\n      30.8364\n      28.3\n      22.4024\n      30.8364\n    \n    \n      51\n      2012\n      Belgium\n      26.6\n      20.8603\n      31.4857\n      48.5\n      28.1200\n      14.6480\n      27.9\n      22.2817\n      31.1232\n      27.9\n      22.2817\n      31.1232\n    \n    \n      52\n      2013\n      Belgium\n      26.4\n      20.4380\n      31.4823\n      49.3\n      28.4085\n      13.9902\n      27.9\n      21.9250\n      31.0038\n      27.9\n      21.9250\n      31.0038\n    \n    \n      53\n      2014\n      Belgium\n      26.2\n      20.4844\n      31.6187\n      49.7\n      28.6665\n      13.6639\n      27.9\n      22.0139\n      30.9550\n      27.9\n      22.0139\n      30.9550\n    \n    \n      54\n      2015\n      Belgium\n      26.6\n      20.6862\n      31.3296\n      50.0\n      28.8055\n      13.3961\n      27.8\n      22.1605\n      31.1528\n      27.8\n      22.1605\n      31.1528\n    \n    \n      55\n      2016\n      Belgium\n      26.5\n      20.7990\n      31.5698\n      50.0\n      29.3329\n      13.6307\n      27.7\n      22.0597\n      31.2912\n      27.7\n      22.0597\n      31.2912\n    \n    \n      56\n      2017\n      Belgium\n      26.0\n      20.1495\n      31.8090\n      48.7\n      28.1267\n      14.5604\n      27.3\n      21.6858\n      31.4754\n      27.3\n      21.6858\n      31.4754\n    \n    \n      57\n      2006\n      Brazil\n      50.5\n      39.2886\n      17.5972\n      59.0\n      45.3650\n      12.4553\n      53.5\n      41.6866\n      15.7415\n      53.5\n      41.6866\n      15.7415\n    \n    \n      58\n      2009\n      Brazil\n      47.7\n      36.9650\n      19.0539\n      56.7\n      42.9650\n      13.5618\n      50.8\n      39.4078\n      17.1833\n      50.8\n      39.4078\n      17.1833\n    \n    \n      59\n      2011\n      Brazil\n      46.9\n      36.2321\n      19.5728\n      56.5\n      42.4945\n      13.6147\n      49.9\n      38.6158\n      17.7841\n      49.9\n      38.6158\n      17.7841\n    \n    \n      60\n      2013\n      Brazil\n      46.0\n      35.7098\n      20.1896\n      56.4\n      42.1742\n      13.7093\n      49.0\n      38.0349\n      18.3756\n      49.0\n      38.0349\n      18.3756\n    \n    \n      61\n      2016\n      Brazil\n      48.2\n      36.7119\n      18.7755\n      58.2\n      43.3815\n      12.5728\n      50.9\n      38.7067\n      16.9817\n      50.9\n      38.7067\n      16.9817\n    \n    \n      62\n      1971\n      Canada\n      32.3\n      22.9561\n      27.7319\n      40.2\n      26.2199\n      22.3031\n      37.3\n      27.0267\n      24.7377\n      37.3\n      27.0267\n      24.7377\n    \n    \n      63\n      1975\n      Canada\n      29.3\n      21.4645\n      29.7542\n      37.9\n      24.8852\n      23.7708\n      33.4\n      24.6718\n      27.2335\n      33.4\n      24.6718\n      27.2335\n    \n    \n      64\n      1981\n      Canada\n      28.6\n      21.1489\n      30.2029\n      37.2\n      24.2255\n      24.1275\n      32.5\n      24.2964\n      27.8121\n      32.5\n      24.2964\n      27.8121\n    \n    \n      65\n      1987\n      Canada\n      28.3\n      21.4852\n      30.4038\n      38.8\n      25.4060\n      23.0998\n      31.5\n      23.8845\n      28.4828\n      31.5\n      23.8845\n      28.4828\n    \n    \n      66\n      1991\n      Canada\n      28.2\n      21.4442\n      30.4592\n      40.8\n      26.6340\n      21.7465\n      31.1\n      23.5999\n      28.7710\n      31.1\n      23.5999\n      28.7710\n    \n    \n      67\n      1994\n      Canada\n      28.5\n      21.5437\n      30.2384\n      42.2\n      26.8303\n      20.4803\n      31.3\n      23.6597\n      28.5929\n      31.3\n      23.6597\n      28.5929\n    \n    \n      68\n      1996\n      Canada\n      30.3\n      22.9436\n      29.1738\n      44.4\n      28.7162\n      19.1664\n      32.8\n      24.9824\n      27.7490\n      32.8\n      24.9824\n      27.7490\n    \n    \n      69\n      1997\n      Canada\n      30.8\n      23.3916\n      28.9143\n      44.6\n      29.1445\n      19.1484\n      33.2\n      25.4188\n      27.6092\n      33.2\n      25.4188\n      27.6092\n    \n    \n      70\n      1998\n      Canada\n      31.2\n      23.7782\n      28.7665\n      44.7\n      29.3693\n      19.1963\n      33.3\n      25.5674\n      27.5894\n      33.3\n      25.5674\n      27.5894\n    \n    \n      71\n      1999\n      Canada\n      31.0\n      23.5663\n      28.7715\n      43.5\n      28.8285\n      20.0146\n      33.1\n      25.1714\n      27.6158\n      33.1\n      25.1714\n      27.6158\n    \n    \n      72\n      2000\n      Canada\n      31.8\n      24.2988\n      28.4294\n      43.7\n      29.4302\n      20.1349\n      33.5\n      25.6444\n      27.4292\n      33.5\n      25.6444\n      27.4292\n    \n    \n      73\n      2001\n      Canada\n      31.8\n      24.3110\n      28.3719\n      43.8\n      29.5122\n      20.0407\n      33.6\n      25.6813\n      27.2833\n      33.6\n      25.6813\n      27.2833\n    \n    \n      74\n      2002\n      Canada\n      31.7\n      24.0637\n      28.4200\n      43.4\n      29.1817\n      20.3087\n      33.6\n      25.5395\n      27.2472\n      33.6\n      25.5395\n      27.2472\n    \n    \n      75\n      2003\n      Canada\n      31.8\n      24.1156\n      28.2961\n      43.6\n      29.1541\n      20.1444\n      33.9\n      25.8066\n      27.1051\n      33.9\n      25.8066\n      27.1051\n    \n    \n      76\n      2004\n      Canada\n      32.0\n      24.2937\n      28.1786\n      43.7\n      29.4177\n      20.1109\n      33.9\n      25.6503\n      27.1118\n      33.9\n      25.6503\n      27.1118\n    \n    \n      77\n      2005\n      Canada\n      31.8\n      24.1214\n      28.2746\n      43.3\n      29.1346\n      20.2812\n      33.7\n      25.6474\n      27.2590\n      33.7\n      25.6474\n      27.2590\n    \n    \n      78\n      2006\n      Canada\n      31.8\n      24.3561\n      28.3096\n      43.4\n      29.4253\n      20.3646\n      34.0\n      26.0143\n      27.0439\n      34.0\n      26.0143\n      27.0439\n    \n    \n      79\n      2007\n      Canada\n      31.6\n      24.2606\n      28.4712\n      43.4\n      29.6064\n      20.4347\n      33.7\n      25.8956\n      27.2669\n      33.7\n      25.8956\n      27.2669\n    \n    \n      80\n      2008\n      Canada\n      32.2\n      24.5736\n      28.1503\n      43.8\n      29.8203\n      20.2208\n      33.9\n      25.9749\n      27.1271\n      33.9\n      25.9749\n      27.1271\n    \n    \n      81\n      2009\n      Canada\n      32.1\n      24.4043\n      28.1151\n      44.4\n      29.8841\n      19.5611\n      34.0\n      25.8853\n      27.0259\n      34.0\n      25.8853\n      27.0259\n    \n    \n      82\n      2010\n      Canada\n      31.8\n      24.2615\n      28.3673\n      44.3\n      29.7703\n      19.6716\n      33.6\n      25.7754\n      27.3213\n      33.6\n      25.7754\n      27.3213\n    \n    \n      83\n      2011\n      Canada\n      31.3\n      23.8086\n      28.6180\n      43.4\n      28.9570\n      20.1814\n      32.7\n      25.0355\n      27.8764\n      32.7\n      25.0355\n      27.8764\n    \n    \n      84\n      2012\n      Canada\n      31.7\n      23.8099\n      28.2503\n      43.1\n      28.5904\n      20.2283\n      33.6\n      25.2017\n      27.1766\n      33.6\n      25.2017\n      27.1766\n    \n    \n      85\n      2013\n      Canada\n      32.1\n      23.7121\n      27.8701\n      43.6\n      28.5567\n      19.7705\n      33.8\n      25.1544\n      26.9233\n      33.8\n      25.1544\n      26.9233\n    \n    \n      86\n      2014\n      Canada\n      31.2\n      23.6019\n      28.6230\n      42.6\n      28.5008\n      20.7597\n      33.2\n      25.1836\n      27.5035\n      33.2\n      25.1836\n      27.5035\n    \n    \n      87\n      2015\n      Canada\n      32.0\n      24.0211\n      28.1513\n      43.8\n      29.1508\n      19.8311\n      33.8\n      25.5065\n      27.1266\n      33.8\n      25.5065\n      27.1266\n    \n    \n      88\n      2016\n      Canada\n      30.8\n      23.2828\n      28.8447\n      43.2\n      28.6796\n      20.2083\n      32.8\n      25.0134\n      27.7456\n      32.8\n      25.0134\n      27.7456\n    \n    \n      89\n      2017\n      Canada\n      31.3\n      23.6980\n      28.5350\n      44.1\n      29.3373\n      19.6208\n      33.3\n      25.3509\n      27.3513\n      33.3\n      25.3509\n      27.3513\n    \n    \n      90\n      2018\n      Canada\n      30.6\n      23.3173\n      29.0637\n      42.9\n      28.6330\n      20.4432\n      32.6\n      24.8325\n      27.8534\n      32.6\n      24.8325\n      27.8534\n    \n    \n      91\n      1990\n      Chile\n      50.7\n      40.4008\n      17.7667\n      55.4\n      43.4721\n      14.9847\n      52.8\n      42.2687\n      16.6576\n      52.8\n      42.2687\n      16.6576\n    \n    \n      92\n      1992\n      Chile\n      50.8\n      40.9414\n      17.8865\n      54.9\n      43.4383\n      15.5157\n      52.7\n      42.7495\n      16.8828\n      52.7\n      42.7495\n      16.8828\n    \n    \n      93\n      1994\n      Chile\n      50.6\n      39.3696\n      17.4048\n      54.9\n      42.0823\n      14.9380\n      52.5\n      41.2217\n      16.5017\n      52.5\n      41.2217\n      16.5017\n    \n    \n      94\n      1996\n      Chile\n      50.4\n      39.5356\n      17.7629\n      54.7\n      42.2900\n      15.0987\n      52.5\n      41.6195\n      16.6754\n      52.5\n      41.6195\n      16.6754\n    \n    \n      95\n      1998\n      Chile\n      51.0\n      40.2855\n      17.4644\n      55.1\n      42.8846\n      14.9717\n      53.4\n      42.4694\n      16.2395\n      53.4\n      42.4694\n      16.2395\n    \n    \n      96\n      2000\n      Chile\n      52.6\n      42.4316\n      16.9251\n      57.5\n      45.7775\n      13.9865\n      54.8\n      44.2552\n      15.7041\n      54.8\n      44.2552\n      15.7041\n    \n    \n      97\n      2003\n      Chile\n      50.3\n      39.8768\n      17.9316\n      54.8\n      42.6038\n      15.2441\n      52.8\n      42.2747\n      16.6622\n      52.8\n      42.2747\n      16.6622\n    \n    \n      98\n      2006\n      Chile\n      47.6\n      37.3633\n      19.3320\n      52.1\n      39.7624\n      16.5301\n      50.0\n      39.7252\n      18.1635\n      50.0\n      39.7252\n      18.1635\n    \n    \n      99\n      2009\n      Chile\n      47.8\n      38.2364\n      19.4950\n      53.8\n      41.5158\n      15.6130\n      50.0\n      40.4126\n      18.4211\n      50.0\n      40.4126\n      18.4211\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave the data\n\n\n\n\n\nI save the prepared data locally:\n\ndf_lis.to_csv(\"data/clean/lis.csv\", index=False)"
  },
  {
    "objectID": "PhD_pages/data_appendices/3_B_Query_OECD_API.html",
    "href": "PhD_pages/data_appendices/3_B_Query_OECD_API.html",
    "title": "Appendix 3.B: Preparing OECD data",
    "section": "",
    "text": "I moved the data folder, but haven’t yet relected this in the code below.\n\n\nlibrary(tidyverse)\nlibrary(rsdmx)\nlibrary(knitr)\n\n\n\nHere is where we will save the outputs of the API without any processing.\n\nfp<- \"PhD_pages/data/original/OECD/\"\n\nSet a year range for the queries below.\n\nquery_API<- FALSE\n\nstart_year<- 1950\nend_year<- 2020\n\n\n\nIndustry-level data on value added and its components\nif (query_API){\nselect_table<- \"SNA_TABLE6A_ARCHIVE\" # Value added and its components by activity, ISIC rev4\n\n\ncountries<- \"\" # leave blank for all entities\ntransactions<- \"\" # i.e. output/GOS/CoE etc. leave blank for all\nactivities<- \"\" # ISIC rev 4 industries. leave blank for all industries and sub-industries\nmeasures<- \"C+VOB\" # Prices. C = constant; VOB = indexed to OECD base year\n\nkey_query<- paste(countries,transactions,activities,measures, sep = \".\")\n\nindustry_accounts <- readSDMX(providerId = \"OECD\",\n                              resource = \"data\",\n                              flowRef = select_table,\n                              key = key_query,\n                              start = start_year,\n                              end = end_year,\n                              dsd = TRUE)\n\nindustry_accounts<- as.data.frame(industry_accounts)\n\n# Save\nsave(industry_accounts, file= paste0(fp, \"industry_accounts\", \".Rda\"))\n\n}\n\n\n\n\nIndustry-level data on employment\nif (query_API){\n\n# INDUSTRY LABOUR INPUTS DATA ----\n\n# set paramaters for API query\n\nselect_table<- \"SNA_TABLE7A_ARCHIVE\" # Labour intput by activity, ISIC rev4\n\ncountries<- \"\" # leave blank for all entities\ntransactions<- \"\" # i.e. total employment/employed/self-employed. leave blank for all\nactivities<- \"\" # ISIC rev 4 industries. leave blank for all industries and sub-industries\nmeasures<- \"HRS\" # i.e. hours/jobs/fte. HRS = hours in millions\n\nkey_query<- paste(countries,transactions,activities,measures, sep = \".\")\n\nemployment_by_industry <- readSDMX(providerId = \"OECD\",\n                              resource = \"data\",\n                              flowRef = select_table,\n                              key = key_query,\n                              start = start_year,\n                              end = end_year,\n                              dsd = TRUE)\n\nemployment_by_industry<- as.data.frame(employment_by_industry)\n\n\n# Save\nsave(employment_by_industry, file=paste0(fp, \"employment_by_industry\", \".Rda\"))\n}\n\n\n\n\nSector-level accounts (Households, Corporations, Govt etc.)\nif (query_API){\n\n# Grab full dataset\n\nsector_accounts <- readSDMX(providerId = \"OECD\",\n                        resource = \"data\",\n                        flowRef = \"SNA_TABLE14A\",\n                        key = \"..S1+S2+S11+S12+S13+S14_S15+S14+S15.C\",\n                        start = start_year,\n                        end = end_year,\n                        dsd = TRUE)\n\nsector_accounts<- as.data.frame(sector_accounts)\n\n# Save\nsave(sector_accounts,\n     file= paste0(fp, \"sector_accounts\", \".Rda\"))\n\n}\n\n\n\n#| code-fold: true\n#| code-summary: \"GDP measured in international-$\"\n\nif (query_API){\n# GDP AT PPPs ----\n\nGDP_PPP<- readSDMX(providerId = \"OECD\",\n                       resource = \"data\",\n                      flowRef = \"SNA_TABLE1\",\n                      key = \".B1_GE.VPVOB\",\n                       start = start_year,\n                      end = end_year,\n                      dsd = TRUE)\n\n\nGDP_PPP<- as.data.frame(GDP_PPP)\n\n# Save\nsave(GDP_PPP, file= paste0(fp, \"GDP_PPP\", \".Rda\"))\n\n}\n\n\n\nConsumption of rent\nif (query_API){\n# HOUSING CONSUMPTION ------\nrental_consumption <- readSDMX(providerId = \"OECD\",\n                            resource = \"data\",\n                            flowRef = \"SNA_TABLE5\",\n                            key = \".P31CP041+P31CP042.C+VOB\",\n                            start = start_year,\n                            end = end_year,\n                            dsd = TRUE)\n\nrental_consumption<- as.data.frame(rental_consumption)\n\n# Save\nsave(rental_consumption, file= paste0(fp, \"rental_consumption\", \".Rda\"))\n}\n\n\n\n\nRental price level\nif (query_API){\n# RENT PRICE -----\n# This is the CPI component for actual rentals or else the aggrgeate\n  # of actual and imputed rentals and maintenance. See paper for details.\n\nrent_price_index <- readSDMX(providerId = \"OECD\",\n                               resource = \"data\",\n                               flowRef = \"HOUSE_PRICES\",\n                               key = \".RPI\",\n                               start = start_year,\n                               end = end_year,\n                               dsd = TRUE)\n\nrent_price_index<- as.data.frame(rent_price_index)\n\n\n# Save\nsave(rent_price_index, file= paste0(fp, \"rent_price_index\", \".Rda\"))\n\n}\n\n\n\n\nCPI\nif (query_API){\n# CPI ------\n\nCPI <- readSDMX(providerId = \"OECD\",\n                             resource = \"data\",\n                             flowRef = \"PRICES_CPI\",\n                             key = \".CPALTT01.IXOB.A\",\n                             start = start_year,\n                             end = end_year,\n                             dsd = TRUE)\n\nCPI<- as.data.frame(CPI)\n\n  # the single subject-measure CPALTT01 - IXOB refers to all items\n    # CPI index. 2015=100\n\n# Save\nsave(CPI, file= paste0(fp, \"CPI\", \".Rda\"))\n}\n\n\n\n\nGDP deflator\nif (query_API){\n\n# GDP deflator ------\n\nGDP_deflator <- readSDMX(providerId = \"OECD\",\n                resource = \"data\",\n                flowRef = \"EO\",\n                key = \".PGDP.A\",\n                start = start_year,\n                end = end_year,\n                dsd = TRUE)\n\nGDP_deflator<- as.data.frame(GDP_deflator)\n\n# the single subject-measure CPALTT01 - IXOB refers to all items\n# CPI index. 2015=100\n\n# Save\nsave(GDP_deflator, file= paste0(fp, \"GDP_deflator\", \".Rda\"))\n\n}"
  },
  {
    "objectID": "PhD_pages/data_appendices/1_A_prepare_PIP.html",
    "href": "PhD_pages/data_appendices/1_A_prepare_PIP.html",
    "title": "Appendix 1.A: Preparing PIP inequality data",
    "section": "",
    "text": "The titles in each of the boxes below summarise the steps taken to prepare the PIP data. In each case you can expand the box to see the code used.\n\n\n\n\n\n\nPackages and settings\n\n\n\n\n\n\nimport pandas as pd\n\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad PIP data\n\n\n\n\n\nWe load the data from a file prepared from the PIP API by Our World in Data.\n\n# df_pip<- read.csv(\"https://raw.githubusercontent.com/owid/poverty-data/main/datasets/pip_dataset.csv\")\n\n#  A local version, in case internet isn't available \ndf_pip = pd.read_csv(\"data/original/pip_dataset.csv\")\n\nThe dataframe looks like this:\n\ndf_pip.head()\n\n\n\n\n\n  \n    \n      \n      country\n      year\n      reporting_level\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      ...\n      decile8_thr\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n    \n  \n  \n    \n      0\n      Albania\n      1996\n      national\n      consumption\n      2011\n      1996.0\n      0.0\n      0.920669\n      11.174149\n      44.618417\n      ...\n      8.85\n      10.92\n      0.270103\n      0.119104\n      0.241293\n      0.928335\n      3.945872\n      3.568627\n      1.889273\n      1.888889\n    \n    \n      1\n      Albania\n      2002\n      national\n      consumption\n      2011\n      2002.0\n      1.0\n      1.570843\n      14.132118\n      49.669635\n      ...\n      8.83\n      11.58\n      0.317390\n      0.164812\n      0.268982\n      1.215056\n      4.831625\n      3.979381\n      2.090253\n      1.903780\n    \n    \n      2\n      Albania\n      2005\n      national\n      consumption\n      2011\n      2005.0\n      1.0\n      0.860527\n      8.715685\n      38.545254\n      ...\n      10.02\n      12.78\n      0.305957\n      0.154413\n      0.254529\n      1.142718\n      4.662236\n      3.872727\n      1.978328\n      1.957576\n    \n    \n      3\n      Albania\n      2008\n      national\n      consumption\n      2011\n      2008.0\n      1.0\n      0.313650\n      5.250542\n      31.110345\n      ...\n      10.74\n      13.62\n      0.299847\n      0.148893\n      0.247311\n      1.114657\n      4.395911\n      3.574803\n      1.956897\n      1.826772\n    \n    \n      4\n      Albania\n      2012\n      national\n      consumption\n      2011\n      2012.0\n      1.0\n      0.849754\n      6.182414\n      34.528906\n      ...\n      10.52\n      13.26\n      0.289605\n      0.138417\n      0.249988\n      1.041193\n      4.272573\n      3.632877\n      1.941435\n      1.871233\n    \n  \n\n5 rows × 108 columns\n\n\n\n\n\n\n\n\n\n\n\n\nSelect PPP version\n\n\n\n\n\nWe will use the 2017 PPPs.\n\ndf_pip = df_pip.loc[df_pip[\"ppp_version\"] == 2017]\n\n\n\n\n\n\n\n\n\n\nDrop sub-national data\n\n\n\n\n\nThe PIP data includes observations for national, urban and rural populations (reporting_level):\n\ndf_pip.groupby('reporting_level').count()\n\n\n\n\n\n  \n    \n      \n      country\n      year\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      headcount_ratio_100\n      ...\n      decile8_thr\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n    \n    \n      reporting_level\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      national\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      ...\n      2024\n      2024\n      2019\n      2019\n      2019\n      2016\n      2016\n      2024\n      2024\n      2024\n    \n    \n      rural\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      ...\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n    \n    \n      urban\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      ...\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n    \n  \n\n3 rows × 107 columns\n\n\n\nHere we add a count of the number of reporting levels per country-year.\n\ndf_pip['n_reporting_level'] = df_pip\\\n  .groupby([\"country\", \"year\"])['reporting_level']\\\n  .transform('count')\n\ndf_pip.head(20)  \n\n\n\n\n\n  \n    \n      \n      country\n      year\n      reporting_level\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      ...\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n      n_reporting_level\n    \n  \n  \n    \n      2439\n      Albania\n      1996\n      national\n      consumption\n      2017\n      1996.00\n      0.0\n      0.534846\n      8.898443\n      47.879143\n      ...\n      13.18\n      0.270103\n      0.119104\n      0.241293\n      0.928335\n      3.945872\n      3.562162\n      1.888252\n      1.886486\n      1\n    \n    \n      2440\n      Albania\n      2002\n      national\n      consumption\n      2017\n      2002.00\n      1.0\n      1.092647\n      11.388324\n      52.090966\n      ...\n      13.98\n      0.317390\n      0.164812\n      0.268982\n      1.215056\n      4.831625\n      3.982906\n      2.089686\n      1.905983\n      1\n    \n    \n      2441\n      Albania\n      2005\n      national\n      consumption\n      2017\n      2005.00\n      1.0\n      0.591086\n      7.289304\n      40.428427\n      ...\n      15.44\n      0.305957\n      0.154413\n      0.254529\n      1.142718\n      4.662236\n      3.869674\n      1.979487\n      1.954887\n      1\n    \n    \n      2442\n      Albania\n      2008\n      national\n      consumption\n      2017\n      2008.00\n      1.0\n      0.199925\n      3.902613\n      33.431851\n      ...\n      16.44\n      0.299847\n      0.148893\n      0.247311\n      1.114657\n      4.395911\n      3.573913\n      1.957143\n      1.826087\n      1\n    \n    \n      2443\n      Albania\n      2012\n      national\n      consumption\n      2017\n      2012.00\n      1.0\n      0.620691\n      4.805442\n      36.667752\n      ...\n      16.00\n      0.289605\n      0.138417\n      0.249988\n      1.041193\n      4.272573\n      3.628118\n      1.941748\n      1.868481\n      1\n    \n    \n      2444\n      Albania\n      2014\n      national\n      consumption\n      2017\n      2014.00\n      2.0\n      1.023101\n      9.675968\n      38.743826\n      ...\n      19.06\n      0.345989\n      0.198662\n      0.324310\n      1.376215\n      5.930924\n      5.179348\n      2.299156\n      2.252717\n      1\n    \n    \n      2445\n      Albania\n      2015\n      national\n      consumption\n      2017\n      2015.00\n      2.0\n      0.120621\n      3.698998\n      26.154314\n      ...\n      22.06\n      0.327537\n      0.175495\n      0.300364\n      1.248506\n      5.278241\n      4.595833\n      2.230536\n      2.060417\n      1\n    \n    \n      2446\n      Albania\n      2016\n      national\n      consumption\n      2017\n      2016.00\n      2.0\n      0.139303\n      4.666635\n      25.413828\n      ...\n      23.16\n      0.337363\n      0.187581\n      0.314380\n      1.306972\n      5.626880\n      4.927660\n      2.252918\n      2.187234\n      2\n    \n    \n      2447\n      Albania\n      2016\n      national\n      income\n      2017\n      2016.00\n      4.0\n      5.795102\n      16.190831\n      41.500098\n      ...\n      19.36\n      0.385656\n      0.273740\n      0.350360\n      1.696002\n      8.286575\n      6.964029\n      2.378378\n      2.928058\n      2\n    \n    \n      2448\n      Albania\n      2017\n      national\n      consumption\n      2017\n      2017.00\n      2.0\n      0.392570\n      3.626683\n      25.540996\n      ...\n      22.72\n      0.330557\n      0.179908\n      0.308522\n      1.259837\n      5.389502\n      4.627291\n      2.231827\n      2.073320\n      2\n    \n    \n      2449\n      Albania\n      2017\n      national\n      income\n      2017\n      2017.00\n      4.0\n      5.264806\n      13.959267\n      37.323773\n      ...\n      19.84\n      0.370951\n      0.254175\n      0.332537\n      1.567077\n      7.732992\n      6.613333\n      2.280460\n      2.900000\n      2\n    \n    \n      2450\n      Albania\n      2018\n      national\n      consumption\n      2017\n      2018.00\n      3.0\n      0.048107\n      2.730375\n      18.160960\n      ...\n      23.32\n      0.301483\n      0.152404\n      0.265930\n      1.083829\n      4.811264\n      4.263254\n      2.003436\n      2.127971\n      2\n    \n    \n      2451\n      Albania\n      2018\n      national\n      income\n      2017\n      2018.00\n      4.0\n      3.892982\n      11.321431\n      34.187015\n      ...\n      20.54\n      0.359888\n      0.233051\n      0.319245\n      1.482572\n      7.036721\n      5.988338\n      2.232609\n      2.682216\n      2\n    \n    \n      2452\n      Albania\n      2019\n      national\n      consumption\n      2017\n      2019.00\n      3.0\n      0.000000\n      0.797915\n      10.936920\n      ...\n      27.58\n      0.307717\n      0.154626\n      0.274892\n      1.132010\n      4.744671\n      4.147368\n      2.108563\n      1.966917\n      1\n    \n    \n      2453\n      Algeria\n      1988\n      national\n      consumption\n      2017\n      1988.00\n      0.0\n      6.420311\n      25.193446\n      63.647189\n      ...\n      12.62\n      0.401949\n      0.281732\n      0.307921\n      1.899252\n      7.210696\n      5.130081\n      2.273874\n      2.256098\n      1\n    \n    \n      2454\n      Algeria\n      1995\n      national\n      consumption\n      2017\n      1995.00\n      1.0\n      5.770566\n      24.248315\n      61.103419\n      ...\n      13.12\n      0.353301\n      0.208518\n      0.313371\n      1.452068\n      6.118002\n      5.165354\n      2.281739\n      2.263780\n      1\n    \n    \n      2455\n      Algeria\n      2011\n      national\n      consumption\n      2017\n      2011.17\n      2.0\n      0.455468\n      4.019208\n      36.574951\n      ...\n      15.06\n      0.276157\n      0.125331\n      0.226046\n      0.992916\n      3.976114\n      3.354120\n      1.873134\n      1.790646\n      1\n    \n    \n      2456\n      Angola\n      2000\n      national\n      consumption\n      2017\n      2000.21\n      0.0\n      21.408848\n      39.538850\n      67.211819\n      ...\n      14.48\n      0.519569\n      0.512576\n      0.464340\n      3.653264\n      17.654010\n      12.271186\n      3.100642\n      3.957627\n      1\n    \n    \n      2457\n      Angola\n      2008\n      national\n      consumption\n      2017\n      2008.50\n      1.0\n      14.632487\n      37.666291\n      69.063484\n      ...\n      12.54\n      0.427155\n      0.311632\n      0.391365\n      2.147126\n      8.942374\n      6.852459\n      2.673774\n      2.562842\n      1\n    \n    \n      2458\n      Angola\n      2018\n      national\n      consumption\n      2017\n      2018.17\n      2.0\n      31.122006\n      52.902326\n      77.974702\n      ...\n      10.72\n      0.512721\n      0.477890\n      0.470982\n      3.465666\n      14.786824\n      10.018692\n      3.134503\n      3.196262\n      1\n    \n  \n\n20 rows × 109 columns\n\n\n\nWe only want one reporting level for each country-year.\nThat is already true for most country-years. But some include all three reporting levels.\n\ndf_pip.groupby('n_reporting_level').count()\n\n\n\n\n\n  \n    \n      \n      country\n      year\n      reporting_level\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      ...\n      decile8_thr\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n    \n    \n      n_reporting_level\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      233\n      233\n      0\n      0\n      233\n      0\n      0\n      233\n      233\n      233\n      ...\n      233\n      233\n      0\n      0\n      0\n      0\n      0\n      233\n      233\n      233\n    \n    \n      1\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      ...\n      1872\n      1872\n      1867\n      1867\n      1867\n      1864\n      1864\n      1872\n      1872\n      1872\n    \n    \n      2\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      ...\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n    \n    \n      3\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      ...\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n    \n  \n\n4 rows × 108 columns\n\n\n\nHere are the countries which include all three reporting levels:\n\nmulti_reporting_level_countries = df_pip.loc[df_pip['n_reporting_level'] == 3, \"country\"].unique()\n\nmulti_reporting_level_countries\n\narray(['China', 'India', 'Indonesia'], dtype=object)\n\n\nFor the country-years with 3 reporting levels, we keep only the national estimates.\n\ndf_pip = df_pip.loc[(df_pip['n_reporting_level'] != 3) | (df_pip['reporting_level'] == 'national') ]\n\n\n\n\n\n\n\n\n\n\nDrop regional data\n\n\n\n\n\nThe dataset includes aggregated estiates for world regions.\nHere we define a list of these aggregate entities and drop them from the data.\n\ndrop_aggs = [\n  \"East Asia and Pacific\",\n  \"South Asia\",\n  \"Europe and Central Asia\",\n  \"High income countries\",\n  \"Latin America and the Caribbean\",\n  \"Middle East and North Africa\",\n  \"Sub-Saharan Africa\",\n  \"World\"\n]\n\ndf_pip = df_pip.loc[~df_pip.country.isin(drop_aggs)]\n\n\n\n\n\n\n\n\n\n\nCalculate additional variables\n\n\n\n\n\n\n# Bottom 50% share – sum shares of lower 5 deciles\nsum_cols = [\n  \"decile1_share\",\n  \"decile2_share\",\n  \"decile3_share\",\n  \"decile4_share\",\n  \"decile5_share\"]\n\ndf_pip[\"Bottom_50_share\"] = df_pip[sum_cols].sum(axis=1)\n\ndf_pip[\"P90_P50_ratio\"] = df_pip[\"decile9_thr\"]/df_pip[\"median\"]\n\ndf_pip[\"Gini\"] = df_pip['gini'] * 100\n\n\n\n\n\n\n\n\n\n\nRename and select needed columns\n\n\n\n\n\n\ndf_pip = df_pip.rename(columns={\n    'decile10_share':'Top_10_share',\n    'mld': 'MLD',\n    \"country\": \"Entity\",\n    \"year\": \"Year\"\n  })\n\nkeep_cols = [\n  \"Year\",\n  \"Entity\",\n  \"Gini\",\n  \"Top_10_share\",\n  \"Bottom_50_share\",\n  \"MLD\",\n  \"welfare_type\"\n]\n\ndf_pip = df_pip[keep_cols]\n\n\n\n\n\n\n\n\n\n\nSee the prepared PIP data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_pip.head(100)\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini\n      Top_10_share\n      Bottom_50_share\n      MLD\n      welfare_type\n    \n  \n  \n    \n      2439\n      1996\n      Albania\n      27.010342\n      21.215573\n      31.233020\n      0.119104\n      consumption\n    \n    \n      2440\n      2002\n      Albania\n      31.738980\n      25.435637\n      28.586811\n      0.164812\n      consumption\n    \n    \n      2441\n      2005\n      Albania\n      30.595656\n      24.341168\n      29.289268\n      0.154413\n      consumption\n    \n    \n      2442\n      2008\n      Albania\n      29.984670\n      24.458311\n      29.854541\n      0.148893\n      consumption\n    \n    \n      2443\n      2012\n      Albania\n      28.960485\n      22.934340\n      30.110824\n      0.138417\n      consumption\n    \n    \n      2444\n      2014\n      Albania\n      34.598896\n      25.544322\n      26.073656\n      0.198662\n      consumption\n    \n    \n      2445\n      2015\n      Albania\n      32.753732\n      24.779308\n      27.467187\n      0.175495\n      consumption\n    \n    \n      2446\n      2016\n      Albania\n      33.736299\n      25.049555\n      26.690538\n      0.187581\n      consumption\n    \n    \n      2447\n      2016\n      Albania\n      38.565643\n      27.466949\n      23.553176\n      0.273740\n      income\n    \n    \n      2448\n      2017\n      Albania\n      33.055663\n      24.612430\n      27.141175\n      0.179908\n      consumption\n    \n    \n      2449\n      2017\n      Albania\n      37.095127\n      26.453363\n      24.529857\n      0.254175\n      income\n    \n    \n      2450\n      2018\n      Albania\n      30.148282\n      22.742312\n      29.118466\n      0.152404\n      consumption\n    \n    \n      2451\n      2018\n      Albania\n      35.988752\n      26.001869\n      25.267952\n      0.233051\n      income\n    \n    \n      2452\n      2019\n      Albania\n      30.771739\n      23.757880\n      28.848613\n      0.154626\n      consumption\n    \n    \n      2453\n      1988\n      Algeria\n      40.194909\n      32.812365\n      24.174448\n      0.281732\n      consumption\n    \n    \n      2454\n      1995\n      Algeria\n      35.330054\n      26.888586\n      25.997710\n      0.208518\n      consumption\n    \n    \n      2455\n      2011\n      Algeria\n      27.615731\n      22.862358\n      31.264953\n      0.125331\n      consumption\n    \n    \n      2456\n      2000\n      Angola\n      51.956892\n      40.245516\n      16.679090\n      0.512576\n      consumption\n    \n    \n      2457\n      2008\n      Angola\n      42.715515\n      32.311734\n      21.591434\n      0.311632\n      consumption\n    \n    \n      2458\n      2018\n      Angola\n      51.272111\n      39.624426\n      17.017691\n      0.477890\n      consumption\n    \n    \n      2459\n      1980\n      Argentina\n      40.830860\n      30.175371\n      22.456041\n      0.291847\n      income\n    \n    \n      2460\n      1986\n      Argentina\n      42.808887\n      32.208083\n      21.663422\n      0.331428\n      income\n    \n    \n      2461\n      1987\n      Argentina\n      45.276366\n      34.251890\n      20.231084\n      0.369971\n      income\n    \n    \n      2462\n      1991\n      Argentina\n      46.761739\n      36.609291\n      19.916604\n      0.382436\n      income\n    \n    \n      2463\n      1992\n      Argentina\n      45.468093\n      34.287122\n      20.005543\n      0.369330\n      income\n    \n    \n      2464\n      1993\n      Argentina\n      44.856286\n      33.201389\n      20.186152\n      0.366267\n      income\n    \n    \n      2465\n      1994\n      Argentina\n      45.916804\n      34.446597\n      19.717602\n      0.380300\n      income\n    \n    \n      2466\n      1995\n      Argentina\n      48.904403\n      36.975603\n      18.094343\n      0.440659\n      income\n    \n    \n      2467\n      1996\n      Argentina\n      49.524429\n      36.880607\n      17.546878\n      0.460014\n      income\n    \n    \n      2468\n      1997\n      Argentina\n      49.110475\n      36.374269\n      17.689760\n      0.449554\n      income\n    \n    \n      2469\n      1998\n      Argentina\n      50.733644\n      38.051340\n      16.843621\n      0.477405\n      income\n    \n    \n      2470\n      1999\n      Argentina\n      49.792041\n      37.048270\n      17.270868\n      0.461812\n      income\n    \n    \n      2471\n      2000\n      Argentina\n      51.063958\n      37.700487\n      16.361297\n      0.492797\n      income\n    \n    \n      2472\n      2001\n      Argentina\n      53.343106\n      39.477386\n      15.019009\n      0.550911\n      income\n    \n    \n      2473\n      2002\n      Argentina\n      53.793758\n      40.506190\n      15.028491\n      0.542299\n      income\n    \n    \n      2474\n      2003\n      Argentina\n      50.897157\n      37.685324\n      16.486608\n      0.486434\n      income\n    \n    \n      2475\n      2004\n      Argentina\n      48.377035\n      35.235994\n      17.749908\n      0.435194\n      income\n    \n    \n      2476\n      2005\n      Argentina\n      47.707355\n      34.894293\n      18.226501\n      0.420457\n      income\n    \n    \n      2477\n      2006\n      Argentina\n      46.346080\n      33.734755\n      18.949481\n      0.400806\n      income\n    \n    \n      2478\n      2007\n      Argentina\n      46.173556\n      33.672263\n      19.063280\n      0.392319\n      income\n    \n    \n      2479\n      2008\n      Argentina\n      44.876790\n      32.407600\n      19.791500\n      0.372277\n      income\n    \n    \n      2480\n      2009\n      Argentina\n      43.654197\n      31.249503\n      20.445920\n      0.353037\n      income\n    \n    \n      2481\n      2010\n      Argentina\n      43.583218\n      31.700111\n      20.632748\n      0.343588\n      income\n    \n    \n      2482\n      2011\n      Argentina\n      42.645281\n      30.957099\n      21.159035\n      0.326801\n      income\n    \n    \n      2483\n      2012\n      Argentina\n      41.326198\n      29.683243\n      21.823721\n      0.309280\n      income\n    \n    \n      2484\n      2013\n      Argentina\n      40.945442\n      29.371888\n      22.032889\n      0.302721\n      income\n    \n    \n      2485\n      2014\n      Argentina\n      41.632790\n      29.921178\n      21.631951\n      0.309027\n      income\n    \n    \n      2486\n      2016\n      Argentina\n      42.032529\n      30.419325\n      21.503691\n      0.316845\n      income\n    \n    \n      2487\n      2017\n      Argentina\n      41.134488\n      29.704420\n      22.022865\n      0.303501\n      income\n    \n    \n      2488\n      2018\n      Argentina\n      41.342498\n      29.830209\n      21.866618\n      0.308587\n      income\n    \n    \n      2489\n      2019\n      Argentina\n      42.905850\n      31.014569\n      20.951558\n      0.332231\n      income\n    \n    \n      2490\n      2020\n      Argentina\n      42.343291\n      30.302825\n      21.074827\n      0.320525\n      income\n    \n    \n      2491\n      1996\n      Armenia\n      44.418623\n      35.221513\n      21.195700\n      0.335479\n      income\n    \n    \n      2492\n      1999\n      Armenia\n      36.219724\n      29.627171\n      26.318746\n      0.218430\n      consumption\n    \n    \n      2493\n      2001\n      Armenia\n      35.364359\n      29.096740\n      26.929964\n      0.206337\n      consumption\n    \n    \n      2494\n      2002\n      Armenia\n      34.779674\n      28.999345\n      27.392142\n      0.200002\n      consumption\n    \n    \n      2495\n      2003\n      Armenia\n      33.028087\n      28.196948\n      28.599118\n      0.182095\n      consumption\n    \n    \n      2496\n      2004\n      Armenia\n      37.505633\n      31.688368\n      26.072292\n      0.237383\n      consumption\n    \n    \n      2497\n      2005\n      Armenia\n      35.992353\n      30.776058\n      26.995990\n      0.217763\n      consumption\n    \n    \n      2498\n      2006\n      Armenia\n      29.709985\n      24.454012\n      30.031688\n      0.145873\n      consumption\n    \n    \n      2499\n      2007\n      Armenia\n      31.226058\n      25.121380\n      29.068954\n      0.160137\n      consumption\n    \n    \n      2500\n      2008\n      Armenia\n      29.188142\n      23.690150\n      30.141146\n      0.139795\n      consumption\n    \n    \n      2501\n      2009\n      Armenia\n      28.015877\n      22.918775\n      30.945396\n      0.127764\n      consumption\n    \n    \n      2502\n      2010\n      Armenia\n      29.992582\n      25.033900\n      30.059406\n      0.148755\n      consumption\n    \n    \n      2503\n      2011\n      Armenia\n      29.352946\n      23.966580\n      30.229219\n      0.141577\n      consumption\n    \n    \n      2504\n      2012\n      Armenia\n      29.602261\n      24.540222\n      30.187470\n      0.145135\n      consumption\n    \n    \n      2505\n      2013\n      Armenia\n      30.579663\n      24.685464\n      29.434196\n      0.156560\n      consumption\n    \n    \n      2506\n      2014\n      Armenia\n      31.483291\n      25.743970\n      28.966402\n      0.165166\n      consumption\n    \n    \n      2507\n      2015\n      Armenia\n      32.356772\n      26.735056\n      28.597144\n      0.176380\n      consumption\n    \n    \n      2508\n      2016\n      Armenia\n      32.547948\n      25.281661\n      27.863252\n      0.180756\n      consumption\n    \n    \n      2509\n      2017\n      Armenia\n      33.621837\n      28.368865\n      28.202627\n      0.190807\n      consumption\n    \n    \n      2510\n      2018\n      Armenia\n      34.433498\n      29.199379\n      27.765776\n      0.200198\n      consumption\n    \n    \n      2511\n      2019\n      Armenia\n      29.878207\n      25.093678\n      30.247507\n      0.149867\n      consumption\n    \n    \n      2512\n      2020\n      Armenia\n      25.171743\n      21.473396\n      32.941241\n      0.104231\n      consumption\n    \n    \n      2513\n      1981\n      Australia\n      31.325787\n      23.301636\n      28.412371\n      0.187102\n      income\n    \n    \n      2514\n      1985\n      Australia\n      32.497685\n      24.289657\n      27.759943\n      0.201840\n      income\n    \n    \n      2515\n      1989\n      Australia\n      33.153835\n      24.666855\n      27.294485\n      0.211511\n      income\n    \n    \n      2516\n      1995\n      Australia\n      32.581990\n      24.601701\n      27.757864\n      0.198392\n      income\n    \n    \n      2517\n      2001\n      Australia\n      33.464798\n      25.065630\n      27.073808\n      0.208055\n      income\n    \n    \n      2518\n      2003\n      Australia\n      33.500516\n      25.082890\n      27.095688\n      0.221342\n      income\n    \n    \n      2519\n      2004\n      Australia\n      33.057409\n      25.316017\n      27.526896\n      0.207807\n      income\n    \n    \n      2520\n      2008\n      Australia\n      35.428508\n      27.415568\n      26.186895\n      0.224778\n      income\n    \n    \n      2521\n      2010\n      Australia\n      34.656728\n      26.457995\n      26.503312\n      0.216345\n      income\n    \n    \n      2522\n      2014\n      Australia\n      34.399431\n      26.983471\n      27.077736\n      0.226976\n      income\n    \n    \n      2523\n      2016\n      Australia\n      33.685811\n      25.808292\n      27.197987\n      0.208579\n      income\n    \n    \n      2524\n      2018\n      Australia\n      34.333762\n      26.613391\n      26.989284\n      0.225616\n      income\n    \n    \n      2525\n      1987\n      Austria\n      23.044493\n      19.288321\n      33.991877\n      0.088150\n      income\n    \n    \n      2526\n      1994\n      Austria\n      31.322342\n      24.590413\n      28.859071\n      0.183306\n      income\n    \n    \n      2527\n      1995\n      Austria\n      31.059269\n      22.409297\n      28.442713\n      0.197686\n      income\n    \n    \n      2528\n      1997\n      Austria\n      30.229853\n      23.442252\n      29.337562\n      0.166189\n      income\n    \n    \n      2529\n      2000\n      Austria\n      28.837106\n      22.713880\n      30.262081\n      0.144586\n      income\n    \n    \n      2530\n      2003\n      Austria\n      29.466078\n      23.469033\n      30.073341\n      0.161863\n      income\n    \n    \n      2531\n      2004\n      Austria\n      29.788990\n      23.842909\n      29.891165\n      0.154047\n      income\n    \n    \n      2532\n      2005\n      Austria\n      28.715433\n      22.849905\n      30.389131\n      0.144996\n      income\n    \n    \n      2533\n      2006\n      Austria\n      29.587583\n      23.711891\n      29.969613\n      0.152394\n      income\n    \n    \n      2534\n      2007\n      Austria\n      30.579996\n      23.848664\n      29.208728\n      0.174352\n      income\n    \n    \n      2535\n      2008\n      Austria\n      30.437386\n      24.109801\n      29.474433\n      0.174083\n      income\n    \n    \n      2536\n      2009\n      Austria\n      31.496232\n      24.683308\n      28.787035\n      0.200792\n      income\n    \n    \n      2537\n      2010\n      Austria\n      30.252263\n      23.567978\n      29.411210\n      0.171590\n      income\n    \n    \n      2538\n      2011\n      Austria\n      30.801669\n      23.686997\n      28.994799\n      0.183447\n      income\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave the data\n\n\n\n\n\nI save the prepared data locally:\n\ndf_pip.to_csv(\"data/clean/pip.csv\", index=False)\n\n\n\n\n\n\n\n\nThe PIP data includes a mix of income and consumption observations – including both for some country-years."
  },
  {
    "objectID": "PhD_pages/data_appendices/1_F_within_country_trends.html",
    "href": "PhD_pages/data_appendices/1_F_within_country_trends.html",
    "title": "Appendix 1.F: Analysing global trends in within-country inequality",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 1000\n\n## file: app.py\n\nimport jinja2\nfrom shiny import *\nimport pandas as pd\nfrom pyodide.http import open_url\nimport numpy as np\nfrom plotnine import *\n\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 1: Data prep functions -------------\n#  ----------------------------------\n\n#  Function get matching for ref years\ndef closest_to_reference(df, reference_val, max_dist_from_ref, reference_col, group_by_col, value_col, tie_break):\n  \n  df = df.loc[:, [reference_col, group_by_col, value_col]]\n\n  # Drop NAs\n  df = df.dropna()\n\n  # Calculate absolute distance from reference value\n  df['ref_diff'] = abs(df[reference_col] - reference_val)\n\n  # Drop any rows with a distance beyond threshold\n  if not pd.isna(max_dist_from_ref):\n    df = df.loc[df['ref_diff'] <= max_dist_from_ref]\n\n  # Keep closest observation to reference value – including tie-breaks (where there is a match above and below the ref value)\n  df = df[df.groupby(group_by_col)['ref_diff'].transform('min') == df['ref_diff']].reset_index(drop=True)\n\n  # Settle tie-breaks\n  if tie_break == 'below':\n    df = df[df.groupby(group_by_col)[reference_col].transform('min') == df[reference_col]].reset_index(drop=True)\n    \n  elif tie_break == 'above':\n    df = df[df.groupby(group_by_col)[reference_col].transform('max') == df[reference_col]].reset_index(drop=True)\n\n  df = df.drop('ref_diff', axis=1)\n\n  df = df\\\n    .rename(columns={value_col: \"value\"})\n\n\n  return df\n\n\n\n\n# Merge matches for different reference points\ndef merge_two_ref_matches(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n# Make sure the pair of reference values are in ascending order\n  reference_vals.sort()\n\n# Maximise distance between two refs by settling tie-breaks below the lowest ref and above the highest ref \n\n# Find matches for lower reference value\n  lower_ref_matches = closest_to_reference(df, reference_vals[0], max_dist_from_refs, reference_col, group_by_col, value_col, 'below')\n\n# Find matches for higher reference value\n  higher_ref_matches = closest_to_reference(df, reference_vals[1], max_dist_from_refs, reference_col, group_by_col, value_col, 'above')\n\n# Merge the two sets of matches\n  merged_df = pd.merge(lower_ref_matches, higher_ref_matches, on=group_by_col, suffixes=(reference_vals[0], reference_vals[1]))\n\n# Drop obs that do not have data for both ref values\n  merged_df = merged_df.dropna()\n\n# Drop obs where the matched data does not meet the min distance requirement\n  if not pd.isna(min_dist_between):\n  \n  # Store the names of the reference column returned from the two matches\n    ref_var_high = f'{reference_col}{reference_vals[1]}'\n    ref_var_low = f'{reference_col}{reference_vals[0]}'\n\n  # Keep only rows >= to the min distance\n    merged_df = merged_df.loc[(merged_df[ref_var_high] - merged_df[ref_var_low]) >= min_dist_between, :]\n\n\n\n  return merged_df\n\n\n\n  # For PIP run this three times – first filtering data for just consumpion only, then with income only, then with a dataset that prefers income over consumption\ndef pip_welfare_routine(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n  # Specify the name of the column in which the income/consumption welfare definition is stored\n  welfare_colname = 'welfare_type'\n\n  # Creat dataframes for thee scenarios:\n  # Scenario 1: only allow income data\n  df_inc_filter = df.loc[df[welfare_colname] == \"income\", :]\n  df_inc_filter.name = \"Income\"\n\n  # Scenario 2: only allow consumption data\n  df_cons_filter = df.loc[df[welfare_colname] == \"consumption\", :]\n  df_cons_filter.name = \"Consumption\"\n  # Scenario 3: allow a mix – dropping consumption data where income data is available in the same year\n  df_mixed = df.copy()\n\n  df_mixed['welfare_count'] = df_mixed.groupby([reference_col, group_by_col])[welfare_colname].transform('count')\n\n  df_mixed = df_mixed.loc[(df_mixed['welfare_count'] == 1) | (df_mixed[welfare_colname] == \"income\")]\n\n  df_mixed.name = \"Mixed\"\n  #  Store the scneario dataframes in a list\n  df_scenarios = [df_inc_filter, df_cons_filter, df_mixed]\n\n  # Run the matching function on each scenario\n  scenario_matches = [merge_two_ref_matches(\n    df_scenario, \n    reference_vals, \n    max_dist_from_refs, \n    min_dist_between, \n    reference_col, \n    group_by_col, \n    value_col) for df_scenario in df_scenarios]\n  \n  # Combine the first two scenarios.\n  df_combined_matches = pd.concat([scenario_matches[0], scenario_matches[1]], keys=[df_scenarios[0].name, df_scenarios[1].name])\n\n  # Tidy up indexes\n  df_combined_matches = df_combined_matches.reset_index()\n  \n  df_combined_matches = df_combined_matches.drop('level_1', axis=1)\n\n  df_combined_matches = df_combined_matches\\\n    .rename(columns={\"level_0\": \"pip_welfare\"})\n\n  # Add in third scenario.\n  df_combined_matches = pd.concat([df_combined_matches, scenario_matches[2]])\n\n  # add scenario name to te pip_welfare column\n  df_combined_matches['pip_welfare'] = df_combined_matches['pip_welfare'].fillna(df_scenarios[2].name)\n\n  # Keep only one match per group (e.g. per Country) - in the priority laid out in the df_scenarios list above (income only -> consumption only -> mixed)\n    # First count the matches\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n    # Then drop any matches from the lowest priority where there are multiple matches\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[2].name)]\n    #  Repeat at the next level of priority\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[1].name)]\n  \n  # Drop the match count column\n  df_combined_matches = df_combined_matches.drop('match_count', axis=1)\n\n\n  return df_combined_matches\n\n\n\n\ndef prep_selected_vars(selected_vars):\n\n  # selected_vars = [\n  #   'LIS: Top_10_share_equiv_market',\n  #   'WID: Bottom_50_share_posttax_dis',\n  #   'PIP: Top_10_share']\n\n  selected_sources = [var.split(sep, 1)[0] for var in selected_vars]\n  selected_var_names = [var.split(sep, 1)[1] for var in selected_vars]\n\n\n  match_data = {\n    \"sources\": selected_sources,\n    \"var_names\": selected_var_names\n          }\n\n\n  return match_data\n\n\n\n\n\n\n\ndef prep_data(\n      data_to_match,\n      reference_vals,\n      max_dist_from_refs,\n      min_dist_between,\n      all_metrics_requirement,\n      reference_col,\n      group_by_col,\n      tolerance,\n      outlier_cut_off_upper):\n\n  # Combine the source and varname strings element-wise to produce keys that will be used for the concat later\n  source_var_keys = [i + j for i, j in zip(data_to_match[\"sources\"], data_to_match[\"var_names\"])]\n\n  matches = []\n\n  for i in range(len(data_to_match['sources'])):\n    \n    source = data_to_match[\"sources\"][i]\n    var = data_to_match[\"var_names\"][i]\n\n    df = data[source]\n\n    if source == \"PIP\":\n\n      matched = pip_welfare_routine(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    else:\n\n      matched = merge_two_ref_matches(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    matches.append(matched)\n\n\n  plot_data = pd.concat(matches, keys=source_var_keys)\n\n  # Tidy up indexes\n  plot_data = plot_data.reset_index()\n  \n  plot_data = plot_data.drop('level_1', axis=1)\n\n  plot_data = plot_data\\\n    .rename(columns={\"level_0\": \"source_var\"})\n\n\n\n\n  # Store the names of the columns to be used onthe X and Y axis\n  x_axis = f'value{reference_vals[0]}'\n  y_axis = f'value{reference_vals[1]}'\n\n  x_ref_val = f'{reference_col}{reference_vals[0]}'\n  y_ref_val = f'{reference_col}{reference_vals[1]}'\n\n\n  # Apply outlier cut off, if specified\n  if not pd.isna(outlier_cut_off_upper):\n    plot_data = plot_data.loc[plot_data[x_axis] <= outlier_cut_off_upper]\n    plot_data = plot_data.loc[plot_data[y_axis] <= outlier_cut_off_upper]\n\n\n  # Add a count by country – counting whether data is available from each source or not\n  plot_data['source_count'] = plot_data.groupby(group_by_col)['source_var'].transform('count')\n\n\n  # Apply metrics requirement (whether to include only observations with data from all metrics)\n  if all_metrics_requirement:\n    plot_data = plot_data.loc[plot_data['source_count'] == plot_data['source_count'].max()]\n\n  # Drop source_count column\n  plot_data = plot_data.drop('source_count', axis=1)\n\n  # Add in region classification\n  plot_data = pd.merge(plot_data, df_regions, how = 'left')\n\n  # Add in population data\n    # For first ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[0], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref1'})\n\n    # For second ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[1], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref2'})\n\n    # Calculate average population two reference periods\n  plot_data['avg_pop'] = (plot_data['population_ref1'] + plot_data['population_ref2'])/2\n\n\n\n  #  PREP SUMMARY TABLE\n\n\n  # Calculate the change between the two ref periods\n  plot_data['change'] = (plot_data[y_axis] - plot_data[x_axis])\n\n\n  group_yes_vars = ['source_var', region_col]\n  group_no_vars = ['source_var']\n\n  group_scenarios = [group_no_vars, group_yes_vars] \n\n  aggs = []\n  \n  for group_vars in group_scenarios:\n  \n  # Prepare pop-weighted average change\n    agg_level = plot_data.copy()\n\n    # Calulate pop weights by source and region\n    agg_level['regional_pop_weights'] = agg_level.groupby(group_vars)['avg_pop'].transform(lambda x: x/x.sum()) \n\n    agg_level['global_pop_weights'] = agg_level.groupby('source_var')['avg_pop'].transform(lambda x: x/x.sum()) \n\n    # Multiply the change by the pop weights \n    agg_level['region_weighted_change'] = agg_level['change'] * agg_level['regional_pop_weights']\n\n\n  # Prepare fall/stable/rise categories\n    agg_level['fall'] = agg_level['change'] < -tolerance\n\n    agg_level['stable'] = (agg_level['change'] <= tolerance) & (agg_level['change'] >= -tolerance)\n\n    agg_level['rise'] = agg_level['change'] > tolerance\n\n    agg_level[['fall', 'stable', 'rise']] = agg_level[['fall', 'stable', 'rise']].astype(int)\n\n    agg_level = agg_level.groupby(group_vars)[['change', 'region_weighted_change', 'global_pop_weights', 'fall', 'stable', 'rise']]\\\n      .agg(['sum', 'mean', 'count'])\n\n  # Aggregate by source and region\n    if group_vars == group_yes_vars:\n\n      agg_level = agg_level\\\n        .unstack().T.reset_index()\n\n    elif group_vars == group_no_vars: \n\n      agg_level = agg_level\\\n        .T.reset_index()\n\n      agg_level[region_col] = \"World\"\n\n    aggs.append(agg_level) \n\n  \n  df_summary = pd.concat(aggs)\n\n    # filter for the aggregations we need and label in the 'summary' column\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'mean'), 'summary'] = 'avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'region_weighted_change') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Regional pop-weighted avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'global_pop_weights') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Global pop weights'\n\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'count'), 'summary'] = 'n'\n\n  df_summary.loc[(df_summary['level_0'] == 'fall') & (df_summary['level_1'] == 'sum'), 'summary'] = 'fall'\n\n  df_summary.loc[(df_summary['level_0'] == 'stable') & (df_summary['level_1'] == 'sum'), 'summary'] = 'stable'\n\n  df_summary.loc[(df_summary['level_0'] == 'rise') & (df_summary['level_1'] == 'sum'), 'summary'] = 'rise'\n\n  df_summary = df_summary[df_summary['summary'].notnull()]\n\n\n  df_summary = df_summary.drop(['level_0', 'level_1'], axis = 1)\n\n\n  df_summary['summary'] = pd.Categorical(df_summary['summary'], categories=['fall', 'stable', 'rise','n', 'avg change', 'Regional pop-weighted avg change', 'Global pop weights'], ordered=True)\n\n\n  df_summary = df_summary.sort_values([region_col,'summary']).set_index([region_col,'summary'])\n  \n  \n  # format to show appropriate d.p. I run a loop over each row for want of figuring out a better way!\n  repeat_length = 7\n  for i in range(0, len(df_summary.index.levels[0].unique())):\n    df_summary.iloc[i*repeat_length,:] = df_summary.iloc[i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[1 + i*repeat_length,:] = df_summary.iloc[1 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[2 + i*repeat_length,:] = df_summary.iloc[2 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[3 + i*repeat_length,:] = df_summary.iloc[3 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[4 + i*repeat_length,:] = df_summary.iloc[4 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[5 + i*repeat_length,:] = df_summary.iloc[5 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[6 + i*repeat_length,:] = df_summary.iloc[6 + i*repeat_length,:].map('{:.2f}'.format)\n  \n  return plot_data, df_summary\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 2: Specifications -------------\n#  ----------------------------------\n# These parameters are not controlled in the app.\n\nreference_col = 'Year'\ngroup_by_col = 'Entity'\n\ntolerance = 1\noutlier_cut_off_upper = None\nregion_col = 'region_alt'\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 3: Read in data -------------\n#  ----------------------------------\n# Note when testing outside of shinylive, this needs to be adjusted to a normal pd_read, without the pyodide step.\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/pip.csv'\n        \ndf_pip = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/wid.csv'\n\ndf_wid = pd.read_csv(open_url(url))\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/lis.csv'\n\ndf_lis = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/region_mapping.csv'\n\ndf_regions = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/population.csv'\n\ndf_pop = pd.read_csv(open_url(url))\n\n\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 4: Gather data into dictionary and collete varnames -------------\n#  ----------------------------------\n\ndata = {\"PIP\": df_pip,\n        \"WID\": df_wid,\n        \"LIS\": df_lis}\n\n# make an empty list to add all the varnames\nall_vars = list()\n\n# A string to use to separate the source name from the var name\nsep = \": \"\n\n# for each df in 'data'\nfor k,v in data.items():\n  \n  # make a list of varnames\n  vars = list(v.columns)\n\n  # remove the id cols\n  vars.remove(reference_col)\n  vars.remove(group_by_col)\n\n  # append the name of the source (the key of 'data') at the front\n  vars = [f'{k}{sep}' + var for var in vars]\n\n  # append to the running list\n  all_vars = all_vars + vars\n\n\n\n\n\n#  ---------------------------------\n#  ---------------------------------\n\n\n\n\n\n\n#  ---------------------------------\n#  ---------- App code -------------\n#  ----------------------------------\n\ndef panel_box(*args, **kwargs):\n    return ui.div(\n        ui.div(*args, class_=\"card-body\"),\n        **kwargs,\n        class_=\"card mb-3\",\n    )\n\napp_ui = ui.page_fluid(\n    {\"class\": \"p-4\"},\n    ui.row(\n        ui.column(\n            4,\n            panel_box(\n                ui.input_slider(\"reference_vals\", \"Reference years\", 1975, 2020, value=[1990,2018]),\n                ui.input_numeric(\n                            \"max_dist_from_refs\",\n                            \"=/- (years)\",\n                            4,\n                        ),\n                ui.input_numeric(\n                            \"min_dist_between\",\n                            \"Min distance between observations (years)\",\n                            23,\n                        ),\n                ui.input_selectize(\n                  \"metrics\", \"Metrics\", all_vars, multiple=True\n                  ),\n                ui.input_checkbox(\"all_metrics_requirement\", \"Show only countries with data for all metrics\", True),\n                ui.input_action_button(\n                    \"download\", \"Download data and image\", class_=\"btn-primary w-100\"\n                ),\n            ),\n        ),\n        ui.column(\n            8,\n            ui.output_plot(\"plot\"),\n            ui.output_table(\"table\")\n            ),\n    ),\n)\n\n\n\n\n\ndef server(input, output, session):\n\n    @reactive.Calc\n    def reactive_data():\n\n      data_to_match = prep_selected_vars(input.metrics())\n\n      reference_vals = list(input.reference_vals())\n\n      max_dist_from_refs = input.max_dist_from_refs()\n      min_dist_between = input.min_dist_between()\n      all_metrics_requirement = input.all_metrics_requirement()\n\n      prepped_data = prep_data(\n        data_to_match = data_to_match,\n        reference_vals = reference_vals,\n        max_dist_from_refs = max_dist_from_refs,\n        min_dist_between = min_dist_between,\n        all_metrics_requirement = all_metrics_requirement,\n        reference_col = reference_col,\n        group_by_col = group_by_col,\n        tolerance = tolerance,\n        outlier_cut_off_upper = outlier_cut_off_upper)\n\n      return prepped_data\n\n\n    @output\n    @render.plot\n    def plot():\n\n        reference_vals = list(input.reference_vals())\n\n        \n        prepped_data = reactive_data()\n    \n        plot_data = prepped_data[0]\n\n        \n        # Store the names of the columns to be used onthe X and Y axis\n        x_axis = f'value{reference_vals[0]}'\n        y_axis = f'value{reference_vals[1]}'\n\n\n        # I grab what I am guessing to be the max and min tick marks on the x axist, in order to define the coordinates of a 'tolerance' ribbon.\n        x_min = plot_data[x_axis].min()\n        x_min_floor = np.floor(x_min * 10) / 10\n\n        x_max = plot_data[x_axis].max()\n        x_max_ceiling = np.ceil(x_max * 10) / 10\n\n\n        plot = (ggplot(plot_data\n        , aes(x_axis, y_axis, alpha=0.5))\n        + geom_point(aes(color=region_col, size='avg_pop', alpha = 0.6))\n        + geom_abline(intercept=0,slope=1) \n        + facet_wrap('~ source_var')\n        + theme_light()\n        + theme(legend_position='none')\n        )\n        \n        return plot\n\n\n    @output\n    @render.table\n    def table():\n\n        \n        prepped_data = reactive_data()\n    \n        summary = prepped_data[1].reset_index()\n\n        \n        return summary\n\napp = App(app_ui, server)\n\n\n## file: requirements.txt\nJinja2\n\n\nTESTING!!! These are the same sections as above, to be used for testing.\n\nfrom plotnine import *\nimport plotly.express as px\nimport pandas as pd\nimport numpy as np\n\n\n#  ---------------------------------\n#  ---------- SECTION 1: Data prep functions -------------\n#  ----------------------------------\n\n#  Function get matching for ref years\ndef closest_to_reference(df, reference_val, max_dist_from_ref, reference_col, group_by_col, value_col, tie_break):\n  \n  df = df.loc[:, [reference_col, group_by_col, value_col]]\n\n  # Drop NAs\n  df = df.dropna()\n\n  # Calculate absolute distance from reference value\n  df['ref_diff'] = abs(df[reference_col] - reference_val)\n\n  # Drop any rows with a distance beyond threshold\n  if not pd.isna(max_dist_from_ref):\n    df = df.loc[df['ref_diff'] <= max_dist_from_ref]\n\n  # Keep closest observation to reference value – including tie-breaks (where there is a match above and below the ref value)\n  df = df[df.groupby(group_by_col)['ref_diff'].transform('min') == df['ref_diff']].reset_index(drop=True)\n\n  # Settle tie-breaks\n  if tie_break == 'below':\n    df = df[df.groupby(group_by_col)[reference_col].transform('min') == df[reference_col]].reset_index(drop=True)\n    \n  elif tie_break == 'above':\n    df = df[df.groupby(group_by_col)[reference_col].transform('max') == df[reference_col]].reset_index(drop=True)\n\n  df = df.drop('ref_diff', axis=1)\n\n  df = df\\\n    .rename(columns={value_col: \"value\"})\n\n\n  return df\n\n\n\n\n# Merge matches for different reference points\ndef merge_two_ref_matches(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n# Make sure the pair of reference values are in ascending order\n  reference_vals.sort()\n\n# Maximise distance between two refs by settling tie-breaks below the lowest ref and above the highest ref \n\n# Find matches for lower reference value\n  lower_ref_matches = closest_to_reference(df, reference_vals[0], max_dist_from_refs, reference_col, group_by_col, value_col, 'below')\n\n# Find matches for higher reference value\n  higher_ref_matches = closest_to_reference(df, reference_vals[1], max_dist_from_refs, reference_col, group_by_col, value_col, 'above')\n\n# Merge the two sets of matches\n  merged_df = pd.merge(lower_ref_matches, higher_ref_matches, on=group_by_col, suffixes=(reference_vals[0], reference_vals[1]))\n\n# Drop obs that do not have data for both ref values\n  merged_df = merged_df.dropna()\n\n# Drop obs where the matched data does not meet the min distance requirement\n  if not pd.isna(min_dist_between):\n  \n  # Store the names of the reference column returned from the two matches\n    ref_var_high = f'{reference_col}{reference_vals[1]}'\n    ref_var_low = f'{reference_col}{reference_vals[0]}'\n\n  # Keep only rows >= to the min distance\n    merged_df = merged_df.loc[(merged_df[ref_var_high] - merged_df[ref_var_low]) >= min_dist_between, :]\n\n\n\n  return merged_df\n\n\n\n  # For PIP run this three times – first filtering data for just consumpion only, then with income only, then with a dataset that prefers income over consumption\ndef pip_welfare_routine(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n  # Specify the name of the column in which the income/consumption welfare definition is stored\n  welfare_colname = 'welfare_type'\n\n  # Creat dataframes for thee scenarios:\n  # Scenario 1: only allow income data\n  df_inc_filter = df.loc[df[welfare_colname] == \"income\", :]\n  df_inc_filter.name = \"Income\"\n\n  # Scenario 2: only allow consumption data\n  df_cons_filter = df.loc[df[welfare_colname] == \"consumption\", :]\n  df_cons_filter.name = \"Consumption\"\n  # Scenario 3: allow a mix – dropping consumption data where income data is available in the same year\n  df_mixed = df.copy()\n\n  df_mixed['welfare_count'] = df_mixed.groupby([reference_col, group_by_col])[welfare_colname].transform('count')\n\n  df_mixed = df_mixed.loc[(df_mixed['welfare_count'] == 1) | (df_mixed[welfare_colname] == \"income\")]\n\n  df_mixed.name = \"Mixed\"\n  #  Store the scneario dataframes in a list\n  df_scenarios = [df_inc_filter, df_cons_filter, df_mixed]\n\n  # Run the matching function on each scenario\n  scenario_matches = [merge_two_ref_matches(\n    df_scenario, \n    reference_vals, \n    max_dist_from_refs, \n    min_dist_between, \n    reference_col, \n    group_by_col, \n    value_col) for df_scenario in df_scenarios]\n  \n  # Combine the first two scenarios.\n  df_combined_matches = pd.concat([scenario_matches[0], scenario_matches[1]], keys=[df_scenarios[0].name, df_scenarios[1].name])\n\n  # Tidy up indexes\n  df_combined_matches = df_combined_matches.reset_index()\n  \n  df_combined_matches = df_combined_matches.drop('level_1', axis=1)\n\n  df_combined_matches = df_combined_matches\\\n    .rename(columns={\"level_0\": \"pip_welfare\"})\n\n  # Add in third scenario.\n  df_combined_matches = pd.concat([df_combined_matches, scenario_matches[2]])\n\n  # add scenario name to te pip_welfare column\n  df_combined_matches['pip_welfare'] = df_combined_matches['pip_welfare'].fillna(df_scenarios[2].name)\n\n  # Keep only one match per group (e.g. per Country) - in the priority laid out in the df_scenarios list above (income only -> consumption only -> mixed)\n    # First count the matches\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n    # Then drop any matches from the lowest priority where there are multiple matches\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[2].name)]\n    #  Repeat at the next level of priority\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[1].name)]\n  \n  # Drop the match count column\n  df_combined_matches = df_combined_matches.drop('match_count', axis=1)\n\n\n  return df_combined_matches\n\n\n\n\ndef prep_selected_vars(selected_vars):\n\n  # selected_vars = [\n  #   'LIS: Top_10_share_equiv_market',\n  #   'WID: Bottom_50_share_posttax_dis',\n  #   'PIP: Top_10_share']\n\n  selected_sources = [var.split(sep, 1)[0] for var in selected_vars]\n  selected_var_names = [var.split(sep, 1)[1] for var in selected_vars]\n\n\n  match_data = {\n    \"sources\": selected_sources,\n    \"var_names\": selected_var_names\n          }\n\n\n  return match_data\n\n\n\n\n# Specify the tolerances for each kind of metric\ndef return_tolerance_for_var(var):\n\n  if 'Gini' in var:\n    tolerance = 1\n\n  elif 'Top_10_share' in var:\n    tolerance = 1\n\n  elif 'Bottom_50_share' in var:\n    tolerance = 1\n\n  else:\n    tolerance = None\n\n  return tolerance\n\n\n\n\n\ndef prep_data(\n      data_to_match,\n      reference_vals,\n      max_dist_from_refs,\n      min_dist_between,\n      all_metrics_requirement,\n      reference_col,\n      group_by_col,\n      outlier_cut_off_upper):\n\n  # Combine the source and varname strings element-wise to produce keys that will be used for the concat later\n  source_var_keys = [i + j for i, j in zip(data_to_match[\"sources\"], data_to_match[\"var_names\"])]\n\n  matches = []\n\n  for i in range(len(data_to_match['sources'])):\n    \n    source = data_to_match[\"sources\"][i]\n    var = data_to_match[\"var_names\"][i]\n\n    tolerance = return_tolerance_for_var(\n      data_to_match[\"var_names\"][i]\n    )\n\n    df = data[source]\n\n    if source == \"PIP\":\n\n      matched = pip_welfare_routine(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    else:\n\n      matched = merge_two_ref_matches(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    matches.append(matched)\n\n\n  plot_data = pd.concat(matches, keys=source_var_keys)\n\n  # Tidy up indexes\n  plot_data = plot_data.reset_index()\n  \n  plot_data = plot_data.drop('level_1', axis=1)\n\n  plot_data = plot_data\\\n    .rename(columns={\"level_0\": \"source_var\"})\n\n\n\n\n  # Store the names of the columns to be used onthe X and Y axis\n  x_axis = f'value{reference_vals[0]}'\n  y_axis = f'value{reference_vals[1]}'\n\n  x_ref_val = f'{reference_col}{reference_vals[0]}'\n  y_ref_val = f'{reference_col}{reference_vals[1]}'\n\n\n  # Apply outlier cut off, if specified\n  if not pd.isna(outlier_cut_off_upper):\n    plot_data = plot_data.loc[plot_data[x_axis] <= outlier_cut_off_upper]\n    plot_data = plot_data.loc[plot_data[y_axis] <= outlier_cut_off_upper]\n\n\n  # Add a count by country – counting whether data is available from each source or not\n  plot_data['source_count'] = plot_data.groupby(group_by_col)['source_var'].transform('count')\n\n\n  # Apply metrics requirement (whether to include only observations with data from all metrics)\n  if all_metrics_requirement:\n    plot_data = plot_data.loc[plot_data['source_count'] == plot_data['source_count'].max()]\n\n  # Drop source_count column\n  plot_data = plot_data.drop('source_count', axis=1)\n\n  # Add in region classification\n  plot_data = pd.merge(plot_data, df_regions, how = 'left')\n\n  # Add in population data\n    # For first ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[0], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref1'})\n\n    # For second ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[1], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref2'})\n\n    # Calculate average population two reference periods\n  plot_data['avg_pop'] = (plot_data['population_ref1'] + plot_data['population_ref2'])/2\n\n\n\n  #  PREP SUMMARY TABLE\n\n\n  # Calculate the change between the two ref periods\n  plot_data['change'] = (plot_data[y_axis] - plot_data[x_axis])\n\n\n  group_yes_vars = ['source_var', region_col]\n  group_no_vars = ['source_var']\n\n  group_scenarios = [group_no_vars, group_yes_vars] \n\n  aggs = []\n  \n  for group_vars in group_scenarios:\n  \n  # Prepare pop-weighted average change\n    agg_level = plot_data.copy()\n\n    # Calulate pop weights by source and region\n    agg_level['regional_pop_weights'] = agg_level.groupby(group_vars)['avg_pop'].transform(lambda x: x/x.sum()) \n\n    agg_level['global_pop_weights'] = agg_level.groupby('source_var')['avg_pop'].transform(lambda x: x/x.sum()) \n\n    # Multiply the change by the pop weights \n    agg_level['region_weighted_change'] = agg_level['change'] * agg_level['regional_pop_weights']\n\n\n  # Prepare fall/stable/rise categories\n    agg_level['fall'] = agg_level['change'] < -tolerance\n\n    agg_level['stable'] = (agg_level['change'] <= tolerance) & (agg_level['change'] >= -tolerance)\n\n    agg_level['rise'] = agg_level['change'] > tolerance\n\n    agg_level[['fall', 'stable', 'rise']] = agg_level[['fall', 'stable', 'rise']].astype(int)\n\n    agg_level = agg_level.groupby(group_vars)[['change', 'region_weighted_change', 'global_pop_weights', 'fall', 'stable', 'rise']]\\\n      .agg(['sum', 'mean', 'count'])\n\n  # Aggregate by source and region\n    if group_vars == group_yes_vars:\n\n      agg_level = agg_level\\\n        .unstack().T.reset_index()\n\n    elif group_vars == group_no_vars: \n\n      agg_level = agg_level\\\n        .T.reset_index()\n\n      agg_level[region_col] = \"World\"\n\n    aggs.append(agg_level) \n\n  \n  df_summary = pd.concat(aggs)\n\n    # filter for the aggregations we need and label in the 'summary' column\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'mean'), 'summary'] = 'avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'region_weighted_change') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Regional pop-weighted avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'global_pop_weights') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Global pop weights'\n\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'count'), 'summary'] = 'n'\n\n  df_summary.loc[(df_summary['level_0'] == 'fall') & (df_summary['level_1'] == 'sum'), 'summary'] = 'fall'\n\n  df_summary.loc[(df_summary['level_0'] == 'stable') & (df_summary['level_1'] == 'sum'), 'summary'] = 'stable'\n\n  df_summary.loc[(df_summary['level_0'] == 'rise') & (df_summary['level_1'] == 'sum'), 'summary'] = 'rise'\n\n  df_summary = df_summary[df_summary['summary'].notnull()]\n\n\n  df_summary = df_summary.drop(['level_0', 'level_1'], axis = 1)\n\n\n  df_summary['summary'] = pd.Categorical(df_summary['summary'], categories=['fall', 'stable', 'rise','n', 'avg change', 'Regional pop-weighted avg change', 'Global pop weights'], ordered=True)\n\n\n  df_summary = df_summary.sort_values([region_col,'summary']).set_index([region_col,'summary'])\n  \n  \n  # format to show appropriate d.p. I run a loop over each row for want of figuring out a better way!\n  repeat_length = 7\n  for i in range(0, len(df_summary.index.levels[0].unique())):\n    df_summary.iloc[i*repeat_length,:] = df_summary.iloc[i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[1 + i*repeat_length,:] = df_summary.iloc[1 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[2 + i*repeat_length,:] = df_summary.iloc[2 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[3 + i*repeat_length,:] = df_summary.iloc[3 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[4 + i*repeat_length,:] = df_summary.iloc[4 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[5 + i*repeat_length,:] = df_summary.iloc[5 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[6 + i*repeat_length,:] = df_summary.iloc[6 + i*repeat_length,:].map('{:.2f}'.format)\n  \n  return plot_data, df_summary\n\n\n#  ---------------------------------\n#  ---------- SECTION 2: Specifications -------------\n#  ----------------------------------\n# These parameters are not controlled in the app.\n\nreference_col = 'Year'\ngroup_by_col = 'Entity'\n\noutlier_cut_off_upper = None\nregion_col = 'region_alt'\n\n\n#  ---------------------------------\n#  ---------- SECTION 3: Read in data -------------\n#  ----------------------------------\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/pip.csv'\n        \ndf_pip = pd.read_csv(url)\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/wid.csv'\n\ndf_wid = pd.read_csv(url)\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/lis.csv'\n\ndf_lis = pd.read_csv(url)\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/region_mapping.csv'\n\ndf_regions = pd.read_csv(url)\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/population.csv'\n\ndf_pop = pd.read_csv(url)\n\n\n#  ---------------------------------\n#  ---------- SECTION 4: Gather data into dictionary and collete varnames -------------\n#  ----------------------------------\n\ndata = {\"PIP\": df_pip,\n        \"WID\": df_wid,\n        \"LIS\": df_lis}\n\n# make an empty list to add all the varnames\nall_vars = list()\n\n# A string to use to separate the source name from the var name\nsep = \": \"\n\n# for each df in 'data'\nfor k,v in data.items():\n  \n  # make a list of varnames\n  vars = list(v.columns)\n\n  # remove the id cols\n  vars.remove(reference_col)\n  vars.remove(group_by_col)\n\n  # append the name of the source (the key of 'data') at the front\n  vars = [f'{k}{sep}' + var for var in vars]\n\n  # append to the running list\n  all_vars = all_vars + vars\n\nWe don’t run this reactive step in the testing. We just run the prep data function in the plot and table functions below.\n\n# def reactive_data():\n\n#   # For testing we define manually, rather than picked up from the app inputs\n#   data_to_match = prep_selected_vars(input.metrics())\n\n#   reference_vals = list(input.reference_vals())\n\n#   max_dist_from_refs = input.max_dist_from_refs()\n#   min_dist_between = input.min_dist_between()\n#   all_metrics_requirement = input.all_metrics_requirement()\n\n\n\n#   prepped_data = prep_data(\n#       data_to_match = data_to_match,\n#       reference_vals = reference_vals,\n#       max_dist_from_refs = max_dist_from_refs,\n#       min_dist_between = min_dist_between,\n#       all_metrics_requirement = all_metrics_requirement,\n#       reference_col = reference_col,\n#       group_by_col = group_by_col,\n#       tolerance = tolerance,\n#       outlier_cut_off_upper = outlier_cut_off_upper)\n\n#   return prepped_data\n\n\ndef interactive_plot(\n  selected_vars,\n  reference_vals,\n  max_dist_from_refs,\n  min_dist_between,\n  all_metrics_requirement):\n\n  data_to_match = prep_selected_vars(selected_vars)\n\n  prepped_data = prep_data(\n      data_to_match = data_to_match,\n      reference_vals = reference_vals,\n      max_dist_from_refs = max_dist_from_refs,\n      min_dist_between = min_dist_between,\n      all_metrics_requirement = all_metrics_requirement,\n      reference_col = reference_col,\n      group_by_col = group_by_col,\n      outlier_cut_off_upper = outlier_cut_off_upper)\n\n  plot_data = prepped_data[0]\n\n  fig = px.scatter(\n    plot_data, \n    x=f'value{reference_vals[0]}', \n    y=f'value{reference_vals[1]}',\n    color=region_col, \n    facet_col='source_var', \n    facet_col_wrap=1, \n    size='avg_pop',\n    hover_name=group_by_col,\n    hover_data={\n      f'value{reference_vals[0]}':':.2f',\n      f'{reference_col}{reference_vals[0]}':True,\n      f'value{reference_vals[1]}':':.2f',\n      f'{reference_col}{reference_vals[1]}':True,\n      region_col: True,\n      'avg_pop': False,\n      'source_var': False},\n      height=1000\n    )\n\n\n  fig.update_layout(legend=dict(\n      orientation=\"h\",\n      yanchor=\"bottom\",\n      y=1.02,\n      xanchor=\"right\",\n      x=1\n  ))\n\n  fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\",1)[1]))\n\n  fig.update_layout(\n      legend_title=\"\"\n  )\n\n\n\n  return fig\n\n\ndef table_test(selected_vars,\n  reference_vals,\n  max_dist_from_refs,\n  min_dist_between,\n  all_metrics_requirement):\n\n  data_to_match = prep_selected_vars(selected_vars)\n\n  prepped_data = prep_data(\n    data_to_match = data_to_match,\n    reference_vals = reference_vals,\n    max_dist_from_refs = max_dist_from_refs,\n    min_dist_between = min_dist_between,\n    all_metrics_requirement = all_metrics_requirement,\n    reference_col = reference_col,\n    group_by_col = group_by_col,\n    outlier_cut_off_upper = outlier_cut_off_upper)\n\n\n  summary = prepped_data[1].reset_index()\n  \n  return summary\n\n\nfig = interactive_plot(\n  selected_vars = [\n      'WID: Top_10_share_pretax',\n      'PIP: Top_10_share'],\n  reference_vals = [1990,2015],\n  max_dist_from_refs = 5,\n  min_dist_between = 10,\n  all_metrics_requirement = True\n)\n\nfig.show()\n\n\n                                                \n\n\n\nsummary_table = table_test(\n  selected_vars = [\n      'WID: Top_10_share_pretax',\n      'PIP: Top_10_share'],\n  reference_vals = [1990,2015],\n  max_dist_from_refs = 5,\n  min_dist_between = 10,\n  all_metrics_requirement = True\n)\n\nsummary_table\n\n\n\n\n\n  \n    \n      source_var\n      region_alt\n      summary\n      PIPTop_10_share\n      WIDTop_10_share_pretax\n    \n  \n  \n    \n      0\n      East Asia\n      fall\n      0\n      0\n    \n    \n      1\n      East Asia\n      stable\n      2\n      1\n    \n    \n      2\n      East Asia\n      rise\n      1\n      2\n    \n    \n      3\n      East Asia\n      n\n      3\n      3\n    \n    \n      4\n      East Asia\n      avg change\n      1.74\n      7.34\n    \n    \n      5\n      East Asia\n      Regional pop-weighted avg change\n      3.57\n      10.78\n    \n    \n      6\n      East Asia\n      Global pop weights\n      0.26\n      0.26\n    \n    \n      7\n      Eastern Europe & Central Asia\n      fall\n      4\n      1\n    \n    \n      8\n      Eastern Europe & Central Asia\n      stable\n      2\n      0\n    \n    \n      9\n      Eastern Europe & Central Asia\n      rise\n      8\n      13\n    \n    \n      10\n      Eastern Europe & Central Asia\n      n\n      14\n      14\n    \n    \n      11\n      Eastern Europe & Central Asia\n      avg change\n      0.52\n      9.79\n    \n    \n      12\n      Eastern Europe & Central Asia\n      Regional pop-weighted avg change\n      -3.16\n      12.86\n    \n    \n      13\n      Eastern Europe & Central Asia\n      Global pop weights\n      0.07\n      0.07\n    \n    \n      14\n      MENA\n      fall\n      5\n      5\n    \n    \n      15\n      MENA\n      stable\n      0\n      1\n    \n    \n      16\n      MENA\n      rise\n      2\n      1\n    \n    \n      17\n      MENA\n      n\n      7\n      7\n    \n    \n      18\n      MENA\n      avg change\n      -3.50\n      -4.42\n    \n    \n      19\n      MENA\n      Regional pop-weighted avg change\n      -2.42\n      -3.73\n    \n    \n      20\n      MENA\n      Global pop weights\n      0.05\n      0.05\n    \n    \n      21\n      North America & Oceania\n      fall\n      0\n      0\n    \n    \n      22\n      North America & Oceania\n      stable\n      0\n      0\n    \n    \n      23\n      North America & Oceania\n      rise\n      3\n      3\n    \n    \n      24\n      North America & Oceania\n      n\n      3\n      3\n    \n    \n      25\n      North America & Oceania\n      avg change\n      2.00\n      6.64\n    \n    \n      26\n      North America & Oceania\n      Regional pop-weighted avg change\n      2.78\n      6.74\n    \n    \n      27\n      North America & Oceania\n      Global pop weights\n      0.07\n      0.07\n    \n    \n      28\n      South & South-East Asia\n      fall\n      5\n      5\n    \n    \n      29\n      South & South-East Asia\n      stable\n      1\n      1\n    \n    \n      30\n      South & South-East Asia\n      rise\n      5\n      5\n    \n    \n      31\n      South & South-East Asia\n      n\n      11\n      11\n    \n    \n      32\n      South & South-East Asia\n      avg change\n      -0.05\n      1.03\n    \n    \n      33\n      South & South-East Asia\n      Regional pop-weighted avg change\n      1.69\n      12.37\n    \n    \n      34\n      South & South-East Asia\n      Global pop weights\n      0.39\n      0.39\n    \n    \n      35\n      Sub-Saharan Africa\n      fall\n      12\n      12\n    \n    \n      36\n      Sub-Saharan Africa\n      stable\n      1\n      1\n    \n    \n      37\n      Sub-Saharan Africa\n      rise\n      6\n      6\n    \n    \n      38\n      Sub-Saharan Africa\n      n\n      19\n      19\n    \n    \n      39\n      Sub-Saharan Africa\n      avg change\n      -4.35\n      -3.95\n    \n    \n      40\n      Sub-Saharan Africa\n      Regional pop-weighted avg change\n      -3.69\n      -2.85\n    \n    \n      41\n      Sub-Saharan Africa\n      Global pop weights\n      0.10\n      0.10\n    \n    \n      42\n      Western Europe\n      fall\n      5\n      2\n    \n    \n      43\n      Western Europe\n      stable\n      0\n      2\n    \n    \n      44\n      Western Europe\n      rise\n      9\n      10\n    \n    \n      45\n      Western Europe\n      n\n      14\n      14\n    \n    \n      46\n      Western Europe\n      avg change\n      0.85\n      2.91\n    \n    \n      47\n      Western Europe\n      Regional pop-weighted avg change\n      0.74\n      2.48\n    \n    \n      48\n      Western Europe\n      Global pop weights\n      0.06\n      0.06\n    \n    \n      49\n      World\n      fall\n      31\n      25\n    \n    \n      50\n      World\n      stable\n      6\n      6\n    \n    \n      51\n      World\n      rise\n      34\n      40\n    \n    \n      52\n      World\n      n\n      71\n      71\n    \n    \n      53\n      World\n      avg change\n      -1.09\n      1.76\n    \n    \n      54\n      World\n      Regional pop-weighted avg change\n      1.13\n      8.60\n    \n    \n      55\n      World\n      Global pop weights\n      1.00\n      1.00"
  },
  {
    "objectID": "PhD_pages/data_appendices/1_F_within_country_trends.html#explore-the-data",
    "href": "PhD_pages/data_appendices/1_F_within_country_trends.html#explore-the-data",
    "title": "Appendix 1.F: Analysing global trends in within-country inequality",
    "section": "Explore the data",
    "text": "Explore the data\nI plan to build a Shiny app to help compare trends across datasets (using Shinylive – built on Shiny for Python - ).\nHere is a test app just so I can test the wiring of how such an app works.\n#| standalone: true\n#| viewerHeight: 1000\n\nfrom shiny import *\nfrom plotnine import *\nfrom pyodide.http import open_url\nimport pandas as pd\nimport numpy as np\nimport plotly.express as px\n\n\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 1: Data prep functions -------------\n#  ----------------------------------\n\n#  Function get matching for ref years\ndef closest_to_reference(df, reference_val, max_dist_from_ref, reference_col, group_by_col, value_col, tie_break):\n  \n  df = df.loc[:, [reference_col, group_by_col, value_col]]\n\n  # Drop NAs\n  df = df.dropna()\n\n  # Calculate absolute distance from reference value\n  df['ref_diff'] = abs(df[reference_col] - reference_val)\n\n  # Drop any rows with a distance beyond threshold\n  if not pd.isna(max_dist_from_ref):\n    df = df.loc[df['ref_diff'] <= max_dist_from_ref]\n\n  # Keep closest observation to reference value – including tie-breaks (where there is a match above and below the ref value)\n  df = df[df.groupby(group_by_col)['ref_diff'].transform('min') == df['ref_diff']].reset_index(drop=True)\n\n  # Settle tie-breaks\n  if tie_break == 'below':\n    df = df[df.groupby(group_by_col)[reference_col].transform('min') == df[reference_col]].reset_index(drop=True)\n    \n  elif tie_break == 'above':\n    df = df[df.groupby(group_by_col)[reference_col].transform('max') == df[reference_col]].reset_index(drop=True)\n\n  df = df.drop('ref_diff', axis=1)\n\n  df = df\\\n    .rename(columns={value_col: \"value\"})\n\n\n  return df\n\n\n\n\n# Merge matches for different reference points\ndef merge_two_ref_matches(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n# Make sure the pair of reference values are in ascending order\n  reference_vals.sort()\n\n# Maximise distance between two refs by settling tie-breaks below the lowest ref and above the highest ref \n\n# Find matches for lower reference value\n  lower_ref_matches = closest_to_reference(df, reference_vals[0], max_dist_from_refs, reference_col, group_by_col, value_col, 'below')\n\n# Find matches for higher reference value\n  higher_ref_matches = closest_to_reference(df, reference_vals[1], max_dist_from_refs, reference_col, group_by_col, value_col, 'above')\n\n# Merge the two sets of matches\n  merged_df = pd.merge(lower_ref_matches, higher_ref_matches, on=group_by_col, suffixes=(reference_vals[0], reference_vals[1]))\n\n# Drop obs that do not have data for both ref values\n  merged_df = merged_df.dropna()\n\n# Drop obs where the matched data does not meet the min distance requirement\n  if not pd.isna(min_dist_between):\n  \n  # Store the names of the reference column returned from the two matches\n    ref_var_high = f'{reference_col}{reference_vals[1]}'\n    ref_var_low = f'{reference_col}{reference_vals[0]}'\n\n  # Keep only rows >= to the min distance\n    merged_df = merged_df.loc[(merged_df[ref_var_high] - merged_df[ref_var_low]) >= min_dist_between, :]\n\n\n\n  return merged_df\n\n\n\n  # For PIP run this three times – first filtering data for just consumpion only, then with income only, then with a dataset that prefers income over consumption\ndef pip_welfare_routine(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n    # Specify the name of the column in which the income/consumption welfare definition is stored\n    welfare_colname = 'welfare_type'\n\n    # Creat dataframes for thee scenarios:\n    # Scenario 1: only allow income data\n    df_inc_filter = df.loc[df[welfare_colname] == \"income\", :]\n    df_inc_filter.name = \"Income\"\n\n    # Scenario 2: only allow consumption data\n    df_cons_filter = df.loc[df[welfare_colname] == \"consumption\", :]\n    df_cons_filter.name = \"Consumption\"\n    # Scenario 3: allow a mix – dropping consumption data where income data is available in the same year\n    df_mixed = df.copy()\n\n    df_mixed['welfare_count'] = df_mixed.groupby([reference_col, group_by_col])[welfare_colname].transform('count')\n\n    df_mixed = df_mixed.loc[(df_mixed['welfare_count'] == 1) | (df_mixed[welfare_colname] == \"income\")]\n\n    df_mixed.name = \"Mixed\"\n    #  Store the scneario dataframes in a list\n    df_scenarios = [df_inc_filter, df_cons_filter, df_mixed]\n\n    # Run the matching function on each scenario\n    scenario_matches = [merge_two_ref_matches(\n      df_scenario, \n      reference_vals, \n      max_dist_from_refs, \n      min_dist_between, \n      reference_col, \n      group_by_col, \n      value_col) for df_scenario in df_scenarios]\n    \n    # Combine the first two scenarios.\n    df_combined_matches = pd.concat([scenario_matches[0], scenario_matches[1]], keys=[df_scenarios[0].name, df_scenarios[1].name])\n\n    # Tidy up indexes\n    df_combined_matches = df_combined_matches.reset_index()\n    \n    df_combined_matches = df_combined_matches.drop('level_1', axis=1)\n\n    df_combined_matches = df_combined_matches\\\n      .rename(columns={\"level_0\": \"pip_welfare\"})\n\n    # Add in third scenario.\n    df_combined_matches = pd.concat([df_combined_matches, scenario_matches[2]])\n\n    # add scenario name to te pip_welfare column\n    df_combined_matches['pip_welfare'] = df_combined_matches['pip_welfare'].fillna(df_scenarios[2].name)\n\n    # Keep only one match per group (e.g. per Country) - in the priority laid out in the df_scenarios list above (income only -> consumption only -> mixed)\n      # First count the matches\n    df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n      # Then drop any matches from the lowest priority where there are multiple matches\n    df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[2].name)]\n      #  Repeat at the next level of priority\n    df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n    df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[1].name)]\n    \n    # Drop the match count column\n    df_combined_matches = df_combined_matches.drop('match_count', axis=1)\n\n\n    return df_combined_matches\n\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 2: Read in data -------------\n#  ----------------------------------\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/pip.csv'\n        \ndf_pip = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/wid.csv'\n\ndf_wid = pd.read_csv(open_url(url))\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/lis.csv'\n\ndf_lis = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/region_mapping.csv'\n\ndf_regions = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/population.csv'\n\ndf_pop = pd.read_csv(open_url(url))\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 3: Specifications -------------\n#  ----------------------------------\n\n# These parameters are not controlled in the app.\nreference_col = 'Year'\ngroup_by_col = 'Entity'\n\ntolerance = 1\noutlier_cut_off_upper = None\n\n\ndata = {\"PIP\": df_pip,\n        \"WID\": df_wid,\n        \"LIS\": df_lis}\n\n# make an empty list to add all the varnames\nall_vars = list()\n\n# A string to use to separate the source name from the var name\nsep = \": \"\n\n# for each df in 'data'\nfor k,v in data.items():\n  \n  # make a list of varnames\n  vars = list(v.columns)\n\n  # remove the id cols\n  vars.remove(reference_col)\n  vars.remove(group_by_col)\n\n  # append the name of the source (the key of 'data') at the front\n  vars = [f'{k}{sep}' + var for var in vars]\n\n  # append to the running list\n  all_vars = all_vars + vars\n\n\n\n\n\n\n\n\n\n#  ---------------------------------\n#  ---------- App code -------------\n#  ----------------------------------\n\ndef panel_box(*args, **kwargs):\n    return ui.div(\n        ui.div(*args, class_=\"card-body\"),\n        **kwargs,\n        class_=\"card mb-3\",\n    )\n\napp_ui = ui.page_fluid(\n    {\"class\": \"p-4\"},\n    ui.row(\n        ui.column(\n            4,\n            panel_box(\n                ui.input_slider(\"reference_vals\", \"Reference years\", 1975, 2020, value=[1990,2018]),\n                ui.input_numeric(\n                            \"max_dist_from_refs\",\n                            \"=/- (years)\",\n                            4,\n                        ),\n                ui.input_numeric(\n                            \"min_dist_between\",\n                            \"Min distance between observations (years)\",\n                            23,\n                        ),\n                ui.input_selectize(\n                  \"metrics\", \"Metrics\", all_vars, multiple=True\n                  ),\n                ui.input_checkbox(\"all_metrics_requirement\", \"Show only countries with data for all metrics\", True),\n                ui.input_action_button(\n                    \"download\", \"Download data and image\", class_=\"btn-primary w-100\"\n                ),\n            ),\n        ),\n        ui.column(\n            8,\n            ui.output_plot(\"example_plot\")\n            ),\n    ),\n)\n\n\ndef server(input, output, session):\n    @output\n    @render.plot\n    def example_plot():\n    \n\n\n\n      #  ---------------------------------\n      #  ---------- SECTION 4: Run data functions and produce plot -------------\n      #  ----------------------------------\n\n\n      def prep_and_merge_multiple_vars(data_to_match, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col):\n        \n\n        # Combine the source and varname strings element-wise to produce keys that will be used for the concat later\n        source_var_keys = [i + j for i, j in zip(data_to_match[\"sources\"], data_to_match[\"var_names\"])]\n\n        matches = []\n\n        for i in range(len(data_to_match['sources'])):\n          \n          source = data_to_match[\"sources\"][i]\n          var = data_to_match[\"var_names\"][i]\n\n          df = data[source]\n\n          if source == \"PIP\":\n\n            matched = pip_welfare_routine(\n                df = df,\n                reference_vals = reference_vals,\n                max_dist_from_refs = max_dist_from_refs,\n                min_dist_between = min_dist_between,\n                reference_col = reference_col,\n                group_by_col = group_by_col,\n                value_col = var\n              )\n\n          else:\n\n            matched = merge_two_ref_matches(\n                df = df,\n                reference_vals = reference_vals,\n                max_dist_from_refs = max_dist_from_refs,\n                min_dist_between = min_dist_between,\n                reference_col = reference_col,\n                group_by_col = group_by_col,\n                value_col = var\n              )\n\n          matches.append(matched)\n\n\n        ref_matches = pd.concat(matches, keys=source_var_keys)\n\n        # Tidy up indexes\n        ref_matches = ref_matches.reset_index()\n        \n        ref_matches = ref_matches.drop('level_1', axis=1)\n\n        ref_matches = ref_matches\\\n          .rename(columns={\"level_0\": \"source_var\"})\n\n        return ref_matches\n\n\n\n\n      def prep_plot_and_tables(\n        data_to_match,\n        reference_vals, \n        max_dist_from_refs,\n        min_dist_between,\n        reference_col,\n        group_by_col,\n        tolerance,\n        outlier_cut_off_upper,\n        all_metrics_requirement):\n\n        # Other spec:\n        region_col = 'region_alt'\n\n        # ---- Prep data ---------\n\n        plot_data = prep_and_merge_multiple_vars(\n          data_to_match = data_to_match,\n          reference_vals = reference_vals, \n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col\n        )\n\n        # Store the names of the columns to be used onthe X and Y axis\n        x_axis = f'value{reference_vals[0]}'\n        y_axis = f'value{reference_vals[1]}'\n\n        x_ref_val = f'{reference_col}{reference_vals[0]}'\n        y_ref_val = f'{reference_col}{reference_vals[1]}'\n\n\n        # Apply outlier cut off, if specified\n        if not pd.isna(outlier_cut_off_upper):\n          plot_data = plot_data.loc[plot_data[x_axis] <= outlier_cut_off_upper]\n          plot_data = plot_data.loc[plot_data[y_axis] <= outlier_cut_off_upper]\n\n\n        # Add a count by country – counting whether data is available from each source or not\n        plot_data['source_count'] = plot_data.groupby(group_by_col)['source_var'].transform('count')\n\n\n        # Apply metrics requirement (whether to include only observations with data from all metrics)\n        if all_metrics_requirement:\n          plot_data = plot_data.loc[plot_data['source_count'] == plot_data['source_count'].max()]\n\n        # Drop source_count column\n        plot_data = plot_data.drop('source_count', axis=1)\n\n        # Add in region classification\n        plot_data = pd.merge(plot_data, df_regions, how = 'left')\n\n        # Add in population data\n          # For first ref\n        df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[0], ['Entity', 'population'] ]\n\n        plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n        plot_data = plot_data.rename(columns={'population':'population_ref1'})\n\n          # For second ref\n        df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[1], ['Entity', 'population'] ]\n\n        plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n        plot_data = plot_data.rename(columns={'population':'population_ref2'})\n\n          # Calculate average population two reference periods\n        plot_data['avg_pop'] = (plot_data['population_ref1'] + plot_data['population_ref2'])/2\n\n\n\n        # ----- Prep plot ------\n\n        # I grab what I am guessing to be the max and min tick marks on the x axist, in order to define the coordinates of a 'tolerance' ribbon.\n        x_min = plot_data[x_axis].min()\n        x_min_floor = np.floor(x_min * 10) / 10\n\n        x_max = plot_data[x_axis].max()\n        x_max_ceiling = np.ceil(x_max * 10) / 10\n\n        # Set the coordinates of the shaded ribbon\n        shaded_coord = pd.DataFrame({'x': [x_min_floor, x_max_ceiling, x_max_ceiling, x_min_floor], \n          'y': [x_min_floor-tolerance, x_max_ceiling-tolerance, x_max_ceiling+tolerance , x_min_floor+tolerance]})\n\n\n        plot = (ggplot(plot_data\n        , aes(x_axis, y_axis, alpha=0.5))\n        + geom_point(aes(color=region_col, size='avg_pop', alpha = 0.6))\n        + facet_wrap('~ source_var')\n        + geom_polygon(aes(x='x', y='y', alpha = 0.2), data=shaded_coord)\n        + theme_light()\n        + theme(legend_position='none')\n        )\n\n\n\n \n        # ---- Prep summary table ----\n\n\n        # Calculate the change between the two ref periods\n        plot_data['change'] = (plot_data[y_axis] - plot_data[x_axis])\n\n\n        group_yes_vars = ['source_var', region_col]\n        group_no_vars = ['source_var']\n\n        group_scenarios = [group_no_vars, group_yes_vars] \n\n        aggs = []\n        \n        for group_vars in group_scenarios:\n        \n        # Prepare pop-weighted average change\n          agg_level = plot_data.copy()\n\n          # Calulate pop weights by source and region\n          agg_level['regional_pop_weights'] = agg_level.groupby(group_vars)['avg_pop'].transform(lambda x: x/x.sum()) \n\n          agg_level['global_pop_weights'] = agg_level.groupby('source_var')['avg_pop'].transform(lambda x: x/x.sum()) \n\n          # Multiply the change by the pop weights \n          agg_level['region_weighted_change'] = agg_level['change'] * agg_level['regional_pop_weights']\n\n\n        # Prepare fall/stable/rise categories\n          agg_level['fall'] = agg_level['change'] < -tolerance\n\n          agg_level['stable'] = (agg_level['change'] <= tolerance) & (agg_level['change'] >= -tolerance)\n\n          agg_level['rise'] = agg_level['change'] > tolerance\n\n          agg_level[['fall', 'stable', 'rise']] = agg_level[['fall', 'stable', 'rise']].astype(int)\n\n          agg_level = agg_level.groupby(group_vars)[['change', 'region_weighted_change', 'global_pop_weights', 'fall', 'stable', 'rise']]\\\n            .agg(['sum', 'mean', 'count'])\n\n        # Aggregate by source and region\n          if group_vars == group_yes_vars:\n\n            agg_level = agg_level\\\n              .unstack().T.reset_index()\n\n          elif group_vars == group_no_vars: \n\n            agg_level = agg_level\\\n              .T.reset_index()\n\n            agg_level[region_col] = \"World\"\n\n          aggs.append(agg_level) \n\n        \n        df_summary = pd.concat(aggs)\n\n          # filter for the aggregations we need and label in the 'summary' column\n        df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'mean'), 'summary'] = 'avg change'\n\n        df_summary.loc[(df_summary['level_0'] == 'region_weighted_change') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Regional pop-weighted avg change'\n\n        df_summary.loc[(df_summary['level_0'] == 'global_pop_weights') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Global pop weights'\n\n        df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'count'), 'summary'] = 'n'\n\n        df_summary.loc[(df_summary['level_0'] == 'fall') & (df_summary['level_1'] == 'sum'), 'summary'] = 'fall'\n\n        df_summary.loc[(df_summary['level_0'] == 'stable') & (df_summary['level_1'] == 'sum'), 'summary'] = 'stable'\n\n        df_summary.loc[(df_summary['level_0'] == 'rise') & (df_summary['level_1'] == 'sum'), 'summary'] = 'rise'\n\n        df_summary = df_summary[df_summary['summary'].notnull()]\n\n\n        df_summary = df_summary.drop(['level_0', 'level_1'], axis = 1)\n\n\n        df_summary['summary'] = pd.Categorical(df_summary['summary'], categories=['fall', 'stable', 'rise','n', 'avg change', 'Regional pop-weighted avg change', 'Global pop weights'], ordered=True)\n\n\n        df_summary = df_summary.sort_values([region_col,'summary']).set_index([region_col,'summary'])\n        \n        \n        # format to show appropriate d.p. I run a loop over each row for want of figuring out a better way!\n        repeat_length = 7\n        for i in range(0, len(df_summary.index.levels[0].unique())):\n          df_summary.iloc[i*repeat_length,:] = df_summary.iloc[i*repeat_length,:].map('{:.0f}'.format)\n          df_summary.iloc[1 + i*repeat_length,:] = df_summary.iloc[1 + i*repeat_length,:].map('{:.0f}'.format)\n          df_summary.iloc[2 + i*repeat_length,:] = df_summary.iloc[2 + i*repeat_length,:].map('{:.0f}'.format)\n          df_summary.iloc[3 + i*repeat_length,:] = df_summary.iloc[3 + i*repeat_length,:].map('{:.0f}'.format)\n          df_summary.iloc[4 + i*repeat_length,:] = df_summary.iloc[4 + i*repeat_length,:].map('{:.2f}'.format)\n          df_summary.iloc[5 + i*repeat_length,:] = df_summary.iloc[5 + i*repeat_length,:].map('{:.2f}'.format)\n          df_summary.iloc[6 + i*repeat_length,:] = df_summary.iloc[6 + i*repeat_length,:].map('{:.2f}'.format)\n\n\n\n        # ----- Return outputs ------\n        plot_and_tables = {\n          \"table_data\": plot_data,\n          \"plot\": plot,\n          \"summary\": df_summary\n        }\n        \n        return plot_and_tables\n\n\n      def prep_selected_vars(selected_vars):\n\n        # selected_vars = [\n        #   'LIS: Top_10_share_equiv_market',\n        #   'WID: Bottom_50_share_posttax_dis',\n        #   'PIP: Top_10_share']\n\n        selected_sources = [var.split(sep, 1)[0] for var in selected_vars]\n        selected_var_names = [var.split(sep, 1)[1] for var in selected_vars]\n\n\n        match_data = {\n          \"sources\": selected_sources,\n          \"var_names\": selected_var_names\n          }\n\n\n        return match_data\n\n\n\n      data_to_match = prep_selected_vars(input.metrics())\n\n\n      plot_and_tables = prep_plot_and_tables(\n        data_to_match = data_to_match,\n        reference_vals = list(input.reference_vals()), \n        max_dist_from_refs = input.max_dist_from_refs(),\n        min_dist_between = input.min_dist_between(),\n        reference_col = reference_col,\n        group_by_col = group_by_col,\n        tolerance = tolerance,\n        outlier_cut_off_upper = outlier_cut_off_upper,\n        all_metrics_requirement = input.all_metrics_requirement()\n        )\n        \n\n      plot = plot_and_tables['plot']\n\n      return plot\n\n\napp = App(app_ui, server)"
  },
  {
    "objectID": "PhD_pages/scripts/PIP/prepare_pip_percentiles.html",
    "href": "PhD_pages/scripts/PIP/prepare_pip_percentiles.html",
    "title": "Test: prep pip percentiles",
    "section": "",
    "text": "library(tidyverse)\n\nsource('PhD_pages/scripts/functions.r')\n\n\n#These variables uniquely id a set of survey results\npip_id_vars<- c('Entity', 'Year', 'reporting_level', 'welfare_type')\n\n\npip_perc_orig<- read.csv(\"PhD_pages/data/original/pip_percentiles.csv\")\n\n\npip_main_vars_orig<- read.csv(\"PhD_pages/data/original/pip_main_vars.csv\")\n\n\nPrep ‘percentiles’ data file\n\npip_perc<- pip_perc_orig\n\n\n# Drop duplicate observations of 'headcount' - The PIP API returns the . Given the discrete nature of the survey data, it sometimes returns a headcount ratio that are fairly far from the target percentile queried and the same headcount ratio can be returned for multiple percentile queries. Here we keep only one.\n\npip_perc<- drop_dupes(pip_perc,\n                       id_vars = pip_id_vars,\n                        duplicate_data_var = 'headcount')\n\n\n# Browse for nonmonotonic rows\n# browse_nonmonotonic<- monotonicity_check(\n#   df = pip_perc, \n#   id_vars = pip_id_vars,\n#   order_var = 'headcount',\n#   data_var = 'percentile_value', \n#   action = 'browse')\n\n#There seems to be an issue with China in 1993,  driven by rural China.\n# br<- pip_perc %>%\n#   filter(Entity == \"China\",\n#          reporting_level == 'national',\n#          Year == 1993)\n\n# Let's drop these rows\npip_perc<- monotonicity_check(\n  df = pip_perc, \n  id_vars = pip_id_vars,\n  order_var = 'headcount',\n  data_var = 'percentile_value', \n  action = 'drop')\n\n\n#Drop world regions from percentile data\n\n# These are entities with no reporting level - as veried below\n# pip_perc %>%\n#   filter(reporting_level==\"\") %>% \n#   select(Entity) %>%\n#   unique() %>%\n#   print()\n\npip_perc<- pip_perc %>%\n    filter(reporting_level!=\"\") \n\n\n\nPrep ‘main vars’ data file\n\npip_main_vars<- pip_main_vars_orig %>%\n  rename(Entity = country_name,\n         Year = reporting_year) %>%\n  select(Entity, Year, reporting_level, welfare_type, mean, reporting_pop, reporting_gdp, gini, mld)\n\n\n\nMerge the percentile and main data files\n\npip_perc<- left_join(pip_perc, pip_main_vars)\n\n\n\nAdditional cleaning\n\n#Keep only 'National' estimates, except for country-years that don't have national estimates.\n\n# Count how many reporting levels there are for each estimate\ncount_reporting_levels<- pip_main_vars %>%\n  select(Entity, Year, reporting_level) %>%\n  unique() %>%\n  count(Entity, Year) %>%\n  rename(number_of_reporting_levels = n)\n\n# We see there only 1 and 3 reporting levels - i.e. either national, rural or uban alone, or else all three are present.\ncount_reporting_levels %>% select(number_of_reporting_levels) %>% unique()\n\n# Merge the counts back into dataframe\npip_main_vars<- left_join(pip_main_vars, count_reporting_levels)\n\n# Filter to see if there are any cases where only non-national estimates are available\npip_main_vars %>%\nfilter(number_of_reporting_levels<3 & reporting_level!='national') %>%\nselect(Entity) %>%\nunique()\n\n# Keep only national estimates except for these cases\n\npip_main_vars<- pip_main_vars %>%\nfilter(reporting_level=='national' | number_of_reporting_levels<3)\n\n# Check again if there is more than one reporting level\npip_main_vars %>%\n  select(Entity, Year, reporting_level) %>%\n  unique() %>%\n  count(Entity, Year) %>%\n  rename(number_of_reporting_levels = n) %>%\n    filter(number_of_reporting_levels>1)\n\n\n\nPrepare reference year data\n\n# I'll prepare the observations from the main_vars file, and then merge in the percentiles\n\n# target_years<- c(1990, 2000, 2010, 2018)\n# \n# df_pip_ref_years<- keep_closest(\n#   df= pip_main_vars,\n#   id_vars = c(\"Entity\", \"reporting_level\"),\n#   distance_varname = \"Year\",\n#   targets = target_years,\n#   tie_break_dist_up_or_down = \"up\",\n#   tie_break_varname = \"welfare_type\",\n#   tie_break_value = \"income\")\n# \n# # We see that if we impose that a max distance, country coverage falls.\n# df_count<- df_pip_ref_years %>%\n#   count(Entity)\n# \n# df_pip_ref_years_filter<- df_pip_ref_years %>%\n#   filter(abs_distance<3)\n# \n# df_count<- df_pip_ref_years_filter %>%\n#   count(Entity)"
  },
  {
    "objectID": "PhD_pages/scripts/PIP/get_main_pip_vars.html",
    "href": "PhD_pages/scripts/PIP/get_main_pip_vars.html",
    "title": "Joe Hasell",
    "section": "",
    "text": "# Build query\n# request_url<- paste0( 'https://api.worldbank.org/pip/v1/pip?',\n#       'country=all',\n#       '&year=', \"all\",\n#       '&povline=', \"2.15\",\n#       'version=20220909_2017_01_02_PROD',\n#       '&fill_gaps=false',\n#       '&welfare_type=all',\n#       '&reporting_level=all',\n#       '&format=csv')\n\n# pip_main_vars_orig<- read.csv(request_url)\n\n\n# write.csv(pip_main_vars_orig, \"PhD_pages/data/original/pip_main_vars.csv\", row.names = FALSE)"
  },
  {
    "objectID": "PhD_pages/scripts/PIP/get_pip_percentiles.html",
    "href": "PhD_pages/scripts/PIP/get_pip_percentiles.html",
    "title": "Joe Hasell",
    "section": "",
    "text": "We have produced a set of percentiles in the pipeline for getting PIP data into OWID.\nHere we take the file from GitHub.\n\n# pip_perc_orig<- read.csv('https://raw.githubusercontent.com/owid/notebooks/main/BetterDataDocs/JoeHasell/PIP/data/ppp_2017/raw/percentiles.csv')\n\n\n# write.csv(pip_perc_orig, \"PhD_pages/data/pip_percentiles.csv.csv\", row.names = FALSE)"
  },
  {
    "objectID": "PhD_pages/paper_pages/overview.html",
    "href": "PhD_pages/paper_pages/overview.html",
    "title": "Overview of papers",
    "section": "",
    "text": "Thanks to the efforts of a number of key teams involved in the production of harmonized inequality datasets, we are in a far better position than ever to describe and monitor trends in income inequality across the world as a whole. Recent years have seen considerable improvements, either in terms of spatial or temporal coverage of these datasets, the degree of comparability achieved across data points, or both.\nHowever, the key takeaways of this substantial body of empirical work remain surprisingly, and unhelpfully fractured.\nFor example, available inequality estimates based on Distributional National Accounts - as collated and summarise by the World Inequality Lab - depict a near universal rise inequality in recent decades.\n\nIncome and wealth inequalities have been on the rise nearly everywhere since the 1980s, following a series of deregulation and liberalization programs which took different forms in different countries. (Chancel et al. 2021)\n\nIn stark contrast, national survey data collected and harmonized by the World Bank show a far more mixed picture, with overall a decline in average inequality more recently.\n\nWithin-country inequality as a whole—that is, considering together the trends of all countries on which evidence is available—[…] started to narrow in the last decade, after peaking in the 1990s. (Poverty and Shared Prosperity 2016: Taking on Inequality 2016)\n\nAlongside these differing views of within-country inequality around the world are starkly contrasting views concerning the locus of global inequality: with inverse findings concerning the respective contributions made by within- and between country inequalities. Lakner and Milanovic (2016)\nDespite the far richer, wider range of distributional data at our disposal, basic questions concerning the nature and direction of inequality around the world remain, effectively, unanswered.\nOne explanation for this disconnect - between the greatly improved data and the ambiguous understanding of inequality globally that this has yielded - lies in extent to which the available data has emerged from the efforts of different networks of researchers, coalescing around different institutions, most notably the World Bank, the World Inequality Lab and the Luxembourg Income Study. These approaches to the measurement of inequality around the world are separated by a range of methodological differences woven together, somewhat as a package. Related to choice of methods, the approaches are also separated by different emphasis on hypotheses regarding the nature of inequality and its drivers - in particular the role played by factor shares in driving income inequality, particularly at the top. They are also separated technologically - presented on different platforms each with fairly high start-up costs required for proficient use.\nA causal observer would be forgiven for thinking that the different efforts occupy almost different ‘worlds’ of inequality research, where it is difficult to compare results, to understand where approaches agree, where they differ and why. Since the answers arrived at within each ‘world’ of inequality measurement can be strikingly different, very basic questions concerning inequality across the world remain, in effect, unanswered.\nIn the public and policy debate, this leads very different narratives that tends to focus, on the one hand, on a runaway global elite - ‘the 1%’ - or on the other hand on ‘convergence’ and ‘shared prosperity’. Within these different narratives sit divergent views concerning a variety of important and urgent questions: the outcomes, merits and demerits of global economic development and globalisation; and the scope and proper role of international development aid, philanthropy, and taxation - at national and international levels - to shape a fairer, more equal world.\nWhich of these ‘worlds’ of inequality we live in matters a great deal - but the way the data supporting these two views of the world has been presented and compared to date leaves us to a large extent in the dark as to which world we actually live in. By not ‘speaking to each other’, the value to society of the enormous efforts collectively made by hundreds of researchers and statisticians around the world in the production of these datasets is greatly diminished.\n\nDistinct methods\n[Breakdown the bundled methods: top incomes approach vs ‘conventional’ approaches]\n\nThe data sources relied upon:\n\nThe use of administrative tax data, national accounts aggregates, or rich lists in place of, or in addition to, household survey data\n\nThe conception of inequality adopted:\n\nThe approach has an emphasis on the share of income captured by the rich, in contrast to measures of overall inequality such as the Gini coefficient;\n\nThe welfare concept typically measured:\n\nFiscal income, or more recently pre-tax national income as defined within the DINA methodology. This contrasts with household disposable income (Canberra Group 2011, chapter 2) or consumption.\nInitially at least, these methodological choices by necessity came somewhat bundled together. The choice to use tax data imposed both restrictions on the income concept (taxable income) and a focus on the top (given the profile of tax filers). Conversely, concerns surrounding the ability of survey data to reliably capture top incomes has always been a main motivation for turning to tax data, less affected by issues of undersampling, underreporting or nonresponse.\nMethodological innovations within the top incomes literature, including the production of Distributional National Accounts (Alvaredo et al. 2016), have to some extent relaxed this constraint that the data source, conception of inequality and welfare concept must come as a package. Within DINA, survey data, national accounting aggregates, and administrative data are combined to produce ‘synthetic microfiles’ that can be used to model the whole distribution for a range of welfare concepts.\nNonetheless a primary focus on top income shares of pre-tax income continues to be a defining feature of research efforts in this space, marking it out from conventional approaches focussing on disposable income or consumption, often measured with Gini coefficient.\n\n\nDistinct views of inequality and its drivers\nThis distinction between in terms of methods is reflected different hypothesis concerning the empirical reality of inequality around the world, one concerning the drivers of these trends.\n\n1) Accounting for ‘missing’ top incomes, inequality within countries around the world is higher and has risen faster than we thought\nMuch of the ‘action’ in the income distribution in recent decades has been towards a greater concentration at the top. This is a phenomenon that standard approaches to inequality measurement – based on survey data and often using the Gini coefficient as the main summary measure – are ill-equipped to monitor.\nCompared to World Bank assessment – Inequality falling in a majority of countries.\n\n\n2) Inequality within countries are considerably greater than inequalities between countries\nBecause within-country inequality is much higher than suggested by survey data, so too is its contribution to global inequality. Working with DINA estimates from the World Inequality Database, Chancel and Piketty (2021) disaggregate global income inequality into between- and within-country components. They find that the majority of global inequality relates to within-country income differences, inverting the results of previous studies anchored more closely to household survey data (Lakner and Milanovic 2016; van Zanden et al. 2014; Bourguignon and Morrisson 2002).\n\n\n3) The accumulation and concentration of wealth is a key driver of these trends, and an inherent feature of capitalism\nA key theme in the top incomes literature – brought to wider prominence by Piketty’s Capital in the 21st Century (Piketty 2014) – is that the rise in inequality in recent decades to a large extent reflects ‘fundamental dynamics of capitalism’. The framework set out in Piketty (2014) connects the rise in inequality to rising wealth-to-income ratios. This trend is interpreted within a standard neoclassical aggregate growth model, whereby the stock of capital is growing faster than total income towards a high steady-state capital-to-income ratio. This increases the share of total income received by owners of that capital, which is in turn a key driver of rising inequality, since the vast majority of capital is owned by those earning top incomes. The return to factor incomes as a , stands in contrast with conventional frameworks – the returns to education, skills premia, labour market interventions, or the progressivity of tax and benefit regime.\nThis is a simplifification – Obviously many people thinking about top incomes in terms of adjustment of survey data. We can think of these as ‘stylized hypotheses’ s: the themes that connect and delineate a given literature and have driven much of the development of its methods – even if the boundaries are fuzzy.\nBut taken together ends up in two distinct views of the world:\n\nAn ‘orthodox’ view of the world where inequalities within countries are mainly a story of taxes and benefits, skills and wages; where trends in within country inequality – at least over the period where a global view is possible (roughly 1990 onwards) are very mixed – reflecting the importance and scope for national policy.; and where global inequalities reflect productivies;\nAnd a ‘radical’ view of the world in which the locus of global inequality is ‘the 1%’ – a global elite, driven by wealth accumulation, somewhat inevitable without radical rethink of policy implemented at the global level.\n\n\n\n\nDistinct platforms\n[I’m not sure whether to include this, but it seems to me that the root of many of these problems is essentially technological: the infrastructure and practices we have to compare and ‘switch’ between different methodological choices in our analysis of global inequality is very poor. Whilst the code behind the production of inequality estimates is become more available, in practice the barriers to this kind of joined-up analysis remain prohibitively high.]\n\n\nConnecting up the worlds of inequality research\nThe goal of the DPhil is to connect up these worlds. It does so in two ways.\nFirstly on the empirical side. Can we triangulate a clearer view of the world by bringing the methods from both ‘worlds’. This is the subject of the first two papers:\nPaper 1: With country inequality\nPaper 2: Global inequality\nSecondly, by addressing the causal hypothesis driving – namely factor shares and wealth accumulation are driving the trends in income inequality. This is the subject of the second two papers:\nPaper 3: Housing and factor shares\nPaper 4: Explaining the poor correlation between wealth and income inequality.\n\n\n\n\n\nReferences\n\nBourguignon, François, and Christian Morrisson. 2002. “Inequality Among World Citizens: 1820-1992.” Am. Econ. Rev. 92 (4): 727744.\n\n\nChancel, Lucas, Thomas Piketty, Emmanuel Saez, and Gabriel Zucman. 2021. “World Inequality Report 2022.”\n\n\nLakner, Christoph, and Branko Milanovic. 2016. “Global Income Distribution: From the Fall of the Berlin Wall to the Great Recession.” World Bank Econ. Rev. 30 (2): 203232.\n\n\nPoverty and Shared Prosperity 2016: Taking on Inequality. 2016. Poverty and Shared Prosperity. The World Bank. https://doi.org/10.1596/978-1-4648-0958-3."
  },
  {
    "objectID": "PhD_pages/paper_pages/paper1.html",
    "href": "PhD_pages/paper_pages/paper1.html",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "",
    "text": "Load packages\n\n\n\n\n\n\nlibrary(tidyverse)\n\nWarning: package 'tidyverse' was built under R version 4.1.2\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──✔ ggplot2 3.3.5      ✔ purrr   0.3.4 \n✔ tibble  3.1.6      ✔ dplyr   1.0.10\n✔ tidyr   1.2.0      ✔ stringr 1.4.0 \n✔ readr   2.1.2      ✔ forcats 0.5.1 \n\n\nWarning: package 'tidyr' was built under R version 4.1.2\n\n\nWarning: package 'readr' was built under R version 4.1.2\n\n\nWarning: package 'dplyr' was built under R version 4.1.2\n\n\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nlibrary(knitr)\nlibrary(data.table)\n\n\nAttaching package: 'data.table'\n\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n\nThe following object is masked from 'package:purrr':\n\n    transpose\nWhat has happened to inequality within countries over the past generation?"
  },
  {
    "objectID": "PhD_pages/paper_pages/paper1.html#data-sources",
    "href": "PhD_pages/paper_pages/paper1.html#data-sources",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "Data sources",
    "text": "Data sources\n\nPIP\n\n\nWID\n\n\nLIS\n\n\nCoverage\nGive an overview of coverage in each dataset."
  },
  {
    "objectID": "PhD_pages/paper_pages/paper1.html#comparing-databases",
    "href": "PhD_pages/paper_pages/paper1.html#comparing-databases",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "Comparing databases",
    "text": "Comparing databases\n\nComparing metrics\nDoes it make a difference whether we look at Gini or top 10%?\nPeople worry about whether Gini masks what’s happening at the top.\nEmpirically: - Make a linear model of top 10% on Gini, for each source separately - Make predicted top 10% - Take a look at the R2 - Investigate individual countries with very poor predictions\nSub-Saharan Africa: example where the Gini fell in more cases than the top 10%.\n\n\nSince 1990\nSimilarities:\nConvergence – Smaller rises in coutries that started out with high inequality. Driven regionally. (We could do a test for this.)\nIndeed for some regions very similar picture:\n- MENA - Roughly 2 point fall, both Gini and top 10%. Only one country with a rise: Not total agreeement on coverage (one country either side)\n\n- South and South East Asia – Very similar not weighting by population. But wildly different when weighting by population, due to the much much stronger rise\n\n-  Sub-Saharan Afric – Very similar across sources. Top 10: Roughly even mix of rises and falling countries, but with a 3 point fall on average. Gini: More falls, 5 point on average. (Mention data quality issues: e.g. Kenya big fall. Lesoto big fall. But how comparable are the surveys?? Same surveys underlie WID...)\n\n- Western Europe – Rises in a majority of countries, but relatively moderate of 1-2 points (Whether Gini of top 10).\nDifferences:\nVerry different bottom line at the global level:\n\nPIP: roughly equal numbers falling and rising. 0 average change – though a modest rise when pop weighted (2 points). Same whether Gini or Top 10. That’s without LAtin America (Which WID is missing). Includung LatAm tips nudges it (with about a 1 point fall unweighter and 1 point rise weighted)\nWID: Far more countries with rising inequality. On average a 3 point rise (whether top 10 or Gini) – [Better to express these relative to the level of ineq. i.e. % increase rather than % point increase? A point rise means ‘less’ in WID terms because inequality levels are much higher.] But the most stark difference comes when we weight by population. Some key populous countries: India, China, US?, Indonesia? Russia"
  },
  {
    "objectID": "PhD_pages/paper_pages/paper1.html#that-difference-is-driven-by-particular-regions",
    "href": "PhD_pages/paper_pages/paper1.html#that-difference-is-driven-by-particular-regions",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "That difference is driven by particular regions:",
    "text": "That difference is driven by particular regions:\nMore countries with rises. LArger rises. Especially larger populations. Average view very different:\nCountries where the sources paint a radically different picture that affect the aggregate results:\n\nIndia: Insane rise in WID 34->56\nChina:\nRussia: Massive drop in PIP. Insane rise in WID.\nUSA: Much larger rise in WID.\n\nWhat explains the different trends in these countries? (We can maybe look in more detail, at different welfare concepts etc.)\nIt sometimes goes the other way: Indonesia – Rise in PIP, fall in WID.\n:::\n\nMethod 2: Use a regression to obtain the time trend\n\n\nResults for a range of inequality metrics\n::: {.callout-note collapse=“true” appearance=“minimal”} ## Calculations for comparisons"
  },
  {
    "objectID": "PhD_pages/paper_pages/paper1.html#explaining-differences-between-pip-and-wid-data",
    "href": "PhD_pages/paper_pages/paper1.html#explaining-differences-between-pip-and-wid-data",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "Explaining differences between PIP and WID data",
    "text": "Explaining differences between PIP and WID data\n\nFor a subset of countries we can bridge between the PIP and WID data\nBesides the underlying data sources, there are many differences between what is being measured in the PIP and WID data - notably the welfare concept and unit of analysis/equivalization.\nIn order to get a better understanding of where differences between the datasets arise, for a subset of countries we can bridge between the two somewhat. For example:\n\nWID has post-tax income series for some countries\nWe can use LIS to look at how changing the welfare concept, unit of analysis, equivalisation affects things. (For equivalisation, we could also possibly use the newly available PIP harmonized microdata).\n\n\n\nMore in-depth discussion of particular outliers\n\nRussia is a very notable case where the two datasets tell very different stories."
  },
  {
    "objectID": "PhD_pages/paper_pages/paper3.html",
    "href": "PhD_pages/paper_pages/paper3.html",
    "title": "Paper 3: Housing and the capital share of income",
    "section": "",
    "text": "A substantial literature has documented a long-run shift in the distribution of national income between wages and returns to capital.\nMuch of the interest in this empirical trend owes to its lying at the junction of two prominent topics within the social sciences: 1) the decline of labour bargaining power, and 2) the rise in income inequality.\n(Explain (1) and connection to (2)).\nThe hypothesis underpins much of the motivation for the Top incomes approach."
  },
  {
    "objectID": "PhD_pages/paper_pages/paper3.html#data",
    "href": "PhD_pages/paper_pages/paper3.html#data",
    "title": "Paper 3: Housing and the capital share of income",
    "section": "Data",
    "text": "Data\n\nBackground on the structure of national accounts\n\n\nApproaches to calculating factor shares\n\n\nAvailable sources"
  },
  {
    "objectID": "PhD_pages/paper_pages/paper3.html#the-housing-share-of-income",
    "href": "PhD_pages/paper_pages/paper3.html#the-housing-share-of-income",
    "title": "Paper 3: Housing and the capital share of income",
    "section": "The housing share of income",
    "text": "The housing share of income\nThe unusual nature of housing … in the national accounts.\nAs a stock, housing is a non-financial asset included in the balance sheet. Housing also features as a flow, included in each of the three approaches to calculating GDP: output, income and expenditure.\nAs output, housing services are included in Real Estate activity (SIC….). Sub Sector.\nThis flow of housing services generates a stream of income, which, in addition to small amounts of labour income (property management, agents’ fees), is the yield received by owners of housing assets.1 This private or public rented sector , and owner occupied, to which an equivalent rent is imputed. includes rent imputed to owner occupiers, as well as actual rents received by private landlords, whether individuals or corporations (both privately and publicly owned).\nThis income as an expenditure by households, again both actual and imputed rents ‘paid’.\nIn line with national accounting principles, the value of the flow of housing is equal, whether conceived of as a stream of services, income, or expenditure. As such, these offer different entry points from which aggregate housing income can be calculated and isolated from non-housing capital income.\nFigure 1 shows these housing flows as a share of total income.\nIn each case the denoninator is gross domestic value added, valued at factor cost. This aggregate is similar to GDP, with the exception that taxes and subsidies on production are excluded. This results in an aggregate that capital and labour components: gross operating surplus and compensation of employees.\n\nCapital income of the real estate industry\n(Give brief description)\nHousehold final consumption of rent\n(Give brief description)\nGross operating surplus of the household sector\n(Give brief description)\n\n\n\n\nTrends in the housing share\nComparing the housing share series plotted in Figure 1, we see the figures for the industry approach are quite consistent across the two data sources: the early vintage KLEMS data (red line) and OECD data (green line). The series adopting the second approach of final household consumption of rent (blue line) also tracks both these series closely.\nAs expected, the third approach of gross operating surplus in the household sector (purple line) is generally an outlier. How far this series falls from the others varies considerably across countries, reflecting the varying accounting conventions and tenure structures just discussed.\nA notable exception to the above characterisation is the UK, in which the more recent data from the OECD (beginning in 1995) for all three approaches falls substantially above the share calculated from the earlier KLEMS industry data. The reason for this large discrepancy is not entirely clear, but may relate to recent revisions to ONS practices for calculating imputed rent. (FIND REFERENCE).\nBefore turning to summary statistics, an inspection of Figure 1shows that there have been substantial rises in a majority of the twenty countries. Many countries – including France, Germany, Italy and Spain – have seen an increase in the housing share roughly five percentage points across five decades, or one point per decade. To give a sense of scale, it serves to compare this with the changes in the factor distribution found in the existing literature. Karabarbounis and Neiman (2014) find a 1.3 points-per-decade fall in the overall ‘global’ labour share between 1975 and 2012; Rodriguez and Jayadev (2010) find xxxx, and Piketty finds xxxx across X countries.\nA number of countries, however have seen only modest rises or none at all – Ireland, Norway and Sweden all falling in the latter group. It is only in Portugal that we see a substantial fall over the period, (Presumably the revolution/nationalizations? But a) why would this affect the housing share so much, b) the fall seems to begin in 1977 – some time after the revolution an economic downturn).\nTo facilitate comparisons I construct a single housing share series for each country. For most countries, the series is centred around the OECD industry-level data which is then extended back using the KLEMS industry-level data where available for earlier years. In the case of Canada, United States and Spain, for which recent OECD industry data is not available, the rent consumption share is used. Earlier and later series are linked on a proportionate basis: the earlier data is adjusted by the ratio of the two series for the earliest overlapping year.\n(The series based on gross operating surplus in the household sector (approach 3) are excluded entirely due to the comparability issues discussed. For each individual country the available series are ‘averaged’ by plotting the year fixed effects from a linear regression across all series, normalised so as to coincide with the earliest series. See Appendix X for details and regression results.)\nFigure 2 plots the ‘average’ of the resulting housing share series across all twenty countries. This represents the year fixed effects from a linear regression of the synthetic housing share on country and year dummies, normalised so as to coincide with the mean across all earliest series. This is used in order to account for entry and exit of countries from the sample.\nOn average x point rise."
  },
  {
    "objectID": "PhD_pages/paper_pages/paper3.html#housing-and-non-housing-capital-shares",
    "href": "PhD_pages/paper_pages/paper3.html#housing-and-non-housing-capital-shares",
    "title": "Paper 3: Housing and the capital share of income",
    "section": "Housing and non-housing capital shares",
    "text": "Housing and non-housing capital shares\nTo see how this increase in housing income has contributed to changes in the overall functional distribution, Figure 1 shows the capital share of income across 18 high income countries from roughly 2017 separating out housing (dotted lines) from non-housing (solid lines) capital income. The data exclude net taxes on production, such that capital and labour income sum to 100% of value added (i.e. at factor cost). On this basis, a rise in the capital share of 1 point implies a fall in the labour share of 1 point. \nIn order to increase coverage, trends are shown from three sources as follows.\n\n\n\n1) EU-KLEMS – industry-level data\nThe EU-KLEMS database collates industry-level data for most European countries as well some larger OECD countries. This includes industry figures for value added, compensation of employees and gross operating surplus (the residual balance after subtracting employee compensation from value added). In addition, labour income attributable to the activity of the self-employed is imputed and separated out from gross operating surplus, resulting in a ‘capital’ and ‘labour’ income series for each industry which together sum to total value added. The imputation is made using employment data, based on the assumption that the hourly compensation of the employed and self-employed is equal on average within each industry.\nIn the series presented below, we use the capital income reported within the real estate industry as a proxy for housing capital income. Since activities other than housing services are included in this industry (such as the rent of offices, or activity involved in the sale or marketing of property) this leads to an overestimate of the housing capital share per se.\nComparison with national accounts data on households’ consumption expenditure on rent (both actual and imputed) shows that in many countries the real estate industry has grown somewhat faster than housing services (Appendix X). Arguably, it makes sense to include these additional activities along with housing since their growth is likely to derive in part from the same underlying force – namely, rising demand for urban space against an inelastic supply. As shown in Appendix X however, where the boundary of ‘housing’ is drawn – whether the real estate industry as a whole or only including dwellings – does not substantively affect the resulting trends in the housing and non-housing capital shares in any case. \nCountry and year coverage varies across different vintages of the EU-KLEMS data, in part due to changes in industry classification over time. In order to maximise coverage in earlier years, I rely on the 2009 release from which long-run series, generally running from 1970 to 2007, can be obtained for 18 high income countries.\n\n\n2) OECD – industry-level data\nThe OECD also provide national accounts data at the industry-level similar to the EU-KLEMS data used, though based on a more recent industry classification. Country coverage is wider, and observations generally run up to 2017 or later, but in most cases only begin from around 1995.\nIn the series presented below, capital and labour components of value added (at factor cost) are obtained following the same imputation method for self-employment activity as used in the EU-KLEMS dataset, based on industry employment data also from the OECD (see Appendix X for further discussion).\n\n\n\n\n3) OECD – institutional sector data\nA third series is based on national accounts data broken down by institutional sector (corporations, households, government and non-profit institutions serving households) rather than by industry.\nThis is added in order to further increase coverage, and to connect with the existing factor shares literature which commonly relies on this approach (see for instance Piketty and Zucman (2014), Karabarbounis and Neiman (2014) and Rognlie (2016)). However, it suffers from two important drawbacks.\nFirstly, the question of how to treat the mixed income arising from self-employment activity is particularly problematic in the context of sector-level data. In the series presented below, I adopt a commonly used approach whereby mixed income – reported as a separate line in the household sector accounts – is split into capital and labour components based on the assumption that the respective shares are equal to those observed in the corporate sector. In addition to the uncertainty surrounding this assumption, however, Pionnier and Guidetti (2015) point to a significant limitation of this approach on account of the varying treatment of unincorporated enterprises across countries. In some countries, substantial self-employment activity may be recorded fully as corporate gross operating surplus, due to the inclusion of some unincorporated enterprises within the corporate sector as quasi-corporations. In the case of Italy and Germany they demonstrate that failing to account for the labour income implicit within such activity biases the labour share downward substantially, and also affect trends as the composition of employment changes over time.\nSecondly, sector-level data also presents difficulties when seeking to isolate the capital income relating specifically to housing. Previous studies have tended to take the gross operating surplus of the household sector as the relevant measure (Piketty and Zucman 2014; Rognlie 2016). According to national accounting conventions, this is where the imputed rent attributable to owner-occupied housing is recorded, which for most countries represents the large majority of dwellings.\nThere are two issues with this approach however. Firstly, whilst the corporate sector involvement in the housing market is often small, it is by no means insignificant in all cases. In addition to houses and apartments owned in the for-profit sector, this includes social housing operated by public or non-profit corporations. The latter comprises, for instance, 18% of the UK housing stock in recent years – down from roughly 30% through the 1970s.\nSecondly, there appears to be inconsistency across national accounting practices with respect to private rentals on the part of unincorporated individuals, which often represent the bulk of the private rented sector. In some countries this is recorded as household gross operating surplus, but in others it is included as mixed income (see Appendix X for further discussion). Consistent with these two observations, household gross operating surplus is often substantially lower than two other more comprehensive measures of housing income available in the national accounts (see Figure A.1).\nFor this reason, in the series below we use households’ final consumption expenditure on rent (both actual and imputed) in order to separate out housing from non-housing capital income within the sector data. These data exclude any costs relating to maintenance, services or utilities, but are, nevertheless, probably a slight overestimate of housing capital income since they may include some labour income (such as the management activity of landlords) and production taxes (since it is measured at market prices).\nGiven these problems relating to the institutional sector data, this third series is generally not included in the calculation of average trends (section X below). The exceptions are the US and Spain, which lack OECD industry-level data for recent years and are not affected by the aforementioned issue relating to quasi-corporations.\n\n\n\n\nCountry trends in the housing and non-housing capital share\nThe three series are plotted in Figure 1. (Further discussion)\nTable 1 indicates the average annual points change observed in each series, multiplied by 10. As a rough indicator of the centrality of housing to changes in the overall housing share, positive changes in the housing capital share greater than the corresponding change seen in the non-housing capital share are highlighted in red (including where the non-housing capital share fell). We see that in the earlier KLEMS data, the majority of countries saw rises in the housing capital share greater than those in the non-housing capital share. In the two later OECD series we see a more even split between countries with rising and falling housing shares. (Further discussion).\n\n\n\nAverage trends\nTo consider average trends, the various series are clustered into an ‘early’ grouping and a ‘later’ grouping. The early grouping is made up of observations from 1970 to 2007 which for almost all countries is taken from the KLEMS industry data. The later grouping is made up of observations from 1995 onwards which for almost all countries is taken from the OECD industry data. The exceptions are Denmark and Norway for which a complete series in the OECD industry data is available. In these cases the OECD data is used twice over, for both the ‘early’ and ‘late’ groupings. For Japan, only the KLEMS industry data is available, and again this is included in both the late and early groupings. In the case of the United States and Spain, for which no OECD industry-level data is available, observations for the later grouping are taken from the sector accounts and housing rent consumption data (see discussion in Section X).\n‘Average’ housing and non-housing capital shares are then obtained within each respective grouping by taking the year fixed effects from a linear model controlling for country fixed effects to account for the (few instances of) entry or exit from the sample. These are then normalised such that the value in the initial year corresponds to the mean across countries for that year. These average series are plotted for the early and late groupings in figure 2. \n\nThe fact that the gradients of the average housing and non-housing capital share trend lines are, broadly speaking, similar gives us an overall indication of the importance of housing to movements in the overall capital share: its contribution alone was comparable to the aggregate across all other industries.\nThis is confirmed in Table 1, which shows the change in the averages, broken down into sub-periods to facilitate comparison between the early and late series. The first four columns split the trends into two roughly equal subperiods: 1970-1995 and 1995-2017. 1995 marks the year in which the later series for the average capital shares begins (the earliest year for which the OECD industry data is available for most countries).\nWe see from the earlier (primarily KLEMS) data that the quarter-century from 1970 to 1995 saw a substantial rise in the overall capital share. The average capital share rose by 4.6 points across the 18 high-income countries in our sample, and 3.5 points where weighted by GDP at PPPs. But around two-thirds of this increase owed to rising housing shares.\nThe later series shows a much more modest rise in the overall capital share between 1995 and 2017, with housing nevertheless playing an important role. Rising housing shares drove almost all of the 1 point rise in the unweighted average for this period, and about half of the 2.5 point rise in the weighted average.\nThe four columns to the right of Table 2 provide a further breakdown of the later period, split at 2007 which marks the end of the early KLEMS data. As visible from Figure 2, where the early and later series overlap, there is some disagreement between them concerning the non-housing capital share. Between 1995 and 2007 the early series average rose by around 1-1.5 points more than the later series, with no apparent slow-down. \nReferring back to Figure 1, we see that whilst the more recent OECD industry data does generally track the earlier KLEMS data very closely, for a small number of countries – Greece, Italy and to a lesser extent the United Kingdom – there is a large initial discrepancy beginning in 1995 that decreases over time. Similarly, for the United States the later series based on institutional sectors rises more slowly than indicated in the KLEMS data. [Can we say anything about the reasons for these discrepancies?]\nTaken together, however, the overall view of the past half century afforded by the available data sources is not much affected by the differences visible across them. Table 3 sums the points changes seen in the averages across the subperiods, as a summary across the full period.\nWe see the rise in the overall capital share varies modestly depending on whether we make a break to the later series from where it begins in 1995 (left two columns) or from where the earlier series ends in 2007 (right two columns). Similarly, the average rise also depends somewhat on whether countries are weighted by GDP, with some larger economies seeing greater rises (see Table 1). But any combination of the series results in a rise in the overall capital share in the region of 6-7 points between 1970 and 2017.\nLikewise, whilst there are differences across specifications, the centrality of housing to changes in the overall capital share over the past five decades is clear. On a weighted basis, rising housing shares contributed to around half of the rise in the overall capital share on average. Taking the unweighted average, the contribution was larger still, at around two-thirds of the overall rise."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "personal_site",
    "section": "",
    "text": "Login\nThis is a Quarto website.\nTo learn more about Quarto websites visit https://quarto.org/docs/websites."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site"
  },
  {
    "objectID": "presentations/INET_xx_feb_inequality_around_the_world.html#publicpolicy-discourse-on-global-inequality-data-is-a-mess",
    "href": "presentations/INET_xx_feb_inequality_around_the_world.html#publicpolicy-discourse-on-global-inequality-data-is-a-mess",
    "title": "Triangulating a global view on inequality",
    "section": "Public/policy discourse on global inequality data is a mess",
    "text": "Public/policy discourse on global inequality data is a mess\nUN summary of inequality trends"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#the-international-poverty-line",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#the-international-poverty-line",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "The International Poverty Line",
    "text": "The International Poverty Line\n\n\n\n\nSet by the World Bank\nReflects definitions of poverty adopted in the world’s poorest countries.\nAdopted by the UN as the first SDG – Indicator 1.1.1\nRecently updated from $1.90 to $2.15"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#outline",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#outline",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Outline",
    "text": "Outline\n\nWhy has the IPL been updated?\nHow does this affect our understanding of global poverty?\n\n\n\nBasic picture: Just a change of units, Limited impact on global estimates\nMajor caveat I: Updated PPPs, Substantial changes for individual countries\nMajor caveat II: Interaction with how WB sets the IPL. The real value of higher WB poverty lines did change."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#a-change-of-units",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#a-change-of-units",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "A change of units",
    "text": "A change of units\n\n\n\n\nInternational-$ at 2011 -> 2017 prices\nChange reflects inflation: $1 in 2017 prices < $1 in 2011 prices\nThe value of the IPL (quantity of goods and services it buys) has, broadly speaking, been maintined"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#a-change-of-units-1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#a-change-of-units-1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "A change of units",
    "text": "A change of units\n\n\n\nInternational-$ at 2011 -> 2017 prices\nChange reflects inflation: $1 in 2017 prices < $1 in 2011 prices\nThe value of the IPL (quantity of goods and services it buys) has, broadly speaking, been maintined\nGlobal extreme poverty very similar measured in either terms."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-not-update-prices",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-not-update-prices",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Why not update prices?",
    "text": "Why not update prices?\n\n\nFlip the question: Why did the World Bank not update it’s prices sooner?"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-not-update-prices-1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-not-update-prices-1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Why not update prices?",
    "text": "Why not update prices?\n\n\nFlip the question: Why did the World Bank not update it’s prices sooner?\nShort answer: They were asked not to by the Atkinson Commission (2017)."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-not-update-prices-2",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-not-update-prices-2",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Why not update prices?",
    "text": "Why not update prices?\n\n\nFlip the question: Why did the World Bank not update it’s prices sooner?\nShort answer: They were asked not to by the Atkinson Commission (2017).\nThis time round the update in prices had a very small effect on global poverty estimates.\nBut in previous updates the changes were much more substantial.\n\n\n\n\nGlobal poverty fell by half on a Tuesday in 2014…"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#understanding-international-",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#understanding-international-",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Understanding international-$",
    "text": "Understanding international-$\n\nConverting local currencies to international-$ means making two price adjustments:\n\ninflation within individual countries\ndifferences in the cost of living between countries"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#understanding-international--1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#understanding-international--1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Understanding international-$",
    "text": "Understanding international-$\n\nConverting local currencies to international-$ means making two price adjustments:\n\ninflation within individual countries\ndifferences in the cost of living between countries\n\nTo make the second adjustment the WB uses Purchasing Power Parity rates\n\nA snapshot of price difference across coutries in a particular year\nData gathered by the ICP in ‘rounds’: 2017, 2011, 2005…\nUS is the ‘numeraire’:\n\n1 int-$ in 2017 prices is the quantity of goods and services that 1 USD could buy in the US in 2017.\nThe real value of 2017 vs 2011 int-$ fell by the same amount that prices increased in the US"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#understanding-international--2",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#understanding-international--2",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Understanding international-$",
    "text": "Understanding international-$\n\nConverting local currencies to international-$ means making two price adjustments:\n\ninflation within individual countries\ndifferences in the cost of living between countries\n\nTo make the second adjustment the WB uses Purchasing Power Parity rates\n\nA snapshot of price difference across coutries in a particular year\nData gathered by the ICP in ‘rounds’: 2017, 2011, 2005…\nUS is the ‘numeraire’:\n\n1 int-$ in 2017 prices is the quantity of goods and services that 1 USD could buy in the US in 2017.\nThe real value of 2017 vs 2011 int-$ fell by the same amount that prices increased in the US\n\n\nNote that ‘in 2017 prices’ thus has a dual meaning:\n\nthe base year to which the within-country inflation adjustment is made\nthe ICP round – i.e. the year cross-country price differences were observed."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "PPP ‘shocks’",
    "text": "PPP ‘shocks’\nWhen PPPs from a new ICP round are released, our view of relative prices between coutries can change a lot.\nI think of this as like a ‘shock’ to our understanding about the world.\nWith the new PPPs we update our view of how prices compare between countries."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks-1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks-1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "PPP ‘shocks’",
    "text": "PPP ‘shocks’\n\n\nCrucially – as our view of relative prices change, so does our view of relative incomes."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-do-these-ppp-shocks-arise",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#why-do-these-ppp-shocks-arise",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Why do these PPP ‘shocks’ arise?",
    "text": "Why do these PPP ‘shocks’ arise?\n\n\nChanges in ICP methodology, quality/availability of price data\nGenuine differences in how prices have changed in different countries (i.e. different inflation rates)\n\nBUT! These should roughly be accouted for by the inflation adjustment bit of converting local currencies to international-$!\nBUT2!! It’s part of the arithmetic construction of PPPs that a change in the relative PPP rate between two countries needn’t exactly map on to their relative rates of inflation (this is needed to provide ‘multilateral’ PPP rates – i.e. transitivity)"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks-impact-on-poverty-estimates",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks-impact-on-poverty-estimates",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "PPP ‘shocks’: impact on poverty estimates",
    "text": "PPP ‘shocks’: impact on poverty estimates\n\n\nAs our view of relative prices and incomes is updated with a new set of PPPs – so is our view of the extent of poverty in each country\nIn some extreme cases, poverty rates look very different when measured in 2017 and 2011 international-$."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks-impact-on-poverty-estimates-1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#ppp-shocks-impact-on-poverty-estimates-1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "PPP ‘shocks’: impact on poverty estimates",
    "text": "PPP ‘shocks’: impact on poverty estimates\nThe shift from 2011 to 2017 PPPs makes such a little difference to global poverty estimates because: - the country-level shocks cancel out to some extent - the shocks were less major than in previous rounds"
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#setting-the-ipl",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#setting-the-ipl",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Setting the IPL",
    "text": "Setting the IPL\n\n\nThe World Bank sets the IPL to reflect the poverty lines adopted in the world’s poorest countries.\nMore specifically, it is set at the median poverty line among ‘low-income’ countries (as per World Bank’s classification).\nIn 2017 prices, that gives the new IPL value of $2.15 per day."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#setting-the-ipl-1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#setting-the-ipl-1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Setting the IPL",
    "text": "Setting the IPL\nWith all the chopping and changing of relative price levels, the real value of the IPL could have changed with the new PPPs – if the median value of low-income countries’ poverty lines had changed.\nIt’s sort of by coincidence that didn’t happen!\nThe median poverty line increased by roughly the same amount (13%) that the value of the international $ fell (9% – the amount of inflation in the US between 2011 and 2017).\nIt’s only this conincidence that meant the real value of the IPL was maintained."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#higher-world-bank-poverty-lines",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#higher-world-bank-poverty-lines",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Higher World Bank poverty lines",
    "text": "Higher World Bank poverty lines\n\n\nThe World Bank also sets two higher poverty lines of $3.65 and $6.85 – the median poverty line among lower- and upper-middle income countries respectively.\nIn shifting to 2017 PPPs, these were updated from $3.20 and $5.50 when calculated with 2011 PPPs (back in 2016)."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#higher-world-bank-poverty-lines-1",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#higher-world-bank-poverty-lines-1",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Higher World Bank poverty lines",
    "text": "Higher World Bank poverty lines\n\n\nFor the upper-middle income poverty line – which rose from $5.50 to $6.85 (by 25%) – the ‘happy coincidence’ didn’t happen.\nGlobal poverty estimates for this poverty line changed considerably across the change in units because – unlike the IPL – the real value of this poverty line changed too."
  },
  {
    "objectID": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#summary",
    "href": "presentations/DSPI_CSP_masters_Jan2023/DSPI_CSP_masters_Jan2023.html#summary",
    "title": "From $1.90 to $2.15: the updated International Poverty Line",
    "section": "Summary",
    "text": "Summary\n\nThe real value of the IPL didnt change (though that’s not true for higher line)\nUnsurprisingly, global poverty rates look very similar.\nBut this is partly due to some ‘cancelling out’ across countries\nThe new PPPs give us a revised understanding of how incomes – and hence poverty levels – compare in different countries.\nThe shift from 2011 to 2017 PPPs is, however, was much less of a ‘shock’ than earlier ICP rounds."
  },
  {
    "objectID": "test_pages/test_with_shinylive.html",
    "href": "test_pages/test_with_shinylive.html",
    "title": "Shinylive in Quarto example",
    "section": "",
    "text": "This is a Shinylive application embedded in a Quarto doc.\nThese are Shiny for Python applications which run completely in the browser, using Pyodide (Python compiled to WebAssembly).\nSee the Shilylive quarto extension for further documentation.\nAnd the documentation on Shiny for Python.\n#| standalone: true\n\nfrom shiny import *\n\napp_ui = ui.page_fluid(\n    ui.input_slider(\"n\", \"N\", 0, 100, 40),\n    ui.output_text_verbatim(\"txt\"),\n)\n\ndef server(input, output, session):\n    @output\n    @render.text\n    def txt():\n        return f\"The value of n*2 is {input.n() * 2}\"\n\napp = App(app_ui, server)\n\nHere is a second app I am testing:\n#| standalone: true\n#| viewerHeight: 420\n\nfrom shiny import *\nfrom plotnine import *\nfrom pyodide.http import open_url\nimport pandas as pd\n\n\n\napp_ui = ui.page_fluid(\n    ui.output_plot(\"example_plot\"),\n)\n\n\ndef server(input, output, session):\n    @output\n    @render.plot\n    def example_plot():\n    \n        url = 'https://raw.githubusercontent.com/owid/notebooks/main/BetterDataDocs/JoeHasell/PIP/data/ppp_2017/final/PIP_data_public_download/full_dataset/cons_only/poverty_cons_only.csv'\n        \n        df = pd.read_csv(open_url(url))\n\n        plot = (ggplot(df, aes('Year', 'headcount_ratio_365', color = 'Entity'))\n        + geom_line())\n\n        # d = {'col1': [1, 2], 'col2': [3, 4]}\n        # df = pd.DataFrame(data=d)\n        # plot = (ggplot(df, aes('col1', 'col2'))\n        # + geom_point())\n\n\n        return plot\n\n\napp = App(app_ui, server)"
  },
  {
    "objectID": "test_pages/test_with_ipywidgets.html",
    "href": "test_pages/test_with_ipywidgets.html",
    "title": "Ipywidgets in Quarto example",
    "section": "",
    "text": "import pandas as pd\nimport ipywidgets as widgets\nfrom ipywidgets import interact, interact_manual\n\nRead in some data\n\ndf = pd.read_csv(\"pip_dataset (2).csv\")\n\n\n@interact\ndef show_ppp_version(version=2011):\n    return df.loc[df[\"ppp_version\"] == version]"
  },
  {
    "objectID": "how_to.html",
    "href": "how_to.html",
    "title": "How I built this site",
    "section": "",
    "text": "This site is built on three main ingredients:\n\nQuarto notebooks, gathered together into a Quarto website\nThese are published to the web via Netlify"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_A_prepare_PIP.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_A_prepare_PIP.html",
    "title": "Appendix 1.A: Preparing PIP inequality data",
    "section": "",
    "text": "The titles in each of the boxes below summarise the steps taken to prepare the PIP data. In each case you can expand the box to see the code used.\n\n\n\n\n\n\nPackages and settings\n\n\n\n\n\n\nimport pandas as pd\n\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad PIP data\n\n\n\n\n\nWe load the data from a file prepared from the PIP API by Our World in Data.\n\n# df_pip<- read.csv(\"https://raw.githubusercontent.com/owid/poverty-data/main/datasets/pip_dataset.csv\")\n\n#  A local version, in case internet isn't available \ndf_pip = pd.read_csv(\"data/original/pip_dataset.csv\")\n\nThe dataframe looks like this:\n\ndf_pip.head()\n\n\n\n\n\n  \n    \n      \n      country\n      year\n      reporting_level\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      ...\n      decile8_thr\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n    \n  \n  \n    \n      0\n      Albania\n      1996\n      national\n      consumption\n      2011\n      1996.0\n      0.0\n      0.920669\n      11.174149\n      44.618417\n      ...\n      8.85\n      10.92\n      0.270103\n      0.119104\n      0.241293\n      0.928335\n      3.945872\n      3.568627\n      1.889273\n      1.888889\n    \n    \n      1\n      Albania\n      2002\n      national\n      consumption\n      2011\n      2002.0\n      1.0\n      1.570843\n      14.132118\n      49.669635\n      ...\n      8.83\n      11.58\n      0.317390\n      0.164812\n      0.268982\n      1.215056\n      4.831625\n      3.979381\n      2.090253\n      1.903780\n    \n    \n      2\n      Albania\n      2005\n      national\n      consumption\n      2011\n      2005.0\n      1.0\n      0.860527\n      8.715685\n      38.545254\n      ...\n      10.02\n      12.78\n      0.305957\n      0.154413\n      0.254529\n      1.142718\n      4.662236\n      3.872727\n      1.978328\n      1.957576\n    \n    \n      3\n      Albania\n      2008\n      national\n      consumption\n      2011\n      2008.0\n      1.0\n      0.313650\n      5.250542\n      31.110345\n      ...\n      10.74\n      13.62\n      0.299847\n      0.148893\n      0.247311\n      1.114657\n      4.395911\n      3.574803\n      1.956897\n      1.826772\n    \n    \n      4\n      Albania\n      2012\n      national\n      consumption\n      2011\n      2012.0\n      1.0\n      0.849754\n      6.182414\n      34.528906\n      ...\n      10.52\n      13.26\n      0.289605\n      0.138417\n      0.249988\n      1.041193\n      4.272573\n      3.632877\n      1.941435\n      1.871233\n    \n  \n\n5 rows × 108 columns\n\n\n\n\n\n\n\n\n\n\n\n\nSelect PPP version\n\n\n\n\n\nWe will use the 2017 PPPs.\n\ndf_pip = df_pip.loc[df_pip[\"ppp_version\"] == 2017]\n\n\n\n\n\n\n\n\n\n\nDrop sub-national data\n\n\n\n\n\nThe PIP data includes observations for national, urban and rural populations (reporting_level):\n\ndf_pip.groupby('reporting_level').count()\n\n\n\n\n\n  \n    \n      \n      country\n      year\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      headcount_ratio_100\n      ...\n      decile8_thr\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n    \n    \n      reporting_level\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      national\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      2024\n      ...\n      2024\n      2024\n      2019\n      2019\n      2019\n      2016\n      2016\n      2024\n      2024\n      2024\n    \n    \n      rural\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      ...\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n      63\n    \n    \n      urban\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      ...\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n      118\n    \n  \n\n3 rows × 107 columns\n\n\n\nHere we add a count of the number of reporting levels per country-year.\n\ndf_pip['n_reporting_level'] = df_pip\\\n  .groupby([\"country\", \"year\"])['reporting_level']\\\n  .transform('count')\n\ndf_pip.head(20)  \n\n\n\n\n\n  \n    \n      \n      country\n      year\n      reporting_level\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      ...\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n      n_reporting_level\n    \n  \n  \n    \n      2439\n      Albania\n      1996\n      national\n      consumption\n      2017\n      1996.00\n      0.0\n      0.534846\n      8.898443\n      47.879143\n      ...\n      13.18\n      0.270103\n      0.119104\n      0.241293\n      0.928335\n      3.945872\n      3.562162\n      1.888252\n      1.886486\n      1\n    \n    \n      2440\n      Albania\n      2002\n      national\n      consumption\n      2017\n      2002.00\n      1.0\n      1.092647\n      11.388324\n      52.090966\n      ...\n      13.98\n      0.317390\n      0.164812\n      0.268982\n      1.215056\n      4.831625\n      3.982906\n      2.089686\n      1.905983\n      1\n    \n    \n      2441\n      Albania\n      2005\n      national\n      consumption\n      2017\n      2005.00\n      1.0\n      0.591086\n      7.289304\n      40.428427\n      ...\n      15.44\n      0.305957\n      0.154413\n      0.254529\n      1.142718\n      4.662236\n      3.869674\n      1.979487\n      1.954887\n      1\n    \n    \n      2442\n      Albania\n      2008\n      national\n      consumption\n      2017\n      2008.00\n      1.0\n      0.199925\n      3.902613\n      33.431851\n      ...\n      16.44\n      0.299847\n      0.148893\n      0.247311\n      1.114657\n      4.395911\n      3.573913\n      1.957143\n      1.826087\n      1\n    \n    \n      2443\n      Albania\n      2012\n      national\n      consumption\n      2017\n      2012.00\n      1.0\n      0.620691\n      4.805442\n      36.667752\n      ...\n      16.00\n      0.289605\n      0.138417\n      0.249988\n      1.041193\n      4.272573\n      3.628118\n      1.941748\n      1.868481\n      1\n    \n    \n      2444\n      Albania\n      2014\n      national\n      consumption\n      2017\n      2014.00\n      2.0\n      1.023101\n      9.675968\n      38.743826\n      ...\n      19.06\n      0.345989\n      0.198662\n      0.324310\n      1.376215\n      5.930924\n      5.179348\n      2.299156\n      2.252717\n      1\n    \n    \n      2445\n      Albania\n      2015\n      national\n      consumption\n      2017\n      2015.00\n      2.0\n      0.120621\n      3.698998\n      26.154314\n      ...\n      22.06\n      0.327537\n      0.175495\n      0.300364\n      1.248506\n      5.278241\n      4.595833\n      2.230536\n      2.060417\n      1\n    \n    \n      2446\n      Albania\n      2016\n      national\n      consumption\n      2017\n      2016.00\n      2.0\n      0.139303\n      4.666635\n      25.413828\n      ...\n      23.16\n      0.337363\n      0.187581\n      0.314380\n      1.306972\n      5.626880\n      4.927660\n      2.252918\n      2.187234\n      2\n    \n    \n      2447\n      Albania\n      2016\n      national\n      income\n      2017\n      2016.00\n      4.0\n      5.795102\n      16.190831\n      41.500098\n      ...\n      19.36\n      0.385656\n      0.273740\n      0.350360\n      1.696002\n      8.286575\n      6.964029\n      2.378378\n      2.928058\n      2\n    \n    \n      2448\n      Albania\n      2017\n      national\n      consumption\n      2017\n      2017.00\n      2.0\n      0.392570\n      3.626683\n      25.540996\n      ...\n      22.72\n      0.330557\n      0.179908\n      0.308522\n      1.259837\n      5.389502\n      4.627291\n      2.231827\n      2.073320\n      2\n    \n    \n      2449\n      Albania\n      2017\n      national\n      income\n      2017\n      2017.00\n      4.0\n      5.264806\n      13.959267\n      37.323773\n      ...\n      19.84\n      0.370951\n      0.254175\n      0.332537\n      1.567077\n      7.732992\n      6.613333\n      2.280460\n      2.900000\n      2\n    \n    \n      2450\n      Albania\n      2018\n      national\n      consumption\n      2017\n      2018.00\n      3.0\n      0.048107\n      2.730375\n      18.160960\n      ...\n      23.32\n      0.301483\n      0.152404\n      0.265930\n      1.083829\n      4.811264\n      4.263254\n      2.003436\n      2.127971\n      2\n    \n    \n      2451\n      Albania\n      2018\n      national\n      income\n      2017\n      2018.00\n      4.0\n      3.892982\n      11.321431\n      34.187015\n      ...\n      20.54\n      0.359888\n      0.233051\n      0.319245\n      1.482572\n      7.036721\n      5.988338\n      2.232609\n      2.682216\n      2\n    \n    \n      2452\n      Albania\n      2019\n      national\n      consumption\n      2017\n      2019.00\n      3.0\n      0.000000\n      0.797915\n      10.936920\n      ...\n      27.58\n      0.307717\n      0.154626\n      0.274892\n      1.132010\n      4.744671\n      4.147368\n      2.108563\n      1.966917\n      1\n    \n    \n      2453\n      Algeria\n      1988\n      national\n      consumption\n      2017\n      1988.00\n      0.0\n      6.420311\n      25.193446\n      63.647189\n      ...\n      12.62\n      0.401949\n      0.281732\n      0.307921\n      1.899252\n      7.210696\n      5.130081\n      2.273874\n      2.256098\n      1\n    \n    \n      2454\n      Algeria\n      1995\n      national\n      consumption\n      2017\n      1995.00\n      1.0\n      5.770566\n      24.248315\n      61.103419\n      ...\n      13.12\n      0.353301\n      0.208518\n      0.313371\n      1.452068\n      6.118002\n      5.165354\n      2.281739\n      2.263780\n      1\n    \n    \n      2455\n      Algeria\n      2011\n      national\n      consumption\n      2017\n      2011.17\n      2.0\n      0.455468\n      4.019208\n      36.574951\n      ...\n      15.06\n      0.276157\n      0.125331\n      0.226046\n      0.992916\n      3.976114\n      3.354120\n      1.873134\n      1.790646\n      1\n    \n    \n      2456\n      Angola\n      2000\n      national\n      consumption\n      2017\n      2000.21\n      0.0\n      21.408848\n      39.538850\n      67.211819\n      ...\n      14.48\n      0.519569\n      0.512576\n      0.464340\n      3.653264\n      17.654010\n      12.271186\n      3.100642\n      3.957627\n      1\n    \n    \n      2457\n      Angola\n      2008\n      national\n      consumption\n      2017\n      2008.50\n      1.0\n      14.632487\n      37.666291\n      69.063484\n      ...\n      12.54\n      0.427155\n      0.311632\n      0.391365\n      2.147126\n      8.942374\n      6.852459\n      2.673774\n      2.562842\n      1\n    \n    \n      2458\n      Angola\n      2018\n      national\n      consumption\n      2017\n      2018.17\n      2.0\n      31.122006\n      52.902326\n      77.974702\n      ...\n      10.72\n      0.512721\n      0.477890\n      0.470982\n      3.465666\n      14.786824\n      10.018692\n      3.134503\n      3.196262\n      1\n    \n  \n\n20 rows × 109 columns\n\n\n\nWe only want one reporting level for each country-year.\nThat is already true for most country-years. But some include all three reporting levels.\n\ndf_pip.groupby('n_reporting_level').count()\n\n\n\n\n\n  \n    \n      \n      country\n      year\n      reporting_level\n      welfare_type\n      ppp_version\n      survey_year\n      survey_comparability\n      headcount_ratio_international_povline\n      headcount_ratio_lower_mid_income_povline\n      headcount_ratio_upper_mid_income_povline\n      ...\n      decile8_thr\n      decile9_thr\n      gini\n      mld\n      polarization\n      palma_ratio\n      s80_s20_ratio\n      p90_p10_ratio\n      p90_p50_ratio\n      p50_p10_ratio\n    \n    \n      n_reporting_level\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      233\n      233\n      0\n      0\n      233\n      0\n      0\n      233\n      233\n      233\n      ...\n      233\n      233\n      0\n      0\n      0\n      0\n      0\n      233\n      233\n      233\n    \n    \n      1\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      1872\n      ...\n      1872\n      1872\n      1867\n      1867\n      1867\n      1864\n      1864\n      1872\n      1872\n      1872\n    \n    \n      2\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      ...\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n      150\n    \n    \n      3\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      ...\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n      183\n    \n  \n\n4 rows × 108 columns\n\n\n\nHere are the countries which include all three reporting levels:\n\nmulti_reporting_level_countries = df_pip.loc[df_pip['n_reporting_level'] == 3, \"country\"].unique()\n\nmulti_reporting_level_countries\n\narray(['China', 'India', 'Indonesia'], dtype=object)\n\n\nFor the country-years with 3 reporting levels, we keep only the national estimates.\n\ndf_pip = df_pip.loc[(df_pip['n_reporting_level'] != 3) | (df_pip['reporting_level'] == 'national') ]\n\n\n\n\n\n\n\n\n\n\nDrop regional data\n\n\n\n\n\nThe dataset includes aggregated estiates for world regions.\nHere we define a list of these aggregate entities and drop them from the data.\n\ndrop_aggs = [\n  \"East Asia and Pacific\",\n  \"South Asia\",\n  \"Europe and Central Asia\",\n  \"High income countries\",\n  \"Latin America and the Caribbean\",\n  \"Middle East and North Africa\",\n  \"Sub-Saharan Africa\",\n  \"World\"\n]\n\ndf_pip = df_pip.loc[~df_pip.country.isin(drop_aggs)]\n\n\n\n\n\n\n\n\n\n\nCalculate additional variables\n\n\n\n\n\n\n# Bottom 50% share – sum shares of lower 5 deciles\nsum_cols = [\n  \"decile1_share\",\n  \"decile2_share\",\n  \"decile3_share\",\n  \"decile4_share\",\n  \"decile5_share\"]\n\ndf_pip[\"Bottom_50_share\"] = df_pip[sum_cols].sum(axis=1)\n\ndf_pip[\"P90_P50_ratio\"] = df_pip[\"decile9_thr\"]/df_pip[\"median\"]\n\ndf_pip[\"Gini\"] = df_pip['gini'] * 100\n\n\n\n\n\n\n\n\n\n\nRename and select needed columns\n\n\n\n\n\n\ndf_pip = df_pip.rename(columns={\n    'decile10_share':'Top_10_share',\n    'mld': 'MLD',\n    \"country\": \"Entity\",\n    \"year\": \"Year\"\n  })\n\nkeep_cols = [\n  \"Year\",\n  \"Entity\",\n  \"Gini\",\n  \"Top_10_share\",\n  \"Bottom_50_share\",\n  \"MLD\",\n  \"welfare_type\"\n]\n\ndf_pip = df_pip[keep_cols]\n\n\n\n\n\n\n\n\n\n\nSee the prepared PIP data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_pip.head(100)\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini\n      Top_10_share\n      Bottom_50_share\n      MLD\n      welfare_type\n    \n  \n  \n    \n      2439\n      1996\n      Albania\n      27.010342\n      21.215573\n      31.233020\n      0.119104\n      consumption\n    \n    \n      2440\n      2002\n      Albania\n      31.738980\n      25.435637\n      28.586811\n      0.164812\n      consumption\n    \n    \n      2441\n      2005\n      Albania\n      30.595656\n      24.341168\n      29.289268\n      0.154413\n      consumption\n    \n    \n      2442\n      2008\n      Albania\n      29.984670\n      24.458311\n      29.854541\n      0.148893\n      consumption\n    \n    \n      2443\n      2012\n      Albania\n      28.960485\n      22.934340\n      30.110824\n      0.138417\n      consumption\n    \n    \n      2444\n      2014\n      Albania\n      34.598896\n      25.544322\n      26.073656\n      0.198662\n      consumption\n    \n    \n      2445\n      2015\n      Albania\n      32.753732\n      24.779308\n      27.467187\n      0.175495\n      consumption\n    \n    \n      2446\n      2016\n      Albania\n      33.736299\n      25.049555\n      26.690538\n      0.187581\n      consumption\n    \n    \n      2447\n      2016\n      Albania\n      38.565643\n      27.466949\n      23.553176\n      0.273740\n      income\n    \n    \n      2448\n      2017\n      Albania\n      33.055663\n      24.612430\n      27.141175\n      0.179908\n      consumption\n    \n    \n      2449\n      2017\n      Albania\n      37.095127\n      26.453363\n      24.529857\n      0.254175\n      income\n    \n    \n      2450\n      2018\n      Albania\n      30.148282\n      22.742312\n      29.118466\n      0.152404\n      consumption\n    \n    \n      2451\n      2018\n      Albania\n      35.988752\n      26.001869\n      25.267952\n      0.233051\n      income\n    \n    \n      2452\n      2019\n      Albania\n      30.771739\n      23.757880\n      28.848613\n      0.154626\n      consumption\n    \n    \n      2453\n      1988\n      Algeria\n      40.194909\n      32.812365\n      24.174448\n      0.281732\n      consumption\n    \n    \n      2454\n      1995\n      Algeria\n      35.330054\n      26.888586\n      25.997710\n      0.208518\n      consumption\n    \n    \n      2455\n      2011\n      Algeria\n      27.615731\n      22.862358\n      31.264953\n      0.125331\n      consumption\n    \n    \n      2456\n      2000\n      Angola\n      51.956892\n      40.245516\n      16.679090\n      0.512576\n      consumption\n    \n    \n      2457\n      2008\n      Angola\n      42.715515\n      32.311734\n      21.591434\n      0.311632\n      consumption\n    \n    \n      2458\n      2018\n      Angola\n      51.272111\n      39.624426\n      17.017691\n      0.477890\n      consumption\n    \n    \n      2459\n      1980\n      Argentina\n      40.830860\n      30.175371\n      22.456041\n      0.291847\n      income\n    \n    \n      2460\n      1986\n      Argentina\n      42.808887\n      32.208083\n      21.663422\n      0.331428\n      income\n    \n    \n      2461\n      1987\n      Argentina\n      45.276366\n      34.251890\n      20.231084\n      0.369971\n      income\n    \n    \n      2462\n      1991\n      Argentina\n      46.761739\n      36.609291\n      19.916604\n      0.382436\n      income\n    \n    \n      2463\n      1992\n      Argentina\n      45.468093\n      34.287122\n      20.005543\n      0.369330\n      income\n    \n    \n      2464\n      1993\n      Argentina\n      44.856286\n      33.201389\n      20.186152\n      0.366267\n      income\n    \n    \n      2465\n      1994\n      Argentina\n      45.916804\n      34.446597\n      19.717602\n      0.380300\n      income\n    \n    \n      2466\n      1995\n      Argentina\n      48.904403\n      36.975603\n      18.094343\n      0.440659\n      income\n    \n    \n      2467\n      1996\n      Argentina\n      49.524429\n      36.880607\n      17.546878\n      0.460014\n      income\n    \n    \n      2468\n      1997\n      Argentina\n      49.110475\n      36.374269\n      17.689760\n      0.449554\n      income\n    \n    \n      2469\n      1998\n      Argentina\n      50.733644\n      38.051340\n      16.843621\n      0.477405\n      income\n    \n    \n      2470\n      1999\n      Argentina\n      49.792041\n      37.048270\n      17.270868\n      0.461812\n      income\n    \n    \n      2471\n      2000\n      Argentina\n      51.063958\n      37.700487\n      16.361297\n      0.492797\n      income\n    \n    \n      2472\n      2001\n      Argentina\n      53.343106\n      39.477386\n      15.019009\n      0.550911\n      income\n    \n    \n      2473\n      2002\n      Argentina\n      53.793758\n      40.506190\n      15.028491\n      0.542299\n      income\n    \n    \n      2474\n      2003\n      Argentina\n      50.897157\n      37.685324\n      16.486608\n      0.486434\n      income\n    \n    \n      2475\n      2004\n      Argentina\n      48.377035\n      35.235994\n      17.749908\n      0.435194\n      income\n    \n    \n      2476\n      2005\n      Argentina\n      47.707355\n      34.894293\n      18.226501\n      0.420457\n      income\n    \n    \n      2477\n      2006\n      Argentina\n      46.346080\n      33.734755\n      18.949481\n      0.400806\n      income\n    \n    \n      2478\n      2007\n      Argentina\n      46.173556\n      33.672263\n      19.063280\n      0.392319\n      income\n    \n    \n      2479\n      2008\n      Argentina\n      44.876790\n      32.407600\n      19.791500\n      0.372277\n      income\n    \n    \n      2480\n      2009\n      Argentina\n      43.654197\n      31.249503\n      20.445920\n      0.353037\n      income\n    \n    \n      2481\n      2010\n      Argentina\n      43.583218\n      31.700111\n      20.632748\n      0.343588\n      income\n    \n    \n      2482\n      2011\n      Argentina\n      42.645281\n      30.957099\n      21.159035\n      0.326801\n      income\n    \n    \n      2483\n      2012\n      Argentina\n      41.326198\n      29.683243\n      21.823721\n      0.309280\n      income\n    \n    \n      2484\n      2013\n      Argentina\n      40.945442\n      29.371888\n      22.032889\n      0.302721\n      income\n    \n    \n      2485\n      2014\n      Argentina\n      41.632790\n      29.921178\n      21.631951\n      0.309027\n      income\n    \n    \n      2486\n      2016\n      Argentina\n      42.032529\n      30.419325\n      21.503691\n      0.316845\n      income\n    \n    \n      2487\n      2017\n      Argentina\n      41.134488\n      29.704420\n      22.022865\n      0.303501\n      income\n    \n    \n      2488\n      2018\n      Argentina\n      41.342498\n      29.830209\n      21.866618\n      0.308587\n      income\n    \n    \n      2489\n      2019\n      Argentina\n      42.905850\n      31.014569\n      20.951558\n      0.332231\n      income\n    \n    \n      2490\n      2020\n      Argentina\n      42.343291\n      30.302825\n      21.074827\n      0.320525\n      income\n    \n    \n      2491\n      1996\n      Armenia\n      44.418623\n      35.221513\n      21.195700\n      0.335479\n      income\n    \n    \n      2492\n      1999\n      Armenia\n      36.219724\n      29.627171\n      26.318746\n      0.218430\n      consumption\n    \n    \n      2493\n      2001\n      Armenia\n      35.364359\n      29.096740\n      26.929964\n      0.206337\n      consumption\n    \n    \n      2494\n      2002\n      Armenia\n      34.779674\n      28.999345\n      27.392142\n      0.200002\n      consumption\n    \n    \n      2495\n      2003\n      Armenia\n      33.028087\n      28.196948\n      28.599118\n      0.182095\n      consumption\n    \n    \n      2496\n      2004\n      Armenia\n      37.505633\n      31.688368\n      26.072292\n      0.237383\n      consumption\n    \n    \n      2497\n      2005\n      Armenia\n      35.992353\n      30.776058\n      26.995990\n      0.217763\n      consumption\n    \n    \n      2498\n      2006\n      Armenia\n      29.709985\n      24.454012\n      30.031688\n      0.145873\n      consumption\n    \n    \n      2499\n      2007\n      Armenia\n      31.226058\n      25.121380\n      29.068954\n      0.160137\n      consumption\n    \n    \n      2500\n      2008\n      Armenia\n      29.188142\n      23.690150\n      30.141146\n      0.139795\n      consumption\n    \n    \n      2501\n      2009\n      Armenia\n      28.015877\n      22.918775\n      30.945396\n      0.127764\n      consumption\n    \n    \n      2502\n      2010\n      Armenia\n      29.992582\n      25.033900\n      30.059406\n      0.148755\n      consumption\n    \n    \n      2503\n      2011\n      Armenia\n      29.352946\n      23.966580\n      30.229219\n      0.141577\n      consumption\n    \n    \n      2504\n      2012\n      Armenia\n      29.602261\n      24.540222\n      30.187470\n      0.145135\n      consumption\n    \n    \n      2505\n      2013\n      Armenia\n      30.579663\n      24.685464\n      29.434196\n      0.156560\n      consumption\n    \n    \n      2506\n      2014\n      Armenia\n      31.483291\n      25.743970\n      28.966402\n      0.165166\n      consumption\n    \n    \n      2507\n      2015\n      Armenia\n      32.356772\n      26.735056\n      28.597144\n      0.176380\n      consumption\n    \n    \n      2508\n      2016\n      Armenia\n      32.547948\n      25.281661\n      27.863252\n      0.180756\n      consumption\n    \n    \n      2509\n      2017\n      Armenia\n      33.621837\n      28.368865\n      28.202627\n      0.190807\n      consumption\n    \n    \n      2510\n      2018\n      Armenia\n      34.433498\n      29.199379\n      27.765776\n      0.200198\n      consumption\n    \n    \n      2511\n      2019\n      Armenia\n      29.878207\n      25.093678\n      30.247507\n      0.149867\n      consumption\n    \n    \n      2512\n      2020\n      Armenia\n      25.171743\n      21.473396\n      32.941241\n      0.104231\n      consumption\n    \n    \n      2513\n      1981\n      Australia\n      31.325787\n      23.301636\n      28.412371\n      0.187102\n      income\n    \n    \n      2514\n      1985\n      Australia\n      32.497685\n      24.289657\n      27.759943\n      0.201840\n      income\n    \n    \n      2515\n      1989\n      Australia\n      33.153835\n      24.666855\n      27.294485\n      0.211511\n      income\n    \n    \n      2516\n      1995\n      Australia\n      32.581990\n      24.601701\n      27.757864\n      0.198392\n      income\n    \n    \n      2517\n      2001\n      Australia\n      33.464798\n      25.065630\n      27.073808\n      0.208055\n      income\n    \n    \n      2518\n      2003\n      Australia\n      33.500516\n      25.082890\n      27.095688\n      0.221342\n      income\n    \n    \n      2519\n      2004\n      Australia\n      33.057409\n      25.316017\n      27.526896\n      0.207807\n      income\n    \n    \n      2520\n      2008\n      Australia\n      35.428508\n      27.415568\n      26.186895\n      0.224778\n      income\n    \n    \n      2521\n      2010\n      Australia\n      34.656728\n      26.457995\n      26.503312\n      0.216345\n      income\n    \n    \n      2522\n      2014\n      Australia\n      34.399431\n      26.983471\n      27.077736\n      0.226976\n      income\n    \n    \n      2523\n      2016\n      Australia\n      33.685811\n      25.808292\n      27.197987\n      0.208579\n      income\n    \n    \n      2524\n      2018\n      Australia\n      34.333762\n      26.613391\n      26.989284\n      0.225616\n      income\n    \n    \n      2525\n      1987\n      Austria\n      23.044493\n      19.288321\n      33.991877\n      0.088150\n      income\n    \n    \n      2526\n      1994\n      Austria\n      31.322342\n      24.590413\n      28.859071\n      0.183306\n      income\n    \n    \n      2527\n      1995\n      Austria\n      31.059269\n      22.409297\n      28.442713\n      0.197686\n      income\n    \n    \n      2528\n      1997\n      Austria\n      30.229853\n      23.442252\n      29.337562\n      0.166189\n      income\n    \n    \n      2529\n      2000\n      Austria\n      28.837106\n      22.713880\n      30.262081\n      0.144586\n      income\n    \n    \n      2530\n      2003\n      Austria\n      29.466078\n      23.469033\n      30.073341\n      0.161863\n      income\n    \n    \n      2531\n      2004\n      Austria\n      29.788990\n      23.842909\n      29.891165\n      0.154047\n      income\n    \n    \n      2532\n      2005\n      Austria\n      28.715433\n      22.849905\n      30.389131\n      0.144996\n      income\n    \n    \n      2533\n      2006\n      Austria\n      29.587583\n      23.711891\n      29.969613\n      0.152394\n      income\n    \n    \n      2534\n      2007\n      Austria\n      30.579996\n      23.848664\n      29.208728\n      0.174352\n      income\n    \n    \n      2535\n      2008\n      Austria\n      30.437386\n      24.109801\n      29.474433\n      0.174083\n      income\n    \n    \n      2536\n      2009\n      Austria\n      31.496232\n      24.683308\n      28.787035\n      0.200792\n      income\n    \n    \n      2537\n      2010\n      Austria\n      30.252263\n      23.567978\n      29.411210\n      0.171590\n      income\n    \n    \n      2538\n      2011\n      Austria\n      30.801669\n      23.686997\n      28.994799\n      0.183447\n      income\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave the data\n\n\n\n\n\nI save the prepared data locally:\n\ndf_pip.to_csv(\"data/clean/pip.csv\", index=False)\n\n\n\n\n\n\n\n\nThe PIP data includes a mix of income and consumption observations – including both for some country-years."
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_B_prepare_WID.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_B_prepare_WID.html",
    "title": "Appendix 1.B: Preparing WID inequality data",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nimport pandas as pd\n\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad WID data\n\n\n\n\n\nWe load the data from a file prepared from the WID Stata package by Our World in Data.\nThe data was prepared in three separate files according to three income concepts: post_tax disposable income, post_tax national income and pretax national income.\nThese we append into a single file.\n\n# df_wid<- read.csv(\"https://raw.githubusercontent.com/owid/notebooks/main/BetterDataDocs/PabloArriagada/WID/data/final/wid_pretax.csv\")\n\ninc_concepts = [\n  'posttax_dis',\n  'posttax_nat',\n  'pretax'\n]\n\n# filepaths = [f'data/original/wid_{inc_concept}.csv' for inc_concept in inc_concepts]\n\nfilepaths = [f'https://raw.githubusercontent.com/owid/notebooks/main/BetterDataDocs/PabloArriagada/WID/data/final/wid_{inc_concept}.csv' for inc_concept in inc_concepts]\n\nwid_dfs = [pd.read_csv(filepath) for filepath in filepaths]\n\ndf_wid = pd.concat(wid_dfs, keys=inc_concepts)\n\n# Tidy up indexes\ndf_wid = df_wid.reset_index()\n\ndf_wid = df_wid.drop('level_1', axis=1)\n\ndf_wid = df_wid\\\n  .rename(columns={\"level_0\": \"inc_concept\"})\n\nThe resulting dataframe looks like this:\n\ndf_wid.head(50)\n\n\n\n\n\n  \n    \n      \n      inc_concept\n      Entity\n      Year\n      Gini coefficient\n      Palma ratio (S90/S40 ratio)\n      S90/S10 ratio\n      S80/S20 ratio\n      S90/S50 ratio\n      P90/P10 ratio\n      P90/P50 ratio\n      ...\n      P50 - income threshold (median)\n      P60 - income threshold\n      P70 - income threshold\n      P80 - income threshold\n      P90 - income threshold of the top 10%\n      P99.999 - income threshold of the top 0.001%\n      P99.99 - income threshold of the top 0.01%\n      P99.9 - income threshold of the top 0.1%\n      P99 - income threshold of the top 1%\n      P0-P40 - share of the bottom 40%\n    \n  \n  \n    \n      0\n      posttax_dis\n      Albania\n      1996\n      0.443678\n      2.422797\n      -333.000000\n      25.670330\n      1.490303\n      25.732002\n      2.317264\n      ...\n      5598.351958\n      6677.413311\n      8006.281754\n      9828.944789\n      12972.860259\n      3.422160e+05\n      1.510025e+05\n      6.662973e+04\n      29400.308601\n      NaN\n    \n    \n      1\n      posttax_dis\n      Albania\n      2002\n      0.457921\n      2.658412\n      -518.833310\n      27.597702\n      1.622199\n      22.376900\n      2.413228\n      ...\n      6694.514303\n      7975.635075\n      9737.097324\n      12066.302508\n      16155.386192\n      4.734979e+05\n      2.035016e+05\n      8.746166e+04\n      37589.584734\n      NaN\n    \n    \n      2\n      posttax_dis\n      Albania\n      2005\n      0.450608\n      2.535596\n      -3063.000000\n      25.782608\n      1.554034\n      21.295458\n      2.335103\n      ...\n      7686.136668\n      9047.728429\n      10957.297531\n      13599.462132\n      17947.917954\n      5.249345e+05\n      2.257264e+05\n      9.706431e+04\n      41738.495620\n      NaN\n    \n    \n      3\n      posttax_dis\n      Albania\n      2008\n      0.449409\n      2.516900\n      -1526.500000\n      26.379889\n      1.544259\n      23.671341\n      2.287115\n      ...\n      8896.834378\n      10535.777463\n      12746.381573\n      15715.719306\n      20348.079121\n      6.605182e+05\n      2.767225e+05\n      1.159322e+05\n      48569.517624\n      NaN\n    \n    \n      4\n      posttax_dis\n      Albania\n      2012\n      0.448045\n      2.490733\n      441.571440\n      23.009708\n      1.545500\n      20.856731\n      2.309005\n      ...\n      9237.230442\n      10833.767569\n      13111.034275\n      16134.512223\n      21328.810393\n      7.254662e+05\n      3.004032e+05\n      1.243918e+05\n      51508.541439\n      NaN\n    \n    \n      5\n      posttax_dis\n      Albania\n      2015\n      0.454367\n      2.561644\n      99.343750\n      18.937500\n      1.614525\n      14.074163\n      2.474667\n      ...\n      9373.105143\n      11023.116961\n      13685.740204\n      16946.858143\n      23195.315519\n      7.946113e+05\n      3.284476e+05\n      1.357618e+05\n      56116.281830\n      NaN\n    \n    \n      6\n      posttax_dis\n      Albania\n      2016\n      0.461121\n      2.696459\n      71.066666\n      19.140625\n      1.690275\n      16.278803\n      2.567514\n      ...\n      9639.325184\n      11562.745214\n      14300.537763\n      17777.603581\n      24749.103918\n      7.507099e+05\n      3.198851e+05\n      1.363063e+05\n      58081.474818\n      NaN\n    \n    \n      7\n      posttax_dis\n      Albania\n      2017\n      0.454116\n      2.577143\n      68.630432\n      18.078358\n      1.624807\n      15.629199\n      2.510383\n      ...\n      9978.637893\n      11909.588865\n      14669.536394\n      18131.390209\n      25050.198975\n      7.536452e+05\n      3.217940e+05\n      1.374007e+05\n      58667.844949\n      NaN\n    \n    \n      8\n      posttax_dis\n      Albania\n      2018\n      0.447469\n      2.472930\n      72.232559\n      17.850746\n      1.562374\n      15.320574\n      2.447565\n      ...\n      10459.202046\n      12392.437320\n      15164.734593\n      18848.563541\n      25599.579922\n      7.440504e+05\n      3.204498e+05\n      1.380122e+05\n      59439.508772\n      NaN\n    \n    \n      9\n      posttax_dis\n      Austria\n      2004\n      0.326530\n      1.334253\n      8.267806\n      4.805300\n      0.984396\n      3.096185\n      1.762371\n      ...\n      35286.670484\n      39035.236480\n      43363.663231\n      49921.128086\n      62188.220292\n      2.431403e+06\n      1.320109e+06\n      7.774640e+05\n      211588.042089\n      NaN\n    \n    \n      10\n      posttax_dis\n      Austria\n      2005\n      0.345903\n      1.465773\n      9.363914\n      5.291109\n      1.077410\n      3.403942\n      1.855844\n      ...\n      34716.135165\n      38197.112972\n      42718.653949\n      49946.254954\n      64427.749511\n      3.612437e+06\n      1.702892e+06\n      7.095053e+05\n      248950.528592\n      NaN\n    \n    \n      11\n      posttax_dis\n      Austria\n      2006\n      0.367595\n      1.633964\n      10.285267\n      5.700629\n      1.200512\n      3.426140\n      1.898158\n      ...\n      34663.420551\n      38676.077697\n      43407.700010\n      50532.721225\n      65796.645717\n      4.996613e+06\n      3.172447e+06\n      1.139762e+06\n      242768.542032\n      NaN\n    \n    \n      12\n      posttax_dis\n      Austria\n      2007\n      0.350346\n      1.488813\n      9.656152\n      5.438356\n      1.093214\n      3.486120\n      1.921174\n      ...\n      36767.860475\n      41341.468466\n      47024.544231\n      54943.652176\n      70637.453336\n      1.698754e+06\n      1.433770e+06\n      8.638599e+05\n      247555.469358\n      NaN\n    \n    \n      13\n      posttax_dis\n      Austria\n      2008\n      0.347730\n      1.468288\n      9.652038\n      5.304982\n      1.084155\n      3.364637\n      1.913161\n      ...\n      37081.428241\n      41027.512140\n      46463.463867\n      54460.542813\n      70942.731826\n      8.245163e+06\n      2.147393e+06\n      7.680208e+05\n      221238.961102\n      NaN\n    \n    \n      14\n      posttax_dis\n      Austria\n      2009\n      0.335487\n      1.370213\n      9.288462\n      5.154689\n      1.006250\n      3.405491\n      1.881750\n      ...\n      34889.950919\n      38569.223749\n      43501.083884\n      51367.088655\n      65654.173788\n      9.567820e+06\n      1.983310e+06\n      5.631204e+05\n      205141.575820\n      NaN\n    \n    \n      15\n      posttax_dis\n      Austria\n      2010\n      0.339232\n      1.411793\n      9.365931\n      5.190012\n      1.035216\n      3.315426\n      1.846056\n      ...\n      35778.198642\n      39896.932616\n      44373.141615\n      51523.937298\n      66048.561994\n      1.400596e+06\n      1.400468e+06\n      1.184037e+06\n      206816.527636\n      NaN\n    \n    \n      16\n      posttax_dis\n      Austria\n      2011\n      0.332465\n      1.364235\n      9.174050\n      5.098540\n      0.998278\n      3.253533\n      1.789999\n      ...\n      37501.331875\n      41360.248857\n      46049.906710\n      53181.015363\n      67127.333543\n      7.742503e+06\n      2.371002e+06\n      7.773831e+05\n      210209.431887\n      NaN\n    \n    \n      17\n      posttax_dis\n      Austria\n      2012\n      0.314739\n      1.235832\n      8.450000\n      4.772674\n      0.907687\n      3.301658\n      1.836239\n      ...\n      37611.682860\n      41727.696916\n      46606.971956\n      54286.468019\n      69064.045150\n      4.139564e+06\n      1.108600e+06\n      4.574044e+05\n      183772.599610\n      NaN\n    \n    \n      18\n      posttax_dis\n      Austria\n      2013\n      0.310547\n      1.219973\n      7.929824\n      4.594071\n      0.898906\n      3.165626\n      1.805434\n      ...\n      37121.320382\n      41132.034729\n      45785.167960\n      53036.989193\n      67020.091036\n      2.418154e+06\n      1.461007e+06\n      6.258436e+05\n      184835.958287\n      NaN\n    \n    \n      19\n      posttax_dis\n      Austria\n      2014\n      0.324911\n      1.323705\n      8.491177\n      4.828107\n      0.974350\n      3.100024\n      1.764432\n      ...\n      36268.820161\n      40043.031105\n      44370.680736\n      51127.735812\n      63993.857724\n      3.006590e+06\n      1.731662e+06\n      8.180580e+05\n      201882.465663\n      NaN\n    \n    \n      20\n      posttax_dis\n      Austria\n      2015\n      0.310730\n      1.226906\n      8.290909\n      4.648899\n      0.901780\n      3.050093\n      1.711939\n      ...\n      36770.062314\n      40566.421167\n      44807.940041\n      50986.688602\n      62948.113758\n      1.168543e+06\n      1.159790e+06\n      8.295021e+05\n      201581.461331\n      NaN\n    \n    \n      21\n      posttax_dis\n      Austria\n      2016\n      0.330063\n      1.350535\n      9.251593\n      5.032491\n      0.990116\n      3.163156\n      1.756769\n      ...\n      36751.411444\n      40493.371923\n      45240.407108\n      51834.526105\n      64563.745444\n      2.149281e+06\n      1.742189e+06\n      9.534938e+05\n      198458.606147\n      NaN\n    \n    \n      22\n      posttax_dis\n      Bosnia and Herzegovina\n      1980\n      0.323922\n      1.247872\n      11.590697\n      5.407459\n      0.899964\n      3.839829\n      1.797241\n      ...\n      1639.240511\n      1994.820908\n      2171.272102\n      2437.436675\n      2946.110056\n      1.765769e+05\n      5.606848e+04\n      1.840047e+04\n      6626.441560\n      NaN\n    \n    \n      23\n      posttax_dis\n      Bosnia and Herzegovina\n      1981\n      0.323916\n      1.247872\n      11.590697\n      5.407459\n      0.899964\n      3.839418\n      1.797382\n      ...\n      1636.711278\n      1991.845340\n      2168.147755\n      2433.865994\n      2941.795482\n      1.763219e+05\n      5.598621e+04\n      1.837309e+04\n      6616.473407\n      NaN\n    \n    \n      24\n      posttax_dis\n      Bosnia and Herzegovina\n      1982\n      0.323933\n      1.247872\n      11.590697\n      5.407459\n      0.899964\n      3.839744\n      1.797327\n      ...\n      1636.264943\n      1991.101448\n      2167.552641\n      2432.973323\n      2940.902812\n      1.762545e+05\n      5.596835e+04\n      1.836818e+04\n      6614.836844\n      NaN\n    \n    \n      25\n      posttax_dis\n      Bosnia and Herzegovina\n      1983\n      0.323813\n      1.247371\n      11.586046\n      5.406077\n      0.899603\n      3.840825\n      1.797468\n      ...\n      1633.735710\n      1989.018550\n      2164.428295\n      2429.700198\n      2936.588238\n      1.760670e+05\n      5.588861e+04\n      1.833679e+04\n      6602.934572\n      NaN\n    \n    \n      26\n      posttax_dis\n      Bosnia and Herzegovina\n      1984\n      0.332829\n      1.310010\n      11.930233\n      5.586014\n      0.944404\n      3.875636\n      1.842521\n      ...\n      1600.409346\n      1958.667755\n      2149.848011\n      2431.634317\n      2948.788067\n      1.966119e+05\n      6.113870e+04\n      1.959516e+04\n      6855.560310\n      NaN\n    \n    \n      27\n      posttax_dis\n      Bosnia and Herzegovina\n      1985\n      0.329238\n      1.283461\n      11.785047\n      5.511142\n      0.923810\n      3.874683\n      1.827472\n      ...\n      1616.031079\n      1975.926051\n      2162.940511\n      2451.273067\n      2953.251420\n      1.812664e+05\n      5.725261e+04\n      1.868121e+04\n      6684.465140\n      NaN\n    \n    \n      28\n      posttax_dis\n      Bosnia and Herzegovina\n      1986\n      0.330885\n      1.283854\n      11.850962\n      5.697540\n      0.914996\n      4.151808\n      1.839873\n      ...\n      1634.330823\n      1997.945255\n      2205.044800\n      2515.396562\n      3006.960425\n      1.246632e+05\n      4.461567e+04\n      1.642811e+04\n      6502.211589\n      NaN\n    \n    \n      29\n      posttax_dis\n      Bosnia and Herzegovina\n      1987\n      0.335034\n      1.321058\n      12.186603\n      5.715308\n      0.946840\n      4.125128\n      1.858080\n      ...\n      1610.228721\n      1968.338352\n      2168.742869\n      2466.746022\n      2991.933806\n      1.699842e+05\n      5.540225e+04\n      1.860459e+04\n      6786.973464\n      NaN\n    \n    \n      30\n      posttax_dis\n      Bosnia and Herzegovina\n      1990\n      0.320483\n      1.215903\n      11.185185\n      5.347165\n      0.873464\n      3.852868\n      1.805231\n      ...\n      1655.308579\n      2028.444829\n      2215.310511\n      2498.882158\n      2988.214346\n      1.388150e+05\n      4.702499e+04\n      1.650756e+04\n      6361.467214\n      NaN\n    \n    \n      31\n      posttax_dis\n      Bosnia and Herzegovina\n      2001\n      0.449018\n      2.542276\n      62.540001\n      18.671875\n      1.576109\n      16.790304\n      2.282341\n      ...\n      7427.315736\n      8770.933548\n      10367.177099\n      12791.223717\n      16951.663148\n      9.660877e+05\n      3.277422e+05\n      1.132455e+05\n      41170.258907\n      NaN\n    \n    \n      32\n      posttax_dis\n      Bosnia and Herzegovina\n      2004\n      0.448017\n      2.494118\n      37.857143\n      15.062112\n      1.591592\n      12.100798\n      2.491139\n      ...\n      7614.330196\n      8913.165707\n      10929.113150\n      13588.080876\n      18968.354483\n      4.784235e+05\n      2.217401e+05\n      1.015686e+05\n      45307.935241\n      NaN\n    \n    \n      33\n      posttax_dis\n      Bosnia and Herzegovina\n      2007\n      0.446135\n      2.476790\n      39.848103\n      15.405751\n      1.570858\n      12.668105\n      2.453044\n      ...\n      8546.873264\n      9964.136389\n      12123.506218\n      14997.756302\n      20965.853402\n      4.764216e+05\n      2.281581e+05\n      1.077264e+05\n      49305.611092\n      NaN\n    \n    \n      34\n      posttax_dis\n      Bosnia and Herzegovina\n      2011\n      0.445600\n      2.457562\n      36.193180\n      14.569277\n      1.572063\n      11.591341\n      2.461620\n      ...\n      8413.865367\n      9742.754116\n      11890.668008\n      14743.196444\n      20711.739880\n      7.115255e+05\n      2.922715e+05\n      1.202510e+05\n      49670.862086\n      NaN\n    \n    \n      35\n      posttax_dis\n      Bosnia and Herzegovina\n      2015\n      0.443763\n      2.420532\n      34.978024\n      14.191176\n      1.559530\n      11.082072\n      2.427410\n      ...\n      9608.407213\n      11177.870650\n      13642.682552\n      16955.828943\n      23323.544850\n      8.772548e+05\n      3.535390e+05\n      1.425581e+05\n      57563.854243\n      NaN\n    \n    \n      36\n      posttax_dis\n      Belgium\n      1985\n      0.351327\n      1.384282\n      21.644068\n      7.483577\n      0.968525\n      6.848332\n      2.068584\n      ...\n      23829.068265\n      27899.253575\n      32625.798097\n      39228.214895\n      49292.433060\n      8.818798e+05\n      4.287973e+05\n      2.084946e+05\n      101376.582380\n      NaN\n    \n    \n      37\n      posttax_dis\n      Belgium\n      1988\n      0.370274\n      1.548986\n      14.790322\n      7.517361\n      1.090369\n      6.423766\n      2.194749\n      ...\n      25194.860150\n      29659.959058\n      36011.518790\n      42503.997708\n      55296.400849\n      1.539870e+06\n      6.703277e+05\n      2.918035e+05\n      127026.357897\n      NaN\n    \n    \n      38\n      posttax_dis\n      Belgium\n      1991\n      0.368910\n      1.498574\n      23.666666\n      8.297088\n      1.042047\n      6.839683\n      2.149004\n      ...\n      28077.428760\n      32664.492048\n      39096.969197\n      49400.671544\n      60338.510227\n      1.206567e+06\n      5.705741e+05\n      2.698192e+05\n      127595.002107\n      NaN\n    \n    \n      39\n      posttax_dis\n      Belgium\n      1992\n      0.374494\n      1.542874\n      22.191668\n      8.248566\n      1.074657\n      6.738485\n      2.188536\n      ...\n      27621.990502\n      32363.829592\n      38835.131415\n      51993.558415\n      60451.716177\n      1.323129e+06\n      6.117217e+05\n      2.828170e+05\n      130754.572345\n      NaN\n    \n    \n      40\n      posttax_dis\n      Belgium\n      1993\n      0.375440\n      1.543174\n      25.931372\n      8.527668\n      1.071718\n      6.342574\n      2.209555\n      ...\n      27384.074994\n      32278.467599\n      38399.693746\n      51535.374978\n      60506.619756\n      1.171194e+06\n      5.583706e+05\n      2.662048e+05\n      126913.936284\n      NaN\n    \n    \n      41\n      posttax_dis\n      Belgium\n      1994\n      0.381199\n      1.597403\n      30.404495\n      9.146138\n      1.104039\n      7.695202\n      2.243350\n      ...\n      28217.040718\n      33113.132720\n      39294.752804\n      49518.975684\n      63300.689026\n      1.306447e+06\n      6.129441e+05\n      2.875742e+05\n      134920.838917\n      NaN\n    \n    \n      42\n      posttax_dis\n      Belgium\n      1995\n      0.373736\n      1.551127\n      22.754238\n      8.313461\n      1.078313\n      6.813639\n      2.250014\n      ...\n      28612.607931\n      33690.927526\n      39921.699385\n      49321.061355\n      64378.760013\n      1.214490e+06\n      5.827483e+05\n      2.796199e+05\n      134169.836393\n      NaN\n    \n    \n      43\n      posttax_dis\n      Belgium\n      1996\n      0.376857\n      1.576182\n      25.961538\n      8.507843\n      1.094003\n      6.346833\n      2.251962\n      ...\n      28619.144071\n      33712.888957\n      39877.253630\n      49481.196793\n      64449.219606\n      1.236080e+06\n      5.906622e+05\n      2.822487e+05\n      134872.863647\n      NaN\n    \n    \n      44\n      posttax_dis\n      Belgium\n      1997\n      0.373875\n      1.580496\n      23.817390\n      8.161290\n      1.096477\n      5.784953\n      2.153851\n      ...\n      30487.042256\n      35769.158707\n      41906.594481\n      51014.313870\n      65664.549540\n      1.641316e+06\n      7.340521e+05\n      3.282929e+05\n      146823.804081\n      NaN\n    \n    \n      45\n      posttax_dis\n      Belgium\n      1998\n      0.386830\n      1.684940\n      27.155340\n      8.959432\n      1.161545\n      6.504806\n      2.323375\n      ...\n      30387.954369\n      35771.511717\n      42407.524277\n      52293.959425\n      70602.603563\n      1.426664e+06\n      6.728934e+05\n      3.173738e+05\n      149690.947401\n      NaN\n    \n    \n      46\n      posttax_dis\n      Belgium\n      1999\n      0.383610\n      1.651079\n      26.228571\n      8.784000\n      1.138017\n      6.885853\n      2.306537\n      ...\n      31224.711055\n      36985.142255\n      43371.474253\n      53264.184096\n      72020.946016\n      1.358278e+06\n      6.517876e+05\n      3.127690e+05\n      150086.253168\n      NaN\n    \n    \n      47\n      posttax_dis\n      Belgium\n      2000\n      0.389392\n      1.697917\n      27.166666\n      9.134297\n      1.169198\n      6.751075\n      2.354764\n      ...\n      31990.877425\n      38023.473508\n      46006.192422\n      57582.742738\n      75330.978204\n      1.426642e+06\n      6.838798e+05\n      3.278268e+05\n      157148.029909\n      NaN\n    \n    \n      48\n      posttax_dis\n      Belgium\n      2001\n      0.380524\n      1.620155\n      27.724489\n      8.758064\n      1.115353\n      6.319833\n      2.237169\n      ...\n      32423.700638\n      38281.389606\n      45501.602389\n      55852.364946\n      72537.301102\n      1.423077e+06\n      6.761790e+05\n      3.212883e+05\n      152661.100292\n      NaN\n    \n    \n      49\n      posttax_dis\n      Belgium\n      2002\n      0.385071\n      1.665060\n      30.043478\n      9.045455\n      1.144988\n      6.501324\n      2.251273\n      ...\n      32086.958688\n      37881.247095\n      44751.776369\n      54902.271587\n      72236.507924\n      1.554368e+06\n      7.216963e+05\n      3.350852e+05\n      155580.794180\n      NaN\n    \n  \n\n50 rows × 57 columns\n\n\n\n\n\n\n\n\n\n\n\n\nDrop subnational, regional and historical geographical entities\n\n\n\n\n\nHere we create a list of entities in the WID data that do not correspond to countries in existence today. These we drop from the data.\n\ndrop_entities =  [\n  \"China - rural\",\n  \"China - urban\",\n  \"East Germany\",\n  \"Other Russia and Central Asia\",\n  \"Other East Asia\",\n  \"Other Western Europe\",\n  \"Other Latin America\",\n  \"Other MENA\",\n  \"Other South & South-East Asia\",\n  \"Other Sub-Saharan Africa\",\n  \"Africa\",\n  \"Asia\",\n  \"Europe\",\n  \"Oceania\",\n  \"Central Asia\",\n  \"East Africa\",\n  \"East Asia\",\n  \"South Asia\",\n  \"Eastern Europe\",\n  \"Middle Africa\",\n  \"North Africa\",\n  \"North America\",\n  \"South-East Asia\",\n  \"South Africa region\",\n  \"West Africa\",\n  \"West Asia\",\n  \"Western Europe\",\n  \"European Union\",\n  \"World\",\n  \"Asia (excluding Middle East)\",\n  \"North America and Oceania\",\n  \"Sub-Saharan Africa\",\n  \"Latin America\",\n  \"Middle East\",\n  \"MENA\",\n  \"Russia and Central Asia\",\n  \"South & South-East Asia\"\n]\n\ndf_wid = df_wid.loc[~df_wid[\"Entity\"].isin(drop_entities)]\n\n\n\n\n\n\n\n\n\n\nCalculate some additional inequality metrics\n\n\n\n\n\n\n# Gini as index\ndf_wid[\"Gini\"] = df_wid['Gini coefficient'] * 100\n\n\n\n\n\n\n\n\n\n\nRename and select needed variables\n\n\n\n\n\n\ndf_wid = df_wid.rename(columns={\n    'P90-P100 - share of the top 10%':'Top_10_share',\n    'P0-P50 - share of the bottom 50%':'Bottom_50_share',\n    'P99-P100 - share of the top 1%':'Top_1_share'\n  })\n\nkeep_cols = [\n  \"Year\",\n  \"Entity\",\n  \"Gini\",\n  \"Top_10_share\",\n  \"Bottom_50_share\",\n  \"inc_concept\"\n]\n\ndf_wid = df_wid[keep_cols]\n\n\n\n\n\n\n\n\n\n\nPivot the data wider by income concept\n\n\n\n\n\n\ndf_wid = df_wid.set_index(['Year','Entity','inc_concept']).unstack()\n\ndf_wid.columns = df_wid.columns.map(lambda x: '{}_{}'.format(x[0], x[1]))\n\ndf_wid = df_wid.reset_index()\n\ndf_wid = df_wid.sort_values(by=['Entity', 'Year'])\n\n\n\n\n\n\n\n\n\n\nSee the prepared WID data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_wid.head(100)\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini_posttax_dis\n      Gini_posttax_nat\n      Gini_pretax\n      Top_10_share_posttax_dis\n      Top_10_share_posttax_nat\n      Top_10_share_pretax\n      Bottom_50_share_posttax_dis\n      Bottom_50_share_posttax_nat\n      Bottom_50_share_pretax\n    \n  \n  \n    \n      2986\n      2008\n      Afghanistan\n      NaN\n      NaN\n      52.452389\n      NaN\n      NaN\n      41.94\n      NaN\n      NaN\n      17.16\n    \n    \n      3318\n      2012\n      Afghanistan\n      NaN\n      NaN\n      49.265584\n      NaN\n      NaN\n      38.76\n      NaN\n      NaN\n      19.00\n    \n    \n      3742\n      2017\n      Afghanistan\n      NaN\n      NaN\n      51.539312\n      NaN\n      NaN\n      41.01\n      NaN\n      NaN\n      17.79\n    \n    \n      2192\n      1996\n      Albania\n      44.367788\n      41.414440\n      46.762984\n      29.97\n      28.65\n      32.57\n      20.11\n      22.10\n      18.80\n    \n    \n      2523\n      2002\n      Albania\n      45.792148\n      42.288218\n      48.169805\n      31.13\n      29.51\n      33.64\n      19.19\n      21.54\n      17.96\n    \n    \n      2739\n      2005\n      Albania\n      45.060796\n      41.501583\n      47.448188\n      30.63\n      29.00\n      33.12\n      19.71\n      22.10\n      18.43\n    \n    \n      2987\n      2008\n      Albania\n      44.940856\n      41.277974\n      47.213163\n      30.53\n      28.86\n      33.07\n      19.77\n      22.23\n      18.59\n    \n    \n      3319\n      2012\n      Albania\n      44.804508\n      40.975732\n      46.751532\n      30.91\n      29.12\n      33.00\n      20.00\n      22.56\n      19.05\n    \n    \n      3571\n      2015\n      Albania\n      45.436682\n      41.710782\n      49.306721\n      31.79\n      30.01\n      35.23\n      19.69\n      22.17\n      17.61\n    \n    \n      3659\n      2016\n      Albania\n      46.112099\n      42.233368\n      50.504972\n      31.98\n      30.14\n      35.78\n      18.92\n      21.53\n      16.48\n    \n    \n      3743\n      2017\n      Albania\n      45.411562\n      41.619377\n      49.776038\n      31.57\n      29.77\n      35.45\n      19.43\n      21.98\n      17.06\n    \n    \n      3816\n      2018\n      Albania\n      44.746907\n      41.062778\n      49.126580\n      31.06\n      29.33\n      35.03\n      19.88\n      22.36\n      17.49\n    \n    \n      362\n      1932\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      383\n      1933\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      408\n      1934\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      435\n      1935\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      460\n      1936\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      485\n      1937\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      509\n      1938\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      534\n      1939\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      557\n      1940\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      576\n      1941\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      668\n      1946\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      688\n      1947\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      711\n      1948\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      737\n      1949\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      764\n      1950\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      790\n      1951\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      817\n      1952\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      845\n      1953\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      875\n      1954\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      904\n      1955\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      960\n      1957\n      Algeria\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1824\n      1988\n      Algeria\n      NaN\n      NaN\n      60.861157\n      NaN\n      NaN\n      51.09\n      NaN\n      NaN\n      13.27\n    \n    \n      2138\n      1995\n      Algeria\n      NaN\n      NaN\n      54.793733\n      NaN\n      NaN\n      42.81\n      NaN\n      NaN\n      15.34\n    \n    \n      3234\n      2011\n      Algeria\n      NaN\n      NaN\n      48.798551\n      NaN\n      NaN\n      38.08\n      NaN\n      NaN\n      19.02\n    \n    \n      2139\n      1995\n      Angola\n      NaN\n      NaN\n      68.246577\n      NaN\n      NaN\n      58.03\n      NaN\n      NaN\n      9.15\n    \n    \n      2405\n      2000\n      Angola\n      NaN\n      NaN\n      68.246581\n      NaN\n      NaN\n      58.03\n      NaN\n      NaN\n      9.15\n    \n    \n      2988\n      2008\n      Angola\n      NaN\n      NaN\n      60.936785\n      NaN\n      NaN\n      49.32\n      NaN\n      NaN\n      12.23\n    \n    \n      3817\n      2018\n      Angola\n      NaN\n      NaN\n      68.559672\n      NaN\n      NaN\n      58.01\n      NaN\n      NaN\n      9.04\n    \n    \n      363\n      1932\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      384\n      1933\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      409\n      1934\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      436\n      1935\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      461\n      1936\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      486\n      1937\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      510\n      1938\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      535\n      1939\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      558\n      1940\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      577\n      1941\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      595\n      1942\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      610\n      1943\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      629\n      1944\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      646\n      1945\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      669\n      1946\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      689\n      1947\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      712\n      1948\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      738\n      1949\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      765\n      1950\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      791\n      1951\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      818\n      1952\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      846\n      1953\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      876\n      1954\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      933\n      1956\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      991\n      1958\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1020\n      1959\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      1069\n      1961\n      Argentina\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      2463\n      2001\n      Argentina\n      NaN\n      61.275055\n      66.088806\n      NaN\n      47.46\n      50.54\n      NaN\n      10.86\n      7.85\n    \n    \n      2524\n      2002\n      Argentina\n      NaN\n      62.559468\n      66.674702\n      NaN\n      49.18\n      51.58\n      NaN\n      10.41\n      7.79\n    \n    \n      2593\n      2003\n      Argentina\n      NaN\n      58.788309\n      61.895195\n      NaN\n      45.85\n      47.99\n      NaN\n      12.71\n      10.96\n    \n    \n      2665\n      2004\n      Argentina\n      NaN\n      57.168198\n      60.244077\n      NaN\n      44.27\n      46.24\n      NaN\n      13.55\n      11.78\n    \n    \n      2740\n      2005\n      Argentina\n      NaN\n      56.009221\n      59.255115\n      NaN\n      42.66\n      44.64\n      NaN\n      14.02\n      12.09\n    \n    \n      2822\n      2006\n      Argentina\n      NaN\n      54.506041\n      57.935620\n      NaN\n      41.33\n      43.49\n      NaN\n      14.76\n      12.73\n    \n    \n      2903\n      2007\n      Argentina\n      NaN\n      55.349858\n      58.750425\n      NaN\n      43.11\n      45.31\n      NaN\n      14.85\n      12.86\n    \n    \n      2989\n      2008\n      Argentina\n      NaN\n      55.500095\n      58.648372\n      NaN\n      43.94\n      45.44\n      NaN\n      15.01\n      13.06\n    \n    \n      3064\n      2009\n      Argentina\n      NaN\n      52.588365\n      56.898668\n      NaN\n      39.82\n      42.39\n      NaN\n      15.78\n      13.22\n    \n    \n      3147\n      2010\n      Argentina\n      NaN\n      52.869671\n      57.094291\n      NaN\n      41.21\n      43.63\n      NaN\n      16.21\n      13.64\n    \n    \n      3235\n      2011\n      Argentina\n      NaN\n      50.721697\n      55.481900\n      NaN\n      39.26\n      42.05\n      NaN\n      17.36\n      14.43\n    \n    \n      3320\n      2012\n      Argentina\n      NaN\n      48.685044\n      53.666061\n      NaN\n      36.11\n      39.05\n      NaN\n      18.00\n      14.95\n    \n    \n      3407\n      2013\n      Argentina\n      NaN\n      48.957375\n      54.173771\n      NaN\n      36.77\n      40.13\n      NaN\n      17.97\n      14.87\n    \n    \n      3487\n      2014\n      Argentina\n      NaN\n      50.984577\n      55.939785\n      NaN\n      38.30\n      41.35\n      NaN\n      16.80\n      13.83\n    \n    \n      3572\n      2015\n      Argentina\n      NaN\n      51.498334\n      56.288187\n      NaN\n      39.82\n      43.24\n      NaN\n      16.90\n      14.45\n    \n    \n      3660\n      2016\n      Argentina\n      NaN\n      52.012087\n      56.671475\n      NaN\n      41.34\n      45.29\n      NaN\n      17.01\n      15.13\n    \n    \n      3744\n      2017\n      Argentina\n      NaN\n      52.525841\n      58.135411\n      NaN\n      42.86\n      46.41\n      NaN\n      17.12\n      13.76\n    \n    \n      3818\n      2018\n      Argentina\n      NaN\n      53.612730\n      58.662965\n      NaN\n      43.86\n      46.85\n      NaN\n      16.53\n      13.46\n    \n    \n      2193\n      1996\n      Armenia\n      NaN\n      NaN\n      58.842226\n      NaN\n      NaN\n      46.77\n      NaN\n      NaN\n      13.48\n    \n    \n      2352\n      1999\n      Armenia\n      NaN\n      NaN\n      55.291180\n      NaN\n      NaN\n      44.17\n      NaN\n      NaN\n      15.68\n    \n    \n      2525\n      2002\n      Armenia\n      NaN\n      NaN\n      53.526514\n      NaN\n      NaN\n      42.91\n      NaN\n      NaN\n      16.84\n    \n    \n      2594\n      2003\n      Armenia\n      NaN\n      NaN\n      52.679758\n      NaN\n      NaN\n      42.55\n      NaN\n      NaN\n      17.53\n    \n    \n      2666\n      2004\n      Armenia\n      NaN\n      NaN\n      55.557885\n      NaN\n      NaN\n      45.67\n      NaN\n      NaN\n      16.14\n    \n    \n      2741\n      2005\n      Armenia\n      NaN\n      NaN\n      54.878909\n      NaN\n      NaN\n      45.00\n      NaN\n      NaN\n      16.48\n    \n    \n      2823\n      2006\n      Armenia\n      NaN\n      NaN\n      48.488536\n      NaN\n      NaN\n      37.77\n      NaN\n      NaN\n      19.32\n    \n    \n      2904\n      2007\n      Armenia\n      NaN\n      NaN\n      49.655285\n      NaN\n      NaN\n      38.41\n      NaN\n      NaN\n      18.56\n    \n    \n      2990\n      2008\n      Armenia\n      NaN\n      NaN\n      48.113928\n      NaN\n      NaN\n      36.96\n      NaN\n      NaN\n      19.33\n    \n    \n      3065\n      2009\n      Armenia\n      NaN\n      NaN\n      47.468036\n      NaN\n      NaN\n      36.37\n      NaN\n      NaN\n      19.74\n    \n    \n      3148\n      2010\n      Armenia\n      NaN\n      NaN\n      49.801407\n      NaN\n      NaN\n      39.12\n      NaN\n      NaN\n      18.78\n    \n    \n      3236\n      2011\n      Armenia\n      NaN\n      NaN\n      48.204984\n      NaN\n      NaN\n      37.29\n      NaN\n      NaN\n      19.48\n    \n    \n      3321\n      2012\n      Armenia\n      NaN\n      NaN\n      48.179293\n      NaN\n      NaN\n      37.70\n      NaN\n      NaN\n      19.63\n    \n    \n      3408\n      2013\n      Armenia\n      NaN\n      NaN\n      48.938826\n      NaN\n      NaN\n      37.99\n      NaN\n      NaN\n      19.06\n    \n    \n      3488\n      2014\n      Armenia\n      NaN\n      NaN\n      49.911902\n      NaN\n      NaN\n      39.16\n      NaN\n      NaN\n      18.57\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave the data\n\n\n\n\n\nI save the prepared data locally:\n\ndf_wid.to_csv(\"data/clean/wid.csv\", index=False)"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_D_prepare_population.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_D_prepare_population.html",
    "title": "Appendix 1.D: Preparing population data",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nfrom owid import catalog\nimport pandas as pd\n\n\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad population data from Our World in Data\n\n\n\n\n\nI grab the main population series prepared by Our World in Data.\n\nresults = catalog.find('population')\nowid_pop = results[results['path'] == 'garden/owid/latest/key_indicators/population']\n\ndf_pop = owid_pop.iloc[0].load().reset_index().rename(columns={'year':'Year', 'country': 'Entity'})\n\ndf_pop.head()\n\n\n\n\n\n  \n    \n      \n      Entity\n      Year\n      population\n      world_pop_share\n    \n  \n  \n    \n      0\n      Afghanistan\n      -10000\n      14737\n      0.33\n    \n    \n      1\n      Afghanistan\n      -9000\n      20405\n      0.36\n    \n    \n      2\n      Afghanistan\n      -8000\n      28253\n      0.39\n    \n    \n      3\n      Afghanistan\n      -7000\n      39120\n      0.41\n    \n    \n      4\n      Afghanistan\n      -6000\n      54166\n      0.41\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nCheck there is population data for each country in WID, PIP, and LIS.\n\n\n\n\n\nAll countries in the PIP data are matched:\n\ndf_pip = pd.read_csv(\"data/clean/pip.csv\")\n\ncheck_pip = pd.merge(df_pip, df_pop, how = 'left')\ncheck_pip[check_pip['population'].isna()]\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini\n      Top_10_share\n      Bottom_50_share\n      MLD\n      welfare_type\n      population\n      world_pop_share\n    \n  \n  \n  \n\n\n\n\nThere is no population data for Zanzibar, present in the WID data.\n\ndf_wid = pd.read_csv(\"data/clean/wid.csv\")\n\ncheck_wid = pd.merge(df_wid, df_pop, how = 'left')\ncheck_wid[check_wid['population'].isna()]\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini_posttax_dis\n      Gini_posttax_nat\n      Gini_pretax\n      Top_10_share_posttax_dis\n      Top_10_share_posttax_nat\n      Top_10_share_pretax\n      Bottom_50_share_posttax_dis\n      Bottom_50_share_posttax_nat\n      Bottom_50_share_pretax\n      population\n      world_pop_share\n    \n  \n  \n    \n      3815\n      1957\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3816\n      1958\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3817\n      1959\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3818\n      1960\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3819\n      1961\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3820\n      1962\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n    \n      3821\n      1963\n      Zanzibar\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n      NaN\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nAdd in Zanzibar population\n\n\n\n\n\nWID release their own population data, but this currently insn’t gathered in our data pipeline. For now I make up a population series for Zanzibar based on two data points from Wikipedia. At some point I will come back and replaces this with the WID population data.\n\nzanz_pop_1978 = 476111\nzanz_pop_2022 = 1889773\n\n# Assume a constant growth rate\nzanz_g = pow(zanz_pop_2022/zanz_pop_1978, 1/(2022-1978))-1\n\nyear = 2022\npop = zanz_pop_1978 * pow(1+zanz_g, year - 1978)\n\ndf_zanz_pop = df_wid[df_wid['Entity'] == \"Zanzibar\"].copy()\ndf_zanz_pop['population'] = zanz_pop_1978 * pow(1+zanz_g, df_zanz_pop['Year'] - 1978)\n\ndf_zanz_pop = df_zanz_pop[['Entity', 'Year', 'population']]\n\ndf_pop = pd.concat([df_pop, df_zanz_pop])\n\n\n\n\n\n\n\n\n\n\nSee the prepared data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_pop.head(100)\n\n\n\n\n\n  \n    \n      \n      Entity\n      Year\n      population\n      world_pop_share\n    \n  \n  \n    \n      0\n      Afghanistan\n      -10000\n      14737.0\n      0.33\n    \n    \n      1\n      Afghanistan\n      -9000\n      20405.0\n      0.36\n    \n    \n      2\n      Afghanistan\n      -8000\n      28253.0\n      0.39\n    \n    \n      3\n      Afghanistan\n      -7000\n      39120.0\n      0.41\n    \n    \n      4\n      Afghanistan\n      -6000\n      54166.0\n      0.41\n    \n    \n      5\n      Afghanistan\n      -5000\n      74999.0\n      0.39\n    \n    \n      6\n      Afghanistan\n      -4000\n      306250.0\n      1.06\n    \n    \n      7\n      Afghanistan\n      -3000\n      537500.0\n      1.21\n    \n    \n      8\n      Afghanistan\n      -2000\n      768751.0\n      1.06\n    \n    \n      9\n      Afghanistan\n      -1000\n      999998.0\n      0.91\n    \n    \n      10\n      Afghanistan\n      0\n      1999997.0\n      0.86\n    \n    \n      11\n      Afghanistan\n      100\n      2250002.0\n      0.95\n    \n    \n      12\n      Afghanistan\n      200\n      2500001.0\n      1.04\n    \n    \n      13\n      Afghanistan\n      300\n      2500001.0\n      1.10\n    \n    \n      14\n      Afghanistan\n      400\n      2500001.0\n      1.04\n    \n    \n      15\n      Afghanistan\n      500\n      2500001.0\n      0.99\n    \n    \n      16\n      Afghanistan\n      600\n      2500001.0\n      0.92\n    \n    \n      17\n      Afghanistan\n      700\n      2425001.0\n      0.87\n    \n    \n      18\n      Afghanistan\n      800\n      2350008.0\n      0.82\n    \n    \n      19\n      Afghanistan\n      900\n      2299999.0\n      0.74\n    \n    \n      20\n      Afghanistan\n      1000\n      2250002.0\n      0.70\n    \n    \n      21\n      Afghanistan\n      1100\n      2375009.0\n      0.60\n    \n    \n      22\n      Afghanistan\n      1200\n      2500001.0\n      0.56\n    \n    \n      23\n      Afghanistan\n      1300\n      1749998.0\n      0.38\n    \n    \n      24\n      Afghanistan\n      1400\n      1874998.0\n      0.42\n    \n    \n      25\n      Afghanistan\n      1500\n      1999997.0\n      0.40\n    \n    \n      26\n      Afghanistan\n      1600\n      2500001.0\n      0.48\n    \n    \n      27\n      Afghanistan\n      1700\n      2500001.0\n      0.42\n    \n    \n      28\n      Afghanistan\n      1710\n      2561614.0\n      0.42\n    \n    \n      29\n      Afghanistan\n      1720\n      2619846.0\n      0.41\n    \n    \n      30\n      Afghanistan\n      1730\n      2679387.0\n      0.40\n    \n    \n      31\n      Afghanistan\n      1740\n      2740283.0\n      0.39\n    \n    \n      32\n      Afghanistan\n      1750\n      2802568.0\n      0.38\n    \n    \n      33\n      Afghanistan\n      1760\n      2866257.0\n      0.37\n    \n    \n      34\n      Afghanistan\n      1770\n      2931400.0\n      0.36\n    \n    \n      35\n      Afghanistan\n      1780\n      2998015.0\n      0.34\n    \n    \n      36\n      Afghanistan\n      1790\n      3066156.0\n      0.33\n    \n    \n      37\n      Afghanistan\n      1800\n      3280000.0\n      0.33\n    \n    \n      38\n      Afghanistan\n      1801\n      3280000.0\n      0.33\n    \n    \n      39\n      Afghanistan\n      1802\n      3280000.0\n      0.33\n    \n    \n      40\n      Afghanistan\n      1803\n      3280000.0\n      0.33\n    \n    \n      41\n      Afghanistan\n      1804\n      3280000.0\n      0.33\n    \n    \n      42\n      Afghanistan\n      1805\n      3280000.0\n      0.33\n    \n    \n      43\n      Afghanistan\n      1806\n      3280000.0\n      0.33\n    \n    \n      44\n      Afghanistan\n      1807\n      3280000.0\n      0.33\n    \n    \n      45\n      Afghanistan\n      1808\n      3280000.0\n      0.32\n    \n    \n      46\n      Afghanistan\n      1809\n      3280000.0\n      0.32\n    \n    \n      47\n      Afghanistan\n      1810\n      3280000.0\n      0.32\n    \n    \n      48\n      Afghanistan\n      1811\n      3280000.0\n      0.32\n    \n    \n      49\n      Afghanistan\n      1812\n      3280000.0\n      0.32\n    \n    \n      50\n      Afghanistan\n      1813\n      3280000.0\n      0.32\n    \n    \n      51\n      Afghanistan\n      1814\n      3280000.0\n      0.31\n    \n    \n      52\n      Afghanistan\n      1815\n      3280000.0\n      0.31\n    \n    \n      53\n      Afghanistan\n      1816\n      3280000.0\n      0.31\n    \n    \n      54\n      Afghanistan\n      1817\n      3280000.0\n      0.31\n    \n    \n      55\n      Afghanistan\n      1818\n      3280000.0\n      0.30\n    \n    \n      56\n      Afghanistan\n      1819\n      3282935.0\n      0.30\n    \n    \n      57\n      Afghanistan\n      1820\n      3288817.0\n      0.30\n    \n    \n      58\n      Afghanistan\n      1821\n      3297661.0\n      0.30\n    \n    \n      59\n      Afghanistan\n      1822\n      3309479.0\n      0.30\n    \n    \n      60\n      Afghanistan\n      1823\n      3324285.0\n      0.30\n    \n    \n      61\n      Afghanistan\n      1824\n      3339157.0\n      0.30\n    \n    \n      62\n      Afghanistan\n      1825\n      3354095.0\n      0.30\n    \n    \n      63\n      Afghanistan\n      1826\n      3369101.0\n      0.30\n    \n    \n      64\n      Afghanistan\n      1827\n      3384173.0\n      0.30\n    \n    \n      65\n      Afghanistan\n      1828\n      3399313.0\n      0.30\n    \n    \n      66\n      Afghanistan\n      1829\n      3414520.0\n      0.29\n    \n    \n      67\n      Afghanistan\n      1830\n      3429796.0\n      0.29\n    \n    \n      68\n      Afghanistan\n      1831\n      3445140.0\n      0.29\n    \n    \n      69\n      Afghanistan\n      1832\n      3460553.0\n      0.29\n    \n    \n      70\n      Afghanistan\n      1833\n      3476034.0\n      0.29\n    \n    \n      71\n      Afghanistan\n      1834\n      3491585.0\n      0.29\n    \n    \n      72\n      Afghanistan\n      1835\n      3507205.0\n      0.29\n    \n    \n      73\n      Afghanistan\n      1836\n      3522896.0\n      0.29\n    \n    \n      74\n      Afghanistan\n      1837\n      3538656.0\n      0.29\n    \n    \n      75\n      Afghanistan\n      1838\n      3554487.0\n      0.29\n    \n    \n      76\n      Afghanistan\n      1839\n      3570389.0\n      0.29\n    \n    \n      77\n      Afghanistan\n      1840\n      3586362.0\n      0.29\n    \n    \n      78\n      Afghanistan\n      1841\n      3602406.0\n      0.29\n    \n    \n      79\n      Afghanistan\n      1842\n      3618522.0\n      0.29\n    \n    \n      80\n      Afghanistan\n      1843\n      3634711.0\n      0.29\n    \n    \n      81\n      Afghanistan\n      1844\n      3650971.0\n      0.29\n    \n    \n      82\n      Afghanistan\n      1845\n      3667305.0\n      0.29\n    \n    \n      83\n      Afghanistan\n      1846\n      3683711.0\n      0.29\n    \n    \n      84\n      Afghanistan\n      1847\n      3700191.0\n      0.29\n    \n    \n      85\n      Afghanistan\n      1848\n      3716745.0\n      0.29\n    \n    \n      86\n      Afghanistan\n      1849\n      3734342.0\n      0.29\n    \n    \n      87\n      Afghanistan\n      1850\n      3752993.0\n      0.29\n    \n    \n      88\n      Afghanistan\n      1851\n      3769828.0\n      0.29\n    \n    \n      89\n      Afghanistan\n      1852\n      3787706.0\n      0.30\n    \n    \n      90\n      Afghanistan\n      1853\n      3806634.0\n      0.30\n    \n    \n      91\n      Afghanistan\n      1854\n      3825655.0\n      0.30\n    \n    \n      92\n      Afghanistan\n      1855\n      3844769.0\n      0.30\n    \n    \n      93\n      Afghanistan\n      1856\n      3863976.0\n      0.30\n    \n    \n      94\n      Afghanistan\n      1857\n      3883276.0\n      0.30\n    \n    \n      95\n      Afghanistan\n      1858\n      3902671.0\n      0.30\n    \n    \n      96\n      Afghanistan\n      1859\n      3922160.0\n      0.30\n    \n    \n      97\n      Afghanistan\n      1860\n      3941745.0\n      0.30\n    \n    \n      98\n      Afghanistan\n      1861\n      3961424.0\n      0.30\n    \n    \n      99\n      Afghanistan\n      1862\n      3981200.0\n      0.30\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave\n\n\n\n\n\n\ndf_pop.to_csv('data/clean/population.csv')"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_E_prepare_region_classifications.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_E_prepare_region_classifications.html",
    "title": "Appendix 1.E: Preparing region classifications",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nimport pandas as pd\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad WID region classifications\n\n\n\n\n\nFor regional classifications I take WID definitions, as specified on their website here.\nI read in a csv prepared from the table in that webpage, which has been mapped to the Our World in Data standarized country names used throughout this project.\n\ndf_regions = pd.read_csv(\"data/original/WID_regions_country_standardized.csv\")\n\n\n\n\n\n\n\n\n\n\nDefine two region classifications\n\n\n\n\n\nI create a clean region mapping table using two regional definitions.\nOne is the ‘standard’ definitions used by WID.\nIn an alternative set I split Western and Eastern Europe, ccombining the latter with Russia & Central Asia to make a joint Eastern Europe and Central Asia region.\n\ndf_regions = df_regions[['Our World In Data Name', 'region (standard)', 'sub-region']].rename(columns={'Our World In Data Name': 'Entity', 'region (standard)': 'WID_region'})\n\n# Define an alt region classification\ndf_regions['region_alt'] = df_regions['WID_region']\n\ndf_regions.loc[df_regions['sub-region'] == 'Western Europe','region_alt'] = 'Western Europe'\n\ndf_regions.loc[(df_regions['sub-region'] == 'Eastern Europe') | (df_regions['WID_region'] == 'Russia & Central Asia'),'region_alt'] = 'Eastern Europe & Central Asia'\n\n\ndf_regions = df_regions[[\"Entity\", \"WID_region\", \"region_alt\"]]\n\n\n\n\n\n\n\n\n\n\nSee the prepared data\n\n\n\n\n\n\ndf_regions\n\n\n\n\n\n  \n    \n      \n      Entity\n      WID_region\n      region_alt\n    \n  \n  \n    \n      0\n      Andorra\n      Europe\n      Western Europe\n    \n    \n      1\n      United Arab Emirates\n      MENA\n      MENA\n    \n    \n      2\n      Afghanistan\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      3\n      Antigua and Barbuda\n      Latin America\n      Latin America\n    \n    \n      4\n      Anguilla\n      Latin America\n      Latin America\n    \n    \n      5\n      Albania\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      6\n      Armenia\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      7\n      Netherlands Antilles\n      Latin America\n      Latin America\n    \n    \n      8\n      Angola\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      9\n      Argentina\n      Latin America\n      Latin America\n    \n    \n      10\n      American Samoa\n      North America & Oceania\n      North America & Oceania\n    \n    \n      11\n      Austria\n      Europe\n      Western Europe\n    \n    \n      12\n      Australia\n      North America & Oceania\n      North America & Oceania\n    \n    \n      13\n      Aruba\n      Latin America\n      Latin America\n    \n    \n      14\n      Azerbaijan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      15\n      Bosnia and Herzegovina\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      16\n      Barbados\n      Latin America\n      Latin America\n    \n    \n      17\n      Bangladesh\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      18\n      Belgium\n      Europe\n      Western Europe\n    \n    \n      19\n      Burkina Faso\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      20\n      Bulgaria\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      21\n      Bahrain\n      MENA\n      MENA\n    \n    \n      22\n      Burundi\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      23\n      Benin\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      24\n      Bermuda\n      North America & Oceania\n      North America & Oceania\n    \n    \n      25\n      Brunei\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      26\n      Bolivia\n      Latin America\n      Latin America\n    \n    \n      27\n      Brazil\n      Latin America\n      Latin America\n    \n    \n      28\n      Bahamas\n      Latin America\n      Latin America\n    \n    \n      29\n      Bhutan\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      30\n      Botswana\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      31\n      Belarus\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      32\n      Belize\n      Latin America\n      Latin America\n    \n    \n      33\n      Canada\n      North America & Oceania\n      North America & Oceania\n    \n    \n      34\n      Democratic Republic of Congo\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      35\n      Central African Republic\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      36\n      Congo\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      37\n      Switzerland\n      Europe\n      Western Europe\n    \n    \n      38\n      Cote d'Ivoire\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      39\n      Cook Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      40\n      Chile\n      Latin America\n      Latin America\n    \n    \n      41\n      Cameroon\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      42\n      China\n      East Asia\n      East Asia\n    \n    \n      43\n      Colombia\n      Latin America\n      Latin America\n    \n    \n      44\n      Costa Rica\n      Latin America\n      Latin America\n    \n    \n      45\n      Czechoslovakia\n      NaN\n      Eastern Europe & Central Asia\n    \n    \n      46\n      Cuba\n      Latin America\n      Latin America\n    \n    \n      47\n      Cape Verde\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      48\n      Curacao\n      Latin America\n      Latin America\n    \n    \n      49\n      Cyprus\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      50\n      Czechia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      51\n      East Germany\n      Europe\n      Western Europe\n    \n    \n      52\n      Germany\n      Europe\n      Western Europe\n    \n    \n      53\n      Djibouti\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      54\n      Denmark\n      Europe\n      Western Europe\n    \n    \n      55\n      Dominica\n      Latin America\n      Latin America\n    \n    \n      56\n      Dominican Republic\n      Latin America\n      Latin America\n    \n    \n      57\n      Algeria\n      MENA\n      MENA\n    \n    \n      58\n      Ecuador\n      Latin America\n      Latin America\n    \n    \n      59\n      Estonia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      60\n      Egypt\n      MENA\n      MENA\n    \n    \n      61\n      Western Sahara\n      MENA\n      MENA\n    \n    \n      62\n      Eritrea\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      63\n      Spain\n      Europe\n      Western Europe\n    \n    \n      64\n      Ethiopia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      65\n      Finland\n      Europe\n      Western Europe\n    \n    \n      66\n      Fiji\n      North America & Oceania\n      North America & Oceania\n    \n    \n      67\n      Falkland Islands\n      Latin America\n      Latin America\n    \n    \n      68\n      Micronesia (country)\n      North America & Oceania\n      North America & Oceania\n    \n    \n      69\n      Faeroe Islands\n      Europe\n      Western Europe\n    \n    \n      70\n      France\n      Europe\n      Western Europe\n    \n    \n      71\n      Gabon\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      72\n      United Kingdom\n      Europe\n      Western Europe\n    \n    \n      73\n      Grenada\n      Latin America\n      Latin America\n    \n    \n      74\n      Georgia\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      75\n      Ghana\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      76\n      Gibraltar\n      Europe\n      Western Europe\n    \n    \n      77\n      Greenland\n      North America & Oceania\n      North America & Oceania\n    \n    \n      78\n      Gambia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      79\n      Guinea\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      80\n      Equatorial Guinea\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      81\n      Greece\n      Europe\n      Western Europe\n    \n    \n      82\n      Guatemala\n      Latin America\n      Latin America\n    \n    \n      83\n      Guam\n      North America & Oceania\n      North America & Oceania\n    \n    \n      84\n      Guinea-Bissau\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      85\n      Guyana\n      Latin America\n      Latin America\n    \n    \n      86\n      Hong Kong\n      East Asia\n      East Asia\n    \n    \n      87\n      Honduras\n      Latin America\n      Latin America\n    \n    \n      88\n      Croatia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      89\n      Haiti\n      Latin America\n      Latin America\n    \n    \n      90\n      Hungary\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      91\n      Indonesia\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      92\n      Ireland\n      Europe\n      Western Europe\n    \n    \n      93\n      Israel\n      MENA\n      MENA\n    \n    \n      94\n      Isle of Man\n      Europe\n      Western Europe\n    \n    \n      95\n      India\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      96\n      Iraq\n      MENA\n      MENA\n    \n    \n      97\n      Iran\n      MENA\n      MENA\n    \n    \n      98\n      Iceland\n      Europe\n      Western Europe\n    \n    \n      99\n      Italy\n      Europe\n      Western Europe\n    \n    \n      100\n      Jamaica\n      Latin America\n      Latin America\n    \n    \n      101\n      Jordan\n      MENA\n      MENA\n    \n    \n      102\n      Japan\n      East Asia\n      East Asia\n    \n    \n      103\n      Kenya\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      104\n      Kyrgyzstan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      105\n      Cambodia\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      106\n      Kiribati\n      North America & Oceania\n      North America & Oceania\n    \n    \n      107\n      Comoros\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      108\n      Saint Kitts and Nevis\n      Latin America\n      Latin America\n    \n    \n      109\n      North Korea\n      East Asia\n      East Asia\n    \n    \n      110\n      South Korea\n      East Asia\n      East Asia\n    \n    \n      111\n      Kosovo\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      112\n      Kuwait\n      MENA\n      MENA\n    \n    \n      113\n      Cayman Islands\n      Latin America\n      Latin America\n    \n    \n      114\n      Kazakhstan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      115\n      Laos\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      116\n      Lebanon\n      MENA\n      MENA\n    \n    \n      117\n      Saint Lucia\n      Latin America\n      Latin America\n    \n    \n      118\n      Liechtenstein\n      Europe\n      Western Europe\n    \n    \n      119\n      Sri Lanka\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      120\n      Liberia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      121\n      Lesotho\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      122\n      Lithuania\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      123\n      Luxembourg\n      Europe\n      Western Europe\n    \n    \n      124\n      Latvia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      125\n      Libya\n      MENA\n      MENA\n    \n    \n      126\n      Morocco\n      MENA\n      MENA\n    \n    \n      127\n      Monaco\n      Europe\n      Western Europe\n    \n    \n      128\n      Moldova\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      129\n      Montenegro\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      130\n      Madagascar\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      131\n      Marshall Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      132\n      North Macedonia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      133\n      Mali\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      134\n      Myanmar\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      135\n      Mongolia\n      East Asia\n      East Asia\n    \n    \n      136\n      Macao\n      East Asia\n      East Asia\n    \n    \n      137\n      Northern Mariana Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      138\n      Mauritania\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      139\n      Montserrat\n      Europe\n      Europe\n    \n    \n      140\n      Malta\n      Europe\n      Western Europe\n    \n    \n      141\n      Mauritius\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      142\n      Maldives\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      143\n      Malawi\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      144\n      Mexico\n      Latin America\n      Latin America\n    \n    \n      145\n      Malaysia\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      146\n      Mozambique\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      147\n      Namibia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      148\n      New Caledonia\n      North America & Oceania\n      North America & Oceania\n    \n    \n      149\n      Niger\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      150\n      Nigeria\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      151\n      Nicaragua\n      Latin America\n      Latin America\n    \n    \n      152\n      Netherlands\n      Europe\n      Western Europe\n    \n    \n      153\n      Norway\n      Europe\n      Western Europe\n    \n    \n      154\n      Nepal\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      155\n      Nauru\n      North America & Oceania\n      North America & Oceania\n    \n    \n      156\n      Niue\n      North America & Oceania\n      North America & Oceania\n    \n    \n      157\n      New Zealand\n      North America & Oceania\n      North America & Oceania\n    \n    \n      158\n      Oman\n      MENA\n      MENA\n    \n    \n      159\n      Panama\n      Latin America\n      Latin America\n    \n    \n      160\n      Peru\n      Latin America\n      Latin America\n    \n    \n      161\n      French Polynesia\n      North America & Oceania\n      North America & Oceania\n    \n    \n      162\n      Papua New Guinea\n      North America & Oceania\n      North America & Oceania\n    \n    \n      163\n      Philippines\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      164\n      Pakistan\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      165\n      Poland\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      166\n      Saint Pierre and Miquelon\n      North America & Oceania\n      North America & Oceania\n    \n    \n      167\n      Puerto Rico\n      Latin America\n      Latin America\n    \n    \n      168\n      Palestine\n      MENA\n      MENA\n    \n    \n      169\n      Portugal\n      Europe\n      Western Europe\n    \n    \n      170\n      Palau\n      North America & Oceania\n      North America & Oceania\n    \n    \n      171\n      Paraguay\n      Latin America\n      Latin America\n    \n    \n      172\n      Qatar\n      MENA\n      MENA\n    \n    \n      173\n      Romania\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      174\n      Serbia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      175\n      Russia\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      176\n      Rwanda\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      177\n      Saudi Arabia\n      MENA\n      MENA\n    \n    \n      178\n      Solomon Islands\n      North America & Oceania\n      North America & Oceania\n    \n    \n      179\n      Seychelles\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      180\n      Sudan\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      181\n      Sweden\n      Europe\n      Western Europe\n    \n    \n      182\n      Singapore\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      183\n      Saint Helena\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      184\n      Slovenia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      185\n      Slovakia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      186\n      Sierra Leone\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      187\n      San Marino\n      Europe\n      Western Europe\n    \n    \n      188\n      Senegal\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      189\n      Somalia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      190\n      Suriname\n      Latin America\n      Latin America\n    \n    \n      191\n      South Sudan\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      192\n      Sao Tome and Principe\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      193\n      USSR\n      NaN\n      NaN\n    \n    \n      194\n      El Salvador\n      Latin America\n      Latin America\n    \n    \n      195\n      Sint Maarten (Dutch part)\n      Latin America\n      Latin America\n    \n    \n      196\n      Syria\n      MENA\n      MENA\n    \n    \n      197\n      Eswatini\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      198\n      Turks and Caicos Islands\n      Latin America\n      Latin America\n    \n    \n      199\n      Chad\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      200\n      Togo\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      201\n      Thailand\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      202\n      Tajikistan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      203\n      Tokelau\n      North America & Oceania\n      North America & Oceania\n    \n    \n      204\n      Timor\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      205\n      Turkmenistan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      206\n      Tunisia\n      MENA\n      MENA\n    \n    \n      207\n      Tonga\n      North America & Oceania\n      North America & Oceania\n    \n    \n      208\n      Turkey\n      MENA\n      MENA\n    \n    \n      209\n      Trinidad and Tobago\n      Latin America\n      Latin America\n    \n    \n      210\n      Tuvalu\n      North America & Oceania\n      North America & Oceania\n    \n    \n      211\n      Taiwan\n      East Asia\n      East Asia\n    \n    \n      212\n      Tanzania\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      213\n      Ukraine\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      214\n      Uganda\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      215\n      United States\n      North America & Oceania\n      North America & Oceania\n    \n    \n      216\n      Uruguay\n      Latin America\n      Latin America\n    \n    \n      217\n      Uzbekistan\n      Russia & Central Asia\n      Eastern Europe & Central Asia\n    \n    \n      218\n      Vatican\n      Europe\n      Western Europe\n    \n    \n      219\n      Saint Vincent and the Grenadines\n      Latin America\n      Latin America\n    \n    \n      220\n      Venezuela\n      Latin America\n      Latin America\n    \n    \n      221\n      British Virgin Islands\n      Latin America\n      Latin America\n    \n    \n      222\n      United States Virgin Islands\n      Latin America\n      Latin America\n    \n    \n      223\n      Vietnam\n      South & South-East Asia\n      South & South-East Asia\n    \n    \n      224\n      Vanuatu\n      North America & Oceania\n      North America & Oceania\n    \n    \n      225\n      Wallis and Futuna\n      North America & Oceania\n      North America & Oceania\n    \n    \n      226\n      Samoa\n      North America & Oceania\n      North America & Oceania\n    \n    \n      227\n      Channel Islands\n      Europe\n      Western Europe\n    \n    \n      228\n      Yemen\n      MENA\n      MENA\n    \n    \n      229\n      Yugoslavia\n      Europe\n      Eastern Europe & Central Asia\n    \n    \n      230\n      South Africa\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      231\n      Zambia\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      232\n      Zimbabwe\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n    \n      233\n      Zanzibar\n      Sub-Saharan Africa\n      Sub-Saharan Africa\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave\n\n\n\n\n\n\ndf_regions.to_csv('data/clean/region_mapping.csv')"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_C_prepare_LIS.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_C_prepare_LIS.html",
    "title": "Appendix 1.C: Preparing LIS inequality data",
    "section": "",
    "text": "Packages and settings\n\n\n\n\n\n\nimport pandas as pd\npd.set_option('display.max_rows', None)\n\n\n\n\n\n\n\n\n\n\nLoad LIS data\n\n\n\n\n\nWe load a local file downloaded from Our World in Data\n\ndf_lis = pd.read_csv(\"data/original/Luxembourg Income Study (LIS, 2022).csv\")\n\nThe dataframe looks like this:\n\ndf_lis.head(50)\n\n\n\n\n\n  \n    \n      \n      Entity\n      Year\n      Richest decile - Average (Disposable household cash income, equivalized)\n      Richest decile - Average (Disposable household cash income, per capita)\n      Richest decile - Average (Disposable household income, equivalized)\n      Richest decile - Average (Total consumption, equivalized)\n      Richest decile - Average (Disposable household income, per capita)\n      Richest decile - Average (Total consumption, per capita)\n      Richest decile - Average (Market income, equivalized)\n      Richest decile - Average (Market income, per capita)\n      ...\n      $40 a day - Total shortfall (Market income, equivalized)\n      $6.85 a day - Total shortfall (Market income, equivalized)\n      $1 a day - Total shortfall (Market income, per capita)\n      $10 a day - Total shortfall (Market income, per capita)\n      $20 a day - Total shortfall (Market income, per capita)\n      $2.15 a day - Total shortfall (Market income, per capita)\n      $30 a day - Total shortfall (Market income, per capita)\n      $3.65 a day - Total shortfall (Market income, per capita)\n      $40 a day - Total shortfall (Market income, per capita)\n      $6.85 a day - Total shortfall (Market income, per capita)\n    \n  \n  \n    \n      0\n      Australia\n      1981\n      50023.832\n      31936.395\n      50023.832\n      NaN\n      31936.395\n      NaN\n      70626.780\n      44461.266\n      ...\n      3.866247e+10\n      3.982356e+09\n      419814080.0\n      7.280809e+09\n      1.894659e+10\n      1.058547e+09\n      3.748656e+10\n      2.019697e+09\n      6.446676e+10\n      4.467916e+09\n    \n    \n      1\n      Australia\n      1985\n      52288.690\n      34355.395\n      52288.690\n      NaN\n      34355.395\n      NaN\n      76894.055\n      49693.500\n      ...\n      4.703279e+10\n      4.726871e+09\n      492149500.0\n      8.809942e+09\n      2.266906e+10\n      1.226572e+09\n      4.324881e+10\n      2.368296e+09\n      7.203492e+10\n      5.343073e+09\n    \n    \n      2\n      Australia\n      1989\n      55940.652\n      35907.617\n      55940.652\n      NaN\n      35907.617\n      NaN\n      80695.900\n      50987.070\n      ...\n      4.477128e+10\n      4.277556e+09\n      430305820.0\n      8.015738e+09\n      2.155789e+10\n      1.101814e+09\n      4.214196e+10\n      2.128218e+09\n      7.099132e+10\n      4.823715e+09\n    \n    \n      3\n      Australia\n      1995\n      52282.652\n      32798.330\n      52282.652\n      NaN\n      32798.330\n      NaN\n      73282.766\n      45911.695\n      ...\n      6.272404e+10\n      7.392468e+09\n      888633660.0\n      1.249220e+10\n      3.081024e+10\n      2.077478e+09\n      5.684046e+10\n      3.810248e+09\n      9.136563e+10\n      7.963823e+09\n    \n    \n      4\n      Australia\n      2001\n      61141.344\n      38586.074\n      61141.344\n      NaN\n      38586.074\n      NaN\n      84623.330\n      52824.360\n      ...\n      6.588217e+10\n      7.593419e+09\n      903245250.0\n      1.306969e+10\n      3.183256e+10\n      2.127348e+09\n      5.793087e+10\n      3.916253e+09\n      9.185732e+10\n      8.249642e+09\n    \n    \n      5\n      Australia\n      2003\n      60767.030\n      39880.895\n      60767.030\n      NaN\n      39880.895\n      NaN\n      85321.850\n      55284.574\n      ...\n      6.307820e+10\n      7.219062e+09\n      881157000.0\n      1.225195e+10\n      3.014891e+10\n      2.056010e+09\n      5.539704e+10\n      3.733895e+09\n      8.857910e+10\n      7.776967e+09\n    \n    \n      6\n      Australia\n      2004\n      67044.836\n      42361.940\n      69175.920\n      55835.004\n      43536.473\n      36100.730\n      93469.810\n      58672.870\n      ...\n      3.552942e+10\n      3.863406e+09\n      438178500.0\n      6.797047e+09\n      1.692003e+10\n      1.062209e+09\n      3.098926e+10\n      1.973497e+09\n      4.969544e+10\n      4.234076e+09\n    \n    \n      7\n      Australia\n      2008\n      88829.020\n      56799.945\n      94228.330\n      NaN\n      59941.715\n      NaN\n      125306.945\n      79572.290\n      ...\n      5.045161e+10\n      5.204412e+09\n      556913800.0\n      9.192074e+09\n      2.374370e+10\n      1.392097e+09\n      4.439591e+10\n      2.628348e+09\n      7.221916e+10\n      5.701780e+09\n    \n    \n      8\n      Australia\n      2010\n      87006.910\n      54742.312\n      91029.270\n      63567.266\n      57119.117\n      40610.445\n      118103.690\n      73404.390\n      ...\n      3.286811e+10\n      3.536595e+09\n      386255840.0\n      6.257946e+09\n      1.550157e+10\n      9.536842e+08\n      2.811584e+10\n      1.804838e+09\n      4.424620e+10\n      3.896993e+09\n    \n    \n      9\n      Australia\n      2014\n      95592.190\n      59411.480\n      100014.620\n      NaN\n      61948.363\n      NaN\n      140760.030\n      86222.500\n      ...\n      5.619110e+10\n      5.810582e+09\n      613722050.0\n      1.034583e+10\n      2.619963e+10\n      1.535612e+09\n      4.797817e+10\n      2.938061e+09\n      7.639243e+10\n      6.431944e+09\n    \n    \n      10\n      Australia\n      2016\n      95338.805\n      57815.190\n      98961.770\n      68191.990\n      60041.000\n      41841.562\n      137332.670\n      82343.980\n      ...\n      3.157090e+10\n      3.298953e+09\n      329876830.0\n      5.809851e+09\n      1.477044e+10\n      8.604021e+08\n      2.745273e+10\n      1.645921e+09\n      4.482942e+10\n      3.617623e+09\n    \n    \n      11\n      Australia\n      2018\n      95226.620\n      58856.266\n      98357.400\n      NaN\n      60820.470\n      NaN\n      139952.250\n      84917.270\n      ...\n      5.699418e+10\n      6.208357e+09\n      650117200.0\n      1.085852e+10\n      2.696330e+10\n      1.663812e+09\n      4.886336e+10\n      3.168145e+09\n      7.752602e+10\n      6.823221e+09\n    \n    \n      12\n      Austria\n      1994\n      69881.110\n      45899.453\n      69881.110\n      NaN\n      45899.453\n      NaN\n      89520.310\n      58899.938\n      ...\n      2.206478e+10\n      2.630414e+09\n      285884320.0\n      4.438652e+09\n      1.071117e+10\n      7.270337e+08\n      1.952715e+10\n      1.356840e+09\n      3.193494e+10\n      2.840446e+09\n    \n    \n      13\n      Austria\n      1995\n      65876.910\n      43685.550\n      65876.910\n      NaN\n      43685.550\n      NaN\n      87497.840\n      56811.676\n      ...\n      2.219400e+10\n      2.590032e+09\n      284019940.0\n      4.428834e+09\n      1.083907e+10\n      7.102111e+08\n      2.003968e+10\n      1.324459e+09\n      3.266376e+10\n      2.784787e+09\n    \n    \n      14\n      Austria\n      1996\n      60737.586\n      41528.630\n      60737.586\n      NaN\n      41528.630\n      NaN\n      84336.910\n      55718.867\n      ...\n      2.260098e+10\n      2.775207e+09\n      301874460.0\n      4.597060e+09\n      1.098366e+10\n      7.625631e+08\n      2.033913e+10\n      1.419866e+09\n      3.325607e+10\n      2.937981e+09\n    \n    \n      15\n      Austria\n      1997\n      59613.934\n      40621.113\n      59613.934\n      NaN\n      40621.113\n      NaN\n      82288.234\n      55246.480\n      ...\n      2.368187e+10\n      2.872324e+09\n      306911040.0\n      4.752263e+09\n      1.143486e+10\n      7.813284e+08\n      2.080697e+10\n      1.464992e+09\n      3.359248e+10\n      3.043656e+09\n    \n    \n      16\n      Austria\n      1998\n      68518.330\n      47025.664\n      68518.330\n      NaN\n      47025.664\n      NaN\n      90662.670\n      59918.950\n      ...\n      2.383486e+10\n      2.873143e+09\n      304562900.0\n      4.804085e+09\n      1.146382e+10\n      7.751332e+08\n      2.081868e+10\n      1.455688e+09\n      3.364921e+10\n      3.066837e+09\n    \n    \n      17\n      Austria\n      1999\n      67443.310\n      45999.090\n      67443.310\n      NaN\n      45999.090\n      NaN\n      88740.010\n      59038.746\n      ...\n      2.322060e+10\n      2.922314e+09\n      311632480.0\n      4.752616e+09\n      1.125651e+10\n      7.980534e+08\n      2.010428e+10\n      1.482893e+09\n      3.234846e+10\n      3.065703e+09\n    \n    \n      18\n      Austria\n      2000\n      63320.880\n      43179.418\n      63320.880\n      NaN\n      43179.418\n      NaN\n      88740.445\n      58514.668\n      ...\n      2.314955e+10\n      2.960108e+09\n      320404900.0\n      4.877011e+09\n      1.123190e+10\n      8.083421e+08\n      1.983614e+10\n      1.501765e+09\n      3.185132e+10\n      3.138284e+09\n    \n    \n      19\n      Austria\n      2003\n      69734.380\n      47596.600\n      70221.875\n      NaN\n      47835.707\n      NaN\n      95364.120\n      63157.457\n      ...\n      2.337836e+10\n      3.002156e+09\n      381028670.0\n      4.784872e+09\n      1.123712e+10\n      8.791692e+08\n      1.992914e+10\n      1.561116e+09\n      3.173868e+10\n      3.108729e+09\n    \n    \n      20\n      Austria\n      2004\n      75738.140\n      50994.240\n      76067.560\n      NaN\n      51156.832\n      NaN\n      98464.940\n      64571.703\n      ...\n      2.398168e+10\n      2.999760e+09\n      331263200.0\n      4.905073e+09\n      1.142636e+10\n      8.291091e+08\n      2.022340e+10\n      1.525757e+09\n      3.228851e+10\n      3.152394e+09\n    \n    \n      21\n      Austria\n      2005\n      69021.120\n      46443.652\n      69458.160\n      NaN\n      46635.330\n      NaN\n      89961.950\n      60223.830\n      ...\n      2.671138e+10\n      3.385736e+09\n      395115800.0\n      5.566860e+09\n      1.284201e+10\n      9.586561e+08\n      2.246157e+10\n      1.748484e+09\n      3.528864e+10\n      3.596450e+09\n    \n    \n      22\n      Austria\n      2006\n      72895.760\n      49464.617\n      73242.600\n      NaN\n      49679.770\n      NaN\n      97450.016\n      64547.445\n      ...\n      2.716263e+10\n      3.362454e+09\n      380588670.0\n      5.538014e+09\n      1.297598e+10\n      9.348848e+08\n      2.280834e+10\n      1.716200e+09\n      3.564946e+10\n      3.559522e+09\n    \n    \n      23\n      Austria\n      2007\n      78440.230\n      52059.820\n      78412.410\n      NaN\n      52243.830\n      NaN\n      111056.770\n      73114.336\n      ...\n      2.656803e+10\n      3.154759e+09\n      309539140.0\n      5.291345e+09\n      1.259816e+10\n      8.291382e+08\n      2.207385e+10\n      1.586577e+09\n      3.428095e+10\n      3.367000e+09\n    \n    \n      24\n      Austria\n      2008\n      79230.125\n      53437.938\n      79606.910\n      NaN\n      53738.477\n      NaN\n      113746.720\n      75953.060\n      ...\n      2.708904e+10\n      3.217971e+09\n      314792480.0\n      5.433489e+09\n      1.284498e+10\n      8.485980e+08\n      2.244254e+10\n      1.615634e+09\n      3.447038e+10\n      3.447235e+09\n    \n    \n      25\n      Austria\n      2009\n      83951.730\n      56609.137\n      84748.350\n      NaN\n      57179.586\n      NaN\n      119655.460\n      78789.250\n      ...\n      2.828675e+10\n      3.386112e+09\n      346781950.0\n      5.683956e+09\n      1.347219e+10\n      8.996375e+08\n      2.336469e+10\n      1.708271e+09\n      3.580894e+10\n      3.613923e+09\n    \n    \n      26\n      Austria\n      2010\n      81076.695\n      53947.445\n      81523.470\n      NaN\n      54308.460\n      NaN\n      110757.810\n      72573.290\n      ...\n      2.862892e+10\n      3.495099e+09\n      360289800.0\n      5.770098e+09\n      1.367704e+10\n      9.423384e+08\n      2.383922e+10\n      1.765965e+09\n      3.643571e+10\n      3.690540e+09\n    \n    \n      27\n      Austria\n      2011\n      80493.055\n      54190.473\n      80793.740\n      NaN\n      54409.770\n      NaN\n      112055.695\n      73432.210\n      ...\n      2.842217e+10\n      3.383949e+09\n      347815260.0\n      5.701490e+09\n      1.343139e+10\n      9.147812e+08\n      2.353691e+10\n      1.719751e+09\n      3.619471e+10\n      3.632217e+09\n    \n    \n      28\n      Austria\n      2012\n      75392.040\n      52374.832\n      76614.310\n      NaN\n      52578.530\n      NaN\n      107937.840\n      72005.130\n      ...\n      2.938072e+10\n      3.551610e+09\n      380646900.0\n      5.954646e+09\n      1.396010e+10\n      9.727799e+08\n      2.399811e+10\n      1.813611e+09\n      3.653724e+10\n      3.795469e+09\n    \n    \n      29\n      Austria\n      2013\n      82440.470\n      57029.902\n      82440.470\n      NaN\n      57029.902\n      NaN\n      112982.030\n      76692.664\n      ...\n      2.921268e+10\n      3.527228e+09\n      391929760.0\n      5.877413e+09\n      1.391488e+10\n      9.774984e+08\n      2.380032e+10\n      1.805767e+09\n      3.615176e+10\n      3.749382e+09\n    \n    \n      30\n      Austria\n      2014\n      79697.336\n      55544.285\n      79697.336\n      NaN\n      55544.285\n      NaN\n      109840.990\n      74982.900\n      ...\n      2.914435e+10\n      3.656938e+09\n      413919070.0\n      6.009400e+09\n      1.386119e+10\n      1.025508e+09\n      2.406541e+10\n      1.880889e+09\n      3.679829e+10\n      3.877160e+09\n    \n    \n      31\n      Austria\n      2015\n      78624.210\n      54856.367\n      78624.210\n      NaN\n      54856.367\n      NaN\n      111741.914\n      75959.805\n      ...\n      2.977386e+10\n      3.780052e+09\n      453066900.0\n      6.129731e+09\n      1.411562e+10\n      1.081278e+09\n      2.444680e+10\n      1.946668e+09\n      3.729886e+10\n      3.962612e+09\n    \n    \n      32\n      Austria\n      2016\n      84399.180\n      57378.082\n      84399.180\n      NaN\n      57378.082\n      NaN\n      119039.484\n      78786.150\n      ...\n      3.033834e+10\n      3.861010e+09\n      476160860.0\n      6.297410e+09\n      1.447051e+10\n      1.113062e+09\n      2.448154e+10\n      1.996445e+09\n      3.687180e+10\n      4.063655e+09\n    \n    \n      33\n      Austria\n      2017\n      81013.720\n      54702.066\n      81013.720\n      NaN\n      54702.066\n      NaN\n      111630.930\n      74736.870\n      ...\n      2.918657e+10\n      3.735702e+09\n      441075140.0\n      6.055330e+09\n      1.391907e+10\n      1.056690e+09\n      2.370464e+10\n      1.921560e+09\n      3.597913e+10\n      3.921300e+09\n    \n    \n      34\n      Austria\n      2018\n      83463.160\n      57253.105\n      83463.160\n      NaN\n      57253.105\n      NaN\n      115263.470\n      78277.100\n      ...\n      3.012088e+10\n      3.887151e+09\n      466428800.0\n      6.278360e+09\n      1.434872e+10\n      1.113488e+09\n      2.426827e+10\n      2.005151e+09\n      3.702200e+10\n      4.063442e+09\n    \n    \n      35\n      Austria\n      2019\n      82089.420\n      56629.710\n      82089.420\n      NaN\n      56629.710\n      NaN\n      117377.695\n      80094.660\n      ...\n      2.934813e+10\n      3.778096e+09\n      460785950.0\n      6.115253e+09\n      1.395052e+10\n      1.083482e+09\n      2.378189e+10\n      1.952915e+09\n      3.594893e+10\n      3.971567e+09\n    \n    \n      36\n      Belgium\n      1985\n      41134.703\n      23562.771\n      41134.703\n      NaN\n      23562.771\n      NaN\n      38227.390\n      23615.049\n      ...\n      4.050182e+10\n      5.040509e+09\n      727205000.0\n      7.808187e+09\n      2.013577e+10\n      1.567359e+09\n      4.046943e+10\n      2.683192e+09\n      6.779089e+10\n      5.163750e+09\n    \n    \n      37\n      Belgium\n      1988\n      44465.400\n      25686.190\n      44465.400\n      NaN\n      25686.190\n      NaN\n      40741.664\n      24987.645\n      ...\n      4.049237e+10\n      5.135251e+09\n      734519400.0\n      7.990967e+09\n      2.018125e+10\n      1.588525e+09\n      3.989350e+10\n      2.727084e+09\n      6.661184e+10\n      5.263755e+09\n    \n    \n      38\n      Belgium\n      1992\n      44531.805\n      27947.602\n      44531.805\n      NaN\n      27947.602\n      NaN\n      66219.220\n      41001.363\n      ...\n      3.805986e+10\n      5.616064e+09\n      765230300.0\n      8.642301e+09\n      1.919126e+10\n      1.707524e+09\n      3.315387e+10\n      2.977780e+09\n      5.177313e+10\n      5.774300e+09\n    \n    \n      39\n      Belgium\n      1995\n      59845.996\n      38071.760\n      59923.324\n      NaN\n      38126.027\n      NaN\n      55208.395\n      34615.797\n      ...\n      3.698898e+10\n      4.445858e+09\n      570852900.0\n      7.297604e+09\n      1.788184e+10\n      1.301427e+09\n      3.297802e+10\n      2.311891e+09\n      5.336472e+10\n      4.677550e+09\n    \n    \n      40\n      Belgium\n      1997\n      53506.082\n      35397.207\n      53506.082\n      NaN\n      35397.207\n      NaN\n      86715.390\n      54934.605\n      ...\n      3.964167e+10\n      4.942290e+09\n      453824160.0\n      8.287223e+09\n      1.910603e+10\n      1.276683e+09\n      3.243410e+10\n      2.474495e+09\n      4.885963e+10\n      5.306969e+09\n    \n    \n      41\n      Belgium\n      2000\n      71637.734\n      46533.008\n      71679.220\n      NaN\n      46711.453\n      NaN\n      81062.570\n      53535.490\n      ...\n      3.042676e+10\n      3.996733e+09\n      531078560.0\n      6.334454e+09\n      1.452915e+10\n      1.194686e+09\n      2.547413e+10\n      2.086721e+09\n      4.052982e+10\n      4.135878e+09\n    \n    \n      42\n      Belgium\n      2003\n      58273.867\n      39482.965\n      58621.387\n      NaN\n      39609.260\n      NaN\n      88043.020\n      58628.383\n      ...\n      3.953542e+10\n      4.981929e+09\n      536375600.0\n      8.298363e+09\n      1.898224e+10\n      1.336157e+09\n      3.200798e+10\n      2.512582e+09\n      4.782651e+10\n      5.300771e+09\n    \n    \n      43\n      Belgium\n      2004\n      65745.970\n      43220.270\n      66189.400\n      NaN\n      43448.746\n      NaN\n      100193.055\n      67825.380\n      ...\n      3.988252e+10\n      5.215997e+09\n      595704400.0\n      8.548323e+09\n      1.934049e+10\n      1.446502e+09\n      3.210507e+10\n      2.667045e+09\n      4.735235e+10\n      5.520924e+09\n    \n    \n      44\n      Belgium\n      2005\n      65475.125\n      42411.062\n      65999.730\n      NaN\n      42670.984\n      NaN\n      98763.520\n      66044.880\n      ...\n      3.953359e+10\n      5.077595e+09\n      564602430.0\n      8.352918e+09\n      1.899013e+10\n      1.383333e+09\n      3.170606e+10\n      2.573566e+09\n      4.751340e+10\n      5.364465e+09\n    \n    \n      45\n      Belgium\n      2006\n      65316.900\n      43735.547\n      67048.160\n      NaN\n      44811.060\n      NaN\n      93107.400\n      61628.582\n      ...\n      3.967641e+10\n      4.917687e+09\n      517002600.0\n      8.281226e+09\n      1.907284e+10\n      1.300792e+09\n      3.204192e+10\n      2.468123e+09\n      4.801887e+10\n      5.279435e+09\n    \n    \n      46\n      Belgium\n      2007\n      67657.810\n      44996.285\n      69637.945\n      NaN\n      46142.060\n      NaN\n      96476.266\n      63592.367\n      ...\n      3.888916e+10\n      4.895261e+09\n      518650560.0\n      8.012710e+09\n      1.860519e+10\n      1.307985e+09\n      3.183521e+10\n      2.462262e+09\n      4.805315e+10\n      5.148464e+09\n    \n    \n      47\n      Belgium\n      2008\n      63561.543\n      43540.340\n      65590.460\n      NaN\n      44618.855\n      NaN\n      90110.710\n      60801.484\n      ...\n      3.911911e+10\n      5.013727e+09\n      552635100.0\n      8.184741e+09\n      1.878338e+10\n      1.360048e+09\n      3.184249e+10\n      2.528480e+09\n      4.787434e+10\n      5.271591e+09\n    \n    \n      48\n      Belgium\n      2009\n      65641.500\n      43462.285\n      67333.240\n      NaN\n      44480.590\n      NaN\n      91483.610\n      60059.312\n      ...\n      4.061629e+10\n      5.136852e+09\n      544317600.0\n      8.544614e+09\n      1.958761e+10\n      1.378240e+09\n      3.307023e+10\n      2.588505e+09\n      4.927838e+10\n      5.453379e+09\n    \n    \n      49\n      Belgium\n      2010\n      63487.170\n      43094.580\n      65512.977\n      NaN\n      44407.176\n      NaN\n      91967.040\n      62218.300\n      ...\n      4.214041e+10\n      5.457073e+09\n      602626900.0\n      8.930732e+09\n      2.037472e+10\n      1.485109e+09\n      3.427268e+10\n      2.766432e+09\n      5.102372e+10\n      5.768364e+09\n    \n  \n\n50 rows × 826 columns\n\n\n\n\n\n\n\n\n\n\n\n\nSelect and rename needed variables, calculating some additional inequality metrics\n\n\n\n\n\n\ninc_concepts = {\n\n    \"short_name\": [\n        \"equiv_disposable\",\n        \"equiv_market\",\n        \"percap_disposable\",\n        \"percap_market\"],\n    \"long_name\": [\n        \"Disposable household income, equivalized\",\n        \"Market income, equivalized\",\n        \"Disposable household income, per capita\",\n        \"Disposable household income, per capita\"\n    ]\n}\n\nkeep_vars = []\n\nfor i in range(len(inc_concepts['short_name'])):\n\n    short_suffix = inc_concepts['short_name'][i]\n    long_suffix = inc_concepts['long_name'][i]\n\n    # Gini\n    gini_new_var = f'Gini_{short_suffix}'\n    gini_old_var = f'Gini coefficient ({long_suffix})'\n\n    df_lis[gini_new_var] = df_lis[gini_old_var] * 100\n\n    keep_vars.append(gini_new_var)\n\n    # Top 10% share\n    top10_new_var = f'Top_10_share_{short_suffix}'\n    top10_old_var = f'Richest decile - Share ({long_suffix})'\n\n    df_lis[top10_new_var] = df_lis[top10_old_var]\n\n    keep_vars.append(top10_new_var)\n\n    # Bottom 50% share\n    sum_cols = [\n    'Poorest decile - Share',\n    '2nd decile - Share',\n    '3rd decile - Share',\n    '4th decile - Share',\n    '5th decile - Share',\n    ]\n\n    sum_cols = [sub + f' ({long_suffix})' for sub in sum_cols]\n\n    bottom50_new_var = f'Bottom_50_share_{short_suffix}'\n\n    df_lis[bottom50_new_var] = df_lis[sum_cols].sum(axis=1)\n\n    keep_vars.append(bottom50_new_var)\n\n\n\nother_vars_to_keep = [\"Year\", \"Entity\"]\n\nkeep_vars = other_vars_to_keep + keep_vars\n\ndf_lis = df_lis[keep_vars]\n\n\n\n\n\n\n\n\n\n\nSee the prepared data\n\n\n\n\n\nThe first 100 rows of the dataframe looks like this:\n\ndf_lis.head(100)\n\n\n\n\n\n  \n    \n      \n      Year\n      Entity\n      Gini_equiv_disposable\n      Top_10_share_equiv_disposable\n      Bottom_50_share_equiv_disposable\n      Gini_equiv_market\n      Top_10_share_equiv_market\n      Bottom_50_share_equiv_market\n      Gini_percap_disposable\n      Top_10_share_percap_disposable\n      Bottom_50_share_percap_disposable\n      Gini_percap_market\n      Top_10_share_percap_market\n      Bottom_50_share_percap_market\n    \n  \n  \n    \n      0\n      1981\n      Australia\n      28.2\n      20.7114\n      30.1790\n      40.4\n      25.3814\n      21.8905\n      31.3\n      23.3191\n      28.4171\n      31.3\n      23.3191\n      28.4171\n    \n    \n      1\n      1985\n      Australia\n      29.3\n      21.6330\n      29.5275\n      43.7\n      27.6839\n      19.7606\n      32.5\n      24.2772\n      27.7783\n      32.5\n      24.2772\n      27.7783\n    \n    \n      2\n      1989\n      Australia\n      30.4\n      22.4356\n      28.8189\n      43.1\n      27.7520\n      20.1667\n      33.1\n      24.6904\n      27.3028\n      33.1\n      24.6904\n      27.3028\n    \n    \n      3\n      1995\n      Australia\n      31.1\n      22.7384\n      28.2401\n      47.0\n      29.0784\n      17.0353\n      32.9\n      24.6306\n      27.5334\n      32.9\n      24.6306\n      27.5334\n    \n    \n      4\n      2001\n      Australia\n      32.0\n      23.5894\n      27.7841\n      48.1\n      30.1565\n      16.2782\n      33.7\n      25.1233\n      26.9225\n      33.7\n      25.1233\n      26.9225\n    \n    \n      5\n      2003\n      Australia\n      31.6\n      23.0152\n      28.0085\n      46.9\n      29.1615\n      17.1217\n      33.7\n      25.1594\n      26.9625\n      33.7\n      25.1594\n      26.9625\n    \n    \n      6\n      2004\n      Australia\n      31.1\n      23.5554\n      28.6207\n      45.7\n      29.0491\n      18.3739\n      32.7\n      25.0199\n      27.7169\n      32.7\n      25.0199\n      27.7169\n    \n    \n      7\n      2008\n      Australia\n      33.5\n      25.7203\n      27.3298\n      46.9\n      31.2839\n      18.0212\n      35.5\n      27.4164\n      26.1679\n      35.5\n      27.4164\n      26.1679\n    \n    \n      8\n      2010\n      Australia\n      33.3\n      24.8845\n      27.1446\n      47.3\n      30.3982\n      17.1927\n      34.9\n      26.3605\n      26.3001\n      34.9\n      26.3605\n      26.3001\n    \n    \n      9\n      2014\n      Australia\n      32.9\n      25.5024\n      27.7800\n      48.1\n      32.6434\n      17.4592\n      34.2\n      26.7302\n      27.1183\n      34.2\n      26.7302\n      27.1183\n    \n    \n      10\n      2016\n      Australia\n      32.6\n      24.7741\n      27.7320\n      45.9\n      30.7677\n      18.7156\n      33.7\n      25.8249\n      27.1812\n      33.7\n      25.8249\n      27.1812\n    \n    \n      11\n      2018\n      Australia\n      32.9\n      25.1997\n      27.7172\n      46.9\n      31.7626\n      18.2276\n      34.2\n      26.4557\n      27.0175\n      34.2\n      26.4557\n      27.0175\n    \n    \n      12\n      1994\n      Austria\n      27.8\n      21.7770\n      31.0690\n      43.8\n      27.2680\n      19.5033\n      30.8\n      24.0030\n      29.1101\n      30.8\n      24.0030\n      29.1101\n    \n    \n      13\n      1995\n      Austria\n      26.6\n      21.1158\n      31.8506\n      43.7\n      27.6185\n      19.7262\n      29.9\n      23.3414\n      29.6358\n      29.9\n      23.3414\n      29.6358\n    \n    \n      14\n      1996\n      Austria\n      25.8\n      20.3351\n      32.0640\n      43.5\n      27.1217\n      19.5170\n      29.3\n      23.1278\n      30.0955\n      29.3\n      23.1278\n      30.0955\n    \n    \n      15\n      1997\n      Austria\n      25.5\n      20.0592\n      32.3206\n      43.4\n      26.7349\n      19.5847\n      29.1\n      22.6440\n      30.3816\n      29.1\n      22.6440\n      30.3816\n    \n    \n      16\n      1998\n      Austria\n      27.5\n      22.2563\n      31.4371\n      44.9\n      28.5377\n      18.8182\n      31.3\n      24.9982\n      29.0709\n      31.3\n      24.9982\n      29.0709\n    \n    \n      17\n      1999\n      Austria\n      26.2\n      21.2059\n      32.0782\n      44.0\n      27.4915\n      19.3987\n      29.7\n      23.7468\n      29.8057\n      29.7\n      23.7468\n      29.8057\n    \n    \n      18\n      2000\n      Austria\n      25.4\n      20.6036\n      32.7149\n      43.6\n      27.2789\n      19.7973\n      28.9\n      22.9367\n      30.2479\n      28.9\n      22.9367\n      30.2479\n    \n    \n      19\n      2003\n      Austria\n      26.5\n      21.3393\n      31.8880\n      45.1\n      28.4883\n      18.6745\n      29.6\n      23.5392\n      30.0162\n      29.6\n      23.5392\n      30.0162\n    \n    \n      20\n      2004\n      Austria\n      26.8\n      22.0364\n      31.9070\n      45.6\n      28.9304\n      18.4123\n      29.9\n      23.8801\n      29.8098\n      29.9\n      23.8801\n      29.8098\n    \n    \n      21\n      2005\n      Austria\n      26.0\n      21.0588\n      32.2278\n      46.2\n      28.3760\n      17.5347\n      28.8\n      22.8680\n      30.3678\n      28.8\n      22.8680\n      30.3678\n    \n    \n      22\n      2006\n      Austria\n      26.8\n      21.7931\n      31.7895\n      47.7\n      29.7501\n      16.6698\n      29.7\n      23.7801\n      29.9291\n      29.7\n      23.7801\n      29.9291\n    \n    \n      23\n      2007\n      Austria\n      28.4\n      22.1949\n      30.6260\n      48.6\n      30.7191\n      16.0955\n      30.6\n      23.8709\n      29.2386\n      30.6\n      23.8709\n      29.2386\n    \n    \n      24\n      2008\n      Austria\n      28.0\n      22.2378\n      30.9866\n      49.0\n      31.1528\n      15.9883\n      30.4\n      24.1139\n      29.5302\n      30.4\n      24.1139\n      29.5302\n    \n    \n      25\n      2009\n      Austria\n      28.9\n      22.9112\n      30.4470\n      50.6\n      32.3594\n      14.9424\n      31.4\n      24.7046\n      28.8619\n      31.4\n      24.7046\n      28.8619\n    \n    \n      26\n      2010\n      Austria\n      28.0\n      22.1773\n      30.9118\n      49.8\n      30.9039\n      15.0692\n      30.3\n      23.6672\n      29.3688\n      30.3\n      23.6672\n      29.3688\n    \n    \n      27\n      2011\n      Austria\n      28.2\n      22.2599\n      30.8252\n      49.6\n      31.0864\n      15.2284\n      30.9\n      23.8736\n      28.9522\n      30.9\n      23.8736\n      28.9522\n    \n    \n      28\n      2012\n      Austria\n      27.7\n      21.7198\n      31.1267\n      49.5\n      30.7545\n      15.1985\n      30.6\n      23.6161\n      29.1880\n      30.6\n      23.6161\n      29.1880\n    \n    \n      29\n      2013\n      Austria\n      28.0\n      22.4941\n      31.0187\n      49.7\n      31.1161\n      15.1641\n      31.1\n      24.4794\n      29.0872\n      31.1\n      24.4794\n      29.0872\n    \n    \n      30\n      2014\n      Austria\n      27.5\n      22.1878\n      31.4116\n      49.5\n      31.0075\n      15.3305\n      30.7\n      24.2447\n      29.3028\n      30.7\n      24.2447\n      29.3028\n    \n    \n      31\n      2015\n      Austria\n      27.6\n      22.0004\n      31.2595\n      49.7\n      31.0976\n      15.1204\n      30.8\n      24.0319\n      29.1982\n      30.8\n      24.0319\n      29.1982\n    \n    \n      32\n      2016\n      Austria\n      28.5\n      22.4421\n      30.7155\n      50.3\n      31.8777\n      14.9410\n      31.0\n      24.0239\n      29.0026\n      31.0\n      24.0239\n      29.0026\n    \n    \n      33\n      2017\n      Austria\n      27.7\n      21.8421\n      31.1325\n      48.8\n      30.1465\n      15.6248\n      30.0\n      23.2091\n      29.5576\n      30.0\n      23.2091\n      29.5576\n    \n    \n      34\n      2018\n      Austria\n      28.0\n      22.3748\n      31.1442\n      49.7\n      31.0995\n      15.3011\n      31.0\n      24.0545\n      29.0590\n      31.0\n      24.0545\n      29.0590\n    \n    \n      35\n      2019\n      Austria\n      27.4\n      21.7319\n      31.4725\n      49.1\n      30.7803\n      15.6146\n      30.4\n      23.3517\n      29.2624\n      30.4\n      23.3517\n      29.2624\n    \n    \n      36\n      1985\n      Belgium\n      22.8\n      19.0669\n      34.0871\n      41.7\n      24.1700\n      20.2685\n      25.2\n      19.1502\n      32.8306\n      25.2\n      19.1502\n      32.8306\n    \n    \n      37\n      1988\n      Belgium\n      23.5\n      19.6520\n      33.8333\n      42.4\n      24.9415\n      20.1113\n      25.7\n      19.8434\n      32.5495\n      25.7\n      19.8434\n      32.5495\n    \n    \n      38\n      1992\n      Belgium\n      22.8\n      18.6798\n      34.1364\n      45.6\n      26.3068\n      17.1878\n      24.9\n      20.0608\n      32.8502\n      24.9\n      20.0608\n      32.8502\n    \n    \n      39\n      1995\n      Belgium\n      26.8\n      21.5448\n      31.6364\n      46.9\n      28.4432\n      16.7190\n      28.4\n      22.8487\n      31.0023\n      28.4\n      22.8487\n      31.0023\n    \n    \n      40\n      1997\n      Belgium\n      25.1\n      19.7236\n      32.4064\n      48.3\n      28.4608\n      15.2332\n      26.9\n      21.5896\n      31.7778\n      26.9\n      21.5896\n      31.7778\n    \n    \n      41\n      2000\n      Belgium\n      28.9\n      23.6319\n      30.7483\n      51.3\n      34.1729\n      15.2615\n      29.9\n      24.8682\n      30.3385\n      29.9\n      24.8682\n      30.3385\n    \n    \n      42\n      2003\n      Belgium\n      26.1\n      20.5639\n      31.8582\n      48.5\n      28.1923\n      14.7719\n      28.3\n      22.3801\n      30.8327\n      28.3\n      22.3801\n      30.8327\n    \n    \n      43\n      2004\n      Belgium\n      27.1\n      21.9555\n      31.4670\n      50.2\n      30.4583\n      14.2118\n      28.8\n      23.1740\n      30.6903\n      28.8\n      23.1740\n      30.6903\n    \n    \n      44\n      2005\n      Belgium\n      27.0\n      21.6756\n      31.5322\n      49.0\n      29.9344\n      15.2924\n      28.3\n      22.6702\n      30.9093\n      28.3\n      22.6702\n      30.9093\n    \n    \n      45\n      2006\n      Belgium\n      27.2\n      21.5829\n      31.3356\n      48.2\n      28.6299\n      15.4494\n      29.1\n      23.3013\n      30.4324\n      29.1\n      23.3013\n      30.4324\n    \n    \n      46\n      2007\n      Belgium\n      27.5\n      21.9729\n      31.1760\n      48.3\n      29.0006\n      15.4849\n      29.4\n      23.5485\n      30.2877\n      29.4\n      23.5485\n      30.2877\n    \n    \n      47\n      2008\n      Belgium\n      26.2\n      20.6228\n      31.7834\n      47.2\n      27.6019\n      16.1025\n      28.4\n      22.5599\n      30.7401\n      28.4\n      22.5599\n      30.7401\n    \n    \n      48\n      2009\n      Belgium\n      26.7\n      20.9649\n      31.4422\n      47.9\n      27.7206\n      15.2211\n      28.4\n      22.3047\n      30.7090\n      28.4\n      22.3047\n      30.7090\n    \n    \n      49\n      2010\n      Belgium\n      26.3\n      20.5291\n      31.5966\n      48.7\n      28.2520\n      14.7279\n      28.2\n      22.3755\n      30.9048\n      28.2\n      22.3755\n      30.9048\n    \n    \n      50\n      2011\n      Belgium\n      26.8\n      20.9416\n      31.3138\n      49.0\n      28.6037\n      14.3974\n      28.3\n      22.4024\n      30.8364\n      28.3\n      22.4024\n      30.8364\n    \n    \n      51\n      2012\n      Belgium\n      26.6\n      20.8603\n      31.4857\n      48.5\n      28.1200\n      14.6480\n      27.9\n      22.2817\n      31.1232\n      27.9\n      22.2817\n      31.1232\n    \n    \n      52\n      2013\n      Belgium\n      26.4\n      20.4380\n      31.4823\n      49.3\n      28.4085\n      13.9902\n      27.9\n      21.9250\n      31.0038\n      27.9\n      21.9250\n      31.0038\n    \n    \n      53\n      2014\n      Belgium\n      26.2\n      20.4844\n      31.6187\n      49.7\n      28.6665\n      13.6639\n      27.9\n      22.0139\n      30.9550\n      27.9\n      22.0139\n      30.9550\n    \n    \n      54\n      2015\n      Belgium\n      26.6\n      20.6862\n      31.3296\n      50.0\n      28.8055\n      13.3961\n      27.8\n      22.1605\n      31.1528\n      27.8\n      22.1605\n      31.1528\n    \n    \n      55\n      2016\n      Belgium\n      26.5\n      20.7990\n      31.5698\n      50.0\n      29.3329\n      13.6307\n      27.7\n      22.0597\n      31.2912\n      27.7\n      22.0597\n      31.2912\n    \n    \n      56\n      2017\n      Belgium\n      26.0\n      20.1495\n      31.8090\n      48.7\n      28.1267\n      14.5604\n      27.3\n      21.6858\n      31.4754\n      27.3\n      21.6858\n      31.4754\n    \n    \n      57\n      2006\n      Brazil\n      50.5\n      39.2886\n      17.5972\n      59.0\n      45.3650\n      12.4553\n      53.5\n      41.6866\n      15.7415\n      53.5\n      41.6866\n      15.7415\n    \n    \n      58\n      2009\n      Brazil\n      47.7\n      36.9650\n      19.0539\n      56.7\n      42.9650\n      13.5618\n      50.8\n      39.4078\n      17.1833\n      50.8\n      39.4078\n      17.1833\n    \n    \n      59\n      2011\n      Brazil\n      46.9\n      36.2321\n      19.5728\n      56.5\n      42.4945\n      13.6147\n      49.9\n      38.6158\n      17.7841\n      49.9\n      38.6158\n      17.7841\n    \n    \n      60\n      2013\n      Brazil\n      46.0\n      35.7098\n      20.1896\n      56.4\n      42.1742\n      13.7093\n      49.0\n      38.0349\n      18.3756\n      49.0\n      38.0349\n      18.3756\n    \n    \n      61\n      2016\n      Brazil\n      48.2\n      36.7119\n      18.7755\n      58.2\n      43.3815\n      12.5728\n      50.9\n      38.7067\n      16.9817\n      50.9\n      38.7067\n      16.9817\n    \n    \n      62\n      1971\n      Canada\n      32.3\n      22.9561\n      27.7319\n      40.2\n      26.2199\n      22.3031\n      37.3\n      27.0267\n      24.7377\n      37.3\n      27.0267\n      24.7377\n    \n    \n      63\n      1975\n      Canada\n      29.3\n      21.4645\n      29.7542\n      37.9\n      24.8852\n      23.7708\n      33.4\n      24.6718\n      27.2335\n      33.4\n      24.6718\n      27.2335\n    \n    \n      64\n      1981\n      Canada\n      28.6\n      21.1489\n      30.2029\n      37.2\n      24.2255\n      24.1275\n      32.5\n      24.2964\n      27.8121\n      32.5\n      24.2964\n      27.8121\n    \n    \n      65\n      1987\n      Canada\n      28.3\n      21.4852\n      30.4038\n      38.8\n      25.4060\n      23.0998\n      31.5\n      23.8845\n      28.4828\n      31.5\n      23.8845\n      28.4828\n    \n    \n      66\n      1991\n      Canada\n      28.2\n      21.4442\n      30.4592\n      40.8\n      26.6340\n      21.7465\n      31.1\n      23.5999\n      28.7710\n      31.1\n      23.5999\n      28.7710\n    \n    \n      67\n      1994\n      Canada\n      28.5\n      21.5437\n      30.2384\n      42.2\n      26.8303\n      20.4803\n      31.3\n      23.6597\n      28.5929\n      31.3\n      23.6597\n      28.5929\n    \n    \n      68\n      1996\n      Canada\n      30.3\n      22.9436\n      29.1738\n      44.4\n      28.7162\n      19.1664\n      32.8\n      24.9824\n      27.7490\n      32.8\n      24.9824\n      27.7490\n    \n    \n      69\n      1997\n      Canada\n      30.8\n      23.3916\n      28.9143\n      44.6\n      29.1445\n      19.1484\n      33.2\n      25.4188\n      27.6092\n      33.2\n      25.4188\n      27.6092\n    \n    \n      70\n      1998\n      Canada\n      31.2\n      23.7782\n      28.7665\n      44.7\n      29.3693\n      19.1963\n      33.3\n      25.5674\n      27.5894\n      33.3\n      25.5674\n      27.5894\n    \n    \n      71\n      1999\n      Canada\n      31.0\n      23.5663\n      28.7715\n      43.5\n      28.8285\n      20.0146\n      33.1\n      25.1714\n      27.6158\n      33.1\n      25.1714\n      27.6158\n    \n    \n      72\n      2000\n      Canada\n      31.8\n      24.2988\n      28.4294\n      43.7\n      29.4302\n      20.1349\n      33.5\n      25.6444\n      27.4292\n      33.5\n      25.6444\n      27.4292\n    \n    \n      73\n      2001\n      Canada\n      31.8\n      24.3110\n      28.3719\n      43.8\n      29.5122\n      20.0407\n      33.6\n      25.6813\n      27.2833\n      33.6\n      25.6813\n      27.2833\n    \n    \n      74\n      2002\n      Canada\n      31.7\n      24.0637\n      28.4200\n      43.4\n      29.1817\n      20.3087\n      33.6\n      25.5395\n      27.2472\n      33.6\n      25.5395\n      27.2472\n    \n    \n      75\n      2003\n      Canada\n      31.8\n      24.1156\n      28.2961\n      43.6\n      29.1541\n      20.1444\n      33.9\n      25.8066\n      27.1051\n      33.9\n      25.8066\n      27.1051\n    \n    \n      76\n      2004\n      Canada\n      32.0\n      24.2937\n      28.1786\n      43.7\n      29.4177\n      20.1109\n      33.9\n      25.6503\n      27.1118\n      33.9\n      25.6503\n      27.1118\n    \n    \n      77\n      2005\n      Canada\n      31.8\n      24.1214\n      28.2746\n      43.3\n      29.1346\n      20.2812\n      33.7\n      25.6474\n      27.2590\n      33.7\n      25.6474\n      27.2590\n    \n    \n      78\n      2006\n      Canada\n      31.8\n      24.3561\n      28.3096\n      43.4\n      29.4253\n      20.3646\n      34.0\n      26.0143\n      27.0439\n      34.0\n      26.0143\n      27.0439\n    \n    \n      79\n      2007\n      Canada\n      31.6\n      24.2606\n      28.4712\n      43.4\n      29.6064\n      20.4347\n      33.7\n      25.8956\n      27.2669\n      33.7\n      25.8956\n      27.2669\n    \n    \n      80\n      2008\n      Canada\n      32.2\n      24.5736\n      28.1503\n      43.8\n      29.8203\n      20.2208\n      33.9\n      25.9749\n      27.1271\n      33.9\n      25.9749\n      27.1271\n    \n    \n      81\n      2009\n      Canada\n      32.1\n      24.4043\n      28.1151\n      44.4\n      29.8841\n      19.5611\n      34.0\n      25.8853\n      27.0259\n      34.0\n      25.8853\n      27.0259\n    \n    \n      82\n      2010\n      Canada\n      31.8\n      24.2615\n      28.3673\n      44.3\n      29.7703\n      19.6716\n      33.6\n      25.7754\n      27.3213\n      33.6\n      25.7754\n      27.3213\n    \n    \n      83\n      2011\n      Canada\n      31.3\n      23.8086\n      28.6180\n      43.4\n      28.9570\n      20.1814\n      32.7\n      25.0355\n      27.8764\n      32.7\n      25.0355\n      27.8764\n    \n    \n      84\n      2012\n      Canada\n      31.7\n      23.8099\n      28.2503\n      43.1\n      28.5904\n      20.2283\n      33.6\n      25.2017\n      27.1766\n      33.6\n      25.2017\n      27.1766\n    \n    \n      85\n      2013\n      Canada\n      32.1\n      23.7121\n      27.8701\n      43.6\n      28.5567\n      19.7705\n      33.8\n      25.1544\n      26.9233\n      33.8\n      25.1544\n      26.9233\n    \n    \n      86\n      2014\n      Canada\n      31.2\n      23.6019\n      28.6230\n      42.6\n      28.5008\n      20.7597\n      33.2\n      25.1836\n      27.5035\n      33.2\n      25.1836\n      27.5035\n    \n    \n      87\n      2015\n      Canada\n      32.0\n      24.0211\n      28.1513\n      43.8\n      29.1508\n      19.8311\n      33.8\n      25.5065\n      27.1266\n      33.8\n      25.5065\n      27.1266\n    \n    \n      88\n      2016\n      Canada\n      30.8\n      23.2828\n      28.8447\n      43.2\n      28.6796\n      20.2083\n      32.8\n      25.0134\n      27.7456\n      32.8\n      25.0134\n      27.7456\n    \n    \n      89\n      2017\n      Canada\n      31.3\n      23.6980\n      28.5350\n      44.1\n      29.3373\n      19.6208\n      33.3\n      25.3509\n      27.3513\n      33.3\n      25.3509\n      27.3513\n    \n    \n      90\n      2018\n      Canada\n      30.6\n      23.3173\n      29.0637\n      42.9\n      28.6330\n      20.4432\n      32.6\n      24.8325\n      27.8534\n      32.6\n      24.8325\n      27.8534\n    \n    \n      91\n      1990\n      Chile\n      50.7\n      40.4008\n      17.7667\n      55.4\n      43.4721\n      14.9847\n      52.8\n      42.2687\n      16.6576\n      52.8\n      42.2687\n      16.6576\n    \n    \n      92\n      1992\n      Chile\n      50.8\n      40.9414\n      17.8865\n      54.9\n      43.4383\n      15.5157\n      52.7\n      42.7495\n      16.8828\n      52.7\n      42.7495\n      16.8828\n    \n    \n      93\n      1994\n      Chile\n      50.6\n      39.3696\n      17.4048\n      54.9\n      42.0823\n      14.9380\n      52.5\n      41.2217\n      16.5017\n      52.5\n      41.2217\n      16.5017\n    \n    \n      94\n      1996\n      Chile\n      50.4\n      39.5356\n      17.7629\n      54.7\n      42.2900\n      15.0987\n      52.5\n      41.6195\n      16.6754\n      52.5\n      41.6195\n      16.6754\n    \n    \n      95\n      1998\n      Chile\n      51.0\n      40.2855\n      17.4644\n      55.1\n      42.8846\n      14.9717\n      53.4\n      42.4694\n      16.2395\n      53.4\n      42.4694\n      16.2395\n    \n    \n      96\n      2000\n      Chile\n      52.6\n      42.4316\n      16.9251\n      57.5\n      45.7775\n      13.9865\n      54.8\n      44.2552\n      15.7041\n      54.8\n      44.2552\n      15.7041\n    \n    \n      97\n      2003\n      Chile\n      50.3\n      39.8768\n      17.9316\n      54.8\n      42.6038\n      15.2441\n      52.8\n      42.2747\n      16.6622\n      52.8\n      42.2747\n      16.6622\n    \n    \n      98\n      2006\n      Chile\n      47.6\n      37.3633\n      19.3320\n      52.1\n      39.7624\n      16.5301\n      50.0\n      39.7252\n      18.1635\n      50.0\n      39.7252\n      18.1635\n    \n    \n      99\n      2009\n      Chile\n      47.8\n      38.2364\n      19.4950\n      53.8\n      41.5158\n      15.6130\n      50.0\n      40.4126\n      18.4211\n      50.0\n      40.4126\n      18.4211\n    \n  \n\n\n\n\n\n\n\n\n\n\n\n\n\nSave the data\n\n\n\n\n\nI save the prepared data locally:\n\ndf_lis.to_csv(\"data/clean/lis.csv\", index=False)"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_F_within_country_trends.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/data_appendix/1_F_within_country_trends.html",
    "title": "Appendix 1.F: Analysing global trends in within-country inequality",
    "section": "",
    "text": "#| standalone: true\n#| viewerHeight: 1000\n\n## file: app.py\n\nimport jinja2\nfrom shiny import *\nimport pandas as pd\nfrom pyodide.http import open_url\nimport numpy as np\nfrom plotnine import *\n\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 1: Data prep functions -------------\n#  ----------------------------------\n\n#  Function get matching for ref years\ndef closest_to_reference(df, reference_val, max_dist_from_ref, reference_col, group_by_col, value_col, tie_break):\n  \n  df = df.loc[:, [reference_col, group_by_col, value_col]]\n\n  # Drop NAs\n  df = df.dropna()\n\n  # Calculate absolute distance from reference value\n  df['ref_diff'] = abs(df[reference_col] - reference_val)\n\n  # Drop any rows with a distance beyond threshold\n  if not pd.isna(max_dist_from_ref):\n    df = df.loc[df['ref_diff'] <= max_dist_from_ref]\n\n  # Keep closest observation to reference value – including tie-breaks (where there is a match above and below the ref value)\n  df = df[df.groupby(group_by_col)['ref_diff'].transform('min') == df['ref_diff']].reset_index(drop=True)\n\n  # Settle tie-breaks\n  if tie_break == 'below':\n    df = df[df.groupby(group_by_col)[reference_col].transform('min') == df[reference_col]].reset_index(drop=True)\n    \n  elif tie_break == 'above':\n    df = df[df.groupby(group_by_col)[reference_col].transform('max') == df[reference_col]].reset_index(drop=True)\n\n  df = df.drop('ref_diff', axis=1)\n\n  df = df\\\n    .rename(columns={value_col: \"value\"})\n\n\n  return df\n\n\n\n\n# Merge matches for different reference points\ndef merge_two_ref_matches(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n# Make sure the pair of reference values are in ascending order\n  reference_vals.sort()\n\n# Maximise distance between two refs by settling tie-breaks below the lowest ref and above the highest ref \n\n# Find matches for lower reference value\n  lower_ref_matches = closest_to_reference(df, reference_vals[0], max_dist_from_refs, reference_col, group_by_col, value_col, 'below')\n\n# Find matches for higher reference value\n  higher_ref_matches = closest_to_reference(df, reference_vals[1], max_dist_from_refs, reference_col, group_by_col, value_col, 'above')\n\n# Merge the two sets of matches\n  merged_df = pd.merge(lower_ref_matches, higher_ref_matches, on=group_by_col, suffixes=(reference_vals[0], reference_vals[1]))\n\n# Drop obs that do not have data for both ref values\n  merged_df = merged_df.dropna()\n\n# Drop obs where the matched data does not meet the min distance requirement\n  if not pd.isna(min_dist_between):\n  \n  # Store the names of the reference column returned from the two matches\n    ref_var_high = f'{reference_col}{reference_vals[1]}'\n    ref_var_low = f'{reference_col}{reference_vals[0]}'\n\n  # Keep only rows >= to the min distance\n    merged_df = merged_df.loc[(merged_df[ref_var_high] - merged_df[ref_var_low]) >= min_dist_between, :]\n\n\n\n  return merged_df\n\n\n\n  # For PIP run this three times – first filtering data for just consumpion only, then with income only, then with a dataset that prefers income over consumption\ndef pip_welfare_routine(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n  # Specify the name of the column in which the income/consumption welfare definition is stored\n  welfare_colname = 'welfare_type'\n\n  # Creat dataframes for thee scenarios:\n  # Scenario 1: only allow income data\n  df_inc_filter = df.loc[df[welfare_colname] == \"income\", :]\n  df_inc_filter.name = \"Income\"\n\n  # Scenario 2: only allow consumption data\n  df_cons_filter = df.loc[df[welfare_colname] == \"consumption\", :]\n  df_cons_filter.name = \"Consumption\"\n  # Scenario 3: allow a mix – dropping consumption data where income data is available in the same year\n  df_mixed = df.copy()\n\n  df_mixed['welfare_count'] = df_mixed.groupby([reference_col, group_by_col])[welfare_colname].transform('count')\n\n  df_mixed = df_mixed.loc[(df_mixed['welfare_count'] == 1) | (df_mixed[welfare_colname] == \"income\")]\n\n  df_mixed.name = \"Mixed\"\n  #  Store the scneario dataframes in a list\n  df_scenarios = [df_inc_filter, df_cons_filter, df_mixed]\n\n  # Run the matching function on each scenario\n  scenario_matches = [merge_two_ref_matches(\n    df_scenario, \n    reference_vals, \n    max_dist_from_refs, \n    min_dist_between, \n    reference_col, \n    group_by_col, \n    value_col) for df_scenario in df_scenarios]\n  \n  # Combine the first two scenarios.\n  df_combined_matches = pd.concat([scenario_matches[0], scenario_matches[1]], keys=[df_scenarios[0].name, df_scenarios[1].name])\n\n  # Tidy up indexes\n  df_combined_matches = df_combined_matches.reset_index()\n  \n  df_combined_matches = df_combined_matches.drop('level_1', axis=1)\n\n  df_combined_matches = df_combined_matches\\\n    .rename(columns={\"level_0\": \"pip_welfare\"})\n\n  # Add in third scenario.\n  df_combined_matches = pd.concat([df_combined_matches, scenario_matches[2]])\n\n  # add scenario name to te pip_welfare column\n  df_combined_matches['pip_welfare'] = df_combined_matches['pip_welfare'].fillna(df_scenarios[2].name)\n\n  # Keep only one match per group (e.g. per Country) - in the priority laid out in the df_scenarios list above (income only -> consumption only -> mixed)\n    # First count the matches\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n    # Then drop any matches from the lowest priority where there are multiple matches\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[2].name)]\n    #  Repeat at the next level of priority\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[1].name)]\n  \n  # Drop the match count column\n  df_combined_matches = df_combined_matches.drop('match_count', axis=1)\n\n\n  return df_combined_matches\n\n\n\n\ndef prep_selected_vars(selected_vars):\n\n  # selected_vars = [\n  #   'LIS: Top_10_share_equiv_market',\n  #   'WID: Bottom_50_share_posttax_dis',\n  #   'PIP: Top_10_share']\n\n  selected_sources = [var.split(sep, 1)[0] for var in selected_vars]\n  selected_var_names = [var.split(sep, 1)[1] for var in selected_vars]\n\n\n  match_data = {\n    \"sources\": selected_sources,\n    \"var_names\": selected_var_names\n          }\n\n\n  return match_data\n\n\n\n\n\n\n\ndef prep_data(\n      data_to_match,\n      reference_vals,\n      max_dist_from_refs,\n      min_dist_between,\n      all_metrics_requirement,\n      reference_col,\n      group_by_col,\n      tolerance,\n      outlier_cut_off_upper):\n\n  # Combine the source and varname strings element-wise to produce keys that will be used for the concat later\n  source_var_keys = [i + j for i, j in zip(data_to_match[\"sources\"], data_to_match[\"var_names\"])]\n\n  matches = []\n\n  for i in range(len(data_to_match['sources'])):\n    \n    source = data_to_match[\"sources\"][i]\n    var = data_to_match[\"var_names\"][i]\n\n    df = data[source]\n\n    if source == \"PIP\":\n\n      matched = pip_welfare_routine(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    else:\n\n      matched = merge_two_ref_matches(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    matches.append(matched)\n\n\n  plot_data = pd.concat(matches, keys=source_var_keys)\n\n  # Tidy up indexes\n  plot_data = plot_data.reset_index()\n  \n  plot_data = plot_data.drop('level_1', axis=1)\n\n  plot_data = plot_data\\\n    .rename(columns={\"level_0\": \"source_var\"})\n\n\n\n\n  # Store the names of the columns to be used onthe X and Y axis\n  x_axis = f'value{reference_vals[0]}'\n  y_axis = f'value{reference_vals[1]}'\n\n  x_ref_val = f'{reference_col}{reference_vals[0]}'\n  y_ref_val = f'{reference_col}{reference_vals[1]}'\n\n\n  # Apply outlier cut off, if specified\n  if not pd.isna(outlier_cut_off_upper):\n    plot_data = plot_data.loc[plot_data[x_axis] <= outlier_cut_off_upper]\n    plot_data = plot_data.loc[plot_data[y_axis] <= outlier_cut_off_upper]\n\n\n  # Add a count by country – counting whether data is available from each source or not\n  plot_data['source_count'] = plot_data.groupby(group_by_col)['source_var'].transform('count')\n\n\n  # Apply metrics requirement (whether to include only observations with data from all metrics)\n  if all_metrics_requirement:\n    plot_data = plot_data.loc[plot_data['source_count'] == plot_data['source_count'].max()]\n\n  # Drop source_count column\n  plot_data = plot_data.drop('source_count', axis=1)\n\n  # Add in region classification\n  plot_data = pd.merge(plot_data, df_regions, how = 'left')\n\n  # Add in population data\n    # For first ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[0], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref1'})\n\n    # For second ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[1], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref2'})\n\n    # Calculate average population two reference periods\n  plot_data['avg_pop'] = (plot_data['population_ref1'] + plot_data['population_ref2'])/2\n\n\n\n  #  PREP SUMMARY TABLE\n\n\n  # Calculate the change between the two ref periods\n  plot_data['change'] = (plot_data[y_axis] - plot_data[x_axis])\n\n\n  group_yes_vars = ['source_var', region_col]\n  group_no_vars = ['source_var']\n\n  group_scenarios = [group_no_vars, group_yes_vars] \n\n  aggs = []\n  \n  for group_vars in group_scenarios:\n  \n  # Prepare pop-weighted average change\n    agg_level = plot_data.copy()\n\n    # Calulate pop weights by source and region\n    agg_level['regional_pop_weights'] = agg_level.groupby(group_vars)['avg_pop'].transform(lambda x: x/x.sum()) \n\n    agg_level['global_pop_weights'] = agg_level.groupby('source_var')['avg_pop'].transform(lambda x: x/x.sum()) \n\n    # Multiply the change by the pop weights \n    agg_level['region_weighted_change'] = agg_level['change'] * agg_level['regional_pop_weights']\n\n\n  # Prepare fall/stable/rise categories\n    agg_level['fall'] = agg_level['change'] < -tolerance\n\n    agg_level['stable'] = (agg_level['change'] <= tolerance) & (agg_level['change'] >= -tolerance)\n\n    agg_level['rise'] = agg_level['change'] > tolerance\n\n    agg_level[['fall', 'stable', 'rise']] = agg_level[['fall', 'stable', 'rise']].astype(int)\n\n    agg_level = agg_level.groupby(group_vars)[['change', 'region_weighted_change', 'global_pop_weights', 'fall', 'stable', 'rise']]\\\n      .agg(['sum', 'mean', 'count'])\n\n  # Aggregate by source and region\n    if group_vars == group_yes_vars:\n\n      agg_level = agg_level\\\n        .unstack().T.reset_index()\n\n    elif group_vars == group_no_vars: \n\n      agg_level = agg_level\\\n        .T.reset_index()\n\n      agg_level[region_col] = \"World\"\n\n    aggs.append(agg_level) \n\n  \n  df_summary = pd.concat(aggs)\n\n    # filter for the aggregations we need and label in the 'summary' column\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'mean'), 'summary'] = 'avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'region_weighted_change') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Regional pop-weighted avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'global_pop_weights') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Global pop weights'\n\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'count'), 'summary'] = 'n'\n\n  df_summary.loc[(df_summary['level_0'] == 'fall') & (df_summary['level_1'] == 'sum'), 'summary'] = 'fall'\n\n  df_summary.loc[(df_summary['level_0'] == 'stable') & (df_summary['level_1'] == 'sum'), 'summary'] = 'stable'\n\n  df_summary.loc[(df_summary['level_0'] == 'rise') & (df_summary['level_1'] == 'sum'), 'summary'] = 'rise'\n\n  df_summary = df_summary[df_summary['summary'].notnull()]\n\n\n  df_summary = df_summary.drop(['level_0', 'level_1'], axis = 1)\n\n\n  df_summary['summary'] = pd.Categorical(df_summary['summary'], categories=['fall', 'stable', 'rise','n', 'avg change', 'Regional pop-weighted avg change', 'Global pop weights'], ordered=True)\n\n\n  df_summary = df_summary.sort_values([region_col,'summary']).set_index([region_col,'summary'])\n  \n  \n  # format to show appropriate d.p. I run a loop over each row for want of figuring out a better way!\n  repeat_length = 7\n  for i in range(0, len(df_summary.index.levels[0].unique())):\n    df_summary.iloc[i*repeat_length,:] = df_summary.iloc[i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[1 + i*repeat_length,:] = df_summary.iloc[1 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[2 + i*repeat_length,:] = df_summary.iloc[2 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[3 + i*repeat_length,:] = df_summary.iloc[3 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[4 + i*repeat_length,:] = df_summary.iloc[4 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[5 + i*repeat_length,:] = df_summary.iloc[5 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[6 + i*repeat_length,:] = df_summary.iloc[6 + i*repeat_length,:].map('{:.2f}'.format)\n  \n  return plot_data, df_summary\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 2: Specifications -------------\n#  ----------------------------------\n# These parameters are not controlled in the app.\n\nreference_col = 'Year'\ngroup_by_col = 'Entity'\n\ntolerance = 1\noutlier_cut_off_upper = None\nregion_col = 'region_alt'\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 3: Read in data -------------\n#  ----------------------------------\n# Note when testing outside of shinylive, this needs to be adjusted to a normal pd_read, without the pyodide step.\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/pip.csv'\n        \ndf_pip = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/wid.csv'\n\ndf_wid = pd.read_csv(open_url(url))\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/lis.csv'\n\ndf_lis = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/region_mapping.csv'\n\ndf_regions = pd.read_csv(open_url(url))\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/population.csv'\n\ndf_pop = pd.read_csv(open_url(url))\n\n\n\n\n\n\n#  ---------------------------------\n#  ---------- SECTION 4: Gather data into dictionary and collete varnames -------------\n#  ----------------------------------\n\ndata = {\"PIP\": df_pip,\n        \"WID\": df_wid,\n        \"LIS\": df_lis}\n\n# make an empty list to add all the varnames\nall_vars = list()\n\n# A string to use to separate the source name from the var name\nsep = \": \"\n\n# for each df in 'data'\nfor k,v in data.items():\n  \n  # make a list of varnames\n  vars = list(v.columns)\n\n  # remove the id cols\n  vars.remove(reference_col)\n  vars.remove(group_by_col)\n\n  # append the name of the source (the key of 'data') at the front\n  vars = [f'{k}{sep}' + var for var in vars]\n\n  # append to the running list\n  all_vars = all_vars + vars\n\n\n\n\n\n#  ---------------------------------\n#  ---------------------------------\n\n\n\n\n\n\n#  ---------------------------------\n#  ---------- App code -------------\n#  ----------------------------------\n\ndef panel_box(*args, **kwargs):\n    return ui.div(\n        ui.div(*args, class_=\"card-body\"),\n        **kwargs,\n        class_=\"card mb-3\",\n    )\n\napp_ui = ui.page_fluid(\n    {\"class\": \"p-4\"},\n    ui.row(\n        ui.column(\n            4,\n            panel_box(\n                ui.input_slider(\"reference_vals\", \"Reference years\", 1975, 2020, value=[1990,2018]),\n                ui.input_numeric(\n                            \"max_dist_from_refs\",\n                            \"=/- (years)\",\n                            4,\n                        ),\n                ui.input_numeric(\n                            \"min_dist_between\",\n                            \"Min distance between observations (years)\",\n                            23,\n                        ),\n                ui.input_selectize(\n                  \"metrics\", \"Metrics\", all_vars, multiple=True\n                  ),\n                ui.input_checkbox(\"all_metrics_requirement\", \"Show only countries with data for all metrics\", True),\n                ui.input_action_button(\n                    \"download\", \"Download data and image\", class_=\"btn-primary w-100\"\n                ),\n            ),\n        ),\n        ui.column(\n            8,\n            ui.output_plot(\"plot\"),\n            ui.output_table(\"table\")\n            ),\n    ),\n)\n\n\n\n\n\ndef server(input, output, session):\n\n    @reactive.Calc\n    def reactive_data():\n\n      data_to_match = prep_selected_vars(input.metrics())\n\n      reference_vals = list(input.reference_vals())\n\n      max_dist_from_refs = input.max_dist_from_refs()\n      min_dist_between = input.min_dist_between()\n      all_metrics_requirement = input.all_metrics_requirement()\n\n      prepped_data = prep_data(\n        data_to_match = data_to_match,\n        reference_vals = reference_vals,\n        max_dist_from_refs = max_dist_from_refs,\n        min_dist_between = min_dist_between,\n        all_metrics_requirement = all_metrics_requirement,\n        reference_col = reference_col,\n        group_by_col = group_by_col,\n        tolerance = tolerance,\n        outlier_cut_off_upper = outlier_cut_off_upper)\n\n      return prepped_data\n\n\n    @output\n    @render.plot\n    def plot():\n\n        reference_vals = list(input.reference_vals())\n\n        \n        prepped_data = reactive_data()\n    \n        plot_data = prepped_data[0]\n\n        \n        # Store the names of the columns to be used onthe X and Y axis\n        x_axis = f'value{reference_vals[0]}'\n        y_axis = f'value{reference_vals[1]}'\n\n\n        # I grab what I am guessing to be the max and min tick marks on the x axist, in order to define the coordinates of a 'tolerance' ribbon.\n        x_min = plot_data[x_axis].min()\n        x_min_floor = np.floor(x_min * 10) / 10\n\n        x_max = plot_data[x_axis].max()\n        x_max_ceiling = np.ceil(x_max * 10) / 10\n\n\n        plot = (ggplot(plot_data\n        , aes(x_axis, y_axis, alpha=0.5))\n        + geom_point(aes(color=region_col, size='avg_pop', alpha = 0.6))\n        + geom_abline(intercept=0,slope=1) \n        + facet_wrap('~ source_var')\n        + theme_light()\n        + theme(legend_position='none')\n        )\n        \n        return plot\n\n\n    @output\n    @render.table\n    def table():\n\n        \n        prepped_data = reactive_data()\n    \n        summary = prepped_data[1].reset_index()\n\n        \n        return summary\n\napp = App(app_ui, server)\n\n\n## file: requirements.txt\nJinja2\n\n\nTESTING!!! These are the same sections as above, to be used for testing.\n\nfrom plotnine import *\nimport plotly.express as px\nimport pandas as pd\nimport numpy as np\n\n\n#  ---------------------------------\n#  ---------- SECTION 1: Data prep functions -------------\n#  ----------------------------------\n\n#  Function get matching for ref years\ndef closest_to_reference(df, reference_val, max_dist_from_ref, reference_col, group_by_col, value_col, tie_break):\n  \n  df = df.loc[:, [reference_col, group_by_col, value_col]]\n\n  # Drop NAs\n  df = df.dropna()\n\n  # Calculate absolute distance from reference value\n  df['ref_diff'] = abs(df[reference_col] - reference_val)\n\n  # Drop any rows with a distance beyond threshold\n  if not pd.isna(max_dist_from_ref):\n    df = df.loc[df['ref_diff'] <= max_dist_from_ref]\n\n  # Keep closest observation to reference value – including tie-breaks (where there is a match above and below the ref value)\n  df = df[df.groupby(group_by_col)['ref_diff'].transform('min') == df['ref_diff']].reset_index(drop=True)\n\n  # Settle tie-breaks\n  if tie_break == 'below':\n    df = df[df.groupby(group_by_col)[reference_col].transform('min') == df[reference_col]].reset_index(drop=True)\n    \n  elif tie_break == 'above':\n    df = df[df.groupby(group_by_col)[reference_col].transform('max') == df[reference_col]].reset_index(drop=True)\n\n  df = df.drop('ref_diff', axis=1)\n\n  df = df\\\n    .rename(columns={value_col: \"value\"})\n\n\n  return df\n\n\n\n\n# Merge matches for different reference points\ndef merge_two_ref_matches(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n# Make sure the pair of reference values are in ascending order\n  reference_vals.sort()\n\n# Maximise distance between two refs by settling tie-breaks below the lowest ref and above the highest ref \n\n# Find matches for lower reference value\n  lower_ref_matches = closest_to_reference(df, reference_vals[0], max_dist_from_refs, reference_col, group_by_col, value_col, 'below')\n\n# Find matches for higher reference value\n  higher_ref_matches = closest_to_reference(df, reference_vals[1], max_dist_from_refs, reference_col, group_by_col, value_col, 'above')\n\n# Merge the two sets of matches\n  merged_df = pd.merge(lower_ref_matches, higher_ref_matches, on=group_by_col, suffixes=(reference_vals[0], reference_vals[1]))\n\n# Drop obs that do not have data for both ref values\n  merged_df = merged_df.dropna()\n\n# Drop obs where the matched data does not meet the min distance requirement\n  if not pd.isna(min_dist_between):\n  \n  # Store the names of the reference column returned from the two matches\n    ref_var_high = f'{reference_col}{reference_vals[1]}'\n    ref_var_low = f'{reference_col}{reference_vals[0]}'\n\n  # Keep only rows >= to the min distance\n    merged_df = merged_df.loc[(merged_df[ref_var_high] - merged_df[ref_var_low]) >= min_dist_between, :]\n\n\n\n  return merged_df\n\n\n\n  # For PIP run this three times – first filtering data for just consumpion only, then with income only, then with a dataset that prefers income over consumption\ndef pip_welfare_routine(df, reference_vals, max_dist_from_refs, min_dist_between, reference_col, group_by_col, value_col):\n\n  # Specify the name of the column in which the income/consumption welfare definition is stored\n  welfare_colname = 'welfare_type'\n\n  # Creat dataframes for thee scenarios:\n  # Scenario 1: only allow income data\n  df_inc_filter = df.loc[df[welfare_colname] == \"income\", :]\n  df_inc_filter.name = \"Income\"\n\n  # Scenario 2: only allow consumption data\n  df_cons_filter = df.loc[df[welfare_colname] == \"consumption\", :]\n  df_cons_filter.name = \"Consumption\"\n  # Scenario 3: allow a mix – dropping consumption data where income data is available in the same year\n  df_mixed = df.copy()\n\n  df_mixed['welfare_count'] = df_mixed.groupby([reference_col, group_by_col])[welfare_colname].transform('count')\n\n  df_mixed = df_mixed.loc[(df_mixed['welfare_count'] == 1) | (df_mixed[welfare_colname] == \"income\")]\n\n  df_mixed.name = \"Mixed\"\n  #  Store the scneario dataframes in a list\n  df_scenarios = [df_inc_filter, df_cons_filter, df_mixed]\n\n  # Run the matching function on each scenario\n  scenario_matches = [merge_two_ref_matches(\n    df_scenario, \n    reference_vals, \n    max_dist_from_refs, \n    min_dist_between, \n    reference_col, \n    group_by_col, \n    value_col) for df_scenario in df_scenarios]\n  \n  # Combine the first two scenarios.\n  df_combined_matches = pd.concat([scenario_matches[0], scenario_matches[1]], keys=[df_scenarios[0].name, df_scenarios[1].name])\n\n  # Tidy up indexes\n  df_combined_matches = df_combined_matches.reset_index()\n  \n  df_combined_matches = df_combined_matches.drop('level_1', axis=1)\n\n  df_combined_matches = df_combined_matches\\\n    .rename(columns={\"level_0\": \"pip_welfare\"})\n\n  # Add in third scenario.\n  df_combined_matches = pd.concat([df_combined_matches, scenario_matches[2]])\n\n  # add scenario name to te pip_welfare column\n  df_combined_matches['pip_welfare'] = df_combined_matches['pip_welfare'].fillna(df_scenarios[2].name)\n\n  # Keep only one match per group (e.g. per Country) - in the priority laid out in the df_scenarios list above (income only -> consumption only -> mixed)\n    # First count the matches\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n    # Then drop any matches from the lowest priority where there are multiple matches\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[2].name)]\n    #  Repeat at the next level of priority\n  df_combined_matches['match_count'] = df_combined_matches.groupby(group_by_col)['pip_welfare'].transform('count')\n  df_combined_matches = df_combined_matches.loc[(df_combined_matches['match_count']==1) | ~(df_combined_matches['pip_welfare']==df_scenarios[1].name)]\n  \n  # Drop the match count column\n  df_combined_matches = df_combined_matches.drop('match_count', axis=1)\n\n\n  return df_combined_matches\n\n\n\n\ndef prep_selected_vars(selected_vars):\n\n  # selected_vars = [\n  #   'LIS: Top_10_share_equiv_market',\n  #   'WID: Bottom_50_share_posttax_dis',\n  #   'PIP: Top_10_share']\n\n  selected_sources = [var.split(sep, 1)[0] for var in selected_vars]\n  selected_var_names = [var.split(sep, 1)[1] for var in selected_vars]\n\n\n  match_data = {\n    \"sources\": selected_sources,\n    \"var_names\": selected_var_names\n          }\n\n\n  return match_data\n\n\n\n\n# Specify the tolerances for each kind of metric\ndef return_tolerance_for_var(var):\n\n  if 'Gini' in var:\n    tolerance = 1\n\n  elif 'Top_10_share' in var:\n    tolerance = 1\n\n  elif 'Bottom_50_share' in var:\n    tolerance = 1\n\n  else:\n    tolerance = None\n\n  return tolerance\n\n\n\n\n\ndef prep_data(\n      data_to_match,\n      reference_vals,\n      max_dist_from_refs,\n      min_dist_between,\n      all_metrics_requirement,\n      reference_col,\n      group_by_col,\n      outlier_cut_off_upper):\n\n  # Combine the source and varname strings element-wise to produce keys that will be used for the concat later\n  source_var_keys = [i + j for i, j in zip(data_to_match[\"sources\"], data_to_match[\"var_names\"])]\n\n  matches = []\n\n  for i in range(len(data_to_match['sources'])):\n    \n    source = data_to_match[\"sources\"][i]\n    var = data_to_match[\"var_names\"][i]\n\n    tolerance = return_tolerance_for_var(\n      data_to_match[\"var_names\"][i]\n    )\n\n    df = data[source]\n\n    if source == \"PIP\":\n\n      matched = pip_welfare_routine(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    else:\n\n      matched = merge_two_ref_matches(\n          df = df,\n          reference_vals = reference_vals,\n          max_dist_from_refs = max_dist_from_refs,\n          min_dist_between = min_dist_between,\n          reference_col = reference_col,\n          group_by_col = group_by_col,\n          value_col = var\n        )\n\n    matches.append(matched)\n\n\n  plot_data = pd.concat(matches, keys=source_var_keys)\n\n  # Tidy up indexes\n  plot_data = plot_data.reset_index()\n  \n  plot_data = plot_data.drop('level_1', axis=1)\n\n  plot_data = plot_data\\\n    .rename(columns={\"level_0\": \"source_var\"})\n\n\n\n\n  # Store the names of the columns to be used onthe X and Y axis\n  x_axis = f'value{reference_vals[0]}'\n  y_axis = f'value{reference_vals[1]}'\n\n  x_ref_val = f'{reference_col}{reference_vals[0]}'\n  y_ref_val = f'{reference_col}{reference_vals[1]}'\n\n\n  # Apply outlier cut off, if specified\n  if not pd.isna(outlier_cut_off_upper):\n    plot_data = plot_data.loc[plot_data[x_axis] <= outlier_cut_off_upper]\n    plot_data = plot_data.loc[plot_data[y_axis] <= outlier_cut_off_upper]\n\n\n  # Add a count by country – counting whether data is available from each source or not\n  plot_data['source_count'] = plot_data.groupby(group_by_col)['source_var'].transform('count')\n\n\n  # Apply metrics requirement (whether to include only observations with data from all metrics)\n  if all_metrics_requirement:\n    plot_data = plot_data.loc[plot_data['source_count'] == plot_data['source_count'].max()]\n\n  # Drop source_count column\n  plot_data = plot_data.drop('source_count', axis=1)\n\n  # Add in region classification\n  plot_data = pd.merge(plot_data, df_regions, how = 'left')\n\n  # Add in population data\n    # For first ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[0], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref1'})\n\n    # For second ref\n  df_pop_ref = df_pop.loc[df_pop['Year'] == reference_vals[1], ['Entity', 'population'] ]\n\n  plot_data = pd.merge(plot_data, df_pop_ref, how = 'left')\n\n  plot_data = plot_data.rename(columns={'population':'population_ref2'})\n\n    # Calculate average population two reference periods\n  plot_data['avg_pop'] = (plot_data['population_ref1'] + plot_data['population_ref2'])/2\n\n\n\n  #  PREP SUMMARY TABLE\n\n\n  # Calculate the change between the two ref periods\n  plot_data['change'] = (plot_data[y_axis] - plot_data[x_axis])\n\n\n  group_yes_vars = ['source_var', region_col]\n  group_no_vars = ['source_var']\n\n  group_scenarios = [group_no_vars, group_yes_vars] \n\n  aggs = []\n  \n  for group_vars in group_scenarios:\n  \n  # Prepare pop-weighted average change\n    agg_level = plot_data.copy()\n\n    # Calulate pop weights by source and region\n    agg_level['regional_pop_weights'] = agg_level.groupby(group_vars)['avg_pop'].transform(lambda x: x/x.sum()) \n\n    agg_level['global_pop_weights'] = agg_level.groupby('source_var')['avg_pop'].transform(lambda x: x/x.sum()) \n\n    # Multiply the change by the pop weights \n    agg_level['region_weighted_change'] = agg_level['change'] * agg_level['regional_pop_weights']\n\n\n  # Prepare fall/stable/rise categories\n    agg_level['fall'] = agg_level['change'] < -tolerance\n\n    agg_level['stable'] = (agg_level['change'] <= tolerance) & (agg_level['change'] >= -tolerance)\n\n    agg_level['rise'] = agg_level['change'] > tolerance\n\n    agg_level[['fall', 'stable', 'rise']] = agg_level[['fall', 'stable', 'rise']].astype(int)\n\n    agg_level = agg_level.groupby(group_vars)[['change', 'region_weighted_change', 'global_pop_weights', 'fall', 'stable', 'rise']]\\\n      .agg(['sum', 'mean', 'count'])\n\n  # Aggregate by source and region\n    if group_vars == group_yes_vars:\n\n      agg_level = agg_level\\\n        .unstack().T.reset_index()\n\n    elif group_vars == group_no_vars: \n\n      agg_level = agg_level\\\n        .T.reset_index()\n\n      agg_level[region_col] = \"World\"\n\n    aggs.append(agg_level) \n\n  \n  df_summary = pd.concat(aggs)\n\n    # filter for the aggregations we need and label in the 'summary' column\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'mean'), 'summary'] = 'avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'region_weighted_change') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Regional pop-weighted avg change'\n\n  df_summary.loc[(df_summary['level_0'] == 'global_pop_weights') & (df_summary['level_1'] == 'sum'), 'summary'] = 'Global pop weights'\n\n  df_summary.loc[(df_summary['level_0'] == 'change') & (df_summary['level_1'] == 'count'), 'summary'] = 'n'\n\n  df_summary.loc[(df_summary['level_0'] == 'fall') & (df_summary['level_1'] == 'sum'), 'summary'] = 'fall'\n\n  df_summary.loc[(df_summary['level_0'] == 'stable') & (df_summary['level_1'] == 'sum'), 'summary'] = 'stable'\n\n  df_summary.loc[(df_summary['level_0'] == 'rise') & (df_summary['level_1'] == 'sum'), 'summary'] = 'rise'\n\n  df_summary = df_summary[df_summary['summary'].notnull()]\n\n\n  df_summary = df_summary.drop(['level_0', 'level_1'], axis = 1)\n\n\n  df_summary['summary'] = pd.Categorical(df_summary['summary'], categories=['fall', 'stable', 'rise','n', 'avg change', 'Regional pop-weighted avg change', 'Global pop weights'], ordered=True)\n\n\n  df_summary = df_summary.sort_values([region_col,'summary']).set_index([region_col,'summary'])\n  \n  \n  # format to show appropriate d.p. I run a loop over each row for want of figuring out a better way!\n  repeat_length = 7\n  for i in range(0, len(df_summary.index.levels[0].unique())):\n    df_summary.iloc[i*repeat_length,:] = df_summary.iloc[i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[1 + i*repeat_length,:] = df_summary.iloc[1 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[2 + i*repeat_length,:] = df_summary.iloc[2 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[3 + i*repeat_length,:] = df_summary.iloc[3 + i*repeat_length,:].map('{:.0f}'.format)\n    df_summary.iloc[4 + i*repeat_length,:] = df_summary.iloc[4 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[5 + i*repeat_length,:] = df_summary.iloc[5 + i*repeat_length,:].map('{:.2f}'.format)\n    df_summary.iloc[6 + i*repeat_length,:] = df_summary.iloc[6 + i*repeat_length,:].map('{:.2f}'.format)\n  \n  return plot_data, df_summary\n\n\n#  ---------------------------------\n#  ---------- SECTION 2: Specifications -------------\n#  ----------------------------------\n# These parameters are not controlled in the app.\n\nreference_col = 'Year'\ngroup_by_col = 'Entity'\n\noutlier_cut_off_upper = None\nregion_col = 'region_alt'\n\n\n#  ---------------------------------\n#  ---------- SECTION 3: Read in data -------------\n#  ----------------------------------\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/pip.csv'\n        \ndf_pip = pd.read_csv(url)\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/wid.csv'\n\ndf_wid = pd.read_csv(url)\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/lis.csv'\n\ndf_lis = pd.read_csv(url)\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/region_mapping.csv'\n\ndf_regions = pd.read_csv(url)\n\n\nurl = 'https://raw.githubusercontent.com/JoeHasell/personal_site/main/PhD_pages/data_appendices/data/clean/population.csv'\n\ndf_pop = pd.read_csv(url)\n\n\n#  ---------------------------------\n#  ---------- SECTION 4: Gather data into dictionary and collete varnames -------------\n#  ----------------------------------\n\ndata = {\"PIP\": df_pip,\n        \"WID\": df_wid,\n        \"LIS\": df_lis}\n\n# make an empty list to add all the varnames\nall_vars = list()\n\n# A string to use to separate the source name from the var name\nsep = \": \"\n\n# for each df in 'data'\nfor k,v in data.items():\n  \n  # make a list of varnames\n  vars = list(v.columns)\n\n  # remove the id cols\n  vars.remove(reference_col)\n  vars.remove(group_by_col)\n\n  # append the name of the source (the key of 'data') at the front\n  vars = [f'{k}{sep}' + var for var in vars]\n\n  # append to the running list\n  all_vars = all_vars + vars\n\nWe don’t run this reactive step in the testing. We just run the prep data function in the plot and table functions below.\n\n# def reactive_data():\n\n#   # For testing we define manually, rather than picked up from the app inputs\n#   data_to_match = prep_selected_vars(input.metrics())\n\n#   reference_vals = list(input.reference_vals())\n\n#   max_dist_from_refs = input.max_dist_from_refs()\n#   min_dist_between = input.min_dist_between()\n#   all_metrics_requirement = input.all_metrics_requirement()\n\n\n\n#   prepped_data = prep_data(\n#       data_to_match = data_to_match,\n#       reference_vals = reference_vals,\n#       max_dist_from_refs = max_dist_from_refs,\n#       min_dist_between = min_dist_between,\n#       all_metrics_requirement = all_metrics_requirement,\n#       reference_col = reference_col,\n#       group_by_col = group_by_col,\n#       tolerance = tolerance,\n#       outlier_cut_off_upper = outlier_cut_off_upper)\n\n#   return prepped_data\n\n\ndef interactive_plot(\n  selected_vars,\n  reference_vals,\n  max_dist_from_refs,\n  min_dist_between,\n  all_metrics_requirement):\n\n  data_to_match = prep_selected_vars(selected_vars)\n\n  prepped_data = prep_data(\n      data_to_match = data_to_match,\n      reference_vals = reference_vals,\n      max_dist_from_refs = max_dist_from_refs,\n      min_dist_between = min_dist_between,\n      all_metrics_requirement = all_metrics_requirement,\n      reference_col = reference_col,\n      group_by_col = group_by_col,\n      outlier_cut_off_upper = outlier_cut_off_upper)\n\n  plot_data = prepped_data[0]\n\n  fig = px.scatter(\n    plot_data, \n    x=f'value{reference_vals[0]}', \n    y=f'value{reference_vals[1]}',\n    color=region_col, \n    facet_col='source_var', \n    facet_col_wrap=1, \n    size='avg_pop',\n    hover_name=group_by_col,\n    hover_data={\n      f'value{reference_vals[0]}':':.2f',\n      f'{reference_col}{reference_vals[0]}':True,\n      f'value{reference_vals[1]}':':.2f',\n      f'{reference_col}{reference_vals[1]}':True,\n      region_col: True,\n      'avg_pop': False,\n      'source_var': False},\n      height=1000\n    )\n\n\n  fig.update_layout(legend=dict(\n      orientation=\"h\",\n      yanchor=\"bottom\",\n      y=1.02,\n      xanchor=\"right\",\n      x=1\n  ))\n\n  fig.for_each_annotation(lambda a: a.update(text=a.text.split(\"=\",1)[1]))\n\n  fig.update_layout(\n      legend_title=\"\"\n  )\n\n\n\n  return fig\n\n\ndef table_test(selected_vars,\n  reference_vals,\n  max_dist_from_refs,\n  min_dist_between,\n  all_metrics_requirement):\n\n  data_to_match = prep_selected_vars(selected_vars)\n\n  prepped_data = prep_data(\n    data_to_match = data_to_match,\n    reference_vals = reference_vals,\n    max_dist_from_refs = max_dist_from_refs,\n    min_dist_between = min_dist_between,\n    all_metrics_requirement = all_metrics_requirement,\n    reference_col = reference_col,\n    group_by_col = group_by_col,\n    outlier_cut_off_upper = outlier_cut_off_upper)\n\n\n  summary = prepped_data[1].reset_index()\n  \n  return summary\n\n\nfig = interactive_plot(\n  selected_vars = [\n      'WID: Top_10_share_pretax',\n      'PIP: Top_10_share'],\n  reference_vals = [1990,2015],\n  max_dist_from_refs = 5,\n  min_dist_between = 10,\n  all_metrics_requirement = True\n)\n\nfig.show()\n\n\n                                                \n\n\n\nsummary_table = table_test(\n  selected_vars = [\n      'WID: Top_10_share_pretax',\n      'PIP: Top_10_share'],\n  reference_vals = [1990,2015],\n  max_dist_from_refs = 5,\n  min_dist_between = 10,\n  all_metrics_requirement = True\n)\n\nsummary_table\n\n\n\n\n\n  \n    \n      source_var\n      region_alt\n      summary\n      PIPTop_10_share\n      WIDTop_10_share_pretax\n    \n  \n  \n    \n      0\n      East Asia\n      fall\n      0\n      0\n    \n    \n      1\n      East Asia\n      stable\n      2\n      1\n    \n    \n      2\n      East Asia\n      rise\n      1\n      2\n    \n    \n      3\n      East Asia\n      n\n      3\n      3\n    \n    \n      4\n      East Asia\n      avg change\n      1.74\n      7.34\n    \n    \n      5\n      East Asia\n      Regional pop-weighted avg change\n      3.57\n      10.78\n    \n    \n      6\n      East Asia\n      Global pop weights\n      0.26\n      0.26\n    \n    \n      7\n      Eastern Europe & Central Asia\n      fall\n      4\n      1\n    \n    \n      8\n      Eastern Europe & Central Asia\n      stable\n      2\n      0\n    \n    \n      9\n      Eastern Europe & Central Asia\n      rise\n      8\n      13\n    \n    \n      10\n      Eastern Europe & Central Asia\n      n\n      14\n      14\n    \n    \n      11\n      Eastern Europe & Central Asia\n      avg change\n      0.52\n      9.79\n    \n    \n      12\n      Eastern Europe & Central Asia\n      Regional pop-weighted avg change\n      -3.16\n      12.86\n    \n    \n      13\n      Eastern Europe & Central Asia\n      Global pop weights\n      0.07\n      0.07\n    \n    \n      14\n      MENA\n      fall\n      5\n      5\n    \n    \n      15\n      MENA\n      stable\n      0\n      1\n    \n    \n      16\n      MENA\n      rise\n      2\n      1\n    \n    \n      17\n      MENA\n      n\n      7\n      7\n    \n    \n      18\n      MENA\n      avg change\n      -3.50\n      -4.42\n    \n    \n      19\n      MENA\n      Regional pop-weighted avg change\n      -2.42\n      -3.73\n    \n    \n      20\n      MENA\n      Global pop weights\n      0.05\n      0.05\n    \n    \n      21\n      North America & Oceania\n      fall\n      0\n      0\n    \n    \n      22\n      North America & Oceania\n      stable\n      0\n      0\n    \n    \n      23\n      North America & Oceania\n      rise\n      3\n      3\n    \n    \n      24\n      North America & Oceania\n      n\n      3\n      3\n    \n    \n      25\n      North America & Oceania\n      avg change\n      2.00\n      6.64\n    \n    \n      26\n      North America & Oceania\n      Regional pop-weighted avg change\n      2.78\n      6.74\n    \n    \n      27\n      North America & Oceania\n      Global pop weights\n      0.07\n      0.07\n    \n    \n      28\n      South & South-East Asia\n      fall\n      5\n      5\n    \n    \n      29\n      South & South-East Asia\n      stable\n      1\n      1\n    \n    \n      30\n      South & South-East Asia\n      rise\n      5\n      5\n    \n    \n      31\n      South & South-East Asia\n      n\n      11\n      11\n    \n    \n      32\n      South & South-East Asia\n      avg change\n      -0.05\n      1.03\n    \n    \n      33\n      South & South-East Asia\n      Regional pop-weighted avg change\n      1.69\n      12.37\n    \n    \n      34\n      South & South-East Asia\n      Global pop weights\n      0.39\n      0.39\n    \n    \n      35\n      Sub-Saharan Africa\n      fall\n      12\n      12\n    \n    \n      36\n      Sub-Saharan Africa\n      stable\n      1\n      1\n    \n    \n      37\n      Sub-Saharan Africa\n      rise\n      6\n      6\n    \n    \n      38\n      Sub-Saharan Africa\n      n\n      19\n      19\n    \n    \n      39\n      Sub-Saharan Africa\n      avg change\n      -4.35\n      -3.95\n    \n    \n      40\n      Sub-Saharan Africa\n      Regional pop-weighted avg change\n      -3.69\n      -2.85\n    \n    \n      41\n      Sub-Saharan Africa\n      Global pop weights\n      0.10\n      0.10\n    \n    \n      42\n      Western Europe\n      fall\n      5\n      2\n    \n    \n      43\n      Western Europe\n      stable\n      0\n      2\n    \n    \n      44\n      Western Europe\n      rise\n      9\n      10\n    \n    \n      45\n      Western Europe\n      n\n      14\n      14\n    \n    \n      46\n      Western Europe\n      avg change\n      0.85\n      2.91\n    \n    \n      47\n      Western Europe\n      Regional pop-weighted avg change\n      0.74\n      2.48\n    \n    \n      48\n      Western Europe\n      Global pop weights\n      0.06\n      0.06\n    \n    \n      49\n      World\n      fall\n      31\n      25\n    \n    \n      50\n      World\n      stable\n      6\n      6\n    \n    \n      51\n      World\n      rise\n      34\n      40\n    \n    \n      52\n      World\n      n\n      71\n      71\n    \n    \n      53\n      World\n      avg change\n      -1.09\n      1.76\n    \n    \n      54\n      World\n      Regional pop-weighted avg change\n      1.13\n      8.60\n    \n    \n      55\n      World\n      Global pop weights\n      1.00\n      1.00"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/paper1.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/paper1.html",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "",
    "text": "Load packages\n\n\n\n\n\n\nlibrary(tidyverse)\n\nWarning: package 'tidyverse' was built under R version 4.1.2\n\n\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──✔ ggplot2 3.3.5      ✔ purrr   0.3.4 \n✔ tibble  3.1.6      ✔ dplyr   1.0.10\n✔ tidyr   1.2.0      ✔ stringr 1.4.0 \n✔ readr   2.1.2      ✔ forcats 0.5.1 \n\n\nWarning: package 'tidyr' was built under R version 4.1.2\n\n\nWarning: package 'readr' was built under R version 4.1.2\n\n\nWarning: package 'dplyr' was built under R version 4.1.2\n\n\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n\nlibrary(knitr)\nlibrary(data.table)\n\n\nAttaching package: 'data.table'\n\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n\nThe following object is masked from 'package:purrr':\n\n    transpose\nWhat has happened to inequality within countries over the past generation?"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/paper1.html#data-sources",
    "href": "PhD_pages/Paper_1_within_country_ineq/paper1.html#data-sources",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "Data sources",
    "text": "Data sources\n\nPIP\n\n\nWID\n\n\nLIS\n\n\nCoverage\nGive an overview of coverage in each dataset."
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/paper1.html#comparing-databases",
    "href": "PhD_pages/Paper_1_within_country_ineq/paper1.html#comparing-databases",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "Comparing databases",
    "text": "Comparing databases\n\nComparing metrics\nDoes it make a difference whether we look at Gini or top 10%?\nPeople worry about whether Gini masks what’s happening at the top.\nEmpirically: - Make a linear model of top 10% on Gini, for each source separately - Make predicted top 10% - Take a look at the R2 - Investigate individual countries with very poor predictions\nSub-Saharan Africa: example where the Gini fell in more cases than the top 10%.\n\n\nSince 1990\nSimilarities:\nConvergence – Smaller rises in coutries that started out with high inequality. Driven regionally. (We could do a test for this.)\nIndeed for some regions very similar picture:\n- MENA - Roughly 2 point fall, both Gini and top 10%. Only one country with a rise: Not total agreeement on coverage (one country either side)\n\n- South and South East Asia – Very similar not weighting by population. But wildly different when weighting by population, due to the much much stronger rise\n\n-  Sub-Saharan Afric – Very similar across sources. Top 10: Roughly even mix of rises and falling countries, but with a 3 point fall on average. Gini: More falls, 5 point on average. (Mention data quality issues: e.g. Kenya big fall. Lesoto big fall. But how comparable are the surveys?? Same surveys underlie WID...)\n\n- Western Europe – Rises in a majority of countries, but relatively moderate of 1-2 points (Whether Gini of top 10).\nDifferences:\nVerry different bottom line at the global level:\n\nPIP: roughly equal numbers falling and rising. 0 average change – though a modest rise when pop weighted (2 points). Same whether Gini or Top 10. That’s without LAtin America (Which WID is missing). Includung LatAm tips nudges it (with about a 1 point fall unweighter and 1 point rise weighted)\nWID: Far more countries with rising inequality. On average a 3 point rise (whether top 10 or Gini) – [Better to express these relative to the level of ineq. i.e. % increase rather than % point increase? A point rise means ‘less’ in WID terms because inequality levels are much higher.] But the most stark difference comes when we weight by population. Some key populous countries: India, China, US?, Indonesia? Russia"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/paper1.html#that-difference-is-driven-by-particular-regions",
    "href": "PhD_pages/Paper_1_within_country_ineq/paper1.html#that-difference-is-driven-by-particular-regions",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "That difference is driven by particular regions:",
    "text": "That difference is driven by particular regions:\nMore countries with rises. LArger rises. Especially larger populations. Average view very different:\nCountries where the sources paint a radically different picture that affect the aggregate results:\n\nIndia: Insane rise in WID 34->56\nChina:\nRussia: Massive drop in PIP. Insane rise in WID.\nUSA: Much larger rise in WID.\n\nWhat explains the different trends in these countries? (We can maybe look in more detail, at different welfare concepts etc.)\nIt sometimes goes the other way: Indonesia – Rise in PIP, fall in WID.\n:::\n\nMethod 2: Use a regression to obtain the time trend\n\n\nResults for a range of inequality metrics\n::: {.callout-note collapse=“true” appearance=“minimal”} ## Calculations for comparisons"
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/paper1.html#explaining-differences-between-pip-and-wid-data",
    "href": "PhD_pages/Paper_1_within_country_ineq/paper1.html#explaining-differences-between-pip-and-wid-data",
    "title": "Paper 1: Triangulating trends in inequality around the world from secondary databases",
    "section": "Explaining differences between PIP and WID data",
    "text": "Explaining differences between PIP and WID data\n\nFor a subset of countries we can bridge between the PIP and WID data\nBesides the underlying data sources, there are many differences between what is being measured in the PIP and WID data - notably the welfare concept and unit of analysis/equivalization.\nIn order to get a better understanding of where differences between the datasets arise, for a subset of countries we can bridge between the two somewhat. For example:\n\nWID has post-tax income series for some countries\nWe can use LIS to look at how changing the welfare concept, unit of analysis, equivalisation affects things. (For equivalisation, we could also possibly use the newly available PIP harmonized microdata).\n\n\n\nMore in-depth discussion of particular outliers\n\nRussia is a very notable case where the two datasets tell very different stories."
  },
  {
    "objectID": "PhD_pages/Paper_1_within_country_ineq/Presentation_INET_16_feb_inequality_around_the_world.html",
    "href": "PhD_pages/Paper_1_within_country_ineq/Presentation_INET_16_feb_inequality_around_the_world.html",
    "title": "Triangulating a global view on inequality",
    "section": "",
    "text": "UN summary of inequality trends"
  }
]